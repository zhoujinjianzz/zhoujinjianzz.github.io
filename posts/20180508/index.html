<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Android N Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL &amp;&amp; OpenGL | zhoujinjian</title><meta name="keywords" content="Android,Graphics,Display"><meta name="author" content="zhoujinjian"><meta name="copyright" content="zhoujinjian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="æ³¨ï¼šæ–‡ç« éƒ½æ˜¯é€šè¿‡é˜…è¯»å„ä½å‰è¾ˆæ€»ç»“çš„èµ„æ–™ã€Android 7.1.2 &amp;&amp; Linuxï¼ˆkernel 3.18ï¼‰Qualcommå¹³å°æºç ã€åŠ ä¸Šè‡ªå·±çš„æ€è€ƒåˆ†ææ€»ç»“å‡ºæ¥çš„ï¼Œå…¶ä¸­éš¾å…æœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚æ–‡ç« ä¸ºä¸ªäººå­¦ä¹ ã€ç ”ç©¶ã€æ¬£èµä¹‹ç”¨ï¼Œå›¾æ–‡å†…å®¹æ•´ç†è‡ªäº’è”ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œç¦æ­¢è½¬è½½ï¼ˆÂ©Qualcomm Technologies, Inc. ç‰ˆæƒæ‰€æœ‰ï¼‰ï¼Œè°¢è°¢ã€‚ ã€ç‰¹åˆ«æ„Ÿ">
<meta property="og:type" content="article">
<meta property="og:title" content="Android N Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL &amp;&amp; OpenGL">
<meta property="og:url" content="https://zhoujinjian.com/posts/20180508/index.html">
<meta property="og:site_name" content="zhoujinjian">
<meta property="og:description" content="æ³¨ï¼šæ–‡ç« éƒ½æ˜¯é€šè¿‡é˜…è¯»å„ä½å‰è¾ˆæ€»ç»“çš„èµ„æ–™ã€Android 7.1.2 &amp;&amp; Linuxï¼ˆkernel 3.18ï¼‰Qualcommå¹³å°æºç ã€åŠ ä¸Šè‡ªå·±çš„æ€è€ƒåˆ†ææ€»ç»“å‡ºæ¥çš„ï¼Œå…¶ä¸­éš¾å…æœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚æ–‡ç« ä¸ºä¸ªäººå­¦ä¹ ã€ç ”ç©¶ã€æ¬£èµä¹‹ç”¨ï¼Œå›¾æ–‡å†…å®¹æ•´ç†è‡ªäº’è”ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œç¦æ­¢è½¬è½½ï¼ˆÂ©Qualcomm Technologies, Inc. ç‰ˆæƒæ‰€æœ‰ï¼‰ï¼Œè°¢è°¢ã€‚ ã€ç‰¹åˆ«æ„Ÿ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.20.jpg">
<meta property="article:published_time" content="2018-05-08T01:25:00.000Z">
<meta property="article:modified_time" content="2024-04-14T13:01:32.952Z">
<meta property="article:author" content="zhoujinjian">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Graphics">
<meta property="article:tag" content="Display">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.20.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zhoujinjian.com/posts/20180508/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-14 21:01:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 5.0.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">104</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">13</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> åª’ä½“</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> ä¹¦å•</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/home/"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fab fa-safari"></i><span> å¯¼èˆª</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.20.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zhoujinjian</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> åª’ä½“</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> ä¹¦å•</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/home/"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fab fa-safari"></i><span> å¯¼èˆª</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">Android N Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL &amp;&amp; OpenGL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2018-05-08T01:25:00.000Z" title="å‘è¡¨äº 2018-05-08 09:25:00">2018-05-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-04-14T13:01:32.952Z" title="æ›´æ–°äº 2024-04-14 21:01:32">2024-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Display/">Display</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><hr>
<p>æ³¨ï¼šæ–‡ç« éƒ½æ˜¯é€šè¿‡é˜…è¯»å„ä½å‰è¾ˆæ€»ç»“çš„èµ„æ–™ã€Android 7.1.2 &amp;&amp; Linuxï¼ˆkernel 3.18ï¼‰Qualcommå¹³å°æºç ã€åŠ ä¸Šè‡ªå·±çš„æ€è€ƒåˆ†ææ€»ç»“å‡ºæ¥çš„ï¼Œå…¶ä¸­éš¾å…æœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚æ–‡ç« ä¸ºä¸ªäººå­¦ä¹ ã€ç ”ç©¶ã€æ¬£èµä¹‹ç”¨ï¼Œå›¾æ–‡å†…å®¹æ•´ç†è‡ªäº’è”ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œç¦æ­¢è½¬è½½ï¼ˆÂ©Qualcomm Technologies, Inc. ç‰ˆæƒæ‰€æœ‰ï¼‰ï¼Œè°¢è°¢ã€‚</p>
<p><a target="_blank" rel="noopener" href="http://www.kandroid.org/board/data/board/conference/file_in_body/1/3AndroidGraphicsAndAndroidEGL.pdf">ã€ç‰¹åˆ«æ„Ÿè°¢ - Android Graphics and Android EGLã€‘</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/jinzhuojun/article/details/17427491">ã€ç‰¹åˆ«æ„Ÿè°¢ - Android 4.4 (KitKat) Design Pattern-Graphics Subsystemã€‘</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/jinzhuojun/article/details/17293325">ã€ç‰¹åˆ«æ„Ÿè°¢ - Android 4.4 (KitKat) in virtualization VSync signalã€‘</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/yangwen123/article/details/22647255">ã€ç‰¹åˆ«æ„Ÿè°¢ - Androidæ˜¾ç¤ºç³»ç»Ÿè®¾è®¡æ¡†æ¶ä»‹ç»ã€‘</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/samchen2009/p/3367496.html">ã€ç‰¹åˆ«æ„Ÿè°¢ - å›¾è§£Android - Android GUI ç³»ç»Ÿ (2) - çª—å£ç®¡ç† (View, Canvas, Window Manager)ã€‘</a></p>
<p>Google Pixelã€Pixel XL å†…æ ¸ä»£ç ï¼ˆæ–‡ç« åŸºäº Kernel-3.18ï¼‰ï¼š<br> <a target="_blank" rel="noopener" href="https://github.com/matthewdalex/marlin">Kernel source for Pixel and Pixel XL - GitHub</a></p>
<p>AOSP æºç ï¼ˆæ–‡ç« åŸºäº Android 7.1.2ï¼‰ï¼š<br> <a target="_blank" rel="noopener" href="https://testerhome.com/topics/2229"> Android ç³»ç»Ÿå…¨å¥—æºä»£ç åˆ†äº« (æ›´æ–°åˆ° 8.1.0_r1)</a></p>
<p> ğŸŒ€ğŸŒ€ï¼šä¸“æ³¨äºLinux &amp;&amp; Android Multimediaï¼ˆCameraã€Videoã€Audioã€Displayï¼‰ç³»ç»Ÿåˆ†æä¸ç ”ç©¶</p>
<p>ã€Android Display System ç³»ç»Ÿåˆ†æç³»åˆ—ã€‘ï¼š<br>ã€Android Display Systemï¼ˆ1ï¼‰ï¼šAndroid 7.1.2 (Android N) Android Graphics ç³»ç»Ÿ åˆ†æã€‘<br>ã€Android Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL &amp;&amp; OpenGLã€‘<br>ã€Android Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æã€‘<br>ã€Android Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc &amp;&amp; HWComposeræ¨¡å—åˆ†æã€‘<br>ã€Android Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architectureã€‘</p>
<hr>
<blockquote>
<p><strong>Android EGLã€GLES_CMã€GLES2ï¼š</strong></p>
</blockquote>
<p>\frameworks\native\opengl\libs\EGL</p>
<ul>
<li>egl.cpp</li>
<li>egl_display.cpp</li>
<li>eglApi.cpp</li>
<li>Loader.cpp</li>
</ul>
<p>\frameworks\native\opengl\libs\GLES_CM</p>
<ul>
<li>gl.cpp</li>
<li>gl_api.in</li>
<li>glext_api.in</li>
</ul>
<p>\frameworks\native\opengl\libs\GLES2</p>
<ul>
<li>gl2.cpp</li>
<li>gl2_api.in</li>
<li>gl2ext_api.in</li>
</ul>
<blockquote>
<p><strong>OpenGL Native &amp;&amp; JNI ï¼š</strong></p>
</blockquote>
<p>\frameworks\base\core\jni\</p>
<ul>
<li>android_opengl_GLES10.cpp</li>
<li>android_opengl_GLES10Ext.cpp</li>
<li>android_opengl_GLES11.cpp</li>
<li>android_opengl_GLES11Ext.cpp</li>
<li>android_opengl_GLES20.cpp</li>
<li>android_opengl_GLES30.cpp</li>
<li>android_opengl_GLES31.cpp</li>
<li>android_opengl_GLES31Ext.cpp</li>
<li>android_opengl_GLES32.cpp</li>
<li>com_google_android_gles_jni_EGLImpl.cpp</li>
<li>com_google_android_gles_jni_GLImpl.cpp</li>
</ul>
<blockquote>
<p><strong>Opengl Javaï¼š</strong></p>
</blockquote>
<p>\frameworks\base\opengl\java\android\opengl</p>
<ul>
<li>GLES10.java</li>
<li>GLES10Ext.java</li>
<li>GLLogWrapper.java</li>
<li>GLSurfaceView.java</li>
<li>EGLDisplay.java</li>
<li>EGLConfig.java</li>
<li>EGLContext.java</li>
<li>EGLSurface.java</li>
</ul>
<p>\frameworks\base\opengl\java\javax\microedition\khronos\opengles</p>
<ul>
<li>GL10.java</li>
<li>GL11.java</li>
</ul>
<p>\frameworks\base\opengl\java\com\google\android\gles_jni</p>
<ul>
<li>GLImpl.java</li>
<li>EGLImpl.java</li>
<li>EGLConfigImpl.java</li>
<li>EGLContextImpl.java</li>
<li>EGLDisplayImpl.java</li>
</ul>
<hr>
<p>æ€»ä½“æ¶æ„ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-01-Android-Graphics-Architecture-EGL.png" alt="Alt text | center"></p>
<p><a target="_blank" rel="noopener" href="http://charlesvincent.cc/2018/02/01/Android-7-1-2-Android-N-Android-Graphics-%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90/">ã€Android Display Systemï¼ˆ1ï¼‰- Android Graphics ç³»ç»Ÿ åˆ†æã€‘</a><br>####ï¼ˆä¸€ï¼‰ã€ Android EGL åº”ç”¨å®ä¾‹</p>
<h5 id="1-1ã€Android-Graphics-æµ‹è¯•ç¨‹åº"><a href="#1-1ã€Android-Graphics-æµ‹è¯•ç¨‹åº" class="headerlink" title="1.1ã€Android Graphics æµ‹è¯•ç¨‹åº"></a>1.1ã€Android Graphics æµ‹è¯•ç¨‹åº</h5><p>é¦–å…ˆçœ‹ä¸€ä¸‹Androidæµ‹è¯•ç¨‹åºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒ\frameworks\native\services\surfaceflinger\tests\Transaction_test.cpp</span><br><span class="line">æ‹·è´åŒç›®å½•ä¸‹.mkæ–‡ä»¶pushåˆ°æ‰‹æœºè¿è¡Œå³å¯çœ‹åˆ°æ•ˆæœã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/native_window.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;binder/IMemory.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gui/ISurfaceComposer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gui/Surface.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gui/SurfaceComposerClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;private/gui/ComposerService.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;private/gui/LayerState.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utils/String8.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ui/DisplayInfo.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> android &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fill an RGBA_8888 formatted surface with a single color.</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fillSurfaceRGBA8</span><span class="params">(<span class="keyword">const</span> sp&lt;SurfaceControl&gt;&amp; sc,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">uint8_t</span> r, <span class="keyword">uint8_t</span> g, <span class="keyword">uint8_t</span> b)</span> </span>&#123;</span><br><span class="line">    ANativeWindow_Buffer outBuffer;</span><br><span class="line">    sp&lt;Surface&gt; s = sc-&gt;getSurface();</span><br><span class="line">    ASSERT_TRUE(s != <span class="literal">NULL</span>);</span><br><span class="line">    ASSERT_EQ(NO_ERROR, s-&gt;lock(&amp;outBuffer, <span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">uint8_t</span>* img = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">uint8_t</span>*&gt;(outBuffer.bits);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; outBuffer.height; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; outBuffer.width; x++) &#123;</span><br><span class="line">            <span class="keyword">uint8_t</span>* pixel = img + (<span class="number">4</span> * (y*outBuffer.stride + x));</span><br><span class="line">            pixel[<span class="number">0</span>] = r;</span><br><span class="line">            pixel[<span class="number">1</span>] = g;</span><br><span class="line">            pixel[<span class="number">2</span>] = b;</span><br><span class="line">            pixel[<span class="number">3</span>] = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ASSERT_EQ(NO_ERROR, s-&gt;unlockAndPost());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LayerTest</span> :</span> <span class="keyword">public</span> ::testing::Test &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mComposerClient = <span class="keyword">new</span> SurfaceComposerClient;</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mComposerClient-&gt;initCheck());</span><br><span class="line"></span><br><span class="line">        <span class="function">sp&lt;IBinder&gt; <span class="title">display</span><span class="params">(SurfaceComposerClient::getBuiltInDisplay(</span></span></span><br><span class="line"><span class="function"><span class="params">                ISurfaceComposer::eDisplayIdMain))</span></span>;</span><br><span class="line">        DisplayInfo info;</span><br><span class="line">        SurfaceComposerClient::getDisplayInfo(display, &amp;info);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">ssize_t</span> displayWidth = info.w;</span><br><span class="line">        <span class="keyword">ssize_t</span> displayHeight = info.h;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Background surface black</span></span><br><span class="line">        mBGSurfaceControl = mComposerClient-&gt;createSurface(</span><br><span class="line">                String8(<span class="string">&quot;BG Test Surface&quot;</span>), displayWidth, displayHeight<span class="number">-720</span>,</span><br><span class="line">                PIXEL_FORMAT_RGBA_8888, <span class="number">0</span>);</span><br><span class="line">        ASSERT_TRUE(mBGSurfaceControl != <span class="literal">NULL</span>);</span><br><span class="line">        ASSERT_TRUE(mBGSurfaceControl-&gt;isValid());</span><br><span class="line">        fillSurfaceRGBA8(mBGSurfaceControl, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Foreground surface red</span></span><br><span class="line">        mFGSurfaceControl = mComposerClient-&gt;createSurface(</span><br><span class="line">                String8(<span class="string">&quot;FG Test Surface&quot;</span>), <span class="number">360</span>, <span class="number">360</span>, PIXEL_FORMAT_RGBA_8888, <span class="number">0</span>);</span><br><span class="line">        ASSERT_TRUE(mFGSurfaceControl != <span class="literal">NULL</span>);</span><br><span class="line">        ASSERT_TRUE(mFGSurfaceControl-&gt;isValid());</span><br><span class="line"></span><br><span class="line">        fillSurfaceRGBA8(mFGSurfaceControl, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Foreground surface blue</span></span><br><span class="line">        mFGSurfaceControlBlue = mComposerClient-&gt;createSurface(</span><br><span class="line">                String8(<span class="string">&quot;FG Test Surface&quot;</span>), <span class="number">360</span>, <span class="number">360</span>, PIXEL_FORMAT_RGBA_8888, <span class="number">0</span>);</span><br><span class="line">        ASSERT_TRUE(mFGSurfaceControlBlue != <span class="literal">NULL</span>);</span><br><span class="line">        ASSERT_TRUE(mFGSurfaceControlBlue-&gt;isValid());</span><br><span class="line"></span><br><span class="line">        fillSurfaceRGBA8(mFGSurfaceControl, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Foreground surface green</span></span><br><span class="line">        mFGSurfaceControlGreen = mComposerClient-&gt;createSurface(</span><br><span class="line">                String8(<span class="string">&quot;FG Test Surface&quot;</span>), <span class="number">360</span>, <span class="number">360</span>, PIXEL_FORMAT_RGBA_8888, <span class="number">0</span>);</span><br><span class="line">        ASSERT_TRUE(mFGSurfaceControlGreen != <span class="literal">NULL</span>);</span><br><span class="line">        ASSERT_TRUE(mFGSurfaceControlGreen-&gt;isValid());</span><br><span class="line"></span><br><span class="line">        fillSurfaceRGBA8(mFGSurfaceControl, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Synchronization surface</span></span><br><span class="line">        mSyncSurfaceControl = mComposerClient-&gt;createSurface(</span><br><span class="line">                String8(<span class="string">&quot;Sync Test Surface&quot;</span>), <span class="number">1</span>, <span class="number">1</span>, PIXEL_FORMAT_RGBA_8888, <span class="number">0</span>);</span><br><span class="line">        ASSERT_TRUE(mSyncSurfaceControl != <span class="literal">NULL</span>);</span><br><span class="line">        ASSERT_TRUE(mSyncSurfaceControl-&gt;isValid());</span><br><span class="line"></span><br><span class="line">        fillSurfaceRGBA8(mSyncSurfaceControl, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//SurfaceComposerClient::openGlobalTransaction()</span></span><br><span class="line"></span><br><span class="line">        SurfaceComposerClient::openGlobalTransaction();</span><br><span class="line"></span><br><span class="line">        mComposerClient-&gt;setDisplayLayerStack(display, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//black</span></span><br><span class="line">        ASSERT_EQ(NO_ERROR, mBGSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-4</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mBGSurfaceControl-&gt;show());</span><br><span class="line">        <span class="comment">//red</span></span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-3</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;setPosition(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;show());</span><br><span class="line">        <span class="comment">//blue</span></span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControlBlue-&gt;setLayer(INT_MAX<span class="number">-2</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControlBlue-&gt;setPosition(<span class="number">360</span>, <span class="number">360</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControlBlue-&gt;show());</span><br><span class="line">        <span class="comment">//green</span></span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControlGreen-&gt;setLayer(INT_MAX<span class="number">-1</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControlGreen-&gt;setPosition(<span class="number">720</span>, <span class="number">720</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mFGSurfaceControlGreen-&gt;show());</span><br><span class="line"></span><br><span class="line">        ASSERT_EQ(NO_ERROR, mSyncSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-1</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mSyncSurfaceControl-&gt;setPosition(displayWidth<span class="number">-2</span>,</span><br><span class="line">                displayHeight<span class="number">-2</span>));</span><br><span class="line">        ASSERT_EQ(NO_ERROR, mSyncSurfaceControl-&gt;show());</span><br><span class="line"></span><br><span class="line">        SurfaceComposerClient::closeGlobalTransaction(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        waitForPostedBuffers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">TearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mComposerClient-&gt;dispose();</span><br><span class="line">        mBGSurfaceControl = <span class="number">0</span>;</span><br><span class="line">        mFGSurfaceControl = <span class="number">0</span>;</span><br><span class="line">        mSyncSurfaceControl = <span class="number">0</span>;</span><br><span class="line">        mComposerClient = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">waitForPostedBuffers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Since the sync surface is in synchronous mode (i.e. double buffered)</span></span><br><span class="line">        <span class="comment">// posting three buffers to it should ensure that at least two</span></span><br><span class="line">        <span class="comment">// SurfaceFlinger::handlePageFlip calls have been made, which should</span></span><br><span class="line">        <span class="comment">// guaranteed that a buffer posted to another Surface has been retired.</span></span><br><span class="line">        fillSurfaceRGBA8(mFGSurfaceControl, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        fillSurfaceRGBA8(mFGSurfaceControlBlue, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line">        fillSurfaceRGBA8(mFGSurfaceControlGreen, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">        fillSurfaceRGBA8(mSyncSurfaceControl, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sp&lt;SurfaceComposerClient&gt; mComposerClient;</span><br><span class="line">    sp&lt;SurfaceControl&gt; mBGSurfaceControl;</span><br><span class="line">    sp&lt;SurfaceControl&gt; mFGSurfaceControl;<span class="comment">//red</span></span><br><span class="line">    sp&lt;SurfaceControl&gt; mFGSurfaceControlBlue;</span><br><span class="line">    sp&lt;SurfaceControl&gt; mFGSurfaceControlGreen;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This surface is used to ensure that the buffers posted to</span></span><br><span class="line">    <span class="comment">// mFGSurfaceControl have been picked up by SurfaceFlinger.</span></span><br><span class="line">    sp&lt;SurfaceControl&gt; mSyncSurfaceControl;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">TEST_F(LayerTest, LayerWorks) &#123;</span><br><span class="line"></span><br><span class="line">    SurfaceComposerClient::openGlobalTransaction();</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;setPosition(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    SurfaceComposerClient::closeGlobalTransaction(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">    <span class="function">sp&lt;IBinder&gt; <span class="title">display</span><span class="params">(SurfaceComposerClient::getBuiltInDisplay(</span></span></span><br><span class="line"><span class="function"><span class="params">            ISurfaceComposer::eDisplayIdMain))</span></span>;</span><br><span class="line">    DisplayInfo info;</span><br><span class="line">    SurfaceComposerClient::getDisplayInfo(display, &amp;info);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">ssize_t</span> displayWidth = info.w;</span><br><span class="line">    <span class="keyword">ssize_t</span> displayHeight = info.h;</span><br><span class="line"></span><br><span class="line">    SurfaceComposerClient::openGlobalTransaction();</span><br><span class="line">    </span><br><span class="line">    mComposerClient-&gt;setDisplayLayerStack(display, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    ASSERT_EQ(NO_ERROR, mBGSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-4</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mBGSurfaceControl-&gt;show());</span><br><span class="line">    <span class="comment">//red</span></span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-3</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;setPosition(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControl-&gt;show());</span><br><span class="line">    <span class="comment">//blue</span></span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControlBlue-&gt;setLayer(INT_MAX<span class="number">-2</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControlBlue-&gt;setPosition(<span class="number">360</span>, <span class="number">360</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControlBlue-&gt;show());</span><br><span class="line">    <span class="comment">//green</span></span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControlGreen-&gt;setLayer(INT_MAX<span class="number">-1</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControlGreen-&gt;setPosition(<span class="number">720</span>, <span class="number">720</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mFGSurfaceControlGreen-&gt;show());</span><br><span class="line">    <span class="comment">//Sync</span></span><br><span class="line">    ASSERT_EQ(NO_ERROR, mSyncSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-1</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mSyncSurfaceControl-&gt;setPosition(displayWidth<span class="number">-2</span>,</span><br><span class="line">            displayHeight<span class="number">-2</span>));</span><br><span class="line">    ASSERT_EQ(NO_ERROR, mSyncSurfaceControl-&gt;show());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    SurfaceComposerClient::closeGlobalTransaction(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°æ•ˆæœï¼ˆä¿æŒè¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°ç•Œé¢æœ€é¡¶å±‚ä¼šç»˜åˆ¶é»‘è‰²èƒŒæ™¯å’Œçº¢ç»¿è“ä¸‰ä¸ªè‰²å—ï¼‰ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-02-Android-graphics-surface-test.gif" alt="Alt text | center"></p>
<p>å¯ä»¥çœ‹åˆ°æ¯”è¾ƒå…³é”®çš„ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºSurfaceComposerClient</span></span><br><span class="line">mComposerClient = <span class="keyword">new</span> SurfaceComposerClient;</span><br><span class="line">ASSERT_EQ(NO_ERROR, mComposerClient-&gt;initCheck());</span><br><span class="line"><span class="comment">//è·å–displayä¿¡æ¯</span></span><br><span class="line"><span class="function">sp&lt;IBinder&gt; <span class="title">display</span><span class="params">(SurfaceComposerClient::getBuiltInDisplay(</span></span></span><br><span class="line"><span class="function"><span class="params">        ISurfaceComposer::eDisplayIdMain))</span></span>;</span><br><span class="line">DisplayInfo info;</span><br><span class="line">SurfaceComposerClient::getDisplayInfo(display, &amp;info);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ssize_t</span> displayWidth = info.w;</span><br><span class="line"><span class="keyword">ssize_t</span> displayHeight = info.h;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Background surface black</span></span><br><span class="line"><span class="comment">//è¯·æ±‚SurfaceFlingeråˆ›å»ºSurface</span></span><br><span class="line">mBGSurfaceControl = mComposerClient-&gt;createSurface(</span><br><span class="line">        String8(<span class="string">&quot;BG Test Surface&quot;</span>), displayWidth, displayHeight<span class="number">-720</span>,</span><br><span class="line">        PIXEL_FORMAT_RGBA_8888, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¡«å……Surface</span></span><br><span class="line">fillSurfaceRGBA8(mBGSurfaceControl, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//è®¾ç½®Layerå±‚çº§</span></span><br><span class="line">ASSERT_EQ(NO_ERROR, mBGSurfaceControl-&gt;setLayer(INT_MAX<span class="number">-4</span>));</span><br><span class="line"><span class="comment">//SurfaceControl-&gt;show()æ˜¾ç¤ºsurface</span></span><br><span class="line">ASSERT_EQ(NO_ERROR, mBGSurfaceControl-&gt;show());</span><br></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†çš„åˆ†æè¯·å‚è€ƒ<a target="_blank" rel="noopener" href="http://charlesvincent.cc/2018/02/01/Android-7-1-2-Android-N-Android-Graphics-%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90/">ã€Android Display Systemï¼ˆ1ï¼‰- Android Graphics ç³»ç»Ÿ åˆ†æã€‘</a><br>æˆ‘ä»¬è¿™é‡Œä¸»è¦ä¸ºäº†å¼•å‡ºAndroidåº•å±‚å¦‚ä½•åˆ©ç”¨EGLç»˜å›¾ã€‚</p>
<h5 id="1-2ã€Android-BootAnimation-å¼€æœºåŠ¨ç”»-EGLåœ¨Androidä¸­åº”ç”¨"><a href="#1-2ã€Android-BootAnimation-å¼€æœºåŠ¨ç”»-EGLåœ¨Androidä¸­åº”ç”¨" class="headerlink" title="1.2ã€Android BootAnimation å¼€æœºåŠ¨ç”»(EGLåœ¨Androidä¸­åº”ç”¨)"></a>1.2ã€Android BootAnimation å¼€æœºåŠ¨ç”»(EGLåœ¨Androidä¸­åº”ç”¨)</h5><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-03-Android-boot-egl.png" alt="Alt text | center"></p>
<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\base\cmds\bootanimation\BootAnimation.cpp]</span><br><span class="line"><span class="function"><span class="keyword">status_t</span> <span class="title">BootAnimation::readyToRun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mAssets.addDefaultAssets();</span><br><span class="line">    <span class="function">sp&lt;IBinder&gt; <span class="title">dtoken</span><span class="params">(SurfaceComposerClient::getBuiltInDisplay(</span></span></span><br><span class="line"><span class="function"><span class="params">            ISurfaceComposer::eDisplayIdMain))</span></span>;</span><br><span class="line">    DisplayInfo dinfo;</span><br><span class="line">    <span class="keyword">status_t</span> status = SurfaceComposerClient::getDisplayInfo(dtoken, &amp;dinfo);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// create the native surface</span></span><br><span class="line">    sp&lt;SurfaceControl&gt; control = session()-&gt;createSurface(String8(<span class="string">&quot;BootAnimation&quot;</span>),</span><br><span class="line">            dinfo.w, dinfo.h, PIXEL_FORMAT_RGB_565);</span><br><span class="line"></span><br><span class="line">    SurfaceComposerClient::openGlobalTransaction();</span><br><span class="line">    control-&gt;setLayer(<span class="number">0x40000000</span>);</span><br><span class="line">    SurfaceComposerClient::closeGlobalTransaction();</span><br><span class="line"></span><br><span class="line">    sp&lt;Surface&gt; s = control-&gt;getSurface();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialize opengl and egl</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// (1)ã€è·å¾— EGLDisplay å¯¹è±¡ã€‚</span></span><br><span class="line">    EGLDisplay display = eglGetDisplay(EGL_DEFAULT_DISPLAY);</span><br><span class="line">    <span class="comment">// (2)ã€åˆå§‹åŒ– EGLDisplay å¯¹è±¡</span></span><br><span class="line">    eglInitialize(display, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// (3)ã€é€‰æ‹© EGLConfig</span></span><br><span class="line">    eglChooseConfig(display, attribs, &amp;config, <span class="number">1</span>, &amp;numConfigs);</span><br><span class="line">    <span class="comment">// (4)ã€åˆ›å»º Windows Surface</span></span><br><span class="line">    surface = eglCreateWindowSurface(display, config, s.get(), <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">// (5)ã€åˆ›å»º EGL context</span></span><br><span class="line">    context = eglCreateContext(display, config, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    eglQuerySurface(display, surface, EGL_WIDTH, &amp;w);</span><br><span class="line">    eglQuerySurface(display, surface, EGL_HEIGHT, &amp;h);</span><br><span class="line">    <span class="comment">// (6)ã€å¯ç”¨å‰é¢åˆ›å»ºçš„ EGL context</span></span><br><span class="line">    <span class="keyword">if</span> (eglMakeCurrent(display, surface, surface, context) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> NO_INIT;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BootAnimation::playAnimation</span><span class="params">(<span class="keyword">const</span> Animation&amp; animation)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">                <span class="comment">// (7)ã€OpenGL ES API ç»˜åˆ¶å›¾å½¢ï¼šgl_*()</span></span><br><span class="line">                glDrawTexiOES(xc, mHeight - (yc + frame.trimHeight),</span><br><span class="line">                              <span class="number">0</span>, frame.trimWidth, frame.trimHeight);</span><br><span class="line">                ......</span><br><span class="line">                <span class="comment">// (8)ã€SwapBuffersæ˜¾ç¤º</span></span><br><span class="line">                eglSwapBuffers(mDisplay, mSurface);</span><br><span class="line">                ......</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨EGLä¸€èˆ¬ä¼šç»å†ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤ã€‚</p>
<h5 id="1-2ã€Understanding-Android-Graphics-Internals"><a href="#1-2ã€Understanding-Android-Graphics-Internals" class="headerlink" title="1.2ã€Understanding Android Graphics Internals"></a>1.2ã€Understanding Android Graphics Internals</h5><p>è¦æ·±å…¥äº†è§£Android Graphicsæœºåˆ¶ï¼Œéœ€è¦äº†è§£ç†Ÿæ‚‰ä»¥ä¸‹çŸ¥è¯†ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºï¼‰ã€‚</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-04-understand-android-graphics-internals.png" alt="Alt text | center"></p>
<p>####ï¼ˆäºŒï¼‰ã€OpenGL ES 2.0 çŸ¥è¯†ä¸²è®²<br>åœ¨äº†è§£EGLä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹å‰äººæ€»ç»“çš„çŸ¥è¯†<a target="_blank" rel="noopener" href="http://geekfaner.com/shineengine/index.html">OPENGL ES 2.0 çŸ¥è¯†ä¸²è®²</a>ï¼š</p>
<h5 id="2-1ã€å†™åœ¨å‰é¢çš„è¯"><a href="#2-1ã€å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="2.1ã€å†™åœ¨å‰é¢çš„è¯"></a>2.1ã€å†™åœ¨å‰é¢çš„è¯</h5><h5 id="2-1-1ã€ç”µè„‘æ˜¯åšä»€ä¹ˆç”¨çš„"><a href="#2-1-1ã€ç”µè„‘æ˜¯åšä»€ä¹ˆç”¨çš„" class="headerlink" title="2.1.1ã€ç”µè„‘æ˜¯åšä»€ä¹ˆç”¨çš„?"></a>2.1.1ã€ç”µè„‘æ˜¯åšä»€ä¹ˆç”¨çš„?</h5><p>ç”µè„‘åˆè¢«ç§°ä¸ºè®¡ç®—æœº,é‚£ä¹ˆæœ€é‡è¦çš„å·¥ä½œå°±æ˜¯è®¡ç®—ã€‚çœ‹è¿‡ä¸‰ä½“çš„åŒå­¦éƒ½çŸ¥é“, ç”µè„‘ä¸­æœ‰æ— æ•°çº³ç±³çº§åˆ«çš„è®¡ç®—å•å…ƒ,é€šè¿‡ 0 å’Œ 1 çš„è½¬æ¢,å®ŒæˆåŠ å‡ä¹˜é™¤çš„æ“ä½œã€‚</p>
<h5 id="2-1-2ã€æ˜¯ä»€ä¹ˆä½¿å¾—ç”µè„‘å·¥ä½œ"><a href="#2-1-2ã€æ˜¯ä»€ä¹ˆä½¿å¾—ç”µè„‘å·¥ä½œ" class="headerlink" title="2.1.2ã€æ˜¯ä»€ä¹ˆä½¿å¾—ç”µè„‘å·¥ä½œ?"></a>2.1.2ã€æ˜¯ä»€ä¹ˆä½¿å¾—ç”µè„‘å·¥ä½œ?</h5><p>é©±åŠ¨,é©±ä½¿ç€ç¡¬ä»¶å®Œæˆå·¥ä½œã€‚</p>
<h5 id="2-1-3ã€è°æ¥å†™é©±åŠ¨"><a href="#2-1-3ã€è°æ¥å†™é©±åŠ¨" class="headerlink" title="2.1.3ã€è°æ¥å†™é©±åŠ¨?"></a>2.1.3ã€è°æ¥å†™é©±åŠ¨?</h5><p>åˆ¶é€ ç”µè„‘çš„å…¬å¸è‡ªå·±æ¥å†™é©±åŠ¨,å› ä¸ºä»–ä»¬å¯¹è‡ªå·±çš„åº•å±‚ç¡¬ä»¶æ¶æ„æœ€ç†Ÿæ‚‰ã€‚</p>
<h5 id="2-1-4ã€è°ä¼šä½¿ç”¨é©±åŠ¨"><a href="#2-1-4ã€è°ä¼šä½¿ç”¨é©±åŠ¨" class="headerlink" title="2.1.4ã€è°ä¼šä½¿ç”¨é©±åŠ¨?"></a>2.1.4ã€è°ä¼šä½¿ç”¨é©±åŠ¨?</h5><p>æ‰€æœ‰çš„è½¯ä»¶å·¥ç¨‹å¸ˆéƒ½ä¼šç›´æ¥æˆ–è€…é—´æ¥çš„ä½¿ç”¨åˆ°é©±åŠ¨ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†,å¦‚æœè¯´ä¸åŒçš„ç”µè„‘å…¬å¸,åˆ¶é€ å‡ºæ¥ä¸åŒçš„ç¡¬ä»¶,ä½¿ç”¨ä¸åŒçš„ é©±åŠ¨,æä¾›å‡ºæ¥ä¸åŒçš„æ¥å£ä¾›è½¯ä»¶å·¥ç¨‹å¸ˆè¿›è¡Œä½¿ç”¨,é‚£ä¹ˆè½¯ä»¶å·¥ç¨‹å¸ˆå°±è¦å´©æºƒäº†ã€‚</p>
<p>æ‰€ä»¥,ä¸€å®šæ˜¯éœ€è¦ä¸€ä¸ªæ ‡å‡†,æ¥ç»Ÿä¸€ä¸€ä¸‹ã€‚</p>
<h5 id="2-1-5ã€é‚£ä¹ˆåœ¨å“ªé‡Œè¿›è¡Œç»Ÿä¸€"><a href="#2-1-5ã€é‚£ä¹ˆåœ¨å“ªé‡Œè¿›è¡Œç»Ÿä¸€" class="headerlink" title="2.1.5ã€é‚£ä¹ˆåœ¨å“ªé‡Œè¿›è¡Œç»Ÿä¸€?"></a>2.1.5ã€é‚£ä¹ˆåœ¨å“ªé‡Œè¿›è¡Œç»Ÿä¸€?</h5><p>ç¡¬ä»¶æ²¡æœ‰åŠæ³•ç»Ÿä¸€,æ¯ä¸ªç”µè„‘å…¬å¸ä¸ºäº†ä¼˜åŒ–è‡ªå·±ç”µè„‘æ€§èƒ½å’ŒåŠŸè€—,åˆ¶é€ å‡ºæ¥ ä¸åŒçš„ç¡¬ä»¶æ¶æ„,è¿™æ˜¯éœ€è¦æ— æ•°çš„å¿ƒè¡€å®Œæˆçš„,å¦‚æœç»Ÿä¸€äº†,é‚£ä¹ˆå°±ä¸éœ€è¦é‚£ä¹ˆ å¤šç”µè„‘å…¬å¸äº†ã€‚</p>
<p>æ‰€ä»¥åªèƒ½ç»Ÿä¸€é©±åŠ¨çš„æ¥å£ã€‚</p>
<p>ç”µè„‘ç»„ä»¶å¤§è‡´åˆ†ä¸º:CPUã€GPUã€å†…å­˜ã€æ€»çº¿ç­‰ã€‚è€Œ OpenGL å°±æ˜¯ GPU é©±åŠ¨ çš„ä¸€å¥—æ ‡å‡†æ¥å£(OpenGL ES ä¸ºåµŒå…¥å¼è®¾å¤‡ GPU é©±åŠ¨çš„æ ‡å‡†æ¥å£,æ¯”å¦‚æ‰‹æœº, OpenGL ES å…¨ç§°:OpenGL for Embedded Systems)ã€‚</p>
<p>æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°,æˆ‘ä½¿ç”¨äº† 5 ä¸ªé—®é¢˜,å¼•å‡ºäº† OpenGL çš„ç”¨å¤„:å°±æ˜¯å°†å¤æ‚çš„ã€ å„ç§å„æ ·çš„ GPU ç¡¬ä»¶åŒ…è£…èµ·æ¥,å„ä¸ªç”µè„‘å…¬å¸ç¼–å†™è‡ªå®¶çš„é©±åŠ¨,ç„¶åæä¾›å‡ºæ¥ ä¸€å¥—ç»Ÿä¸€çš„æ¥å£,ä¾›ä¸Šå±‚è½¯ä»¶å·¥ç¨‹å¸ˆè°ƒç”¨ã€‚è¿™æ ·,ä¸–ç•Œå°±å’Œå¹³äº†ã€‚</p>
<h5 id="2-1-6ã€è°è¿™ä¹ˆç‰›-å®šä¹‰äº†-OpenGL-è¿™å¥—æ ‡å‡†"><a href="#2-1-6ã€è°è¿™ä¹ˆç‰›-å®šä¹‰äº†-OpenGL-è¿™å¥—æ ‡å‡†" class="headerlink" title="2.1.6ã€è°è¿™ä¹ˆç‰›,å®šä¹‰äº† OpenGL è¿™å¥—æ ‡å‡†?"></a>2.1.6ã€è°è¿™ä¹ˆç‰›,å®šä¹‰äº† OpenGL è¿™å¥—æ ‡å‡†?</h5><p>Khronosã€‚æ¯å½“æˆ‘æ‰“è¿™å‡ ä¸ªå­—æ¯çš„æ—¶å€™,éƒ½ä¼šæŠ±æœ‰ä¸€ç§æ•¬ç•çš„å¿ƒç†,å› ä¸ºå®ƒ ä¸æ˜¯ä¸€å®¶å…¬å¸,å®ƒæ˜¯ä¸€ä¸ªç»„ç»‡,å®ƒæ˜¯ç”±ä¼—å¤šå¤§å…¬å¸è”åˆç»„å»ºè€Œæ¥,æ¯”å¦‚ Appleã€ Intelã€AMDã€Googleã€ARMã€Qualcommã€Nvidia ç­‰ç­‰ç­‰ç­‰ã€‚å„ä¸ªå¤§å…¬å¸æŠ•å…¥äº†å¤§ é‡çš„äººåŠ›ã€èµ„é‡‘ç­‰åˆ›å»ºäº†è¿™ä¸ªç»„ç»‡ã€‚å¯¹ç”µè„‘ GPU å®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£ OpenGL,å¯¹ æ‰‹æœº GPU å®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£ OpenGL ES(æˆ‘ä¹Ÿéå¸¸æœ‰å¹¸,åœ¨ Intel å·¥ä½œæœŸé—´,è·Ÿ Intel é©» Khronos çš„ 3D è´Ÿè´£äººå…±äº‹äº†ä¸€æ®µæ—¶é—´,æ¯å‘¨ä¸€æ¬¡çš„è·¨æ´‹ç”µè¯,éƒ½ä¼šè®©æˆ‘å—ç›ŠåŒªæµ…)</p>
<p>è¿™ä¸ªç»„ç»‡é™¤äº†å®šä¹‰äº† OpenGL æ¥å£ä¹‹å¤–,è¿˜å®šä¹‰äº†å¾ˆå¤šå…¶ä»–æ¥å£ã€‚ç›®å‰é’ˆå¯¹ GPU åˆæå‡ºäº†å¦å¤–ä¸€å¥—æ›´åº•å±‚çš„æ¥å£ Vulkan,è¿™æ˜¯ä¸€å¥—æ¯” OpenGL æ›´åº•å±‚çš„æ¥å£, ä½¿ç”¨å…¶å¯ä»¥æ›´å®¹æ˜“ä¼˜åŒ–,ä¸è¿‡ç›®å‰ç¡¬ä»¶å‚å•†çš„é©±åŠ¨è¿˜æœ‰å¾…å¼€å‘,å¯èƒ½æ™®åŠ Vulkan è¿˜éœ€è¦å¾ˆå¤šå¹´ã€‚å°±å¥½æ¯” OpenGL ES å·²ç»å‘å±•åˆ°äº† 3.1,è€Œå¸‚é¢ä¸Šçš„æ‰‹æœºå¾ˆå¤šè¿˜æ˜¯ åªèƒ½æ”¯æŒ OpenGL ES 2.0 ä¸€æ ·ã€‚æ‰€ä»¥æ–°çš„ç§‘æŠ€ä»æå‡º,åˆ°å®ç°,åˆ°é‡äº§,åˆ°ä½¿ç”¨, åˆ°æ™®åŠ,æ˜¯ä¸€æ®µå¾ˆé•¿çš„è·¯ã€‚</p>
<p>æ‰€ä»¥,æˆ‘ä»¬ç°åœ¨å­¦ä¹  OpenGL ES 2.0 æ˜¯é€‚æ—¶çš„,ä¸”æ˜¯éå¸¸å¿…è¦çš„(ä¸æ‡‚ 2.0, æƒ³ç›´æ¥å­¦ä¹ æ›´éš¾çš„ 3.0ã€3.1ã€Vulkan,å¾ˆéš¾)ã€‚</p>
<p>äº‹å…ˆé¢„å‘Šä¸€ä¸‹,OpenGL ES 2.0 ä¼šåˆ†åä¸‰ä¸ªè¯¾ç¨‹,ç»“æŸä¹‹å,æˆ‘ä¼šç«‹å³å¥‰ä¸Š OpenGL ES 3.0 åœ¨ OpenGL ES 2.0 åŸºç¡€ä¸Šçš„æ”¹å˜ã€‚</p>
<h5 id="2-1-7ã€OpenGL-å’Œæˆ‘ä»¬æ¸¸æˆï¼ˆAndroid-ï¼‰å¼€å‘è€…æœ‰ä»€ä¹ˆå…³ç³»"><a href="#2-1-7ã€OpenGL-å’Œæˆ‘ä»¬æ¸¸æˆï¼ˆAndroid-ï¼‰å¼€å‘è€…æœ‰ä»€ä¹ˆå…³ç³»" class="headerlink" title="2.1.7ã€OpenGL å’Œæˆ‘ä»¬æ¸¸æˆï¼ˆAndroid ï¼‰å¼€å‘è€…æœ‰ä»€ä¹ˆå…³ç³»?"></a>2.1.7ã€OpenGL å’Œæˆ‘ä»¬æ¸¸æˆï¼ˆAndroid ï¼‰å¼€å‘è€…æœ‰ä»€ä¹ˆå…³ç³»?</h5><p>ç”µè„‘/æ‰‹æœºå±å¹•ä¸Šæ˜¾ç¤ºçš„ä¸œè¥¿,è¦ä¹ˆæ˜¯ 2D çš„,è¦ä¹ˆæ˜¯ 3D çš„,é‚£ä¹ˆå¦‚æœæ˜¯ 3D çš„,ä¸ç®¡æ˜¯ App ä¹Ÿå¥½,æ¸¸æˆä¹Ÿå¥½,ç®€å•çš„å›¾ç‰‡ç•Œé¢ä¹Ÿå¥½,åº•å±‚éƒ½æ˜¯é€šè¿‡ GPUã€ é€šè¿‡ OpenGL(ES)ç»˜åˆ¶å‡ºæ¥çš„ã€‚</p>
<p>å¼€å‘ App çš„æ—¶å€™,æ˜¯é€šè¿‡åˆ›å»ºæ§ä»¶çš„æ–¹å¼,è€Œæ§ä»¶å·²ç»å¯¹åº•å±‚è¿›è¡Œäº†ä¸€å±‚å°è£…,æ‰€ä»¥ App å¼€å‘è€…å¾ˆå°‘ä¼šæ¥è§¦åˆ° OpenGL(ES)ã€‚</p>
<p>æ¸¸æˆçš„å¼€å‘æ˜¯é€šè¿‡æ¸¸æˆå¼•æ“,è€Œæ¸¸æˆå¼•æ“çš„æœ€åº•å±‚,æ˜¯ç›´æ¥è°ƒç”¨äº† OpenGL(ES),ç›´æ¥å¯¹ GPU è¿›è¡Œæ§åˆ¶ã€‚</p>
<p>æ‰€ä»¥è¯´æ¸¸æˆå¼•æ“å·¥ç¨‹å¸ˆå¿…é¡»æ‡‚ OpenGL(ES),è€Œæ¸¸æˆå¼€å‘è€…,æƒ³è¦æ›´å¥½çš„å¯¹æ¸¸æˆè¿›è¡Œæ›´å¥½çš„ç†è§£å’Œä¼˜åŒ–,ä¹Ÿå»ºè®®å­¦ä¸€äº› OpenGL(ES)ã€‚</p>
<h5 id="2-1-8ã€DirectX-æ˜¯ä»€ä¹ˆ"><a href="#2-1-8ã€DirectX-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.1.8ã€DirectX æ˜¯ä»€ä¹ˆ?"></a>2.1.8ã€DirectX æ˜¯ä»€ä¹ˆ?</h5><p>æœ€åä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å‘ç° Khronos ç»„ç»‡çš„æˆå‘˜ä¸­,æˆ‘æ²¡æœ‰æåˆ°å¤§åé¼é¼çš„å¾® è½¯,å› ä¸ºå¾®è½¯ä¸åœ¨ç»„ç»‡ä¸­,è€Œå®ƒæå‡ºäº†è‡ªå·±çš„ GPU é©±åŠ¨æ ‡å‡†,DirectXã€‚</p>
<p>æ‰€ä»¥ç›®å‰æ‰‹æœº,ä¸ç®¡æ˜¯ iOS è¿˜æ˜¯ Android,éƒ½æ˜¯æ”¯æŒ OpenGL ESã€‚ç”µè„‘,Windows ç³»ç»Ÿæ”¯æŒ DirectX å’Œ OpenGL,Linux/Mac(Unix)ç³»ç»Ÿæ”¯æŒ OpenGLã€‚</p>
<h4 id="2-2ã€OpenGL-ES-çš„ä¸¤ä¸ªå°ä¼™ä¼´"><a href="#2-2ã€OpenGL-ES-çš„ä¸¤ä¸ªå°ä¼™ä¼´" class="headerlink" title="2.2ã€OpenGL ES çš„ä¸¤ä¸ªå°ä¼™ä¼´"></a>2.2ã€OpenGL ES çš„ä¸¤ä¸ªå°ä¼™ä¼´</h4><p>è™½ç„¶,æˆ‘ä»¬æ•™ç¨‹çš„æ ‡é¢˜æ˜¯ OpenGL ES,ä½†æ˜¯æˆ‘ä»¬çš„å†…å®¹å°†ä¸ä»…é™äº OpenGL ESã€‚ OpenGL ES æ˜¯è´Ÿè´£ GPU å·¥ä½œçš„,ç›®çš„æ˜¯é€šè¿‡ GPU è®¡ç®—,å¾—åˆ°ä¸€å¼ å›¾ç‰‡,è¿™å¼ å›¾ ç‰‡åœ¨å†…å­˜ä¸­å…¶å®å°±æ˜¯ä¸€å— buffer,å­˜å‚¨æœ‰æ¯ä¸ªç‚¹çš„é¢œè‰²ä¿¡æ¯ç­‰ã€‚è€Œè¿™å¼ å›¾ç‰‡æœ€ç»ˆæ˜¯è¦æ˜¾ç¤ºåˆ°å±å¹•ä¸Š,æ‰€ä»¥è¿˜éœ€è¦å…·ä½“çš„çª—å£ç³»ç»Ÿæ¥æ“ä½œ,OpenGL ES å¹¶æ²¡æœ‰ç›¸å…³çš„å‡½æ•°ã€‚æ‰€ä»¥,OpenGL ES æœ‰ä¸€ä¸ªå¥½æ­æ¡£ EGLã€‚</p>
<p>EGL,å…¨ç§°:embedded Graphic Interface,æ˜¯ OpenGL ES å’Œåº•å±‚ Native å¹³å° è§†çª—ç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚æ‰€ä»¥å¤§æ¦‚æµç¨‹æ˜¯è¿™æ ·çš„:é¦–å…ˆ,é€šè¿‡ EGL è·å–åˆ°æ‰‹æœºå±å¹• çš„ handle,è·å–åˆ°æ‰‹æœºæ”¯æŒçš„é…ç½®(RGBA8888/RGB565 ä¹‹ç±»,è¡¨ç¤ºæ¯ä¸ªåƒç´ ä¸­åŒ… å«çš„é¢œè‰²ç­‰ä¿¡æ¯çš„å­˜å‚¨ç©ºé—´æ˜¯å¤šå°‘ä½),ç„¶åæ ¹æ®è¿™ä¸ªé…ç½®åˆ›å»ºä¸€å—åŒ…å«é»˜è®¤ buffer çš„ surface(buffer çš„å¤§å°æ˜¯æ ¹æ®å±å¹•åˆ†è¾¨ç‡ä¹˜ä»¥æ¯ä¸ªåƒç´ ä¿¡æ¯æ‰€å å¤§å°è®¡ ç®—è€Œå¾—)å’Œç”¨äºå­˜æ”¾ OpenGL ES çŠ¶æ€é›†çš„ context,å¹¶å°†å®ƒä»¬ enable èµ·æ¥ã€‚ç„¶å, é€šè¿‡ OpenGL ES æ“ä½œ GPU è¿›è¡Œè®¡ç®—,å°†è®¡ç®—çš„ç»“æœä¿å­˜åœ¨ surface çš„ buffer ä¸­ã€‚ æœ€å,ä½¿ç”¨ EGL,å°†ç»˜åˆ¶çš„å›¾ç‰‡æ˜¾ç¤ºåˆ°æ‰‹æœºå±å¹•ä¸Šã€‚</p>
<p>è€Œåœ¨ OpenGL ES æ“ä½œ GPU è®¡ç®—çš„æ—¶å€™,è¿˜éœ€è¦ä»‹ç» OpenGL ES çš„å¦å¤–ä¸€ä¸ªå¥½æ­æ¡£ GLSLã€‚</p>
<p>GLSL,å…¨ç§°:OpenGL Shading Language,æ˜¯ OpenGL ES ä¸­ä½¿ç”¨åˆ°çš„ç€è‰²å™¨çš„ è¯­è¨€,ç”¨è¿™ä¸ªè¯­è¨€å¯ä»¥ç¼–å†™å°ç¨‹åºè¿è¡Œåœ¨ GPU ä¸Šã€‚</p>
<p>åœ¨è¿™é‡Œéœ€è¦å…ˆæåˆ° CPU å’Œ GPU çš„åŒºåˆ«,å®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ç”¨äºè®¡ç®—,ä¹Ÿéƒ½æ˜¯ç”±å¾ˆå¤šæ ¸ç»„æˆ,åŒºåˆ«åœ¨äº CPU çš„æ ¸æ¯”è¾ƒå°‘,ä½†æ˜¯å•ä¸ªæ ¸çš„è®¡ç®—èƒ½åŠ›æ¯”è¾ƒå¼º,è€Œ GPU çš„æ ¸å¾ˆå¤š,ä½†æ˜¯æ¯ä¸ªæ ¸çš„è®¡ç®—èƒ½åŠ›éƒ½ä¸ç®—ç‰¹åˆ«å¼ºã€‚ç›®å‰ GPU çš„ä¸»è¦å·¥ä½œæ˜¯ç”¨äºç”Ÿæˆå›¾ç‰‡(ç°åœ¨ä¹Ÿæœ‰é€šè¿‡ GPU è¿›è¡Œé«˜æ€§èƒ½è¿ç®—_å¹¶è¡Œè¿ç®—,ä½†æ˜¯åœ¨è¿™é‡Œä¸å±äºè®¨è®ºçš„èŒƒå›´),åŸå› å°±æ˜¯å›¾ç‰‡æ˜¯ç”±å¾ˆå¤šåƒç´ ç»„æˆ,æ¯ä¸ªåƒç´ éƒ½åŒ…å«æœ‰é¢œè‰²ã€æ·±åº¦ç­‰ä¿¡æ¯,è€Œä¸ºäº†å¾—åˆ°è¿™äº›ä¿¡æ¯æ•°æ®,é’ˆå¯¹æ¯ä¸ªåƒç´ ç‚¹çš„è®¡ç®—,æ˜¯å¯ä»¥é€šè¿‡ç»Ÿä¸€çš„ç®—æ³•æ¥å®Œæˆã€‚GPU å°±æ“…é•¿å¤„ç†é’ˆå¯¹è¿™ç§å¤§è§„æ¨¡æ•°æ®,ä½¿ç”¨åŒä¸€ä¸ªç®—æ³•è¿›è¡Œè®¡ç®—ã€‚è€Œè¿™ä¸ªç®—æ³•,å°±æ˜¯ä½¿ç”¨ GLSL å†™æˆ Shader,ä¾› GPU è¿ç®—ä½¿ç”¨ã€‚</p>
<p>åœ¨å›¾å½¢å­¦çš„è§†è§’ä¸­,æ‰€æœ‰çš„å›¾ç‰‡éƒ½æ˜¯ç”±ä¸‰è§’å½¢æ„æˆçš„ã€‚æ‰€ä»¥é€šè¿‡ OpenGL ES ç»˜åˆ¶å›¾ç‰‡çš„æ—¶å€™,æˆ‘ä»¬éœ€è¦é€šè¿‡ OpenGL ES API åˆ›å»ºç”¨äºåœ¨ GPU ä¸Šè¿è¡Œçš„ shader, ç„¶åå°†é€šè¿‡ CPU è·å–åˆ°çš„å›¾ç‰‡é¡¶ç‚¹ä¿¡æ¯,ä¼ å…¥ GPU ä¸­çš„ Shader ä¸­ã€‚åœ¨ Vertex Shader ä¸­é€šè¿‡çŸ©é˜µå˜æ¢,å°†é¡¶ç‚¹åæ ‡ä»æ¨¡å‹åæ ‡ç³»è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»,å†åˆ°è§‚å¯Ÿåæ ‡ç³»,åˆ°è£å‰ªåæ ‡ç³»,æœ€åæŠ•å½±åˆ°å±å¹•åæ ‡ç³»ä¸­,è®¡ç®—å‡ºåœ¨å±å¹•ä¸Šå„ä¸ªé¡¶ç‚¹çš„åæ ‡ã€‚ç„¶å,é€šè¿‡å…‰æ …åŒ–,ä»¥æ’å€¼çš„æ–¹æ³•å¾—åˆ°æ‰€æœ‰åƒç´ ç‚¹çš„ä¿¡æ¯,å¹¶åœ¨ Fragment shader ä¸­è®¡ç®—å‡ºæ‰€æœ‰åƒç´ ç‚¹çš„é¢œè‰²ã€‚æœ€å,é€šè¿‡ OpenGL ES çš„ API è®¾å®šçš„çŠ¶æ€,å°†å¾—åˆ°çš„åƒç´ ä¿¡æ¯è¿›è¡Œ depth/stencil testã€blend,å¾—åˆ°æœ€ç»ˆçš„å›¾ç‰‡ã€‚</p>
<h4 id="2-3ã€å±å¹•å›¾ç‰‡çš„æœ¬è´¨å’Œäº§ç”Ÿè¿‡ç¨‹"><a href="#2-3ã€å±å¹•å›¾ç‰‡çš„æœ¬è´¨å’Œäº§ç”Ÿè¿‡ç¨‹" class="headerlink" title="2.3ã€å±å¹•å›¾ç‰‡çš„æœ¬è´¨å’Œäº§ç”Ÿè¿‡ç¨‹"></a>2.3ã€å±å¹•å›¾ç‰‡çš„æœ¬è´¨å’Œäº§ç”Ÿè¿‡ç¨‹</h4><p>å½“æˆ‘ä»¬ä¹°ä¸€ä¸ªæ‰‹æœºçš„æ—¶å€™,æˆ‘ä»¬ä¼šéå¸¸å…³æ³¨è¿™ä¸ªæ‰‹æœºçš„åˆ†è¾¨ç‡ã€‚åˆ†è¾¨ç‡ä»£è¡¨ç€åƒç´ çš„å¤šå°‘,æ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„ iphone6 çš„åˆ†è¾¨ç‡ä¸º 1334Ã—750,è€Œ iphone6 plus çš„åˆ†è¾¨ç‡æ˜¯1920Ã—1080ã€‚</p>
<p>æ‰‹æœºå±å¹•ä¸Šçš„å›¾ç‰‡,æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„åƒç´ ç»„æˆ,é‚£ä¹ˆå¯ä»¥è®¡ç®—å‡ºæ¥,ä¸€ä¸ªå±å¹•ä¸Šçš„å›¾ç‰‡,æ˜¯ç”±ä¸Šç™¾ä¸‡ä¸ªåƒç´ ç‚¹ç»„æˆã€‚è€Œæ¯ä¸ªåƒç´ ç‚¹éƒ½æœ‰è‡ªå·±çš„é¢œè‰²,æ¯ç§é¢œè‰²éƒ½æ˜¯ç”± RGB ä¸‰åŸè‰²ç»„æˆã€‚ä¸‰åŸè‰²æŒ‰ç…§ä¸åŒçš„æ¯”ä¾‹æ··åˆ,ç»„æˆäº†æ‰‹æœºæ‰€èƒ½æ˜¾ç¤ºå‡ºæ¥çš„é¢œè‰²ã€‚</p>
<p>æ¯ä¸ªåƒç´ çš„é¢œè‰²ä¿¡æ¯éƒ½ä¿å­˜åœ¨ buffer ä¸­,è¿™å— buffer å¯ä»¥åˆ†ç»™ RGB æ¯ä¸ªé€š é“å„ 8bit è¿›è¡Œä¿¡æ¯ä¿å­˜,ä¹Ÿå¯ä»¥åˆ†ç»™ RGB æ¯ä¸ªé€šé“ä¸åŒçš„ç©ºé—´è¿›è¡Œä¿¡æ¯ä¿å­˜, æ¯”å¦‚ç”±äºäººçœ¼å¯¹ç»¿è‰²æœ€æ•æ„Ÿ,é‚£ä¹ˆå¯ä»¥åˆ†é…ç»™ G é€šé“ 6 ä½,R å’Œ B é€šé“å„ 5 ä½ã€‚è¿™äº›éƒ½æ˜¯å¸¸è§çš„æ‰‹æœºé…ç½®ã€‚å‡å¦‚ä½¿ç”¨ RGB888 çš„æ‰‹æœºé…ç½®,ä¹Ÿå°±æ˜¯æ¯ç§é¢œè‰²çš„å–å€¼ä» 0 åˆ° 255,0 æœ€å°,255 æœ€å¤§ã€‚é‚£ä¹ˆçº¢ç»¿è“éƒ½ä¸º 0 çš„æ—¶å€™,è¿™ä¸ªåƒç´ ç‚¹çš„é¢œè‰²å°±æ˜¯é»‘è‰²,çº¢ç»¿è“éƒ½ä¸º 255 çš„æ—¶å€™,è¿™ä¸ªåƒç´ ç‚¹çš„é¢œè‰²å°±æ˜¯ç™½è‰²ã€‚å½“çº¢ä¸º 255, ç»¿è“éƒ½ä¸º 0 çš„æ—¶å€™,è¿™ä¸ªåƒç´ ç‚¹çš„é¢œè‰²å°±æ˜¯çº¢è‰²ã€‚å½“çº¢ç»¿ä¸º 255,è“ä¸º 0 çš„æ—¶å€™, è¿™ä¸ªåƒç´ ç‚¹çš„é¢œè‰²å°±æ˜¯é»„è‰²ã€‚å½“ç„¶ä¸æ˜¯åªå– 0 æˆ–è€… 255,å¯ä»¥å– 0-255 ä¸­é—´çš„å€¼, 100,200,ä»»æ„åœ¨ 0 å’Œ 255 ä¸­é—´çš„å€¼éƒ½æ²¡æœ‰é—®é¢˜ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç®—ä¸€ä¸‹,æŒ‰ç…§çº¢ç»¿è“ä¸åŒæ¯”ä¾‹è¿›è¡Œæ­é…,æ¯ä¸ªåƒç´ ç‚¹,å¯ä»¥æ˜¾ç¤ºçš„é¢œè‰²æœ‰ 255<em>255</em>255=16581375 ç§,è¿™ä¸ªæ•°å­—æ˜¯éå¸¸ææ€–,æ‰€ä»¥æˆ‘ä»¬çš„æ‰‹æœºå¯ä»¥æ˜¾ç¤ºå‡ºæ¥å„ç§å„æ ·çš„é¢œè‰²ã€‚ è¿™é‡Œåœ¨å»¶ä¼¸çš„ç§‘æ™®ä¸€ä¸‹,æˆ‘ä»¬çœ‹åˆ°æ‰‹æœºå¯ä»¥æ˜¾ç¤ºé‚£ä¹ˆå¤šç§é¢œè‰²äº†,ä½†æ˜¯æ˜¯ä¸æ˜¯è¯´æˆ‘ä»¬çš„æ‰‹æœºåœ¨é¢œè‰²ä¸Šå°±å·²ç»å‘å±•åˆ°æè‡´äº†å‘¢?å…¶å®æ˜¯è¿œè¿œæ²¡æœ‰çš„,åœ¨è¿™ä¸ªæ‰‹æœºé…ç½®ä¸‹,ä¸‰åŸè‰²ä¸­æ¯ä¸€ç§çš„å–å€¼å¯ä»¥ä» 0 åˆ° 255,è€Œåœ¨ç°å®ç”Ÿæ´»ä¸­,å®ƒä»¬çš„å– å€¼å¯ä»¥ä» 0 åˆ° 1 äº¿,è€Œæˆ‘ä»¬äººç±»çš„çœ¼ç›æ‰€èƒ½çœ‹åˆ°çš„èŒƒå›´æ˜¯,ä» 0 åˆ° 10 ä¸‡ã€‚æ‰€ä»¥æ‰‹æœºç¡¬ä»¶è¿˜å­˜åœ¨å¾ˆå¤§çš„æå‡ç©ºé—´ã€‚è€Œåœ¨æ‰‹æœºç¡¬ä»¶æå‡ä¹‹å‰,æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ HDR ç­‰æŠ€æœ¯å°½é‡çš„åœ¨æ‰‹æœºä¸­å¤šæ˜¾ç¤ºä¸€äº›é¢œè‰²ã€‚æ‰€ä»¥,è®²åˆ°è¿™é‡Œ,æˆ‘ä»¬çŸ¥é“äº†,æ‰‹æœºå±å¹•ä¸Šæ˜¾ç¤ºçš„å›¾ç‰‡,æ˜¯ç”±è¿™ä¸Šç™¾ä¸‡ä¸ªåƒç´ ç‚¹,ä»¥åŠè¿™ä¸Šç™¾ä¸‡ä¸ªåƒç´ ç‚¹å¯¹åº”çš„é¢œè‰²ç»„æˆçš„ã€‚</p>
<p>ç”¨ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹,å°±æ˜¯æ‰‹æœºå±å¹•å¯¹åº”ç€ä¸€å— buffer,è¿™å— buffer å¯¹åº”ä¸Šç™¾ä¸‡ä¸ªåƒç´ ç‚¹,æ¯ä¸ªåƒç´ ç‚¹éœ€è¦ä¸€å®šçš„ç©ºé—´æ¥å­˜å‚¨å…¶é¢œè‰²ã€‚å¦‚æœä½¿ç”¨æ›´åŠ å½¢è±¡çš„ä¾‹å­æ¥æ¯”å–»,æ‰‹æœºå±å¹•å¯¹åº”çš„ buffer å°±å¥½åƒä¸€å—å·¨å¤§çš„æ£‹ç›˜,æ£‹ç›˜ä¸Šæœ‰ä¸Šç™¾ä¸‡ä¸ªæ ¼å­,æ¯ä¸ªæ ¼å­éƒ½æœ‰è‡ªå·±çš„é¢œè‰²,é‚£ä¹ˆä»è¿œå¤„æ•´ä½“çš„çœ‹è¿™ä¸ªæ£‹ç›˜,å°±æ˜¯æˆ‘ä»¬çœ‹æ‰‹æœºçš„æ—¶å€™æ˜¾ç¤ºçš„æ ·å­ã€‚è¿™å°±æ˜¯æ‰‹æœºå±å¹•ä¸Šå›¾ç‰‡çš„æœ¬è´¨ã€‚</p>
<p>é€šè¿‡æˆ‘ä»¬å¯¹ EGLã€GLSLã€OpenGL ES çš„ç†è§£,å€ŸåŠ©ä¸€å¼ å›¾ç‰‡,ä»ä¸“ä¸šçš„è§’åº¦æ¥è§£é‡Šä¸€ä¸‹æ‰‹æœºå±å¹•ä¸Šçš„å›¾ç‰‡æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-05-OpenGL-Picture-Generate.png" alt="Alt text | center"></p>
<p>é¦–å…ˆ,é€šè¿‡ EGL è·å–æ‰‹æœºå±å¹•,è¿›è€Œè·å–åˆ°æ‰‹æœºå±å¹•å¯¹åº”çš„è¿™ä¸ªæ£‹ç›˜,åŒæ—¶, åœ¨æ‰‹æœºçš„ GPU ä¸­æ ¹æ®æ‰‹æœºçš„é…ç½®ä¿¡æ¯,ç”Ÿæˆå¦å¤–ä¸€ä¸ªçš„æ£‹ç›˜å’Œä¸€ä¸ªæœ¬å­,æœ¬å­æ˜¯ç”¨äºè®°å½•è¿™ä¸ªæ£‹ç›˜åˆå§‹é¢œè‰²ç­‰ä¿¡æ¯ã€‚</p>
<p>ç„¶å,OpenGL ES å°±å¥½åƒç¨‹åºå‘˜çš„ç”»ç¬”,ç¨‹åºå‘˜éœ€è¦çŸ¥é“è‡ªå·±æƒ³ç”»ä»€ä¹ˆä¸œè¥¿,æ¯”å¦‚æƒ³ç”»ä¸€ä¸ªè‹¹æœ,é‚£ä¹ˆå°±éœ€è¦é€šè¿‡ä¸ºæ•°ä¸å¤šçš„åŸºæœ¬å‡ ä½•å›¾å…ƒ(å¦‚ç‚¹ã€ç›´çº¿ã€ä¸‰ è§’å½¢)æ¥åˆ›å»ºæ‰€éœ€è¦çš„æ¨¡å‹ã€‚æ¯”å¦‚ç”¨å‡ ä¸ªä¸‰è§’å½¢å’Œç‚¹å’Œçº¿æ¥è¿‘ä¼¼çš„ç»„æˆè¿™ä¸ªè‹¹æœ (å›¾å½¢å­¦çš„æ ¹æœ¬å°±æ˜¯ç‚¹ã€çº¿å’Œä¸‰è§’å½¢,æ‰€æœ‰çš„å›¾å½¢,éƒ½å¯ä»¥ç”±è¿™äº›åŸºæœ¬å›¾å½¢ç»„æˆ, æ¯”å¦‚æ­£æ–¹å½¢æˆ–è€…é•¿æ–¹å½¢,å°±å¯ä»¥ç”±ä¸¤ä¸ªä¸‰è§’å½¢ç»„æˆ,åœ†å½¢å¯ä»¥ç”±æ— æ•°ä¸ªä¸‰è§’å½¢ç»„æˆ,åªæ˜¯ä¸‰è§’å½¢çš„æ•°é‡è¶Šå¤š,åœ†å½¢çœ‹ä¸Šå»è¶Šåœ†æ¶¦)ã€‚</p>
<p>æ ¹æ®è¿™äº›å‡ ä½•å›¾å…ƒ,å»ºç«‹æ•°å­¦æè¿°,æ¯”å¦‚æ¯ä¸ªä¸‰è§’å½¢æˆ–è€…çº¿çš„é¡¶ç‚¹åæ ‡ä½ç½®ã€æ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²ã€‚å¾—åˆ°è¿™äº›ä¿¡æ¯ä¹‹å,å¯ä»¥å…ˆé€šè¿‡ OpenGL ES å°† EGL ç”Ÿæˆçš„æ£‹ç›˜ (buffer)è¿›è¡Œé¢œè‰²åˆå§‹åŒ–,ä¸€èˆ¬ä¼šè¢«åˆå§‹åŒ–ä¸ºé»‘è‰²ã€‚ç„¶åå°†åˆšæ‰æˆ‘ä»¬è·å–åˆ°çš„é¡¶ç‚¹åæ ‡ä½ç½®,é€šè¿‡çŸ©é˜µå˜åŒ–çš„æ–¹å¼,è¿›è¡Œæ¨¡å‹å˜æ¢ã€è§‚å¯Ÿå˜æ¢ã€æŠ•å½±å˜æ¢,æœ€åæ˜ å°„åˆ°å±å¹•ä¸Š,å¾—åˆ°å±å¹•ä¸Šçš„åæ ‡ã€‚è¿™ä¸ªæ­¥éª¤å¯ä»¥åœ¨ CPU ä¸­å®Œæˆ,ä¹Ÿå°±æ˜¯åœ¨ OpenGL ES æŠŠåæ ‡ä¿¡æ¯ä¼ ç»™ Shader ä¹‹å‰,åœ¨ CPU ä¸­é€šè¿‡çŸ©é˜µç›¸ä¹˜ç­‰æ–¹å¼è¿›è¡Œæ›´æ–°,æˆ–è€…æ˜¯ç›´æ¥æŠŠåæ ‡ä¿¡æ¯é€šè¿‡ OpenGL ES ä¼ ç»™ Shader,åŒæ—¶ä¹ŸæŠŠçŸ©é˜µä¿¡æ¯ä¼ ç»™ Shader,é€šè¿‡ Shader åœ¨ GPU ç«¯è¿›è¡Œåæ ‡æ›´æ–°,æ›´æ–°çš„ç®—æ³•é€šè¿‡ GLSL å†™åœ¨ Shader ä¸­ã€‚è¿™ä¸ªè¿›è¡Œåæ ‡æ›´æ–°çš„ Shader è¢«ç§°ä¸º vertex shader,ç®€ç§° VS,æ˜¯ OpenGL ES2.0, ä¹Ÿæ˜¯ GLSL130 ç‰ˆæœ¬å¯¹åº”çš„æœ€é‡è¦ä¸¤ä¸ª shader ä¹‹ä¸€,ä½œç”¨æ˜¯å®Œæˆé¡¶ç‚¹æ“ä½œé˜¶æ®µä¸­çš„æ‰€æœ‰æ“ä½œã€‚ç»è¿‡çŸ©é˜µå˜æ¢åçš„åƒç´ åæ ‡ä¿¡æ¯,ä¸ºå±å¹•åæ ‡ç³»ä¸­çš„åæ ‡ä¿¡æ¯ã€‚åœ¨ VS ä¸­,æœ€é‡è¦çš„è¾“å…¥ä¸ºé¡¶ç‚¹åæ ‡ã€çŸ©é˜µ(è¿˜å¯ä»¥ä¼ å…¥é¡¶ç‚¹çš„é¢œè‰²ã€æ³•çº¿ã€çº¹ç† åæ ‡ç­‰ä¿¡æ¯),è€Œæœ€é‡è¦çš„è¿ç®—ç»“æœ,å°±æ˜¯è¿™ä¸ªå°†è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„åæ ‡ä¿¡æ¯ã€‚ VS ä¼šé’ˆå¯¹ä¼ å…¥çš„æ‰€æœ‰é¡¶ç‚¹è¿›è¡Œè¿ç®—,æ¯”å¦‚åœ¨ OpenGL ES ä¸­åªæƒ³ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ å’Œä¸€æ¡çº¿,è¿™ä¸¤ä¸ªå›¾å…ƒä¸å…±äº«é¡¶ç‚¹,é‚£ä¹ˆåœ¨ VS ä¸­,ä¹Ÿå°±ä¼ å…¥äº† 5 ä¸ªé¡¶ç‚¹ä¿¡æ¯, æ ¹æ®çŸ©é˜µå˜æ¢,è¿™ 5 ä¸ªé¡¶ç‚¹çš„åæ ‡è½¬æ¢æˆäº†å±å¹•ä¸Šçš„é¡¶ç‚¹åæ ‡ä¿¡æ¯,ä»å›¾ä¸Šæ˜¾ç¤º, ä¹Ÿå°±æ˜¯ä»å·¦ä¸Šè§’çš„å›¾ä¸€,æ›´æ–°æˆäº†ä¸­ä¸Šå›¾çš„å›¾äºŒã€‚</p>
<p>å†ç„¶å,å½“å›¾äºŒç”Ÿæˆä¹‹å,æˆ‘ä»¬çŸ¥é“äº†å›¾å…ƒåœ¨å±å¹•ä¸Šçš„é¡¶ç‚¹ä½ç½®,è€Œé¡¶ç‚¹çš„é¢œè‰²åœ¨ VS ä¸­æ²¡æœ‰å‘ç”Ÿå˜åŒ–,æ‰€ä»¥å›¾å…ƒçš„é¡¶ç‚¹é¢œè‰²æˆ‘ä»¬ä¹Ÿæ˜¯çŸ¥é“çš„ã€‚ä¸‹é¢å°±æ˜¯æ ¹æ® OpenGL ES ä¸­è®¾ç½®çš„çŠ¶æ€,è¡¨æ˜å“ªäº›ç‚¹è¿æˆçº¿,å“ªäº›ç‚¹ç»„æˆä¸‰è§’å½¢,è¿›è¡Œå›¾å…ƒè£…é…,ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å³ä¸Šè§’çš„å›¾ä¸‰ä¸­çœ‹åˆ°çš„æ ·å­ã€‚è¿™ä¸ªæ ·å­åœ¨ GPU ä¸­ä¸ä¼šæ˜¾ç¤º, é‚£å‡ æ¡çº¿ä¹Ÿæ˜¯è™šæ‹Ÿçš„çº¿,æ˜¯ä¸ä¼šæ˜¾ç¤ºåœ¨æ£‹ç›˜ buffer ä¸­çš„,è€Œ GPU åšçš„æ˜¯å…‰çŠåŒ–,è¿™ä¸€æ­¥æ˜¯å‘ç”Ÿåœ¨ä» VS å‡ºæ¥,è¿›å…¥å¦å¤–ä¸€ä¸ªShader (Pixel shader,ä¹Ÿç§° fragment shader)ä¹‹å‰,åœ¨ GPU ä¸­è¿›è¡Œçš„ã€‚ä½œç”¨æ˜¯æŠŠçº¿ä¸Š,æˆ–è€…ä¸‰è§’å½¢å†…éƒ¨æ‰€æœ‰çš„åƒç´ ç‚¹æ‰¾åˆ°,å¹¶æ ¹æ®æ’å€¼æˆ–è€…å…¶ä»–æ–¹å¼è®¡ç®—å‡ºå…¶é¢œè‰²ç­‰ä¿¡æ¯(å¦‚æœä¸é€šè¿‡æ’å€¼,å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•,è¿™äº›åœ¨ OpenGL ES å’Œ GLSL ä¸­éƒ½å¯ä»¥è¿›è¡Œè®¾ç½®)ã€‚ä¹Ÿå°±ç”Ÿæˆäº†ä¸‹é¢ä¸€è¡Œçš„å›¾å››å’Œå›¾äº”ã€‚</p>
<p>æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çœ‹åˆ°åœ¨å›¾ 4 å’Œå›¾ 5 ç§å‡ºç°äº†å¤§é‡çš„é¡¶ç‚¹,å¤§æ¦‚æ•°ä¸€ä¸‹ä¼°è®¡æœ‰ 40 ä¸ªç‚¹å·¦å³,è¿™äº›ç‚¹å…¨éƒ¨éƒ½ä¼šè¿›å…¥ PS è¿›è¡Œæ“ä½œ,åœ¨ PS ä¸­å¯ä»¥å¯¹è¿™äº›ç‚¹çš„é¢œè‰²è¿›è¡Œæ“ä½œ,æ¯”å¦‚å¯ä»¥åªæ˜¾ç¤ºè¿™äº›ç‚¹çš„çº¢è‰²é€šé“,å…¶ä»–çš„ç»¿è“é€šé“çš„å€¼è®¾ç½®ä¸º 0, æ¯”å¦‚ä¹‹å‰æŸä¸ªç‚¹çš„ RGB ä¸º 200,100,100ã€‚åœ¨ PS ä¸­å¯ä»¥å°†å…¶é€šè¿‡è®¡ç®—,æ›´æ–°ä¸º 200,0,0ã€‚è¿™æ ·åšçš„ç»“æœå°±æ˜¯æ‰€æ˜¾ç¤ºçš„å›¾ç‰‡å‡ä¸ºçº¢è‰²,åªæ˜¯æ·±æµ…ä¸åŒã€‚è¿™ä¹Ÿå°±å¥½åƒæˆ´ä¸Šäº†ä¸€å±‚çº¢è‰²çš„æ»¤é•œ,å…¶ä»–é¢œè‰²å‡ä¸ºæ»¤æ‰äº†ã€‚æ‰€ä»¥ç”¨ PS æ¥åšæ»¤é•œæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚å†æ¯”å¦‚,å‡å¦‚ä¸€ç›çº¢è‰²çš„ç¯ç…§åˆ°äº†è‹¹æœä¸Š,é‚£ä¹ˆæ˜¾ç¤ºå‡ºæ¥çš„é¢œè‰²å°±æ˜¯åœ¨è‹¹æœåŸæœ¬çš„é¢œè‰²åŸºç¡€ä¸Š,çº¢è‰²å€¼è¿›è¡Œä¸€å®šçš„å¢å€¼ã€‚</p>
<p>æ‰€ä»¥,æ€»ç»“ä¸€ä¸‹,ç»è¿‡ VS å’Œ PS ä¹‹å,ç¨‹åºå‘˜æƒ³è¦ç”»çš„ä¸œè¥¿,å°±å·²ç»è¢«ç”»å‡ºæ¥äº†ã€‚æƒ³è¦ç»˜åˆ¶çš„ä¸œè¥¿,ä¹Ÿå°±æ˜¯å·¦ä¸‹è§’å›¾äº”çš„æ ·å­ã€‚ç„¶åå†æ ¹æ® OpenGL ES çš„è®¾ç½®,å¯¹æ–°ç»˜åˆ¶å‡ºæ¥çš„ä¸œè¥¿è¿›è¡Œ Depth/Stencil Test,å‰”é™¤æ‰è¢«é®æŒ¡çš„éƒ¨åˆ†,å°†å‰©ä½™éƒ¨åˆ†ä¸åŸå›¾ç‰‡è¿›è¡Œ Blend,ç”Ÿæˆæ–°çš„å›¾ç‰‡ã€‚ æœ€å,é€šè¿‡ EGL,æŠŠè¿™ä¸ªç”Ÿæˆçš„æ£‹ç›˜ buffer å’Œæ‰‹æœºå±å¹•ä¸Šå¯¹åº”çš„æ£‹ç›˜ buffer è¿›è¡Œè°ƒæ¢,è®©æ‰‹æœºå±å¹•æ˜¾ç¤ºè¿™ä¸ªæ–°ç”Ÿæˆçš„æ£‹ç›˜,æ—§çš„é‚£ä¸ªæ£‹ç›˜å†å»ç»˜åˆ¶æ–°çš„å›¾ç‰‡ä¿¡æ¯ã€‚å‘¨è€Œå¤å§‹,ä¸åœçš„æŠŠæ£‹ç›˜è¿›è¡Œåˆ‡æ¢,ä¹Ÿå°±åƒè¿‡å»çœ‹è¿ç¯ç”»ä¸€æ ·,åŠ¨ç”»å°±æ˜¯ç”±ä¸€å¹…å¹…çš„å›¾ç‰‡ç»„æˆ,å½“æ¯ç§’åˆ‡æ¢çš„å›¾ç‰‡æ•°é‡è¶…è¿‡ 30 å¼ çš„æ—¶å€™,æˆ‘ä»¬çš„æ‰‹æœºä¹Ÿå°±çœ‹åˆ°äº†åŠ¨æ€çš„æ•ˆæœã€‚è¿™å°±æ˜¯å±å¹•ä¸Šå›¾ç‰‡çš„äº§ç”Ÿè¿‡ç¨‹ã€‚</p>
<p>åœ¨è¿™é‡Œå†è¿›è¡Œä¸€ä¸‹å»¶ä¼¸,è¿™ä¸ªä¾‹å­ä¸­,VS è®¡ç®—äº† 5 ä¸ªé¡¶ç‚¹çš„æ•°æ®,PS è®¡ç®— äº†å¤§æ¦‚ 40 ä¸ªé¡¶ç‚¹çš„æ•°æ®,è€Œæˆ‘ä»¬åˆšæ‰è¯´è¿‡,æ‰‹æœºä¸­å­˜åœ¨ä¸Šç™¾ä¸‡ä¸ªåƒç´ ç‚¹,è¿™ä¸Šç™¾ä¸‡ä¸ªåƒç´ ç‚¹éƒ½å¯ä»¥æ˜¯é¡¶ç‚¹,é‚£ä¹ˆè¿™ä¸ªè®¡ç®—é‡æ˜¯éå¸¸å¤§çš„ã€‚è€Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦å°† shader è¿ç®—æ”¾åœ¨ GPU ä¸­çš„åŸå› ,å› ä¸º GPU æ“…é•¿è¿›è¡Œè¿™ç§è¿ç®—ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ CPU ç°åœ¨ä¸€èˆ¬éƒ½æ˜¯åŒæ ¸æˆ–è€… 4 æ ¸,å¤šçš„ä¹Ÿå°±æ˜¯ 8 æ ¸æˆ–è€… 16 æ ¸,ä½†æ˜¯ GPU åŠ¨è¾„å°±æ˜¯ 72 æ ¸,å¤šçš„è¿˜æœ‰ä¸Šåƒæ ¸,è¿™ä¹ˆå¤šæ ¸çš„ç›®çš„å°±æ˜¯è¿›è¡Œå¹¶è¡Œè¿ç®—, è™½ç„¶å•ä¸ªçš„ GPU æ ¸ä¸å¦‚ CPU æ ¸,ä½†æ˜¯å•ä¸ªçš„ GPU æ ¸è¶³å¤Ÿè¿›è¡ŒåŠ å‡ä¹˜é™¤è¿ç®—,æ‰€ä»¥å¤§é‡çš„ GPU æ ¸ç”¨åœ¨å›¾å½¢å­¦åƒç´ ç‚¹è¿ç®—ä¸Š,æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚è€Œ CPU è™½ç„¶å•ä¸ªå¾ˆå¼ºå¤§,è€Œä¸”ä¹Ÿå¯ä»¥é€šè¿‡å¤šçº§æµæ°´æ¥æé«˜ååç‡,ä½†æ˜¯ç»ˆç©¶è¿˜æ˜¯ä¸å¦‚ GPU çš„å¤šæ ¸æ¥å¾—å¿«ã€‚ä½†æ˜¯åœ¨é€šè¿‡ GPU è¿›è¡Œå¤šæ ¸è¿ç®—çš„æ—¶å€™,éœ€è¦æ³¨æ„çš„æ˜¯:å¦‚æœ shader ä¸­å­˜æ”¾åˆ¤æ–­è¯­å¥,å°±ä¼šå¯¹ GPU é€ æˆæ¯”è¾ƒå¤§çš„è´Ÿè·,ä¸åŒ GPU çš„å®ç°æ–¹å¼ä¸åŒ,å¤šæ•° GPU ä¼šå¯¹åˆ¤æ–­è¯­å¥çš„ä¸¤ç§æƒ…å†µéƒ½è¿›è¡Œè¿ç®—,ç„¶åæ ¹æ®åˆ¤æ–­ç»“æœå–å…¶ä¸­ä¸€ä¸ªã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡è¿™ä¸ªä¾‹å­å†æ¬¡æ¸…æ¥šäº† OpenGL ES ç»˜åˆ¶çš„æ•´ä¸ªæµç¨‹,è€Œè¿™ä¸ªä¾‹å­ä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­,å…¶ä¸­æœ‰å¾ˆå¤š OpenGL ES çš„å…¶ä»–æ“ä½œæ²¡æœ‰è¢«æ¶‰åŠåˆ°ã€‚æ¯”å¦‚,æˆ‘ä»¬ç»˜åˆ¶ç‰©ä½“çš„é¢œè‰²å¤§å¤šæ˜¯ä»çº¹ç†ä¸­é‡‡æ ·å‡ºæ¥,é‚£ä¹ˆè®¾è®¡åˆ°é€šè¿‡ OpenGL ES å¯¹çº¹ç† è¿›è¡Œæ“ä½œã€‚è€Œ OpenGL ES çš„è¿™äº›åŠŸèƒ½,æˆ‘ä»¬ä¼šåœ¨ä¸‹é¢ä¸€ç‚¹ä¸€ç‚¹è¿›è¡Œå­¦ä¹ ã€‚</p>
<h4 id="2-4-2ã€OpenGL-æµæ°´çº¿ï¼ˆpipelineï¼‰"><a href="#2-4-2ã€OpenGL-æµæ°´çº¿ï¼ˆpipelineï¼‰" class="headerlink" title="2.4.2ã€OpenGL æµæ°´çº¿ï¼ˆpipelineï¼‰"></a>2.4.2ã€OpenGL æµæ°´çº¿ï¼ˆpipelineï¼‰</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-06-OpenGL-ES-pipeline.png" alt="Alt text | center"></p>
<p>EGL æ˜¯ç”¨äºä¸æ‰‹æœºè®¾å¤‡æ‰“äº¤é“,æ¯”å¦‚è·å–ç»˜åˆ¶ buffer,å°†ç»˜åˆ¶ buffer å±•ç°åˆ°æ‰‹æœºå±å¹•ä¸­ã€‚é‚£ä¹ˆæŠ›å¼€ EGL ä¸è¯´,OpenGL ES ä¸ GLSL çš„ä¸»è¦åŠŸèƒ½,å°±æ˜¯å¾€è¿™å— buffer ä¸Šç»˜åˆ¶å›¾ç‰‡ã€‚</p>
<p>æ‰€ä»¥,æˆ‘ä»¬å¯ä»¥æŠŠOpenGL ESå’ŒGLSLçš„æµç¨‹å•ç‹¬æ‹¿å‡ºæ¥è¿›è¡Œå½’çº³æ€»ç»“,è€Œè¿™å¹…æµç¨‹å›¾å°±æ˜¯è‘—åçš„ OpenGL ES2.0 pipelineã€‚</p>
<p>é¦–å…ˆ,æœ€å·¦è¾¹çš„ API æŒ‡çš„å°±æ˜¯ OpenGL ES çš„ API,OpenGL ES å…¶å®æ˜¯ä¸€ä¸ªå›¾å½¢å­¦åº“,ç”± 109 ä¸ª API ç»„æˆ,åªè¦æ˜ç™½äº†è¿™ 109 ä¸ª API çš„æ„ä¹‰å’Œç”¨é€”,å°±æŒæ¡äº†OpenGL ES 2.0ã€‚</p>
<p>ç„¶å,æˆ‘ä»¬é€šè¿‡ API å…ˆè®¾å®šäº†é¡¶ç‚¹çš„ä¿¡æ¯,é¡¶ç‚¹çš„åæ ‡ã€ç´¢å¼•ã€é¢œè‰²ç­‰ä¿¡æ¯,å°†è¿™äº›ä¿¡æ¯ä¼ å…¥ VSã€‚</p>
<p>åœ¨ VS ä¸­è¿›è¡Œè¿ç®—,å¾—åˆ°æœ€ç»ˆçš„é¡¶ç‚¹åæ ‡ã€‚å†æŠŠç®—å‡ºæ¥çš„é¡¶ç‚¹åæ ‡è¿›è¡Œå›¾å…ƒè£…é…,æ„å»ºæˆè™šæ‹Ÿçš„çº¿å’Œä¸‰è§’å½¢ã€‚å†è¿›è¡Œå…‰çŠåŒ–(åœ¨å…‰çŠåŒ–çš„æ—¶å€™,æŠŠé¡¶ç‚¹è¿æ¥èµ·æ¥å½¢æˆç›´çº¿,æˆ–è€…å¡«å……å¤šè¾¹å½¢çš„æ—¶å€™,éœ€è¦è€ƒè™‘ç›´çº¿å’Œå¤šè¾¹å½¢çš„ç›´çº¿å®½åº¦ã€ç‚¹çš„å¤§å°ã€æ¸å˜ç®—æ³•ä»¥åŠæ˜¯å¦ä½¿ç”¨æ”¯æŒæŠ—é”¯é½¿å¤„ç†çš„è¦†ç›–ç®—æ³•ã€‚æœ€ç»ˆçš„æ¯ä¸ªåƒç´ ç‚¹,éƒ½å…·æœ‰å„è‡ªçš„é¢œè‰²å’Œæ·±åº¦å€¼)ã€‚</p>
<p>å°†å…‰çŠåŒ–çš„ç»“æœä¼ å…¥ PS,è¿›è¡Œæœ€ç»ˆçš„é¢œè‰²è®¡ç®—ã€‚</p>
<p>ç„¶å,è¿™æ‰€è°“æœ€ç»ˆçš„ç»“æœåœ¨è¢«å®é™…å­˜å‚¨åˆ°ç»˜åˆ¶ buffer ä¹‹å‰,è¿˜éœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚è¿™äº›æ“ä½œå¯èƒ½ä¼šä¿®æ”¹ç”šè‡³ä¸¢å¼ƒè¿™äº›åƒç´ ç‚¹ã€‚</p>
<p>è¿™äº›æ“ä½œä¸»è¦ä¸º alpha testã€Depth/Stencil testã€Blendã€Ditherã€‚</p>
<p>Alpha Test é‡‡ç”¨ä¸€ç§å¾ˆéœ¸é“æç«¯çš„æœºåˆ¶,åªè¦ä¸€ä¸ªåƒç´ çš„ alpha ä¸æ»¡è¶³æ¡ä»¶, é‚£ä¹ˆå®ƒå°±ä¼šè¢« fragment shader èˆå¼ƒ,è¢«èˆå¼ƒçš„ fragments ä¸ä¼šå¯¹åé¢çš„å„ç§ Tests äº§ç”Ÿå½±å“;å¦åˆ™,å°±ä¼šæŒ‰æ­£å¸¸æ–¹å¼ç»§ç»­ä¸‹é¢çš„æ£€éªŒã€‚Alpha Test äº§ç”Ÿçš„æ•ˆæœä¹Ÿå¾ˆæç«¯,è¦ä¹ˆå®Œå…¨é€æ˜,å³çœ‹ä¸åˆ°,è¦ä¹ˆå®Œå…¨ä¸é€æ˜ã€‚</p>
<p>Depth/stencil test æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ç”±äºæˆ‘ä»¬ç»˜åˆ¶çš„æ˜¯ 3D å›¾å½¢,é‚£ä¹ˆåæ ‡ä¸º XYZ,è€Œ Z ä¸€èˆ¬å°±æ˜¯æ·±åº¦å€¼,OpenGL ES å¯ä»¥å¯¹æ·±åº¦æµ‹è¯•è¿›è¡Œè®¾å®š,æ¯”å¦‚è®¾å®šæ·±åº¦å€¼å¤§çš„è¢«æŠ›å¼ƒ,é‚£ä¹ˆå‡å¦‚ç»˜åˆ¶ buffer ä¸ŠæŸä¸ªåƒç´ ç‚¹çš„æ·±åº¦å€¼ä¸º 0,è€Œ PS è¾“å‡ºçš„ åƒç´ ç‚¹çš„æ·±åº¦å€¼ä¸º 1,é‚£ä¹ˆ PS è¾“å‡ºçš„åƒç´ ç‚¹å°±è¢«æŠ›å¼ƒäº†ã€‚è€Œ stencil æµ‹è¯•æ›´åŠ ç®€å•,å…¶åˆè¢«ç§°ä¸ºè’™ç‰ˆæµ‹è¯•,æ¯”å¦‚å¯ä»¥é€šè¿‡ OpenGL ES è®¾å®šä¸åŒ stencil å€¼çš„é…æŠ›å¼ƒ, é‚£ä¹ˆå‡å¦‚ç»˜åˆ¶ buffer ä¸ŠæŸä¸ªåƒç´ ç‚¹çš„ stencil å€¼ä¸º 0,è€Œ PS è¾“å‡ºçš„åƒç´ ç‚¹çš„ stencil å€¼ä¸º 1,é‚£ä¹ˆ PS è¾“å‡ºçš„åƒç´ ç‚¹å°±è¢«æŠ›å¼ƒäº†ã€‚</p>
<p>æ—¢ç„¶è¯´åˆ°äº† Depth/stencil,é‚£ä¹ˆå°±åœ¨è¿™é‡Œè¯´ä¸€ä¸‹ç»˜åˆ¶ buffer åˆ°åº•æœ‰å¤šå¤§,å­˜ å‚¨äº†å¤šå°‘ä¿¡æ¯ã€‚æŒ‰ç…§æˆ‘ä»¬åˆšæ‰çš„è¯´æ³•,æ‰‹æœºå¯ä»¥æ”¯æŒä¸€ç™¾ä¸‡ä¸ªåƒç´ ,é‚£ä¹ˆç”Ÿæˆçš„ ç»˜åˆ¶ buffer å°±éœ€è¦å­˜å‚¨è¿™ä¸€ç™¾ä¸‡ä¸ªåƒç´ æ‰€åŒ…å«çš„ä¿¡æ¯,è€Œæ¯ä¸ªåƒç´ åŒ…å«çš„ä¿¡æ¯, ä¸æ‰‹æœºé…ç½®æœ‰å…³,å‡å¦‚æ‰‹æœºæ”¯æŒ Depth/stencilã€‚é‚£ä¹ˆé€šè¿‡ EGL è·å–çš„ç»˜åˆ¶ buffer ä¸­,æ¯ä¸ªåƒç´ ç‚¹å°±åŒ…å«äº† RGBA çš„é¢œè‰²å€¼,depth å€¼å’Œ stencil å€¼,å…¶ä¸­ RGBA æ¯ä¸ªåˆ†é‡ä¸€èˆ¬å æ® 8 ä½,ä¹Ÿå°±æ˜¯ 8bit,ä¹Ÿå°±æ˜¯ 1byte,è€Œ depth å¤§å¤šæ•°å  24 ä½,stencil å  8 ä½ã€‚æ‰€ä»¥æ¯ä¸ªåƒç´ å  64bit,ä¹Ÿå°±æ˜¯ 8byteã€‚é‚£ä¹ˆ iphone6 plus çš„ç»˜åˆ¶ buffer çš„å°ºå¯¸ä¸º 1920Ã—1080Ã—8=16588800byte=16200KB=15.8MBã€‚</p>
<p>ä¸‹é¢è¿˜æœ‰ blend,é€šè¿‡ OpenGL ES å¯ä»¥è®¾ç½® blend æ··åˆæ¨¡å¼ã€‚ç”±äºç»˜åˆ¶ buffer ä¸­åŸæœ¬æ¯ä¸ªåƒç´ ç‚¹å·²ç»æœ‰é¢œè‰²äº†,é‚£ä¹ˆ PS è¾“å‡ºçš„é¢œè‰²ä¸ç»˜åˆ¶ buffer ä¸­çš„é¢œè‰²å¦‚ä½•æ··åˆ,ç”Ÿæˆæ–°çš„é¢œè‰²å­˜å‚¨åœ¨ç»˜åˆ¶ buffer ä¸­,å°±æ˜¯é€šè¿‡ blend æ¥è¿›è¡Œè®¾å®šã€‚</p>
<p>æœ€åçš„ dither,dither æ˜¯ä¸€ç§å›¾åƒå¤„ç†æŠ€æœ¯,æ˜¯æ•…æ„é€ æˆçš„å™ªéŸ³,ç”¨ä»¥éšæœºåŒ–é‡åŒ–è¯¯å·®,é˜»æ­¢å¤§å¹…åº¦æ‹‰å‡å›¾åƒæ—¶,å¯¼è‡´çš„åƒ banding(è‰²å¸¦)è¿™æ ·çš„é—®é¢˜ã€‚ä¹Ÿ æ˜¯é€šè¿‡OpenGL ES å¯ä»¥å¼€å¯æˆ–è€…å…³é—­ã€‚</p>
<p>ç»è¿‡äº†è¿™ä¸€ç³»åˆ—çš„è¿ç®—å’Œæµ‹è¯•,ä¹Ÿå°±å¾—åˆ°äº†æœ€ç»ˆçš„åƒç´ ç‚¹ä¿¡æ¯,å°†å…¶å­˜å‚¨åˆ°ç»˜åˆ¶ buffer ä¸Šä¹‹å,OpenGL ES çš„ pipeline ä¹Ÿå°±ç»“æŸäº†ã€‚</p>
<p>æ•´ä¸ªpipelineä¸­ï¼Œçºµå‘æŒ‰ç…§æµæ°´çº¿ä½œä¸šï¼Œæ¨ªçº¿æŒ‰ç…§ç‹¬ç«‹ä½œä¸šï¼Œå¤šçº§å¹¶è¡Œã€æé«˜æ¸²æŸ“æ€§èƒ½</p>
<p>####ï¼ˆä¸‰ï¼‰ã€ Android EGL Overviewï¼š OpenGL ES å’Œ EGL ä»‹ç»</p>
<h4 id="3-1-0ã€OpenGL-ES"><a href="#3-1-0ã€OpenGL-ES" class="headerlink" title="3.1.0ã€OpenGL ES"></a>3.1.0ã€OpenGL ES</h4><p>OpenGL ESï¼ˆOpenGL for Embedded Systemsï¼‰æ˜¯ OpenGL ä¸‰ç»´å›¾å½¢APIçš„å­é›†ï¼Œé’ˆå¯¹æ‰‹æœºã€PDAå’Œæ¸¸æˆä¸»æœºç­‰åµŒå…¥å¼è®¾å¤‡è€Œè®¾è®¡ï¼Œå„æ˜¾å¡åˆ¶é€ å•†å’Œç³»ç»Ÿåˆ¶é€ å•†æ¥å®ç°è¿™ç»„ APIã€‚</p>
<h4 id="3-1-1ã€OpenGL-åŸºæœ¬æ¦‚å¿µ"><a href="#3-1-1ã€OpenGL-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.1.1ã€OpenGL åŸºæœ¬æ¦‚å¿µ"></a>3.1.1ã€OpenGL åŸºæœ¬æ¦‚å¿µ</h4><p>OpenGL çš„ç»“æ„å¯ä»¥ä»é€»è¾‘ä¸Šåˆ’åˆ†ä¸ºä¸‹é¢ 3 ä¸ªéƒ¨åˆ†ï¼š</p>
<p>â˜¯ å›¾å…ƒï¼ˆPrimitivesï¼‰<br>â˜¯ ç¼“å†²åŒºï¼ˆBuffersï¼‰<br>â˜¯ å…‰æ …åŒ–ï¼ˆRasterizeï¼‰<br> <strong>å›¾å…ƒï¼ˆPrimitivesï¼‰</strong><br>åœ¨ OpenGL çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬åªèƒ½ç”»ç‚¹ã€çº¿ã€ä¸‰è§’å½¢è¿™ä¸‰ç§åŸºæœ¬å›¾å½¢ï¼Œè€Œå…¶å®ƒå¤æ‚çš„å›¾å½¢éƒ½å¯ä»¥é€šè¿‡ä¸‰è§’å½¢æ¥ç»„æˆã€‚æ‰€ä»¥è¿™é‡Œçš„å›¾å…ƒæŒ‡çš„å°±æ˜¯è¿™ä¸‰ç§åŸºç¡€å›¾å½¢ï¼š</p>
<p>â˜¯ ç‚¹ï¼šç‚¹å­˜åœ¨äºä¸‰ç»´ç©ºé—´ï¼Œåæ ‡ç”¨ï¼ˆx,y,zï¼‰è¡¨ç¤ºã€‚<br>â˜¯ çº¿ï¼šç”±ä¸¤ä¸ªä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹ç»„æˆã€‚<br>â˜¯ ä¸‰è§’å½¢ï¼šç”±ä¸‰ä¸ªä¸‰ç»´ç©ºé—´çš„ç‚¹ç»„æˆã€‚<br><strong>ç¼“å†²åŒºï¼ˆBuffersï¼‰</strong><br>OpenGL ä¸­ä¸»è¦æœ‰ 3 ç§ Bufferï¼š</p>
<p><strong>å¸§ç¼“å†²åŒºï¼ˆFrame Buffersï¼‰</strong> å¸§ç¼“å†²åŒºï¼š<strong>è¿™ä¸ªæ˜¯å­˜å‚¨OpenGL æœ€ç»ˆæ¸²æŸ“è¾“å‡ºç»“æœçš„åœ°æ–¹</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå›¾åƒçš„é›†åˆï¼Œä¾‹å¦‚é¢œè‰²å›¾åƒã€æ·±åº¦å›¾åƒã€æ¨¡æ¿å›¾åƒç­‰ã€‚</p>
<p><strong>æ¸²æŸ“ç¼“å†²åŒºï¼ˆRender Buffersï¼‰</strong> æ¸²æŸ“ç¼“å†²åŒºï¼šæ¸²æŸ“ç¼“å†²åŒºå°±æ˜¯ä¸€ä¸ªå›¾åƒï¼Œå®ƒæ˜¯ Frame Buffer çš„ä¸€ä¸ªå­é›†ã€‚</p>
<p><strong>ç¼“å†²åŒºå¯¹è±¡ï¼ˆBuffer Objectsï¼‰</strong> ç¼“å†²åŒºå¯¹è±¡å°±æ˜¯ç¨‹åºå‘˜è¾“å…¥åˆ° OpenGL çš„æ•°æ®ï¼Œåˆ†ä¸ºç»“æ„ç±»å’Œç´¢å¼•ç±»çš„ã€‚å‰è€…è¢«ç§°ä¸ºâ€œæ•°ç»„ç¼“å†²åŒºå¯¹è±¡â€æˆ–â€œé¡¶ç‚¹ç¼“å†²åŒºå¯¹è±¡â€ï¼ˆâ€œArray Buffer Objectâ€æˆ–â€œVertex Buff er Objectâ€ï¼‰ï¼Œå³ç”¨æ¥æè¿°æ¨¡å‹çš„æ•°ç»„ï¼Œå¦‚é¡¶ç‚¹æ•°ç»„ã€çº¹ç†æ•°ç»„ç­‰ï¼› åè€…è¢«ç§°ä¸ºâ€œç´¢å¼•ç¼“å†²åŒºå¯¹è±¡â€ï¼ˆâ€œIndex Buffer Objectâ€ï¼‰ï¼Œæ˜¯å¯¹ä¸Šè¿°æ•°ç»„çš„ç´¢å¼•ã€‚</p>
<p><strong>å…‰æ …åŒ–ï¼ˆRasterizeï¼‰</strong><br>åœ¨ä»‹ç»å…‰æ …åŒ–ä¹‹å‰ï¼Œé¦–å…ˆæ¥è¡¥å…… OpenGL ä¸­çš„ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼š</p>
<p>Vertex Vertex å°±æ˜¯å›¾å½¢ä¸­é¡¶ç‚¹ï¼Œä¸€ç³»åˆ—çš„é¡¶ç‚¹å°±å›´æˆäº†ä¸€ä¸ªå›¾å½¢ã€‚<br>Fragment Fragment æ˜¯ä¸‰ç»´ç©ºé—´çš„ç‚¹ã€çº¿ã€ä¸‰è§’å½¢è¿™äº›åŸºæœ¬å›¾å…ƒæ˜ å°„åˆ°äºŒç»´å¹³é¢ä¸Šçš„æ˜ å°„åŒºåŸŸï¼Œé€šå¸¸ä¸€ä¸ª Fragment å¯¹åº”äºå±å¹•ä¸Šçš„ä¸€ä¸ªåƒç´ ï¼Œä½†é«˜åˆ†è¾¨ç‡çš„å±å¹•å¯èƒ½ä¼šç”¨å¤šä¸ªåƒç´ ç‚¹æ˜ å°„åˆ°ä¸€ä¸ª Fragmentï¼Œä»¥å‡å°‘ GPU çš„å·¥ä½œã€‚<br>è€Œå…‰æ …åŒ–æ˜¯æŠŠç‚¹ã€çº¿ã€ä¸‰è§’å½¢æ˜ å°„åˆ°å±å¹•ä¸Šçš„åƒç´ ç‚¹çš„è¿‡ç¨‹ã€‚</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-07-OpenGL-guangshanhua.png" alt="Alt text | center"></p>
<p>ç€è‰²å™¨ç¨‹åºï¼ˆShaderï¼‰<br>Shader ç”¨æ¥æè¿°å¦‚ä½•ç»˜åˆ¶ï¼ˆæ¸²æŸ“ï¼‰ï¼ŒGLSL æ˜¯ OpenGL çš„ç¼–ç¨‹è¯­è¨€ï¼Œå…¨ç§° OpenGL Shader Languageï¼Œå®ƒçš„è¯­æ³•ç±»ä¼¼äº C è¯­è¨€ã€‚OpenGL æ¸²æŸ“éœ€è¦ä¸¤ç§ Shaderï¼šVertex Shader å’Œ Fragment Shaderã€‚</p>
<p>Vertex Shader Vertex Shader å¯¹äº3Dæ¨¡å‹ç½‘æ ¼çš„æ¯ä¸ªé¡¶ç‚¹æ‰§è¡Œä¸€æ¬¡ï¼Œä¸»è¦æ˜¯ç¡®å®šè¯¥é¡¶ç‚¹çš„æœ€ç»ˆä½ç½®ã€‚<br>Fragment Shader Fragment Shaderå¯¹å…‰æ …åŒ–ä¹‹å2Då›¾åƒä¸­çš„æ¯ä¸ªåƒç´ å¤„ç†ä¸€æ¬¡ã€‚3Dç‰©ä½“çš„è¡¨é¢æœ€ç»ˆæ˜¾ç¤ºæˆä»€ä¹ˆæ ·å°†ç”±å®ƒå†³å®šï¼Œä¾‹å¦‚ä¸ºæ¨¡å‹çš„å¯è§è¡¨é¢æ·»åŠ çº¹ç†ï¼Œå¤„ç†å…‰ç…§ã€é˜´å½±çš„å½±å“ç­‰ç­‰ã€‚</p>
<h4 id="3-2ã€EGL-Overview"><a href="#3-2ã€EGL-Overview" class="headerlink" title="3.2ã€EGL Overview"></a>3.2ã€EGL Overview</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-08-OpenGL-EGL-Overview.png.png" alt="Alt text | center"></p>
<p>What is the Direction?<br>SW : Standard API (Java, NDK Stable API)<br>HW : OpenGLES, OpenSLES, OpenMAX<br>EGLâ„¢ is an interface between Khronos rendering APIs such as OpenGL ES or OpenVG and the underlying native platform window system</p>
<h4 id="3-2-1ã€ä»€ä¹ˆæ˜¯-EGLï¼Ÿ"><a href="#3-2-1ã€ä»€ä¹ˆæ˜¯-EGLï¼Ÿ" class="headerlink" title="3.2.1ã€ä»€ä¹ˆæ˜¯ EGLï¼Ÿ"></a>3.2.1ã€ä»€ä¹ˆæ˜¯ EGLï¼Ÿ</h4><p>EGL æ˜¯ OpenGL ES æ¸²æŸ“ API å’Œæœ¬åœ°çª—å£ç³»ç»Ÿ(native platform window system)ä¹‹é—´çš„ä¸€ä¸ªä¸­é—´æ¥å£å±‚ï¼Œå®ƒä¸»è¦ç”±ç³»ç»Ÿåˆ¶é€ å•†å®ç°ã€‚</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-09-eglCreateWindowSurface.png" alt="Alt text | center"></p>
<p>EGLæä¾›å¦‚ä¸‹æœºåˆ¶ï¼š<br>ä¸è®¾å¤‡çš„åŸç”Ÿçª—å£ç³»ç»Ÿé€šä¿¡<br>æŸ¥è¯¢ç»˜å›¾è¡¨é¢çš„å¯ç”¨ç±»å‹å’Œé…ç½®<br>åˆ›å»ºç»˜å›¾è¡¨é¢<br>åœ¨OpenGL ES å’Œå…¶ä»–å›¾å½¢æ¸²æŸ“APIä¹‹é—´åŒæ­¥æ¸²æŸ“<br>ç®¡ç†çº¹ç†è´´å›¾ç­‰æ¸²æŸ“èµ„æº<br>ä¸ºäº†è®©OpenGL ESèƒ½å¤Ÿç»˜åˆ¶åœ¨å½“å‰è®¾å¤‡ä¸Šï¼Œæˆ‘ä»¬éœ€è¦EGLä½œä¸ºOpenGL ESä¸è®¾å¤‡çš„æ¡¥æ¢ã€‚</p>
<h4 id="3-2-2ã€ä½¿ç”¨-EGL-ç»˜å›¾çš„åŸºæœ¬æ­¥éª¤"><a href="#3-2-2ã€ä½¿ç”¨-EGL-ç»˜å›¾çš„åŸºæœ¬æ­¥éª¤" class="headerlink" title="3.2.2ã€ä½¿ç”¨ EGL ç»˜å›¾çš„åŸºæœ¬æ­¥éª¤"></a>3.2.2ã€ä½¿ç”¨ EGL ç»˜å›¾çš„åŸºæœ¬æ­¥éª¤</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-10-egl-draw-surface.png.png" alt="Alt text | center"></p>
<p>â˜¯  Display(EGLDisplay) æ˜¯å¯¹å®é™…æ˜¾ç¤ºè®¾å¤‡çš„æŠ½è±¡ã€‚<br>â˜¯  Surfaceï¼ˆEGLSurfaceï¼‰æ˜¯å¯¹ç”¨æ¥å­˜å‚¨å›¾åƒçš„å†…å­˜åŒºåŸŸ<br>â˜¯  FrameBuffer çš„æŠ½è±¡ï¼ŒåŒ…æ‹¬ Color Bufferï¼Œ Stencil Buffer ï¼ŒDepth Bufferã€‚Context (EGLContext) å­˜å‚¨ OpenGL ESç»˜å›¾çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚<br>ä½¿ç”¨EGLçš„ç»˜å›¾çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p>
<p>1ã€è·å– EGL Display å¯¹è±¡ï¼šeglGetDisplay()<br>2ã€åˆå§‹åŒ–ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥ï¼šeglInitialize()<br>3ã€è·å– EGLConfig å¯¹è±¡ï¼šeglChooseConfig()<br>4ã€åˆ›å»º EGLContext å®ä¾‹ï¼šeglCreateContext()<br>5ã€åˆ›å»º EGLSurface å®ä¾‹ï¼šeglCreateWindowSurface()<br>6ã€è¿æ¥ EGLContext å’Œ EGLSurfaceï¼šeglMakeCurrent()<br>7ã€ä½¿ç”¨ OpenGL ES API ç»˜åˆ¶å›¾å½¢ï¼šgl_*()<br>8ã€åˆ‡æ¢ front buffer å’Œ back buffer é€æ˜¾ï¼šeglSwapBuffer()<br>9ã€æ–­å¼€å¹¶é‡Šæ”¾ä¸ EGLSurface å…³è”çš„ EGLContext å¯¹è±¡ï¼šeglRelease()<br>10ã€åˆ é™¤ EGLSurface å¯¹è±¡<br>11ã€åˆ é™¤ EGLContext å¯¹è±¡<br>12ã€ç»ˆæ­¢ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥</p>
<h4 id="3-3ã€EGLSurface-and-ANativeWindow-å…³ç³»"><a href="#3-3ã€EGLSurface-and-ANativeWindow-å…³ç³»" class="headerlink" title="3.3ã€EGLSurface and ANativeWindow å…³ç³»"></a>3.3ã€EGLSurface and ANativeWindow å…³ç³»</h4><p>OpenGL ES å®šä¹‰äº†ä¸€ä¸ªæ¸²æŸ“å›¾å½¢çš„ APIï¼Œä½†æ²¡æœ‰å®šä¹‰çª—å£ç³»ç»Ÿã€‚ä¸ºäº†è®© GLES èƒ½å¤Ÿé€‚åˆå„ç§å¹³å°ï¼ŒGLES å°†ä¸çŸ¥é“å¦‚ä½•é€šè¿‡æ“ä½œç³»ç»Ÿåˆ›å»ºå’Œè®¿é—®çª—å£çš„åº“ç»“åˆä½¿ç”¨ã€‚ç”¨äº Android çš„åº“ç§°ä¸º EGLã€‚å¦‚æœè¦ç»˜åˆ¶çº¹ç†å¤šè¾¹å½¢ï¼Œåº”ä½¿ç”¨ GLES è°ƒç”¨ï¼›å¦‚æœè¦åœ¨å±å¹•ä¸Šè¿›è¡Œæ¸²æŸ“ï¼Œåº”ä½¿ç”¨ EGL è°ƒç”¨ã€‚</p>
<p>åœ¨ä½¿ç”¨ GLES è¿›è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª GL ä¸Šä¸‹æ–‡ã€‚åœ¨ EGL ä¸­ï¼Œè¿™æ„å‘³ç€è¦åˆ›å»ºä¸€ä¸ª EGLContext å’Œä¸€ä¸ª EGLSurfaceã€‚GLES æ“ä½œé€‚ç”¨äºå½“å‰ä¸Šä¸‹æ–‡ï¼Œè¯¥ä¸Šä¸‹æ–‡é€šè¿‡çº¿ç¨‹å±€éƒ¨å­˜å‚¨è®¿é—®ï¼Œè€Œä¸æ˜¯ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ã€‚è¿™æ„å‘³ç€æ‚¨å¿…é¡»æ³¨æ„æ¸²æŸ“ä»£ç åœ¨å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œä»¥åŠè¯¥çº¿ç¨‹ä¸Šçš„å½“å‰ä¸Šä¸‹æ–‡ã€‚</p>
<h4 id="3-3-1ã€EGLSurface"><a href="#3-3-1ã€EGLSurface" class="headerlink" title="3.3.1ã€EGLSurface"></a>3.3.1ã€EGLSurface</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-11-eglsurface-anativewindwo.png" alt="Alt text | center"></p>
<p>EGLSurface å¯ä»¥æ˜¯ç”± EGL åˆ†é…çš„ç¦»å±ç¼“å†²åŒºï¼ˆç§°ä¸ºâ€œpbufferâ€ï¼‰ï¼Œæˆ–ç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„çª—å£ã€‚EGL çª—å£ Surface é€šè¿‡ eglCreateWindowSurface() è°ƒç”¨è¢«åˆ›å»ºã€‚è¯¥è°ƒç”¨å°†â€œçª—å£å¯¹è±¡â€ä½œä¸ºå‚æ•°ï¼Œåœ¨ Android ä¸Šï¼Œè¯¥å¯¹è±¡å¯ä»¥æ˜¯ SurfaceViewã€SurfaceTextureã€SurfaceHolder æˆ– Surfaceï¼Œæ‰€æœ‰è¿™äº›å¯¹è±¡ä¸‹é¢éƒ½æœ‰ä¸€ä¸ª BufferQueueã€‚å½“æ‚¨è¿›è¡Œæ­¤è°ƒç”¨æ—¶ï¼ŒEGL å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ EGLSurface å¯¹è±¡ï¼Œå¹¶å°†å…¶è¿æ¥åˆ°çª—å£å¯¹è±¡çš„ BufferQueue çš„ç”Ÿäº§æ–¹æ¥å£ã€‚æ­¤åï¼Œæ¸²æŸ“åˆ°è¯¥ EGLSurface ä¼šå¯¼è‡´ä¸€ä¸ªç¼“å†²åŒºç¦»å¼€é˜Ÿåˆ—ã€è¿›è¡Œæ¸²æŸ“ï¼Œç„¶åæ’é˜Ÿç­‰å¾…æ¶ˆè€—æ–¹ä½¿ç”¨ã€‚ï¼ˆæœ¯è¯­â€œçª—å£â€è¡¨ç¤ºé¢„æœŸç”¨é€”ï¼Œä½†è¯·æ³¨æ„ï¼Œè¾“å‡ºå†…å®¹ä¸ä¸€å®šä¼šæ˜¾ç¤ºåœ¨æ˜¾ç¤ºå±ä¸Šã€‚ï¼‰</p>
<p>EGL ä¸æä¾›é”å®š/è§£é”è°ƒç”¨ï¼Œè€Œæ˜¯ç”±æ‚¨å‘å‡ºç»˜åˆ¶å‘½ä»¤ï¼Œç„¶åè°ƒç”¨ eglSwapBuffers() æ¥æäº¤å½“å‰å¸§ã€‚æ–¹æ³•åç§°æ¥è‡ªä¼ ç»Ÿçš„å‰åç¼“å†²åŒºäº¤æ¢ï¼Œä½†å®é™…å®ç°å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒã€‚</p>
<p>ä¸€ä¸ª Surface ä¸€æ¬¡åªèƒ½ä¸ä¸€ä¸ª EGLSurface å…³è”ï¼ˆæ‚¨åªèƒ½å°†ä¸€ä¸ªç”Ÿäº§æ–¹è¿æ¥åˆ°ä¸€ä¸ª BufferQueueï¼‰ï¼Œä½†æ˜¯å¦‚æœæ‚¨é”€æ¯è¯¥ EGLSurfaceï¼Œå®ƒå°†ä¸è¯¥ BufferQueue æ–­å¼€è¿æ¥ï¼Œå¹¶å…è®¸å…¶ä»–å†…å®¹è¿æ¥åˆ°è¯¥ BufferQueueã€‚</p>
<p>é€šè¿‡æ›´æ”¹â€œå½“å‰â€EGLSurfaceï¼ŒæŒ‡å®šçº¿ç¨‹å¯åœ¨å¤šä¸ª EGLSurface ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚ä¸€ä¸ª EGLSurface ä¸€æ¬¡åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå¤„äºå½“å‰çŠ¶æ€ã€‚</p>
<p>å…³äº EGLSurface æœ€å¸¸è§çš„ä¸€ä¸ªé”™è¯¯ç†è§£å°±æ˜¯å‡è®¾å®ƒåªæ˜¯ Surface çš„å¦ä¸€æ–¹é¢ï¼ˆå¦‚ SurfaceHolderï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªç›¸å…³ä½†ç‹¬ç«‹çš„æ¦‚å¿µã€‚æ‚¨å¯ä»¥åœ¨æ²¡æœ‰ Surface ä½œä¸ºæ”¯æŒçš„ EGLSurface ä¸Šç»˜åˆ¶ï¼Œä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰ EGL çš„æƒ…å†µä¸‹ä½¿ç”¨ Surfaceã€‚EGLSurface ä»…ä¸º GLES æä¾›ä¸€ä¸ªç»˜åˆ¶çš„åœ°æ–¹ã€‚</p>
<h4 id="3-3-2ã€ANativeWindow"><a href="#3-3-2ã€ANativeWindow" class="headerlink" title="3.3.2ã€ANativeWindow"></a>3.3.2ã€ANativeWindow</h4><p>å…¬å¼€çš„ Surface ç±»ä»¥ Java ç¼–ç¨‹è¯­è¨€å®ç°ã€‚C/C++ ä¸­çš„åŒç­‰é¡¹æ˜¯ ANATIONWindow ç±»ï¼Œç”± Android NDK åŠå…¬å¼€ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ ANativeWindow_fromSurface() è°ƒç”¨ä» Surface è·å– ANativeWindowã€‚å°±åƒå®ƒçš„ Java è¯­è¨€åŒç­‰é¡¹ä¸€æ ·ï¼Œæ‚¨å¯ä»¥å¯¹ ANativeWindow è¿›è¡Œé”å®šã€åœ¨è½¯ä»¶ä¸­è¿›è¡Œæ¸²æŸ“ï¼Œä»¥åŠè§£é”å¹¶å‘å¸ƒã€‚</p>
<p>è¦ä»åŸç”Ÿä»£ç åˆ›å»º EGL çª—å£ Surfaceï¼Œå¯å°† EGLNativeWindowType çš„å®ä¾‹ä¼ é€’åˆ° eglCreateWindowSurface()ã€‚EGLNativeWindowType æ˜¯ ANativeWindow çš„åŒä¹‰è¯ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°åœ¨å®ƒä»¬ä¹‹é—´è½¬æ¢ã€‚</p>
<p>åŸºæœ¬çš„â€œåŸç”Ÿçª—å£â€ç±»å‹åªæ˜¯å°è£… BufferQueue çš„ç”Ÿäº§æ–¹ï¼Œè¿™ä¸€ç‚¹å¹¶ä¸è¶³ä¸ºå¥‡ã€‚</p>
<h4 id="3-3-3ã€egl-surface-t-å…³ç³»å›¾"><a href="#3-3-3ã€egl-surface-t-å…³ç³»å›¾" class="headerlink" title="3.3.3ã€egl_surface_t å…³ç³»å›¾"></a>3.3.3ã€egl_surface_t å…³ç³»å›¾</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-12-egl_surface_t.png" alt="Alt text | center"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function"><span class="keyword">static</span> EGLSurface <span class="title">createWindowSurface</span><span class="params">(EGLDisplay dpy, EGLConfig config,</span></span></span><br><span class="line"><span class="function"><span class="params">        NativeWindowType window, <span class="keyword">const</span> EGLint* <span class="comment">/*attrib_list*/</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    EGLint surfaceType;</span><br><span class="line">    <span class="keyword">if</span> (!(surfaceType &amp; EGL_WINDOW_BIT))</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_NO_SURFACE);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">static_cast</span>&lt;ANativeWindow*&gt;(window)-&gt;common.magic !=</span><br><span class="line">            ANDROID_NATIVE_WINDOW_MAGIC) &#123;</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_NATIVE_WINDOW, EGL_NO_SURFACE);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    EGLint configID;</span><br><span class="line">    <span class="keyword">if</span> (getConfigAttrib(dpy, config, EGL_CONFIG_ID, &amp;configID) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> EGL_FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int32_t</span> depthFormat;</span><br><span class="line">    <span class="keyword">int32_t</span> pixelFormat;</span><br><span class="line">    <span class="keyword">if</span> (getConfigFormatInfo(configID, pixelFormat, depthFormat) != NO_ERROR) &#123;</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_NO_SURFACE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   ......</span><br><span class="line">    <span class="keyword">egl_surface_t</span>* surface;</span><br><span class="line">    surface = <span class="keyword">new</span> <span class="keyword">egl_window_surface_v2_t</span>(dpy, config, depthFormat,</span><br><span class="line">            <span class="keyword">static_cast</span>&lt;ANativeWindow*&gt;(window));</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">return</span> surface;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-13-framebufferwindow-surface.png" alt="Alt text | center"></p>
<h4 id="3-3-4ã€EGLContext-and-Thread-Local-Storage"><a href="#3-3-4ã€EGLContext-and-Thread-Local-Storage" class="headerlink" title="3.3.4ã€EGLContext and Thread Local Storage"></a>3.3.4ã€EGLContext and Thread Local Storage</h4><h4 id="3-3-4-1ã€EGLContext"><a href="#3-3-4-1ã€EGLContext" class="headerlink" title="3.3.4.1ã€EGLContext"></a>3.3.4.1ã€EGLContext</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-14-eglcontect-TLS.png" alt="Alt text | center"></p>
<h4 id="3-3-4-2ã€Thread-Local-Storage"><a href="#3-3-4-2ã€Thread-Local-Storage" class="headerlink" title="3.3.4.2ã€Thread Local Storage"></a>3.3.4.2ã€Thread Local Storage</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-15-eglcontect-Thread-Loacal.png.png" alt="Alt text | center"></p>
<h4 id="3-3-5ã€EGLImplementation-HWCompser-and-SurfaceFlinger"><a href="#3-3-5ã€EGLImplementation-HWCompser-and-SurfaceFlinger" class="headerlink" title="3.3.5ã€EGLImplementation : HWCompser and SurfaceFlinger"></a>3.3.5ã€EGLImplementation : HWCompser and SurfaceFlinger</h4><h4 id="3-3-5-1ã€HWCompser"><a href="#3-3-5-1ã€HWCompser" class="headerlink" title="3.3.5.1ã€HWCompser"></a>3.3.5.1ã€HWCompser</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-16-Android-graphics-components.png" alt="Alt text | center"></p>
<h4 id="3-3-5-2ã€SurfaceFlinger"><a href="#3-3-5-2ã€SurfaceFlinger" class="headerlink" title="3.3.5.2ã€SurfaceFlinger"></a>3.3.5.2ã€SurfaceFlinger</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-17-eglimp-hwrenderer-surfaceflinger.png" alt="Alt text | center"></p>
<p>####ï¼ˆå››ï¼‰ã€Android EGLï¼šOpenGL ES åº“å’Œ EGL åº“åŠ è½½è¿‡ç¨‹<br>åœ¨è¯¦ç»†åˆ†æ EGL ç»˜å›¾åŸºæœ¬æ­¥éª¤ å‰ï¼Œå…ˆæ¥çœ‹çœ‹OpenGL ES åº“å’Œ EGL åº“åŠ è½½è¿‡ç¨‹ã€‚</p>
<h5 id="4-1ã€OpenGL-ES-å’Œ-OpenGL-ES-åº“çš„åŒºåˆ«"><a href="#4-1ã€OpenGL-ES-å’Œ-OpenGL-ES-åº“çš„åŒºåˆ«" class="headerlink" title="4.1ã€OpenGL ES å’Œ OpenGL ES åº“çš„åŒºåˆ«"></a>4.1ã€OpenGL ES å’Œ OpenGL ES åº“çš„åŒºåˆ«</h5><p><strong>OpenGL ES ï¼š</strong> å®ƒæœ¬èº«åªæ˜¯ä¸€ä¸ªåè®®è§„èŒƒï¼Œå®šä¹‰äº†ä¸€å¥—å¯ä»¥ä¾›ä¸Šå±‚åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒç”¨çš„ APIï¼Œå®ƒæŠ½è±¡äº† GPU çš„åŠŸèƒ½ï¼Œä½¿åº”ç”¨å¼€å‘è€…ä¸å¿…å…³å¿ƒåº•å±‚çš„ GPU ç±»å‹å’Œå…·ä½“å®ç°ã€‚<br><strong>OpenGL ES åº“ï¼š</strong>OpenGL ES åº“å°±æ˜¯ä¸Šé¢ OpenGL ES ä¸­å®šä¹‰çš„ API çš„å…·ä½“å®ç°ã€‚ç”±äºæ¯ä¸ªæ˜¾å¡åˆ¶é€ å‚å•†çš„ GPU ç¡¬ä»¶ç»“æ„ä¸åŒï¼Œä»è€Œå¯¼è‡´å„ä¸ªå‚å•†çš„OpenGL ES åº“ä¹Ÿå„ä¸ç›¸åŒï¼Œæ‰€ä»¥ Android ç³»ç»Ÿä¸­çš„ OpenGL ES åº“é€šå¸¸æ˜¯ç”±ç¡¬ä»¶å‚å•†æä¾›çš„ï¼Œé€šå¸¸å­˜æ”¾åœ¨ Android ç³»ç»Ÿä¸­çš„ /system/lib64/ï¼ˆ/system/lib/ï¼‰ ã€‚<br><strong>OpenGL ES Wrapper åº“ï¼š</strong>OpenGL ES Wrapper åº“æ˜¯ä¸€ä¸ªå¯¹ OpenGL ES API è¿›è¡Œå°è£…çš„ä¸€ä¸ªåŒ…è£¹åº“ï¼Œå®ƒå‘ä¸Šä¸ºåº”ç”¨ç¨‹åºæä¾›äº†æ ‡å‡†çš„ OpenGL ES APIï¼Œå‘ä¸‹å¯ä»¥å’Œä¸åŒå‚å•†å®ç°çš„ OpenGL ES åº“è¿›è¡Œç»‘å®šï¼Œå°† OpenGL ES API å’Œå¯¹åº”çš„å®ç°å‡½æ•°ä¸€ä¸€ç»‘å®šåœ¨ä¸€èµ·ã€‚<br>å¹¶ä¸”ï¼ŒOpenGL ES åº“çš„å®ç°åˆ†ä¸ºï¼š<br><strong>è½¯ä»¶æ¨¡æ‹Ÿå®ç°</strong><br><strong>ç¡¬ä»¶åŠ é€Ÿå®ç°</strong><br>ç°åœ¨ï¼Œå› ä¸ºæˆ‘ä»¬ Android æ‰‹æœºä¸­çš„ Soc ç‰‡ä¸ŠèŠ¯ç‰‡ä¸­éƒ½é›†æˆäº† GPU æ¨¡å—ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„å°±æ˜¯ç¡¬ä»¶åŠ é€Ÿå®ç°çš„ OpenGL ES åº“ã€‚ä½†æ˜¯ï¼Œåƒ Android Emulator ä¸­çš„ Android ç³»ç»Ÿï¼Œå¦‚æœä¸æ”¯æŒå°† OpenGL ES API æŒ‡ä»¤é‡å®šå‘åˆ°ä¸»æœºç³»ç»Ÿçš„ GPU åŠ é€Ÿæ‰§è¡Œçš„è¯ï¼Œå®ƒæ‰€é‡‡ç”¨çš„ OpenGL ES åº“å°±æ˜¯è½¯ä»¶æ¨¡æ‹Ÿå®ç°çš„ã€‚</p>
<p>è¡¥å……ï¼šå¦‚å‰é¢å°èŠ‚ã€OpenGL ES å’Œ EGL ä»‹ç»ã€‘ä¸­ä»‹ç»çš„ï¼ŒEGL ä¹Ÿæ˜¯ä¸€å¥— APIï¼Œå®ƒçš„å®ç°ä¹Ÿéœ€è¦ç³»ç»Ÿå‚å•†æ¥æä¾›ã€‚ç³»ç»Ÿå‚å•†é€šå¸¸ä¼šå°†è¿™ä¸¤å¥— API çš„å®ç°å°è£…åœ¨ä¸€ä¸ªå…±äº«é“¾æ¥åº“ä¸­ï¼Œä½†æ˜¯æ ¹æ®æœ€æ–°çš„æ ‡å‡†ï¼ŒOpenGL ES API å®ç°çš„å…±äº«é“¾æ¥åº“å’Œ EGL API å®ç°çš„å…±äº«é“¾æ¥åº“æ˜¯ç‹¬ç«‹åˆ†å¼€çš„ï¼Œä¾‹å¦‚  Nexus 9 å¹³æ¿è®¾å¤‡ä¸­ OpenGL ES å’Œ EGL API å®ç°åº“å°±æ˜¯ç‹¬ç«‹åˆ†å¼€çš„ã€‚</p>
<h5 id="4-2ã€Android-ä¸­-OpenGL-ES-è½¯ä»¶å±‚æ¬¡æ ˆ"><a href="#4-2ã€Android-ä¸­-OpenGL-ES-è½¯ä»¶å±‚æ¬¡æ ˆ" class="headerlink" title="4.2ã€Android ä¸­ OpenGL ES è½¯ä»¶å±‚æ¬¡æ ˆ"></a>4.2ã€Android ä¸­ OpenGL ES è½¯ä»¶å±‚æ¬¡æ ˆ</h5><p>æŒ‰ç…§åˆ†å±‚ç†å¿µçš„è®¾è®¡ï¼ŒAndroid ä¸­çš„ OpenGL ES å®ç°ä¹Ÿæ˜¯å±‚æ¬¡è®¾è®¡çš„ï¼Œå½¢æˆä¸€ä¸ªè½¯ä»¶å±‚æ¬¡æ ˆã€‚æœ€ä¸Šé¢çš„æ˜¯ Java å±‚ï¼Œæ¥ç€ä¸‹é¢æ˜¯ JNI å±‚ï¼Œå†è°ƒç”¨ä¸‹é¢çš„ wrapper å±‚ï¼Œwrapper å±‚ä¸‹é¢åˆ™æ˜¯ OpenGL ES API çš„å…·ä½“è½¯ä»¶å®æˆ–è€…ç¡¬ä»¶å®ç°äº†ã€‚æ•´ä¸ª OpenGL è½¯ä»¶å±‚æ¬¡æ ˆçš„è°ƒç”¨å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-18-OpenGL_ES_call_graph_so.png" alt="Alt text | center"></p>
<h5 id="4-3ã€OpenGL-ES-EGL-Wrapper-åº“"><a href="#4-3ã€OpenGL-ES-EGL-Wrapper-åº“" class="headerlink" title="4.3ã€OpenGL ES/EGL Wrapper åº“"></a>4.3ã€OpenGL ES/EGL Wrapper åº“</h5><p>å‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ OpenGL ES/EGL Wrapper åº“æ˜¯ä¸€ä¸ªå°† OpenGL ES API å’Œ OpenGL ES API å…·ä½“å®ç°ç»‘å®šåœ¨ä¸€èµ·çš„åº“ï¼Œå®ƒå¯¹åº”çš„æºç è·¯å¾„æ˜¯ï¼š/frameworks/native/opengl/libs/ï¼Œå…¶ä¸­:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libGLESv1_CM.soï¼šOpenGL ES <span class="number">1.</span>x API çš„ Wrapper åº“</span><br><span class="line">libGLESv2.soï¼šOpenGL ES <span class="number">2.0</span> çš„ Wrapper åº“</span><br><span class="line">libGLESv3.soï¼šOpenGL ES <span class="number">3.0</span> çš„ Wrapper åº“</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å› ä¸º OpenGL ES 3.0 API æ˜¯å…¼å®¹ OpenGL ES 2.0 API çš„ï¼Œæ‰€ä»¥ libGLESv2.so åº“æœ¬è´¨ä¸Šå’Œ libGLESv3.so åº“æ˜¯ä¸€æ ·çš„ã€‚</p>
<h5 id="4-3-1ã€OpenGL-ES-EGL-å®ç°åº“"><a href="#4-3-1ã€OpenGL-ES-EGL-å®ç°åº“" class="headerlink" title="4.3.1ã€OpenGL ES/EGL å®ç°åº“"></a>4.3.1ã€OpenGL ES/EGL å®ç°åº“</h5><p>å¦‚æœAndroidç³»ç»Ÿå¹³å°æ”¯æŒ OpenGL ES ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ï¼Œé‚£ä¹ˆ OpenGL ES/EGL å®ç°åº“ç”±ç³»ç»Ÿå‚å•†ä»¥.soçš„å…±äº«é“¾æ¥åº“çš„å½¢å¼æä¾›ï¼Œä¾‹å¦‚ï¼Œé«˜é€šçš„å®ç°ï¼šsystem\vendor\lib\egl</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libEGL_adreno.so </span><br><span class="line">libGLESv1_CM_adreno.so</span><br><span class="line">libGLESv2_adreno.so</span><br></pre></td></tr></table></figure>

<p>å¦‚æœAndroidç³»ç»Ÿå¹³å°ä¸æ”¯æŒ OpenGL ES ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šé»˜è®¤å¯ç”¨è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“ï¼Œè¿™æ—¶ OpenGL ES/EGL å®ç°åº“å°±æ˜¯ç”± AOSP æä¾›ï¼Œé“¾æ¥åº“çš„å­˜åœ¨çš„è·¯å¾„ä¸ºï¼š /system/lib64/egl/libGLES_android.soã€‚è€Œ libGLES_android.so åº“åœ¨ Android 7.1 ç³»ç»Ÿå¯¹åº”çš„å®ç°æºç è·¯å¾„ä¸ºï¼š/frameworks/native/opengl/libagl/ ã€‚</p>
<h5 id="4-3-2ã€Android-7-1-ä¸­åŠ è½½-OpenGL-ES-åº“çš„è¿‡ç¨‹"><a href="#4-3-2ã€Android-7-1-ä¸­åŠ è½½-OpenGL-ES-åº“çš„è¿‡ç¨‹" class="headerlink" title="4.3.2ã€Android 7.1 ä¸­åŠ è½½ OpenGL ES åº“çš„è¿‡ç¨‹"></a>4.3.2ã€Android 7.1 ä¸­åŠ è½½ OpenGL ES åº“çš„è¿‡ç¨‹</h5><p>Android ä¸­å›¾å½¢æ¸²æŸ“æ‰€é‡‡ç”¨çš„æ–¹å¼ï¼ˆç¡¬ä»¶ or è½¯ä»¶ï¼‰æ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨ä¹‹ååŠ¨æ€ç¡®å®šçš„ï¼Œè€Œç¡®å®šæ¸²æŸ“æ–¹å¼çš„è¿™ä¸ªæºç æ–‡ä»¶å°±æ˜¯ /frameworks/native/opengl/libs/EGL/Loader.cpp ã€‚</p>
<h5 id="4-3-2-1ã€-Android-7-1-OpenGL-ES-åº“å’Œ-EGL-åº“åŠ è½½è¯´æ˜"><a href="#4-3-2-1ã€-Android-7-1-OpenGL-ES-åº“å’Œ-EGL-åº“åŠ è½½è¯´æ˜" class="headerlink" title="4.3.2.1ã€ Android 7.1 OpenGL ES åº“å’Œ EGL åº“åŠ è½½è¯´æ˜"></a>4.3.2.1ã€ Android 7.1 OpenGL ES åº“å’Œ EGL åº“åŠ è½½è¯´æ˜</h5><p><a target="_blank" rel="noopener" href="http://www.2net.co.uk/tutorial/android-egl-cgf-is-dead">How Android finds OpenGL libraries, and the death of egl.cfg</a> è¿™ç¯‡æ–‡ç« ä¸­æåˆ°äº†éå¸¸å…³é”®çš„ä¸€ç‚¹ï¼Œå°±æ˜¯ä» Android Kitkat 4.4 ä¹‹åï¼ŒAndroid ä¸­åŠ è½½ OpenGL ES/EGL åº“çš„æ–¹æ³•å‘ç”Ÿäº†å˜åŒ–äº†ï¼ˆä½†æ˜¯æ•´ä¸ªåŠ è½½è¿‡ç¨‹éƒ½æ˜¯ç”± /frameworks/native/opengl/libs/EGL/Loader.cpp ç¨‹åºæ‰€å†³å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ Loader.cpp æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚</p>
<p>åœ¨ Android 4.4 ä¹‹å‰ï¼ŒåŠ è½½ OpenGL ES åº“æ˜¯ç”± /system/lib/egl/egl.cfg æ–‡ä»¶æ‰€å†³å®šçš„ï¼Œé€šè¿‡è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶æ¥ç¡®å®šæ˜¯åŠ è½½ OpenGL ES è½¯ä»¶æ¨¡æ‹Ÿå®ç°çš„åº“ï¼Œè¿˜æ˜¯OpenGL ES ç¡¬ä»¶åŠ é€Ÿå®ç°çš„åº“ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨Android 4.4 ä¹‹åï¼ŒAndroid ä¸å†é€šè¿‡è¯»å– egl.cfg é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥åŠ è½½ OpenGL ES åº“ï¼Œæ–°çš„åŠ è½½ OpenGL ES åº“çš„è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>ä» /system/lib/egl æˆ–è€… /system/vendor/lib/egl/ ç›®å½•ä¸‹åŠ è½½ libGLES.so åº“æ–‡ä»¶æˆ–è€… libEGL_vendor.soï¼ŒlibGLESv1_CM_vendor.soï¼ŒlibGLESv2_vendor.so åº“æ–‡ä»¶ã€‚<br>ä¸ºäº†å‘ä¸‹å…¼å®¹æ—§çš„åº“çš„å‘½åæ–¹å¼ï¼ŒåŒæ ·ä¹Ÿä¼šåŠ è½½ /system/lib/egl æˆ–è€… /vendor/lib/egl/ ç›®å½•ä¸‹çš„ libGLES_*.so æˆ–è€… libEGL_*.soï¼ŒlibGLESv1CM*.soï¼ŒlibGLESv2_*.so åº“æ–‡ä»¶ã€‚</p>
<h5 id="4-3-2-2ã€ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“-or-è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“ï¼Ÿ"><a href="#4-3-2-2ã€ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“-or-è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“ï¼Ÿ" class="headerlink" title="4.3.2.2ã€ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ or è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“ï¼Ÿ"></a>4.3.2.2ã€ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ or è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“ï¼Ÿ</h5><p>å‰é¢æˆ‘ä»¬æåˆ° OpenGL ES åº“çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç¡¬ä»¶åŠ é€Ÿå®ç°ï¼Œä¸€ç§æ˜¯è½¯ä»¶æ¨¡æ‹Ÿå®ç°ï¼Œé‚£ä¹ˆç³»ç»Ÿæ˜¯æ€ä¹ˆç¡®å®šåŠ è½½é‚£ä¸€ç§ OpenGL ES åº“çš„å‘¢ï¼Ÿ</p>
<p>Android 7.1 æºç ä¸­è´Ÿè´£åŠ è½½ OpenGL ES/EGL åº“éƒ¨åˆ†çš„ä»£ç ä½äºï¼š/frameworks/native/opengl/libs/EGL/Loader.cpp æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­ä»£ç çš„ä¸»è¦å…¥å£å‡½æ•°æ˜¯ Loader::open() å‡½æ•°ï¼Œè€Œå†³å®šåŠ è½½ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“åº“è¿˜æ˜¯è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“åº“ä¸»è¦æ¶‰åŠåˆ°ä¸‹é¢ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setEmulatorGlesValue()</span><br><span class="line">checkGlesEmulationStatus()</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å°±æ¥ç®€è¦çš„åˆ†æä¸€ä¸‹ Android ç³»ç»Ÿæ˜¯å¦‚ä½•é€‰æ‹©åŠ è½½ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“åº“è¿˜æ˜¯è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“åº“ï¼š</p>
<p>é¦–å…ˆï¼ŒLoader::open() å…¥å£å‡½æ•°ä¼šè°ƒç”¨ setEmulatorGlesValue() ä» property å±æ€§ç³»ç»Ÿä¸­è·å–ä¸€äº›å±æ€§å€¼æ¥åˆ¤æ–­å½“å‰ Android ç³»ç»Ÿæ˜¯å¦åœ¨ Emulator ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶æ ¹æ®è¯»å–å‡ºæ¥çš„ä¿¡æ¯æ¥é‡æ–°è®¾ç½®æ–°çš„å±æ€§é”®å€¼å¯¹ï¼ŒsetEmulatorGlesValue() å‡½æ•°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;/frameworks/native/opengl/libs/EGL/Loader.cpp]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setEmulatorGlesValue</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">char</span> prop[PROPERTY_VALUE_MAX];</span><br><span class="line">     property_get(<span class="string">&quot;ro.kernel.qemu&quot;</span>, prop, <span class="string">&quot;0&quot;</span>); <span class="comment">//è¯»å– ro.kernel.qemu å±æ€§å€¼ï¼Œåˆ¤æ–­Androidç³»ç»Ÿæ˜¯å¦è¿è¡Œåœ¨ qemu ä¸­</span></span><br><span class="line">     <span class="keyword">if</span> (atoi(prop) != <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">     property_get(<span class="string">&quot;ro.kernel.qemu.gles&quot;</span>, prop, <span class="string">&quot;0&quot;</span>); <span class="comment">//è¯»å– ro.kernel.qemu.gles å±æ€§å€¼ï¼Œåˆ¤æ–­ qemu ä¸­ OpenGL ES åº“çš„å®ç°æ–¹å¼</span></span><br><span class="line">     <span class="keyword">if</span> (atoi(prop) == <span class="number">1</span>) &#123;</span><br><span class="line">         ALOGD(<span class="string">&quot;Emulator has host GPU support, qemu.gles is set to 1.&quot;</span>);</span><br><span class="line">         property_set(<span class="string">&quot;qemu.gles&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// for now, checking the following</span></span><br><span class="line">     <span class="comment">// directory is good enough for emulator system images</span></span><br><span class="line">     <span class="keyword">const</span> <span class="keyword">char</span>* vendor_lib_path =</span><br><span class="line"> #<span class="keyword">if</span> defined(__LP64__)</span><br><span class="line">         <span class="string">&quot;/vendor/lib64/egl&quot;</span>;</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">         <span class="string">&quot;/vendor/lib/egl&quot;</span>;</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">     <span class="keyword">const</span> <span class="keyword">bool</span> has_vendor_lib = (access(vendor_lib_path, R_OK) == <span class="number">0</span>);</span><br><span class="line">     <span class="comment">//å¦‚æœå­˜åœ¨ vendor_lib_path è¿™ä¸ªè·¯å¾„ï¼Œé‚£ä¹ˆå°±è¯´æ˜å‚å•†æä¾›äº† OpenGL ESåº“è‡ªå·±çš„è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“åº“ï¼Œè€Œä¸æ˜¯ Android ç³»ç»Ÿè‡ªå·±ç¼–è¯‘å¾—åˆ°çš„è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“åº“</span></span><br><span class="line">     <span class="keyword">if</span> (has_vendor_lib) &#123;</span><br><span class="line">         ALOGD(<span class="string">&quot;Emulator has vendor provided software renderer, qemu.gles is set to 2.&quot;</span>);</span><br><span class="line">         property_set(<span class="string">&quot;qemu.gles&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         ALOGD(<span class="string">&quot;Emulator without GPU support detected. &quot;</span></span><br><span class="line">               <span class="string">&quot;Fallback to legacy software renderer, qemu.gles is set to 0.&quot;</span>);</span><br><span class="line">         property_set(<span class="string">&quot;qemu.gles&quot;</span>, <span class="string">&quot;0&quot;</span>); <span class="comment">//æœ€åï¼Œé»˜è®¤é‡‡å–çš„æ˜¯æ–¹æ¡ˆå°±æ˜¯è°ƒç”¨ä¼ ç»Ÿçš„Androidç³»ç»Ÿè‡ªå·±ç¼–è¯‘å¾—åˆ°è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“åº“</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ load_system_driver() å‡½æ•°ä¸­ï¼Œå†…éƒ¨ç±» MatchFile ç±»ä¸­ä¼šè°ƒç”¨ checkGlesEmulationStatus() å‡½æ•°æ¥æ£€æŸ¥ Android ç³»ç»Ÿæ˜¯å¦è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œä»¥åŠåœ¨æ¨¡æ‹Ÿå™¨ä¸­æ˜¯å¦å¯ç”¨äº†ä¸»æœºç¡¬ä»¶åŠ é€Ÿçš„åŠŸèƒ½ï¼Œç„¶åæ ¹æ® checkGlesEmulationStatus() å‡½æ•°çš„è¿”å›çŠ¶æ€å€¼æ¥ç¡®å®šè¦åŠ è½½å…±äº«é“¾æ¥åº“çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ã€‚load_system_driver() å’Œ checkGlesEmulationStatus() å‡½æ•°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;/frameworks/native/opengl/libs/EGL/Loader.cpp]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>* <span class="title">load_system_driver</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* kind)</span> </span>&#123;</span><br><span class="line">     ATRACE_CALL();</span><br><span class="line">     <span class="class"><span class="keyword">class</span> <span class="title">MatchFile</span> &#123;</span></span><br><span class="line">     <span class="keyword">public</span>:</span><br><span class="line">         <span class="comment">//è¿™ä¸ªå‡½æ•°ä½œç”¨æ˜¯è¿”å›éœ€è¦åŠ è½½æ‰“å¼€çš„ OpenGL ES å’Œ EGL API å®ç°åº“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">         <span class="function"><span class="keyword">static</span> String8 <span class="title">find</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* kind)</span> </span>&#123;</span><br><span class="line">             String8 result;</span><br><span class="line">             <span class="keyword">int</span> emulationStatus = checkGlesEmulationStatus(); <span class="comment">//æ£€æŸ¥ Android ç³»ç»Ÿæ˜¯å¦è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œä»¥åŠåœ¨æ¨¡æ‹Ÿå™¨ä¸­æ˜¯å¦å¯ç”¨äº†ä¸»æœºç¡¬ä»¶åŠ é€Ÿçš„åŠŸèƒ½</span></span><br><span class="line">             <span class="keyword">switch</span> (emulationStatus) &#123;</span><br><span class="line">             <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">//Android è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œä½¿ç”¨ç³»ç»Ÿè½¯ä»¶æ¨¡æ‹Ÿå®ç°çš„ OpenGL ES API åº“ libGLES_android.so</span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">if</span> defined(__LP64__)</span></span><br><span class="line">                 result.setTo(<span class="string">&quot;/system/lib64/egl/libGLES_android.so&quot;</span>);</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">                 result.setTo(<span class="string">&quot;/system/lib/egl/libGLES_android.so&quot;</span>);</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">                 <span class="keyword">return</span> result;</span><br><span class="line">             <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// Android è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œé€šè¿‡ä¸»æœºç³»ç»Ÿä¸­å®ç° OpenGL ES åŠ é€Ÿæ¸²æŸ“ï¼Œé€šè¿‡ libGLES_emulation.so åº“å°†  OpenGL ES API æŒ‡ä»¤é‡å®šå‘åˆ° host ä¸­æ‰§è¡Œ</span></span><br><span class="line">                 <span class="comment">// Use host-side OpenGL through the &quot;emulation&quot; library</span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">if</span> defined(__LP64__)</span></span><br><span class="line">                 result.appendFormat(<span class="string">&quot;/system/lib64/egl/lib%s_emulation.so&quot;</span>, kind);</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">                 result.appendFormat(<span class="string">&quot;/system/lib/egl/lib%s_emulation.so&quot;</span>, kind);</span><br><span class="line"> <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">                 <span class="keyword">return</span> result;</span><br><span class="line">             <span class="keyword">default</span>:</span><br><span class="line">                 <span class="comment">// Not in emulator, or use other guest-side implementation</span></span><br><span class="line">                 <span class="keyword">break</span>;</span><br><span class="line">             &#125;</span><br><span class="line">    </span><br><span class="line">             <span class="comment">// å¦‚æœä¸æ˜¯ä¸Šé¢ä¸¤ç§æƒ…å†µï¼Œå°±æ ¹æ®åº“çš„å‘½åè§„åˆ™å»æ‰¾åˆ°å‚å•†å®ç°åº“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">             String8 pattern;</span><br><span class="line">             pattern.appendFormat(<span class="string">&quot;lib%s&quot;</span>, kind);</span><br><span class="line">             <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> searchPaths[] = &#123;</span><br><span class="line"> #<span class="keyword">if</span> defined(__LP64__)</span><br><span class="line">                 <span class="string">&quot;/vendor/lib64/egl&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;/system/lib64/egl&quot;</span></span><br><span class="line"> #<span class="keyword">else</span></span><br><span class="line">                 <span class="string">&quot;/vendor/lib/egl&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;/system/lib/egl&quot;</span></span><br><span class="line"> #endif</span><br><span class="line">             &#125;;</span><br><span class="line">                </span><br><span class="line">             ......</span><br><span class="line">     &#125;</span><br><span class="line">        </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢ä»£ç çš„åŠŸèƒ½å°±æ˜¯ï¼Œé¦–å…ˆåˆ¤æ–­ Android æ˜¯å¦åœ¨ qemu è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥å»åŠ è½½å‚å•†å­˜æ”¾åº“çš„è·¯å¾„ä¸­å»åŠ è½½ OpenGL ES å®ç°åº“ï¼ˆä¸ç®¡æ˜¯ç¡¬ä»¶åŠ é€Ÿå®ç°çš„ï¼Œè¿˜æ˜¯è½¯ä»¶æ¨¡æ‹Ÿå®ç°çš„ï¼‰ï¼›å¦‚æœæ˜¯åœ¨ qemu ä¸­è¿è¡Œï¼Œé‚£ä¹ˆå°±è¦æ ¹æ®è¿”å›çš„ emulationStatus å€¼ æ¥ç¡®å®šæ˜¯åŠ è½¯ä»¶æ¨¡æ‹Ÿå®ç°çš„ OpenGL ES API åº“ libGLES_android.soï¼Œè¿˜æ˜¯åŠ è½½ libGLES_emulation.soåº“å°† OpenGL ES æŒ‡ä»¤é‡å®šå‘åˆ° Host ç³»ç»Ÿä¸­å»æ‰§è¡Œã€‚</p>
<h5 id="4-3-3ã€OpenGL-ES-EGL-åº“åŠ è½½å’Œè§£æè¿‡ç¨‹"><a href="#4-3-3ã€OpenGL-ES-EGL-åº“åŠ è½½å’Œè§£æè¿‡ç¨‹" class="headerlink" title="4.3.3ã€OpenGL ES/EGL åº“åŠ è½½å’Œè§£æè¿‡ç¨‹"></a>4.3.3ã€OpenGL ES/EGL åº“åŠ è½½å’Œè§£æè¿‡ç¨‹</h5><p>æ­£å¦‚å‰é¢åˆ†æï¼Œåœ¨è¿›è¡Œ OpenGL ç¼–ç¨‹æ—¶ï¼Œæœ€å…ˆå¼€å§‹éœ€è¦è·å– Displayï¼Œè¿™å°†è°ƒç”¨ eglgGetDisplay() å‡½æ•°è¢«è°ƒç”¨ã€‚åœ¨ eglGetDisplay() é‡Œåˆ™ä¼šè°ƒç”¨ egl_init_drivers() åˆå§‹åŒ–é©±åŠ¨ï¼šè£…è½½å„ä¸ªåº“è¿›è¡Œè§£æï¼Œå°† OpenGL ES/EGL API å‡½æ•°æ¥å£å’Œå…·ä½“çš„å®ç°ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ egl_connection_t ç±»å‹çš„å…¨å±€å˜é‡ gEGLImpl çš„ç»“æ„ä½“çš„æˆå‘˜å˜é‡ä¸­ã€‚</p>
<p>ä¸‹é¢ä»¥ SurfaceFlinger è¿›ç¨‹init()ä¸ºä¾‹è¿›è¡Œåˆ†æï¼Œæ•´ä¸ª OpenGL ES/EGL åº“çš„åŠ è½½å’Œè§£ææµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-19-SF_init.png" alt="Alt text | center"></p>
<p>è¿™é‡Œé€šè¿‡è°ƒç”¨ EGL åº“çš„ eglGetDisplay() è·å¾— Displayã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libs\EGL\eglApi.cpp]</span><br><span class="line"><span class="function">EGLDisplay <span class="title">eglGetDisplay</span><span class="params">(EGLNativeDisplayType display)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (egl_init_drivers() == EGL_FALSE) &#123;</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_PARAMETER, EGL_NO_DISPLAY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    EGLDisplay dpy = <span class="keyword">egl_display_t</span>::getFromNativeDisplay(display);</span><br><span class="line">    <span class="keyword">return</span> dpy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‡½æ•°EGLBoolean egl_init_drivers()å°±æ˜¯è´Ÿè´£OpenGLåº“çš„åŠ è½½ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libs\EGL\egl.cpp]</span><br><span class="line"><span class="function">EGLBoolean <span class="title">egl_init_drivers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    EGLBoolean res;</span><br><span class="line">    pthread_mutex_lock(&amp;sInitDriverMutex);</span><br><span class="line">    res = egl_init_drivers_locked();</span><br><span class="line">    pthread_mutex_unlock(&amp;sInitDriverMutex);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºä¿è¯å¤šçº¿ç¨‹è®¿é—®çš„å®‰å…¨æ€§ï¼Œä½¿ç”¨çº¿ç¨‹é”æ¥æ”¾å®Œå¦ä¸€ä¸ªæ¥å£å‡½æ•°egl_init_drivers_locked()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libs\EGL\egl.cpp]</span><br><span class="line"><span class="comment">//åœ¨è¯¥æ–‡ä»¶èµ·å§‹ä½ç½®å®šä¹‰çš„å…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">egl_connection_t</span> gEGLImpl; <span class="comment">// æè¿°EGLå®ç°å†…å®¹çš„ç»“æ„ä½“å¯¹è±¡</span></span><br><span class="line"><span class="keyword">gl_hooks_t</span> gHooks[<span class="number">2</span>]; <span class="comment">// gl_hooks_t æ˜¯åŒ…å« OpenGL ES API å‡½æ•°å£°æ˜å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">gl_hooks_t</span> gHooksNoContext;</span><br><span class="line"><span class="keyword">pthread_key_t</span> gGLWrapperKey = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> EGLBoolean <span class="title">egl_init_drivers_locked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sEarlyInitState) &#123;</span><br><span class="line">        <span class="comment">// initialized by static ctor. should be set here.</span></span><br><span class="line">        <span class="keyword">return</span> EGL_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾—åˆ° Loader å¯¹è±¡å•ä¾‹</span></span><br><span class="line">    <span class="comment">// get our driver loader</span></span><br><span class="line">    <span class="function">Loader&amp; <span class="title">loader</span><span class="params">(Loader::getInstance())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  gEGLImple æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ•°æ®ç±»å‹ä¸º egl_connection_t ç»“æ„ä½“ç±»å‹</span></span><br><span class="line">    <span class="comment">// dynamically load our EGL implementation</span></span><br><span class="line">    <span class="keyword">egl_connection_t</span>* cnx = &amp;gEGLImpl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cnx-&gt;dso æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª (void *)ç±»å‹çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡æ˜¯ EGL å…±äº«åº“æ‰“å¼€ä¹‹åçš„å¥æŸ„</span></span><br><span class="line">    <span class="keyword">if</span> (cnx-&gt;dso == <span class="number">0</span>) &#123; </span><br><span class="line">        <span class="comment">// &gt;= å°†cnxä¸­çš„ hooks æ•°ç»„ä¸­æŒ‡å‘OpenGL ES API å‡½æ•°æŒ‡é’ˆç»“æ„ä½“æŒ‡çš„æ•°ç»„æˆå‘˜ï¼Œç”¨ gHooks ä¸­çš„æˆå‘˜çš„åœ°å€å»åˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">//ä¹Ÿå°±æ˜¯è¯´ gEGLImpl ä¸­ hook æ•°ç»„æŒ‡å‘ gHooks æ•°ç»„ï¼Œæœ€ç»ˆæŒ‡å‘åŒä¸€ä¸ª OpenGL ES API å‡½æ•°æŒ‡é’ˆçš„å®ç°</span></span><br><span class="line">        cnx-&gt;hooks[<span class="keyword">egl_connection_t</span>::GLESv1_INDEX] =</span><br><span class="line">            &amp;gHooks[<span class="keyword">egl_connection_t</span>::GLESv1_INDEX];</span><br><span class="line">        cnx-&gt;hooks[<span class="keyword">egl_connection_t</span>::GLESv2_INDEX] =</span><br><span class="line">            &amp;gHooks[<span class="keyword">egl_connection_t</span>::GLESv2_INDEX];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &gt;= æœ€åé€šè¿‡loaderå¯¹è±¡çš„openå‡½æ•°å¼€å§‹åŠ è½½ OpenGL ES å’Œ EGL wrapper åº“</span></span><br><span class="line">        cnx-&gt;dso = loader.open(cnx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cnx-&gt;dso ? EGL_TRUE : EGL_FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸å…³é”®çš„ egl_connection_t æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå…¨å±€å˜é‡ gEGLImplï¼Œå½“ç¬¬ä¸€æ¬¡åˆå§‹åŒ–åŠ è½½ OpenGL ES å®ç°åº“å’Œ EGL å®ç°åº“æ—¶ï¼Œè¿˜éœ€è¦å°† gEGLImpl ä¸­çš„ hooks æ•°ç»„ä¸­çš„ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå…¨å±€çš„ gl_hooks_t æ•°ç»„ gHooksï¼ˆè¿™å°±æ˜¯ä¸¤ä¸ªæŒ‡é’ˆé’©å­ï¼Œæœ€ç»ˆåˆå§‹åŒ–å®Œæˆåå°†åˆ†åˆ«å‹¾ä½ OpenGL ES 1.0 å’Œ OpenGL ES 2.0 çš„å®ç°åº“ï¼‰ï¼Œæ¥ç€è°ƒç”¨ Loader ç±»çš„å®ä¾‹çš„ open() å‡½æ•°å®Œæˆä» OpenGL ES å®ç°åº“ä¸­å®Œæˆç¬¦å·è§£æå·¥ä½œã€‚</p>
<p>Loader::open() å‡½æ•°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[/frameworks/native/opengl/libs/EGL/Loader.cpp]</span><br><span class="line"><span class="comment">// &gt;= Loader ç±»å¯¹è±¡æ„é€ å®Œæˆåï¼Œå°±åœ¨ /EGL/egl.cpp æ–‡ä»¶ä¸­çš„ egl_init_drivers_locked() ä¸­è¢«è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">Loader::open</span><span class="params">(<span class="keyword">egl_connection_t</span>* cnx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span>* dso;</span><br><span class="line">    <span class="keyword">driver_t</span>* hnd = <span class="number">0</span>;</span><br><span class="line">    setEmulatorGlesValue();</span><br><span class="line">    dso = load_driver(<span class="string">&quot;GLES&quot;</span>, cnx, EGL | GLESv1_CM | GLESv2);</span><br><span class="line">    <span class="keyword">if</span> (dso) &#123;</span><br><span class="line">        hnd = <span class="keyword">new</span> <span class="keyword">driver_t</span>(dso);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Always load EGL first</span></span><br><span class="line">        dso = load_driver(<span class="string">&quot;EGL&quot;</span>, cnx, EGL);</span><br><span class="line">        <span class="keyword">if</span> (dso) &#123;</span><br><span class="line">            hnd = <span class="keyword">new</span> <span class="keyword">driver_t</span>(dso);</span><br><span class="line">            hnd-&gt;<span class="built_in">set</span>( load_driver(<span class="string">&quot;GLESv1_CM&quot;</span>, cnx, GLESv1_CM), GLESv1_CM );</span><br><span class="line">            hnd-&gt;<span class="built_in">set</span>( load_driver(<span class="string">&quot;GLESv2&quot;</span>,    cnx, GLESv2),    GLESv2 );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    cnx-&gt;libEgl   = load_wrapper(EGL_WRAPPER_DIR <span class="string">&quot;/libEGL.so&quot;</span>);</span><br><span class="line">    cnx-&gt;libGles2 = load_wrapper(EGL_WRAPPER_DIR <span class="string">&quot;/libGLESv2.so&quot;</span>);</span><br><span class="line">    cnx-&gt;libGles1 = load_wrapper(EGL_WRAPPER_DIR <span class="string">&quot;/libGLESv1_CM.so&quot;</span>);</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">void</span>*)hnd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>open() å‡½æ•°ä¸»è¦è´Ÿè´£ OpenGL ES åº“åŠ è½½å‰çš„å‡†å¤‡å·¥ä½œï¼Œå…·ä½“çš„åŠ è½½ç»†èŠ‚ï¼Œåˆ™æ˜¯é€šè¿‡è°ƒç”¨ load_driver() å»å®Œæˆçš„ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[/frameworks/native/opengl/libs/EGL/Loader.cpp]</span><br><span class="line"><span class="function">oid *<span class="title">Loader::load_driver</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* kind,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">egl_connection_t</span>* cnx, <span class="keyword">uint32_t</span> mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span>* dso = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (mGetDriverNamespace) &#123;</span><br><span class="line">        <span class="keyword">android_namespace_t</span>* ns = mGetDriverNamespace();</span><br><span class="line">        <span class="keyword">if</span> (ns) &#123;</span><br><span class="line">            dso = load_updated_driver(kind, ns); <span class="comment">//åŠ è½½ OpenGL ES å®ç°åº“ï¼Œæ”¾å›æ‰“å¼€çš„å…±äº«é“¾æ¥åº“çš„å¥æŸ„</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!dso) &#123;</span><br><span class="line">        dso = load_system_driver(kind);</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ EGL åº“ï¼Œå¹¶å°†wrapper åº“ libEGL.so ä¸­çš„å‡½æ•° API æŒ‡é’ˆå’Œå…·ä½“çš„å®ç°ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="keyword">if</span> (mask &amp; EGL) &#123;</span><br><span class="line">        getProcAddress = (getProcAddressType)dlsym(dso, <span class="string">&quot;eglGetProcAddress&quot;</span>);</span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">egl_t</span>* egl = &amp;cnx-&gt;egl; <span class="comment">//å°† egl æŒ‡é’ˆæŒ‡å‘æè¿°å½“å‰ç³»ç»Ÿæ”¯æŒ OpenGL ESå’Œ EGL å…¨å±€å˜é‡çš„ gEGLImpl</span></span><br><span class="line">        __eglMustCastToProperFunctionPointerType* curr =</span><br><span class="line">            (__eglMustCastToProperFunctionPointerType*)egl;</span><br><span class="line">        <span class="keyword">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> * api = egl_names; <span class="comment">//egl_names æ˜¯å®šä¹‰åœ¨ egl.cpp æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯ EGL API å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">while</span> (*api) &#123;</span><br><span class="line">            <span class="keyword">char</span> <span class="keyword">const</span> * name = *api;</span><br><span class="line">            __eglMustCastToProperFunctionPointerType f =</span><br><span class="line">                (__eglMustCastToProperFunctionPointerType)dlsym(dso, name);</span><br><span class="line">            <span class="keyword">if</span> (f == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                <span class="comment">// couldn&#x27;t find the entry-point, use eglGetProcAddress()</span></span><br><span class="line">                f = getProcAddress(name);</span><br><span class="line">                <span class="keyword">if</span> (f == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                    f = (__eglMustCastToProperFunctionPointerType)<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            *curr++ = f; <span class="comment">//è¿™ä¸€æ­¥å°±æ˜¯æœ€å…³é”®çš„å°†å…±äº«é“¾æ¥åº“ä¸­çš„ EGL API çš„å®ç°å’Œä¸Šå±‚è°ƒç”¨çš„ API å‡½æ•°æŒ‡é’ˆç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">            api++; <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªéœ€è¦ç»‘å®šçš„ api å‡½æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ OpenGL ES åº“ä¸­çš„ OpenGL ES 1.x API ç¬¦å·</span></span><br><span class="line">    <span class="keyword">if</span> (mask &amp; GLESv1_CM) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ init_api å®ç° OpenGL API å’Œå¯¹åº”å®ç°å‡½æ•°çš„ç»‘å®š</span></span><br><span class="line">        init_api(dso, gl_names, <span class="comment">// gl_names æ˜¯å®šä¹‰åœ¨ egl.cpp æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯ OpenGL ES API å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">                 (__eglMustCastToProperFunctionPointerType*)</span><br><span class="line">                 &amp;cnx-&gt;hooks[<span class="keyword">egl_connection_t</span>::GLESv1_INDEX]-&gt;gl, <span class="comment">//glæˆå‘˜å˜é‡æ˜¯ä¸€ä¸ªç»“æ„ä½“å˜é‡ï¼Œç»“æ„ä½“ä¸­çš„æ˜¯ OpenGL ES API å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">                 getProcAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ OpenGL ES åº“ä¸­çš„ OpenGL ES 2.0 API ç¬¦å·</span></span><br><span class="line">    <span class="keyword">if</span> (mask &amp; GLESv2) &#123;</span><br><span class="line">        init_api(dso, gl_names,</span><br><span class="line">                 (__eglMustCastToProperFunctionPointerType*)</span><br><span class="line">                 &amp;cnx-&gt;hooks[<span class="keyword">egl_connection_t</span>::GLESv2_INDEX]-&gt;gl,</span><br><span class="line">                 getProcAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dso;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Loader::load_driver() å®ƒä¸»è¦å®ç°äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š</p>
<p>é€šè¿‡ load_system_driver()  å‡½æ•°æŸ¥æ‰¾ OpenGL ES/EGL å®ç°åº“ï¼Œå¹¶åœ¨æŒ‡å®šçš„å­˜æ”¾è·¯å¾„ä¸­æ‰¾åˆ°å…±äº«é“¾æ¥åº“æ–‡ä»¶å¹¶æ‰“å¼€å®ƒã€‚<br>è°ƒç”¨ init_api()è§£ææ‰“å¼€çš„ OpenGL ES/EGL å…±äº«é“¾æ¥åº“ï¼Œå°† OpenGL ES/EGL API å‡½æ•°æŒ‡é’ˆå’Œå…±äº«é“¾æ¥åº“ä¸­å®ç°çš„å¯¹åº”çš„å‡½æ•°ç¬¦å·ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™æ ·è°ƒç”¨ OpenGL ES/EGL API å°±ä¼šè°ƒç”¨åˆ°å…·ä½“å®ç°çš„OpenGL ES/EGL å…±äº«é“¾æ¥åº“ä¸­å¯¹åº”å‡½æ•°ã€‚</p>
<h5 id="4-4ã€å°ç»“"><a href="#4-4ã€å°ç»“" class="headerlink" title="4.4ã€å°ç»“"></a>4.4ã€å°ç»“</h5><p>Android OpenGL ES å›¾å½¢åº“ç»“æ„<br>Android çš„ OpenGL ES å›¾å½¢ç³»ç»Ÿæ¶‰åŠå¤šä¸ªåº“ï¼Œæ ¹æ®è®¾å¤‡ç±»å‹çš„ä¸åŒï¼Œè¿™äº›åº“æœ‰ç€ä¸åŒçš„ç»“æ„ã€‚</p>
<p>å¯¹äºæ¨¡æ‹Ÿå™¨ï¼Œæ²¡æœ‰å¼€å¯ OpenGL ES çš„ GPU ç¡¬ä»¶æ¨¡æ‹Ÿçš„æƒ…å†µï¼ŒAndroid OpenGL ES å›¾å½¢åº“ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-20-opencl-egl-imp.png" alt="Alt text | center"></p>
<p>å½“ä¸ºæ¨¡æ‹Ÿå™¨å¼€å¯äº† OpenGL ES çš„ GPU ç¡¬ä»¶æ¨¡æ‹Ÿï¼Œå®é™…çš„ EGL å’Œ OpenGL ES å®ç°åº“ä¼šé‡‡ç”¨ç”± android-7.1.1_r22/device/generic/goldfish-opengl ä¸‹çš„æºç ç¼–è¯‘å‡ºæ¥çš„å‡ ä¸ªåº“æ–‡ä»¶ï¼Œå³ libGLESv2_emulation.soã€libGLESv1_CM_emulation.so å’Œ libEGL_emulation.soã€‚æ­¤æ—¶ï¼ŒOpenGL ES å›¾å½¢åº“ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-21-opencl-egl-imp-emulate.png" alt="Alt text | center"></p>
<p>å¯¹äºçœŸå®çš„ç‰©ç† Android è®¾å¤‡ï¼ŒOpenGL ES å›¾å½¢åº“ç»“æ„å¦‚ä¸‹ï¼Œä¾‹å¦‚é«˜é€šå®ç°ï¼ˆlibEGL_adreno.so<br>libGLESv1_CM_adreno.so libGLESv2_adreno.so [\system\vendor\lib64\egl]ï¼‰ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS-02-22-opencl-egl-imp-qcom-adreno.png" alt="Alt text | center"></p>
<p>####ï¼ˆäº”ï¼‰ã€OpenGL ESï¼šEGLæ¥å£è§£æä¸ç†è§£</p>
<p>ç”±å‰é¢çš„åˆ†æçŸ¥é“EGLçš„ç»˜å›¾çš„ä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼Œæ¥ä¸‹æ¥åˆ†æä¸»è¦çš„1-8ä¸ªå°æ­¥éª¤ï¼š</p>
<blockquote>
<p>ä½¿ç”¨EGLçš„ç»˜å›¾çš„ä¸€èˆ¬æ­¥éª¤ï¼š<br>1ã€è·å– EGL Display å¯¹è±¡ï¼šeglGetDisplay()<br>2ã€åˆå§‹åŒ–ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥ï¼šeglInitialize()<br>3ã€è·å– EGLConfig å¯¹è±¡ï¼šeglChooseConfig()<br>4ã€åˆ›å»º EGLContext å®ä¾‹ï¼šeglCreateContext()<br>5ã€åˆ›å»º EGLSurface å®ä¾‹ï¼šeglCreateWindowSurface()<br>6ã€è¿æ¥ EGLContext å’Œ EGLSurfaceï¼šeglMakeCurrent()<br>7ã€ä½¿ç”¨ OpenGL ES API ç»˜åˆ¶å›¾å½¢ï¼šgl_*()<br>8ã€åˆ‡æ¢ front buffer å’Œ back buffer é€æ˜¾ï¼šeglSwapBuffer()<br>9ã€æ–­å¼€å¹¶é‡Šæ”¾ä¸ EGLSurface å…³è”çš„ EGLContext å¯¹è±¡ï¼šeglRelease()<br>10ã€åˆ é™¤ EGLSurface å¯¹è±¡<br>11ã€åˆ é™¤ EGLContext å¯¹è±¡<br>12ã€ç»ˆæ­¢ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥</p>
</blockquote>
<p>æ ‡å‡† EGL æ•°æ®ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>EGLBoolean â€”â€”EGL_TRUE =1, EGL_FALSE=0<br>EGLint â€”â€”int æ•°æ®ç±»å‹<br>EGLDisplay â€”â€”ç³»ç»Ÿæ˜¾ç¤º ID æˆ–å¥æŸ„ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‰ç«¯çš„æ˜¾ç¤ºçª—å£<br>EGLConfig â€”â€”Surfaceçš„EGLé…ç½®ï¼Œå¯ä»¥ç†è§£ä¸ºç»˜åˆ¶ç›®æ ‡framebufferçš„é…ç½®å±æ€§<br>EGLSurface â€”â€”ç³»ç»Ÿçª—å£æˆ– frame buffer å¥æŸ„ ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåç«¯çš„æ¸²æŸ“ç›®æ ‡çª—å£ã€‚<br>EGLContext â€”â€”OpenGL ES å›¾å½¢ä¸Šä¸‹æ–‡ï¼Œå®ƒä»£è¡¨äº†OpenGLçŠ¶æ€æœºï¼›å¦‚æœæ²¡æœ‰å®ƒï¼ŒOpenGLæŒ‡ä»¤å°±æ²¡æœ‰æ‰§è¡Œçš„ç¯å¢ƒã€‚</p>
<p>ä¸‹é¢å‡ ä¸ªç±»å‹æ¯”è¾ƒå¤æ‚ï¼Œé€šè¿‡ä¾‹å­å¯ä»¥æ›´æ·±å…¥çš„ç†è§£ã€‚è¿™é‡Œè¦è¯´æ˜çš„æ˜¯è¿™å‡ ä¸ªç±»å‹åœ¨ä¸åŒå¹³å°å…¶å®ç°æ˜¯ä¸åŒçš„ï¼ŒEGLåªæä¾›æŠ½è±¡æ ‡å‡†ã€‚</p>
<p>NativeDisplayTypeâ€”â€”Native ç³»ç»Ÿæ˜¾ç¤ºç±»å‹ï¼Œæ ‡è¯†ä½ æ‰€å¼€å‘è®¾å¤‡çš„ç‰©ç†å±å¹•<br>NativeWindowType â€”â€”Native ç³»ç»Ÿçª—å£ç¼“å­˜ç±»å‹ï¼Œæ ‡è¯†ç³»ç»Ÿçª—å£<br>NativePixmapType â€”â€”Native ç³»ç»Ÿ frame bufferï¼Œå¯ä»¥ä½œä¸º Framebuffer çš„ç³»ç»Ÿå›¾åƒï¼ˆå†…å­˜ï¼‰æ•°æ®ç±»å‹ï¼Œè¯¥ç±»å‹åªç”¨äºç¦»å±æ¸²æŸ“.</p>
<h5 id="5-1ã€eglGetDisplay"><a href="#5-1ã€eglGetDisplay" class="headerlink" title="5.1ã€eglGetDisplay()"></a>5.1ã€eglGetDisplay()</h5><p>EGLDisplay æ˜¯ä¸€ä¸ªå…³è”ç³»ç»Ÿç‰©ç†å±å¹•çš„é€šç”¨æ•°æ®ç±»å‹ï¼Œè¡¨ç¤ºæ˜¾ç¤ºè®¾å¤‡å¥æŸ„ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå‰ç«¯æ˜¾ç¤ºçª—ã€‚ä¸ºäº†ä½¿ç”¨ç³»ç»Ÿçš„æ˜¾ç¤ºè®¾å¤‡ï¼Œ EGL æä¾›äº† EGLDisplay æ•°æ®ç±»å‹ï¼Œä»¥åŠä¸€ç»„æ“ä½œè®¾å¤‡æ˜¾ç¤ºçš„ API ã€‚<br>ä¸‹é¢çš„å‡½æ•°åŸå‹ç”¨äºè·å– Native Display ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLDisplay <span class="title">eglGetDisplay</span><span class="params">(NativeDisplayType display)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">......</span><br><span class="line">    <span class="keyword">if</span> (display == EGL_DEFAULT_DISPLAY) &#123;</span><br><span class="line">        EGLDisplay dpy = (EGLDisplay)<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">egl_display_t</span>&amp; d = <span class="keyword">egl_display_t</span>::get_display(dpy);</span><br><span class="line">        d.type = display;</span><br><span class="line">        <span class="keyword">return</span> dpy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> EGL_NO_DISPLAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">egl_display_t</span>&amp; <span class="title">egl_display_t::get_display</span><span class="params">(EGLDisplay dpy)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gDisplays[<span class="keyword">uintptr_t</span>(dpy)<span class="number">-1U</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ ä¸­ display å‚æ•°æ˜¯ native ç³»ç»Ÿçš„çª—å£æ˜¾ç¤º ID å€¼ã€‚å¦‚æœä½ åªæ˜¯æƒ³å¾—åˆ°ä¸€ä¸ªç³»ç»Ÿé»˜è®¤çš„ Display ï¼Œä½ å¯ä»¥ä½¿ç”¨ EGL_DEFAULT_DISPLAY å‚æ•°ã€‚å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰ä¸€ä¸ªå¯ç”¨çš„ native display ID ä¸ç»™å®šçš„ display å‚æ•°åŒ¹é…ï¼Œå‡½æ•°å°†è¿”å› EGL_NO_DISPLAY ï¼Œè€Œæ²¡æœ‰ä»»ä½• Error çŠ¶æ€è¢«è®¾ç½®ã€‚</p>
<h5 id="5-2ã€eglInitialize"><a href="#5-2ã€eglInitialize" class="headerlink" title="5.2ã€eglInitialize()"></a>5.2ã€eglInitialize()</h5><p>æ¯ä¸ª EGLDisplay åœ¨ä½¿ç”¨å‰éƒ½éœ€è¦åˆå§‹åŒ–ã€‚åˆå§‹åŒ– EGLDisplay çš„åŒæ—¶ï¼Œä½ å¯ä»¥å¾—åˆ°ç³»ç»Ÿä¸­ EGL çš„å®ç°ç‰ˆæœ¬å·ã€‚äº†è§£å½“å‰çš„ç‰ˆæœ¬å·åœ¨å‘åå…¼å®¹æ€§æ–¹é¢æ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œé€šè¿‡åŠ¨æ€æŸ¥è¯¢ EGL ç‰ˆæœ¬å·ï¼Œä½ å¯ä»¥ä¸ºæ–°æ—§ç‰ˆæœ¬çš„ EGL é™„åŠ é¢å¤–çš„ç‰¹æ€§æˆ–è¿è¡Œç¯å¢ƒã€‚åŸºäºå¹³å°é…ç½®ï¼Œè½¯ä»¶å¼€å‘å¯ç”¨æ¸…æ¥šçŸ¥é“å“ªäº› API å¯ç”¨è®¿é—®ï¼Œè¿™å°†ä¼šä¸ºä½ çš„ä»£ç æä¾›æœ€å¤§é™åº¦çš„å¯ç§»æ¤æ€§ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLBoolean <span class="title">eglInitialize</span><span class="params">(EGLDisplay dpy, EGLint *major, EGLint *minor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">egl_display_t</span>::is_valid(dpy) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_FALSE);</span><br><span class="line"></span><br><span class="line">    EGLBoolean res = EGL_TRUE;</span><br><span class="line">    <span class="keyword">egl_display_t</span>&amp; d = <span class="keyword">egl_display_t</span>::get_display(dpy);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (d.initialized.fetch_add(<span class="number">1</span>, <span class="built_in">std</span>::memory_order_acquire) == <span class="number">0</span>) &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res == EGL_TRUE) &#123;</span><br><span class="line">        <span class="keyword">if</span> (major != <span class="literal">NULL</span>) *major = VERSION_MAJOR;</span><br><span class="line">        <span class="keyword">if</span> (minor != <span class="literal">NULL</span>) *minor = VERSION_MINOR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ dpy åº”è¯¥æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ EGLDisplay ã€‚å‡½æ•°è¿”å›æ—¶ï¼Œ major å’Œ minor å°†è¢«èµ‹äºˆå½“å‰ EGL ç‰ˆæœ¬å·ã€‚æ¯”å¦‚ EGL1.0 ï¼Œ major è¿”å› 1 ï¼Œ minor åˆ™è¿”å› 0 ã€‚ç»™ major å’Œ minor ä¼  NULL æ˜¯æœ‰æ•ˆçš„ï¼Œå¦‚æœä½ ä¸å…³å¿ƒç‰ˆæœ¬å·ã€‚<br>eglQueryString() å‡½æ•°æ˜¯å¦å¤–ä¸€ä¸ªè·å–ç‰ˆæœ¬ä¿¡æ¯å’Œå…¶ä»–ä¿¡æ¯çš„é€”å¾„ã€‚é€šè¿‡ eglQueryString() è·å–ç‰ˆæœ¬ä¿¡æ¯éœ€è¦è§£æç‰ˆæœ¬å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆç»™ eglInitializ() å‡½æ•°æ¯”è¾ƒå®¹æ˜“è·å¾—è¿™ä¸ªä¿¡æ¯ã€‚æ³¨æ„åœ¨è°ƒç”¨ eglQueryString() å¿…é¡»å…ˆä½¿ç”¨ eglInitialize() åˆå§‹åŒ– EGLDisplay ï¼Œå¦åˆ™å°†å¾—åˆ° EGL_NOT_INITIALIZED é”™è¯¯ä¿¡æ¯ã€‚</p>
<h5 id="5-3ã€eglChooseConfig"><a href="#5-3ã€eglChooseConfig" class="headerlink" title="5.3ã€eglChooseConfig()"></a>5.3ã€eglChooseConfig()</h5><p>åŸº äº EGL çš„å±æ€§ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå’Œéœ€æ±‚æ¥è¿‘çš„Configï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå·±éœ€è¦çš„Configï¼Œåªè¦å¹³å°æ”¯æŒã€‚ä¸æ˜¯æ‰€æœ‰çš„Configéƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯æ‰€æœ‰Configéƒ½ä¼šæ”¯æŒã€‚ eglChooseConfig() å‡½æ•°å°†é€‚é…ä¸€ä¸ªæ‰€æœŸæœ›çš„é…ç½®ï¼Œå¹¶ä¸”å°½å¯èƒ½æ¥è¿‘ä¸€ä¸ªæœ‰æ•ˆçš„ç³»ç»Ÿé…ç½®ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLBoolean <span class="title">eglChooseConfig</span><span class="params">( EGLDisplay dpy, <span class="keyword">const</span> EGLint *attrib_list,</span></span></span><br><span class="line"><span class="function"><span class="params">                            EGLConfig *configs, EGLint config_size,</span></span></span><br><span class="line"><span class="function"><span class="params">                            EGLint *num_config)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">egl_display_t</span>::is_valid(dpy) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_FALSE);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (ggl_unlikely(num_config==<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_PARAMETER, EGL_FALSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ggl_unlikely(attrib_list==<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * A NULL attrib_list should be treated as though it was an empty</span></span><br><span class="line"><span class="comment">         * one (terminated with EGL_NONE) as defined in</span></span><br><span class="line"><span class="comment">         * section 3.4.1 &quot;Querying Configurations&quot; in the EGL specification.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> EGLint dummy = EGL_NONE;</span><br><span class="line">        attrib_list = &amp;dummy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> numAttributes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> numConfigs =  NELEM(gConfigs);</span><br><span class="line">    <span class="keyword">uint32_t</span> possibleMatch = (<span class="number">1</span>&lt;&lt;numConfigs)<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(possibleMatch &amp;&amp; *attrib_list != EGL_NONE) &#123;</span><br><span class="line">        numAttributes++;</span><br><span class="line">        EGLint attr = *attrib_list++;</span><br><span class="line">        EGLint val  = *attrib_list++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span> ; possibleMatch &amp;&amp; i&lt;numConfigs ; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(possibleMatch &amp; (<span class="number">1</span>&lt;&lt;i)))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (isAttributeMatching(i, attr, val) == <span class="number">0</span>) &#123;</span><br><span class="line">                possibleMatch &amp;= ~(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// now, handle the attributes which have a useful default value</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> j=<span class="number">0</span> ; possibleMatch &amp;&amp; j&lt;NELEM(config_defaults) ; j++) &#123;</span><br><span class="line">        <span class="comment">// see if this attribute was specified, if not, apply its</span></span><br><span class="line">        <span class="comment">// default value</span></span><br><span class="line">        <span class="keyword">if</span> (binarySearch&lt;<span class="keyword">config_pair_t</span>&gt;(</span><br><span class="line">                (<span class="keyword">config_pair_t</span> <span class="keyword">const</span>*)attrib_list,</span><br><span class="line">                <span class="number">0</span>, numAttributes<span class="number">-1</span>,</span><br><span class="line">                config_defaults[j].key) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span> ; possibleMatch &amp;&amp; i&lt;numConfigs ; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!(possibleMatch &amp; (<span class="number">1</span>&lt;&lt;i)))</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (isAttributeMatching(i,</span><br><span class="line">                        config_defaults[j].key,</span><br><span class="line">                        config_defaults[j].value) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    possibleMatch &amp;= ~(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return the configurations found</span></span><br><span class="line">    <span class="keyword">int</span> n=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (possibleMatch) &#123;</span><br><span class="line">        <span class="keyword">if</span> (configs) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span> ; config_size &amp;&amp; i&lt;numConfigs ; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (possibleMatch &amp; (<span class="number">1</span>&lt;&lt;i)) &#123;</span><br><span class="line">                    *configs++ = (EGLConfig)(<span class="keyword">uintptr_t</span>)i;</span><br><span class="line">                    config_size--;</span><br><span class="line">                    n++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span> ; i&lt;numConfigs ; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (possibleMatch &amp; (<span class="number">1</span>&lt;&lt;i)) &#123;</span><br><span class="line">                    n++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *num_config = n;</span><br><span class="line">     <span class="keyword">return</span> EGL_TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•° attrib_list æŒ‡å®šäº†é€‰æ‹©é…ç½®æ—¶éœ€è¦å‚ç…§çš„å±æ€§ã€‚å‚æ•° configs å°†è¿”å›ä¸€ä¸ªæŒ‰ç…§ attrib_list æ’åºçš„å¹³å°æœ‰æ•ˆçš„æ‰€æœ‰ EGL framebuffer é…ç½®åˆ—è¡¨ã€‚å‚æ•° config_size æŒ‡å®šäº†å¯ä»¥è¿”å›åˆ° configs çš„æ€»é…ç½®ä¸ªæ•°ã€‚å‚æ•° num_config è¿”å›äº†å®é™…åŒ¹é…çš„é…ç½®æ€»æ•°ã€‚</p>
<h5 id="5-4ã€eglCreateContext"><a href="#5-4ã€eglCreateContext" class="headerlink" title="5.4ã€eglCreateContext()"></a>5.4ã€eglCreateContext()</h5><p>OpenGL ESçš„pipelineä»ç¨‹åºçš„è§’åº¦çœ‹å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œæœ‰å½“å‰çš„é¢œè‰²ã€çº¹ç†åæ ‡ã€å˜æ¢çŸ©é˜µã€ç»šæŸ“æ¨¡å¼ç­‰ä¸€å¤§å †çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ä½œç”¨äºOpenGL APIç¨‹åºæäº¤çš„é¡¶ç‚¹åæ ‡ç­‰å›¾å…ƒä»è€Œå½¢æˆå¸§ç¼“å†²å†…çš„åƒç´ ã€‚åœ¨OpenGLçš„ç¼–ç¨‹æ¥å£ä¸­ï¼ŒContextå°±ä»£è¡¨è¿™ä¸ªçŠ¶æ€æœºï¼ŒOpenGL APIç¨‹åºçš„ä¸»è¦å·¥ä½œå°±æ˜¯å‘Contextæä¾›å›¾å…ƒã€è®¾ç½®çŠ¶æ€ï¼Œå¶å°”ä¹Ÿä»Contexté‡Œè·å–ä¸€äº›ä¿¡æ¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLContext <span class="title">eglCreateContext</span><span class="params">(EGLDisplay dpy, EGLConfig config,</span></span></span><br><span class="line"><span class="function"><span class="params">                            EGLContext <span class="comment">/*share_list*/</span>, <span class="keyword">const</span> EGLint* <span class="comment">/*attrib_list*/</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">egl_display_t</span>::is_valid(dpy) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_NO_SURFACE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">ogles_context_t</span>* gl = ogles_init(<span class="keyword">sizeof</span>(<span class="keyword">egl_context_t</span>));</span><br><span class="line">    <span class="keyword">if</span> (!gl) <span class="keyword">return</span> setError(EGL_BAD_ALLOC, EGL_NO_CONTEXT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">egl_context_t</span>* c = <span class="keyword">static_cast</span>&lt;<span class="keyword">egl_context_t</span>*&gt;(gl-&gt;rasterizer.base);</span><br><span class="line">    c-&gt;flags = <span class="keyword">egl_context_t</span>::NEVER_CURRENT;</span><br><span class="line">    c-&gt;dpy = dpy;</span><br><span class="line">    c-&gt;config = config;</span><br><span class="line">    c-&gt;read = <span class="number">0</span>;</span><br><span class="line">    c-&gt;draw = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> (EGLContext)gl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-5ã€eglCreateWindowSurface"><a href="#5-5ã€eglCreateWindowSurface" class="headerlink" title="5.5ã€eglCreateWindowSurface()"></a>5.5ã€eglCreateWindowSurface()</h5><p>Surfaceå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªFrameBufferï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“ç›®çš„åœ°ï¼Œ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLSurface <span class="title">eglCreateWindowSurface</span><span class="params">(  EGLDisplay dpy, EGLConfig config,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    NativeWindowType window,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="keyword">const</span> EGLint *attrib_list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createWindowSurface(dpy, config, window, attrib_list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> EGLSurface <span class="title">createWindowSurface</span><span class="params">(EGLDisplay dpy, EGLConfig config,</span></span></span><br><span class="line"><span class="function"><span class="params">        NativeWindowType window, <span class="keyword">const</span> EGLint* <span class="comment">/*attrib_list*/</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">egl_display_t</span>::is_valid(dpy) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_NO_SURFACE);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_NO_SURFACE);</span><br><span class="line"></span><br><span class="line">    EGLint surfaceType;</span><br><span class="line">    <span class="keyword">if</span> (getConfigAttrib(dpy, config, EGL_SURFACE_TYPE, &amp;surfaceType) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> EGL_FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(surfaceType &amp; EGL_WINDOW_BIT))</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_NO_SURFACE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">static_cast</span>&lt;ANativeWindow*&gt;(window)-&gt;common.magic !=</span><br><span class="line">            ANDROID_NATIVE_WINDOW_MAGIC) &#123;</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_NATIVE_WINDOW, EGL_NO_SURFACE);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    EGLint configID;</span><br><span class="line">    <span class="keyword">if</span> (getConfigAttrib(dpy, config, EGL_CONFIG_ID, &amp;configID) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> EGL_FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int32_t</span> depthFormat;</span><br><span class="line">    <span class="keyword">int32_t</span> pixelFormat;</span><br><span class="line">    <span class="keyword">if</span> (getConfigFormatInfo(configID, pixelFormat, depthFormat) != NO_ERROR) &#123;</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_NO_SURFACE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="keyword">egl_surface_t</span>* surface;</span><br><span class="line">    surface = <span class="keyword">new</span> <span class="keyword">egl_window_surface_v2_t</span>(dpy, config, depthFormat,</span><br><span class="line">            <span class="keyword">static_cast</span>&lt;ANativeWindow*&gt;(window));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!surface-&gt;initCheck()) &#123;</span><br><span class="line">        <span class="keyword">delete</span> surface;</span><br><span class="line">        surface = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> surface;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ¥åˆ›å»ºä¸€ä¸ªå¯å®é™…æ˜¾ç¤ºçš„Surfaceã€‚</p>
<p>ç³»ç»Ÿé€šå¸¸è¿˜æ”¯æŒå¦å¤–ä¸¤ç§Surfaceï¼šPixmapSurfaceå’ŒPBufferSurfaceï¼Œè¿™ä¸¤ç§éƒ½ä¸æ˜¯å¯æ˜¾ç¤ºçš„Surfaceï¼ŒPixmapSurfaceæ˜¯ä¿å­˜åœ¨ç³»ç»Ÿå†…å­˜ä¸­çš„ä½å›¾ï¼ŒPBufferåˆ™æ˜¯ä¿å­˜åœ¨æ˜¾å­˜ä¸­çš„å¸§ã€‚</p>
<p>å¯¹äºè¿™ä¸¤ç§surfaceï¼ŒAndroidç³»ç»Ÿä¸­ï¼Œæ”¯æŒPBufferSurfaceã€‚</p>
<h5 id="5-6ã€eglMakeCurrent"><a href="#5-6ã€eglMakeCurrent" class="headerlink" title="5.6ã€eglMakeCurrent()"></a>5.6ã€eglMakeCurrent()</h5><p>è¯¥æ¥å£å°†ç”³è¯·åˆ°çš„displayï¼Œdrawï¼ˆsurfaceï¼‰å’Œ contextè¿›è¡Œäº†ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨contextä¸‹çš„OpenGLAPIæŒ‡ä»¤å°†drawï¼ˆsurfaceï¼‰ä½œä¸ºå…¶æ¸²æŸ“æœ€ç»ˆç›®çš„åœ°ã€‚è€Œdisplayä½œä¸ºdrawï¼ˆsurfaceï¼‰çš„å‰ç«¯æ˜¾ç¤ºã€‚è°ƒç”¨åï¼Œå½“å‰çº¿ç¨‹ä½¿ç”¨çš„EGLContexä¸ºcontextã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLBoolean <span class="title">eglMakeCurrent</span><span class="params">(  EGLDisplay dpy, EGLSurface draw,</span></span></span><br><span class="line"><span class="function"><span class="params">                            EGLSurface read, EGLContext ctx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">egl_display_t</span>::is_valid(dpy) == EGL_FALSE)</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_FALSE);</span><br><span class="line">    <span class="keyword">if</span> (draw) &#123;</span><br><span class="line">        <span class="keyword">egl_surface_t</span>* s = (<span class="keyword">egl_surface_t</span>*)draw;</span><br><span class="line">        <span class="keyword">if</span> (!s-&gt;isValid())</span><br><span class="line">            <span class="keyword">return</span> setError(EGL_BAD_SURFACE, EGL_FALSE);</span><br><span class="line">        <span class="keyword">if</span> (s-&gt;dpy != dpy)</span><br><span class="line">            <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_FALSE);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> check that draw is compatible with the context</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (read &amp;&amp; read!=draw) &#123;</span><br><span class="line">        <span class="keyword">egl_surface_t</span>* s = (<span class="keyword">egl_surface_t</span>*)read;</span><br><span class="line">        <span class="keyword">if</span> (!s-&gt;isValid())</span><br><span class="line">            <span class="keyword">return</span> setError(EGL_BAD_SURFACE, EGL_FALSE);</span><br><span class="line">        <span class="keyword">if</span> (s-&gt;dpy != dpy)</span><br><span class="line">            <span class="keyword">return</span> setError(EGL_BAD_DISPLAY, EGL_FALSE);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> check that read is compatible with the context</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    EGLContext current_ctx = EGL_NO_CONTEXT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((read == EGL_NO_SURFACE &amp;&amp; draw == EGL_NO_SURFACE) &amp;&amp; (ctx != EGL_NO_CONTEXT))</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((read != EGL_NO_SURFACE || draw != EGL_NO_SURFACE) &amp;&amp; (ctx == EGL_NO_CONTEXT))</span><br><span class="line">        <span class="keyword">return</span> setError(EGL_BAD_MATCH, EGL_FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ctx == EGL_NO_CONTEXT) &#123;</span><br><span class="line">        <span class="comment">// if we&#x27;re detaching, we need the current context</span></span><br><span class="line">        current_ctx = (EGLContext)getGlThreadSpecific();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">egl_context_t</span>* c = <span class="keyword">egl_context_t</span>::context(ctx);</span><br><span class="line">        <span class="keyword">egl_surface_t</span>* d = (<span class="keyword">egl_surface_t</span>*)draw;</span><br><span class="line">        <span class="keyword">egl_surface_t</span>* r = (<span class="keyword">egl_surface_t</span>*)read;</span><br><span class="line">        <span class="keyword">if</span> ((d &amp;&amp; d-&gt;ctx &amp;&amp; d-&gt;ctx != ctx) ||</span><br><span class="line">            (r &amp;&amp; r-&gt;ctx &amp;&amp; r-&gt;ctx != ctx)) &#123;</span><br><span class="line">            <span class="comment">// one of the surface is bound to a context in another thread</span></span><br><span class="line">            <span class="keyword">return</span> setError(EGL_BAD_ACCESS, EGL_FALSE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">ogles_context_t</span>* gl = (<span class="keyword">ogles_context_t</span>*)ctx;</span><br><span class="line">    <span class="keyword">if</span> (makeCurrent(gl) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ctx) &#123;</span><br><span class="line">            <span class="keyword">egl_context_t</span>* c = <span class="keyword">egl_context_t</span>::context(ctx);</span><br><span class="line">            <span class="keyword">egl_surface_t</span>* d = (<span class="keyword">egl_surface_t</span>*)draw;</span><br><span class="line">            <span class="keyword">egl_surface_t</span>* r = (<span class="keyword">egl_surface_t</span>*)read;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (c-&gt;draw) &#123;</span><br><span class="line">                <span class="keyword">egl_surface_t</span>* s = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">egl_surface_t</span>*&gt;(c-&gt;draw);</span><br><span class="line">                s-&gt;disconnect();</span><br><span class="line">                s-&gt;ctx = EGL_NO_CONTEXT;</span><br><span class="line">                <span class="keyword">if</span> (s-&gt;zombie)</span><br><span class="line">                    <span class="keyword">delete</span> s;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (c-&gt;read) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">FIXME:</span> unlock/disconnect the read surface too </span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            c-&gt;draw = draw;</span><br><span class="line">            c-&gt;read = read;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c-&gt;flags &amp; <span class="keyword">egl_context_t</span>::NEVER_CURRENT) &#123;</span><br><span class="line">                c-&gt;flags &amp;= ~<span class="keyword">egl_context_t</span>::NEVER_CURRENT;</span><br><span class="line">                GLint w = <span class="number">0</span>;</span><br><span class="line">                GLint h = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (draw) &#123;</span><br><span class="line">                    w = d-&gt;getWidth();</span><br><span class="line">                    h = d-&gt;getHeight();</span><br><span class="line">                &#125;</span><br><span class="line">                ogles_surfaceport(gl, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ogles_viewport(gl, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">                ogles_scissor(gl, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (d) &#123;</span><br><span class="line">                <span class="keyword">if</span> (d-&gt;connect() == EGL_FALSE) &#123;</span><br><span class="line">                    <span class="keyword">return</span> EGL_FALSE;</span><br><span class="line">                &#125;</span><br><span class="line">                d-&gt;ctx = ctx;</span><br><span class="line">                d-&gt;bindDrawSurface(gl);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (r) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">FIXME:</span> lock/connect the read surface too </span></span><br><span class="line">                r-&gt;ctx = ctx;</span><br><span class="line">                r-&gt;bindReadSurface(gl);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// if surfaces were bound to the context bound to this thread</span></span><br><span class="line">            <span class="comment">// mark then as unbound.</span></span><br><span class="line">            <span class="keyword">if</span> (current_ctx) &#123;</span><br><span class="line">                <span class="keyword">egl_context_t</span>* c = <span class="keyword">egl_context_t</span>::context(current_ctx);</span><br><span class="line">                <span class="keyword">egl_surface_t</span>* d = (<span class="keyword">egl_surface_t</span>*)c-&gt;draw;</span><br><span class="line">                <span class="keyword">egl_surface_t</span>* r = (<span class="keyword">egl_surface_t</span>*)c-&gt;read;</span><br><span class="line">                <span class="keyword">if</span> (d) &#123;</span><br><span class="line">                    c-&gt;draw = <span class="number">0</span>;</span><br><span class="line">                    d-&gt;disconnect();</span><br><span class="line">                    d-&gt;ctx = EGL_NO_CONTEXT;</span><br><span class="line">                    <span class="keyword">if</span> (d-&gt;zombie)</span><br><span class="line">                        <span class="keyword">delete</span> d;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (r) &#123;</span><br><span class="line">                    c-&gt;read = <span class="number">0</span>;</span><br><span class="line">                    r-&gt;ctx = EGL_NO_CONTEXT;</span><br><span class="line">                    <span class="comment">// <span class="doctag">FIXME:</span> unlock/disconnect the read surface too </span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> EGL_TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setError(EGL_BAD_ACCESS, EGL_FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="5-7ã€ç»˜åˆ¶gl"><a href="#5-7ã€ç»˜åˆ¶gl" class="headerlink" title="5.7ã€ç»˜åˆ¶gl_*()"></a>5.7ã€ç»˜åˆ¶gl_*()</h5><p>åº”ç”¨ç¨‹åºé€šè¿‡OpenGL APIè¿›è¡Œç»˜åˆ¶ï¼Œä¸€å¸§å®Œæˆä¹‹åï¼Œè°ƒç”¨eglSwapBuffers(EGLDisplay dpy, EGLContext ctx)æ¥æ˜¾ç¤ºã€‚</p>
<h5 id="5-8ã€eglSwapBuffersæ¥å£å®ç°è¯´æ˜"><a href="#5-8ã€eglSwapBuffersæ¥å£å®ç°è¯´æ˜" class="headerlink" title="5.8ã€eglSwapBuffersæ¥å£å®ç°è¯´æ˜"></a>5.8ã€eglSwapBuffersæ¥å£å®ç°è¯´æ˜</h5><p>Androidå¹³å°ï¼š</p>
<p>ä¸ºäº†å®ç°eglSwapBuffersï¼Œ eglSurfaceå…¶å®ä»£è¡¨äº†ä¸€ä¸ªä»NativeWindow ç”³è¯·åˆ°çš„ä¸€ä¸ªBufferï¼ˆDequeueæ“ä½œï¼‰ã€‚å½“è°ƒç”¨eglSwapBuffersæ—¶ï¼Œå¯¹äºä¸€èˆ¬åº”ç”¨çª—å£è€Œè¨€ï¼ŒNativeWindowå°†è¯¥Surfaceçš„Buffer æäº¤å›å»ç»™SurfaceFlingerï¼ˆQueueæ“ä½œ)ï¼Œ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\frameworks\native\opengl\libagl\egl.cpp]</span><br><span class="line"><span class="function">EGLBoolean <span class="title">egl_window_surface_v2_t::swapBuffers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">......</span><br><span class="line">nativeWindow-&gt;queueBuffer(nativeWindow, buffer); </span><br><span class="line">nativeWindow-&gt;dequeueBuffer(nativeWindow, &amp;buffer);</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆé‡æ–°ä»NativeWindowä¸­é‡æ–°Dequeueå‡ºæ¥ä¸€ä¸ªæ–°çš„Bufferç»™eglSurfaceã€‚è€ŒeglDisplayå¹¶ä¸ä»£è¡¨å®é™…çš„æ„ä¹‰ã€‚æˆ‘ä»¬åªæ˜¯ä»æ¥å£ä¸Šæ„Ÿè§‰æ˜¯ï¼Œsurfaceå’Œdisplayè¿›è¡Œäº†äº¤æ¢ã€‚ï¼ˆæ³¨ï¼šç°åœ¨æ˜¯Triple Bufferï¼‰</p>
<blockquote>
<p><strong>æ€»ç»“ï¼šä»å‰é¢å…³äºAndroid EGLã€OpenGL ESçš„åˆ†æçŸ¥é“ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡SurfaceFlingerç”³è¯·ä¸€å—Surfaceï¼ˆBufferï¼‰ï¼Œç„¶åå¯ä»¥åˆ©ç”¨OpenGL ESæ¥å£åœ¨Native å±‚ç»˜åˆ¶ç›¸å…³çš„å›¾ç‰‡ã€æ–‡å­—ï¼›é‚£ä¹ˆç–‘é—®æ¥äº†ï¼ŒAndroidä¸Šå±‚ç»šä¸½å¤šå½©çš„Appç•Œé¢æ˜¯å¦‚ä½•ç»˜åˆ¶è€Œæˆçš„å‘¢ã€Appå±‚å¦‚ä½•é€šè¿‡åº•å±‚çš„OpenGL ESæ¥å£æ¥å®Œæˆç»˜åˆ¶å‘¢ï¼Ÿï¼Ÿï¼Ÿ</strong></p>
</blockquote>
<h4 id="ï¼ˆå…­ï¼‰ã€å‚è€ƒèµ„æ–™-ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º-ï¼š"><a href="#ï¼ˆå…­ï¼‰ã€å‚è€ƒèµ„æ–™-ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º-ï¼š" class="headerlink" title="ï¼ˆå…­ï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š"></a>ï¼ˆå…­ï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š</h4><p><a target="_blank" rel="noopener" href="https://www.khronos.org/">Khronos Group</a><br><a target="_blank" rel="noopener" href="https://source.android.com/devices/graphics/architecture">Androidå›¾å½¢æ¶æ„ å®˜æ–¹æ–‡æ¡£</a><br><a target="_blank" rel="noopener" href="http://geekfaner.com/shineengine/index.html">OPENGL ES 2.0 çŸ¥è¯†ä¸²è®²</a><br><a target="_blank" rel="noopener" href="https://www.slideshare.net/namjungsoo/egl-31239467">OpenGL ES EGL Spec&amp;APIs</a><br><a target="_blank" rel="noopener" href="https://www.slideshare.net/SuhanLee2/understaing-android-egl">Understaing-Android-Egl</a><br><a target="_blank" rel="noopener" href="https://woshijpf.github.io/category/android/">Android ç³»ç»Ÿå›¾å½¢æ ˆ(1) &amp;&amp;(2)ï¼š OpenGL ES å’Œ EGL</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/hovan/article/details/43198399">Android L çš„å¼€æœºåŠ¨ç”»æµç¨‹ - CSDNåšå®¢</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">zhoujinjian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://zhoujinjian.com/posts/20180508/">https://zhoujinjian.com/posts/20180508/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://zhoujinjian.com" target="_blank">zhoujinjian</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/Graphics/">Graphics</a><a class="post-meta__tags" href="/tags/Display/">Display</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.20.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/20180608/"><img class="prev-cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.21.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Android N Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æ</div></div></a></div><div class="next-post pull-right"><a href="/posts/20180408/"><img class="next-cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.07.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Android N Display Systemï¼ˆ1ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android Graphics ç³»ç»Ÿåˆ†æ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/20180408/" title="Android N Display Systemï¼ˆ1ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android Graphics ç³»ç»Ÿåˆ†æ"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.07.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-04-08</div><div class="title">Android N Display Systemï¼ˆ1ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android Graphics ç³»ç»Ÿåˆ†æ</div></div></a></div><div><a href="/posts/20180608/" title="Android N Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æ"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-08</div><div class="title">Android N Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æ</div></div></a></div><div><a href="/posts/20180708/" title="Android N Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc && HWComposeræ¨¡å—åˆ†æ"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-08</div><div class="title">Android N Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc && HWComposeræ¨¡å—åˆ†æ</div></div></a></div><div><a href="/posts/20180808/" title="Android N Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architecture"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.23.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-08-08</div><div class="title">Android N Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architecture</div></div></a></div><div><a href="/posts/20210310/" title="Android 10 Display Systemæºç åˆ†æï¼ˆ1ï¼‰ï¼šLCDæ˜¾ç¤ºåŸç†ï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-10</div><div class="title">Android 10 Display Systemæºç åˆ†æï¼ˆ1ï¼‰ï¼šLCDæ˜¾ç¤ºåŸç†ï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰</div></div></a></div><div><a href="/posts/20210410/" title="Android 10 Display Systemæºç åˆ†æï¼ˆ2ï¼‰ï¼šDisplay System ç²¾å½©ä¸–ç•Œï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.23.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-10</div><div class="title">Android 10 Display Systemæºç åˆ†æï¼ˆ2ï¼‰ï¼šDisplay System ç²¾å½©ä¸–ç•Œï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E3%80%81Android-Graphics-%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.</span> <span class="toc-text">1.1ã€Android Graphics æµ‹è¯•ç¨‹åº</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E3%80%81Android-BootAnimation-%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB-EGL%E5%9C%A8Android%E4%B8%AD%E5%BA%94%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">1.2ã€Android BootAnimation å¼€æœºåŠ¨ç”»(EGLåœ¨Androidä¸­åº”ç”¨)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E3%80%81Understanding-Android-Graphics-Internals"><span class="toc-number">3.</span> <span class="toc-text">1.2ã€Understanding Android Graphics Internals</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E3%80%81%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D"><span class="toc-number">4.</span> <span class="toc-text">2.1ã€å†™åœ¨å‰é¢çš„è¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1%E3%80%81%E7%94%B5%E8%84%91%E6%98%AF%E5%81%9A%E4%BB%80%E4%B9%88%E7%94%A8%E7%9A%84"><span class="toc-number">5.</span> <span class="toc-text">2.1.1ã€ç”µè„‘æ˜¯åšä»€ä¹ˆç”¨çš„?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-2%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88%E4%BD%BF%E5%BE%97%E7%94%B5%E8%84%91%E5%B7%A5%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">2.1.2ã€æ˜¯ä»€ä¹ˆä½¿å¾—ç”µè„‘å·¥ä½œ?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-3%E3%80%81%E8%B0%81%E6%9D%A5%E5%86%99%E9%A9%B1%E5%8A%A8"><span class="toc-number">7.</span> <span class="toc-text">2.1.3ã€è°æ¥å†™é©±åŠ¨?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-4%E3%80%81%E8%B0%81%E4%BC%9A%E4%BD%BF%E7%94%A8%E9%A9%B1%E5%8A%A8"><span class="toc-number">8.</span> <span class="toc-text">2.1.4ã€è°ä¼šä½¿ç”¨é©±åŠ¨?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-5%E3%80%81%E9%82%A3%E4%B9%88%E5%9C%A8%E5%93%AA%E9%87%8C%E8%BF%9B%E8%A1%8C%E7%BB%9F%E4%B8%80"><span class="toc-number">9.</span> <span class="toc-text">2.1.5ã€é‚£ä¹ˆåœ¨å“ªé‡Œè¿›è¡Œç»Ÿä¸€?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-6%E3%80%81%E8%B0%81%E8%BF%99%E4%B9%88%E7%89%9B-%E5%AE%9A%E4%B9%89%E4%BA%86-OpenGL-%E8%BF%99%E5%A5%97%E6%A0%87%E5%87%86"><span class="toc-number">10.</span> <span class="toc-text">2.1.6ã€è°è¿™ä¹ˆç‰›,å®šä¹‰äº† OpenGL è¿™å¥—æ ‡å‡†?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-7%E3%80%81OpenGL-%E5%92%8C%E6%88%91%E4%BB%AC%E6%B8%B8%E6%88%8F%EF%BC%88Android-%EF%BC%89%E5%BC%80%E5%8F%91%E8%80%85%E6%9C%89%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB"><span class="toc-number">11.</span> <span class="toc-text">2.1.7ã€OpenGL å’Œæˆ‘ä»¬æ¸¸æˆï¼ˆAndroid ï¼‰å¼€å‘è€…æœ‰ä»€ä¹ˆå…³ç³»?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-8%E3%80%81DirectX-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">12.</span> <span class="toc-text">2.1.8ã€DirectX æ˜¯ä»€ä¹ˆ?</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81OpenGL-ES-%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%B0%8F%E4%BC%99%E4%BC%B4"><span class="toc-number"></span> <span class="toc-text">2.2ã€OpenGL ES çš„ä¸¤ä¸ªå°ä¼™ä¼´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E5%B1%8F%E5%B9%95%E5%9B%BE%E7%89%87%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%92%8C%E4%BA%A7%E7%94%9F%E8%BF%87%E7%A8%8B"><span class="toc-number"></span> <span class="toc-text">2.3ã€å±å¹•å›¾ç‰‡çš„æœ¬è´¨å’Œäº§ç”Ÿè¿‡ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2%E3%80%81OpenGL-%E6%B5%81%E6%B0%B4%E7%BA%BF%EF%BC%88pipeline%EF%BC%89"><span class="toc-number"></span> <span class="toc-text">2.4.2ã€OpenGL æµæ°´çº¿ï¼ˆpipelineï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-0%E3%80%81OpenGL-ES"><span class="toc-number"></span> <span class="toc-text">3.1.0ã€OpenGL ES</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1%E3%80%81OpenGL-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number"></span> <span class="toc-text">3.1.1ã€OpenGL åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E3%80%81EGL-Overview"><span class="toc-number"></span> <span class="toc-text">3.2ã€EGL Overview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-EGL%EF%BC%9F"><span class="toc-number"></span> <span class="toc-text">3.2.1ã€ä»€ä¹ˆæ˜¯ EGLï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2%E3%80%81%E4%BD%BF%E7%94%A8-EGL-%E7%BB%98%E5%9B%BE%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><span class="toc-number"></span> <span class="toc-text">3.2.2ã€ä½¿ç”¨ EGL ç»˜å›¾çš„åŸºæœ¬æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%E3%80%81EGLSurface-and-ANativeWindow-%E5%85%B3%E7%B3%BB"><span class="toc-number"></span> <span class="toc-text">3.3ã€EGLSurface and ANativeWindow å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1%E3%80%81EGLSurface"><span class="toc-number"></span> <span class="toc-text">3.3.1ã€EGLSurface</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2%E3%80%81ANativeWindow"><span class="toc-number"></span> <span class="toc-text">3.3.2ã€ANativeWindow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3%E3%80%81egl-surface-t-%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="toc-number"></span> <span class="toc-text">3.3.3ã€egl_surface_t å…³ç³»å›¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4%E3%80%81EGLContext-and-Thread-Local-Storage"><span class="toc-number"></span> <span class="toc-text">3.3.4ã€EGLContext and Thread Local Storage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-1%E3%80%81EGLContext"><span class="toc-number"></span> <span class="toc-text">3.3.4.1ã€EGLContext</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-2%E3%80%81Thread-Local-Storage"><span class="toc-number"></span> <span class="toc-text">3.3.4.2ã€Thread Local Storage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5%E3%80%81EGLImplementation-HWCompser-and-SurfaceFlinger"><span class="toc-number"></span> <span class="toc-text">3.3.5ã€EGLImplementation : HWCompser and SurfaceFlinger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-1%E3%80%81HWCompser"><span class="toc-number"></span> <span class="toc-text">3.3.5.1ã€HWCompser</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-2%E3%80%81SurfaceFlinger"><span class="toc-number"></span> <span class="toc-text">3.3.5.2ã€SurfaceFlinger</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1%E3%80%81OpenGL-ES-%E5%92%8C-OpenGL-ES-%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.</span> <span class="toc-text">4.1ã€OpenGL ES å’Œ OpenGL ES åº“çš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2%E3%80%81Android-%E4%B8%AD-OpenGL-ES-%E8%BD%AF%E4%BB%B6%E5%B1%82%E6%AC%A1%E6%A0%88"><span class="toc-number">2.</span> <span class="toc-text">4.2ã€Android ä¸­ OpenGL ES è½¯ä»¶å±‚æ¬¡æ ˆ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3%E3%80%81OpenGL-ES-EGL-Wrapper-%E5%BA%93"><span class="toc-number">3.</span> <span class="toc-text">4.3ã€OpenGL ES&#x2F;EGL Wrapper åº“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-1%E3%80%81OpenGL-ES-EGL-%E5%AE%9E%E7%8E%B0%E5%BA%93"><span class="toc-number">4.</span> <span class="toc-text">4.3.1ã€OpenGL ES&#x2F;EGL å®ç°åº“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-2%E3%80%81Android-7-1-%E4%B8%AD%E5%8A%A0%E8%BD%BD-OpenGL-ES-%E5%BA%93%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">4.3.2ã€Android 7.1 ä¸­åŠ è½½ OpenGL ES åº“çš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-2-1%E3%80%81-Android-7-1-OpenGL-ES-%E5%BA%93%E5%92%8C-EGL-%E5%BA%93%E5%8A%A0%E8%BD%BD%E8%AF%B4%E6%98%8E"><span class="toc-number">6.</span> <span class="toc-text">4.3.2.1ã€ Android 7.1 OpenGL ES åº“å’Œ EGL åº“åŠ è½½è¯´æ˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-2-2%E3%80%81%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E6%B8%B2%E6%9F%93-or-%E8%BD%AF%E4%BB%B6%E6%A8%A1%E6%8B%9F%E6%B8%B2%E6%9F%93%EF%BC%9F"><span class="toc-number">7.</span> <span class="toc-text">4.3.2.2ã€ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ or è½¯ä»¶æ¨¡æ‹Ÿæ¸²æŸ“ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3%E3%80%81OpenGL-ES-EGL-%E5%BA%93%E5%8A%A0%E8%BD%BD%E5%92%8C%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-number">8.</span> <span class="toc-text">4.3.3ã€OpenGL ES&#x2F;EGL åº“åŠ è½½å’Œè§£æè¿‡ç¨‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">9.</span> <span class="toc-text">4.4ã€å°ç»“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1%E3%80%81eglGetDisplay"><span class="toc-number">10.</span> <span class="toc-text">5.1ã€eglGetDisplay()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2%E3%80%81eglInitialize"><span class="toc-number">11.</span> <span class="toc-text">5.2ã€eglInitialize()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3%E3%80%81eglChooseConfig"><span class="toc-number">12.</span> <span class="toc-text">5.3ã€eglChooseConfig()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-4%E3%80%81eglCreateContext"><span class="toc-number">13.</span> <span class="toc-text">5.4ã€eglCreateContext()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5%E3%80%81eglCreateWindowSurface"><span class="toc-number">14.</span> <span class="toc-text">5.5ã€eglCreateWindowSurface()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-6%E3%80%81eglMakeCurrent"><span class="toc-number">15.</span> <span class="toc-text">5.6ã€eglMakeCurrent()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-7%E3%80%81%E7%BB%98%E5%88%B6gl"><span class="toc-number">16.</span> <span class="toc-text">5.7ã€ç»˜åˆ¶gl_*()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8%E3%80%81eglSwapBuffers%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">17.</span> <span class="toc-text">5.8ã€eglSwapBuffersæ¥å£å®ç°è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E5%85%AD%EF%BC%89%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-%E7%89%B9%E5%88%AB%E6%84%9F%E8%B0%A2%E5%90%84%E4%BD%8D%E5%89%8D%E8%BE%88%E7%9A%84%E5%88%86%E6%9E%90%E5%92%8C%E5%9B%BE%E7%A4%BA-%EF%BC%9A"><span class="toc-number"></span> <span class="toc-text">ï¼ˆå…­ï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š</span></a></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/20240225/" title="Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.64.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº"/></a><div class="content"><a class="title" href="/posts/20240225/" title="Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº">Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº</a><time datetime="2024-02-24T16:00:00.000Z" title="å‘è¡¨äº 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240224/" title="Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.63.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»"/></a><div class="content"><a class="title" href="/posts/20240224/" title="Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»">Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»</a><time datetime="2024-02-23T16:00:00.000Z" title="å‘è¡¨äº 2024-02-24 00:00:00">2024-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240223/" title="Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.62.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†"/></a><div class="content"><a class="title" href="/posts/20240223/" title="Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†">Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†</a><time datetime="2024-02-22T16:00:00.000Z" title="å‘è¡¨äº 2024-02-23 00:00:00">2024-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240222/" title="Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.61.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"/></a><div class="content"><a class="title" href="/posts/20240222/" title="Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†">Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†</a><time datetime="2024-02-21T16:00:00.000Z" title="å‘è¡¨äº 2024-02-22 00:00:00">2024-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240221/" title="Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.60.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"/></a><div class="content"><a class="title" href="/posts/20240221/" title="Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†">Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†</a><time datetime="2024-02-20T16:00:00.000Z" title="å‘è¡¨äº 2024-02-21 00:00:00">2024-02-21</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By zhoujinjian</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/js/fishes.js"></script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>