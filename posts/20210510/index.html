<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Android 10 Display System源码分析（3）：U-boot Display 显示过程源码分析（Android 10.0 &amp;&amp; Kernel 4.15） | zhoujinjian</title><meta name="keywords" content="Android,Linux,Graphics"><meta name="author" content="zhoujinjian"><meta name="copyright" content="zhoujinjian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="&#x3D;&#x3D; 源码（部分）&#x3D;&#x3D;  U-boot   X:\u-boot\drivers\video\drm\rockchip_*.c X:\u-boot\drivers\video\drm\dw_mipi_dsi.c X:\u-boot\drivers\pinctrl\pinctrl-rockchip.c X:\u-boot\drivers\video\pwm_backlight.c   显示模块主要分">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 10 Display System源码分析（3）：U-boot Display 显示过程源码分析（Android 10.0 &amp;&amp; Kernel 4.15）">
<meta property="og:url" content="https://zhoujinjian.com/posts/20210510/index.html">
<meta property="og:site_name" content="zhoujinjian">
<meta property="og:description" content="&#x3D;&#x3D; 源码（部分）&#x3D;&#x3D;  U-boot   X:\u-boot\drivers\video\drm\rockchip_*.c X:\u-boot\drivers\video\drm\dw_mipi_dsi.c X:\u-boot\drivers\pinctrl\pinctrl-rockchip.c X:\u-boot\drivers\video\pwm_backlight.c   显示模块主要分">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.24.jpg">
<meta property="article:published_time" content="2021-05-10T01:25:00.000Z">
<meta property="article:modified_time" content="2024-04-14T13:01:32.932Z">
<meta property="article:author" content="zhoujinjian">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Graphics">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.24.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zhoujinjian.com/posts/20210510/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-14 21:01:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 5.0.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> 主页</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/home/"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fab fa-safari"></i><span> 导航</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.24.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zhoujinjian</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> 主页</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/home/"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fab fa-safari"></i><span> 导航</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">Android 10 Display System源码分析（3）：U-boot Display 显示过程源码分析（Android 10.0 &amp;&amp; Kernel 4.15）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-10T01:25:00.000Z" title="发表于 2021-05-10 09:25:00">2021-05-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-14T13:01:32.932Z" title="更新于 2024-04-14 21:01:32">2024-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Display/">Display</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>== 源码（部分）==</p>
<blockquote>
<p>U-boot</p>
</blockquote>
<ul>
<li>X:\u-boot\drivers\video\drm\rockchip_*.c</li>
<li>X:\u-boot\drivers\video\drm\dw_mipi_dsi.c</li>
<li>X:\u-boot\drivers\pinctrl\pinctrl-rockchip.c</li>
<li>X:\u-boot\drivers\video\pwm_backlight.c</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/Android10.Display.3.TestColor.gif"></p>
<p>显示模块主要分 vop, dsi, panel 三大模块，另加 gpio, 背光的控制，另外还有 logo 的解析和加载。整个流程基本上就是解析各个模块参数，然后准备，使能各个模块。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/khadas-edge-v-rk3399-mipi-dsi-framwork.jpg"></p>
<h2 id="一-、MIPI-屏幕配置"><a href="#一-、MIPI-屏幕配置" class="headerlink" title="(一)、MIPI 屏幕配置"></a>(一)、MIPI 屏幕配置</h2><h3 id="（1）、LCD-使用"><a href="#（1）、LCD-使用" class="headerlink" title="（1）、LCD 使用"></a>（1）、LCD 使用</h3><p>Edge-V 开发板外置了 3 个 LCD 屏接口：HDMI + MIPI + EDP。接口对应板子上的位置如下图，我们这里是 mipi：<br><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/edge-v_display_interfaces.jpg"></p>
<h3 id="（2）-（MIPI-HDMI）屏幕配置"><a href="#（2）-（MIPI-HDMI）屏幕配置" class="headerlink" title="（2）,（MIPI + HDMI）屏幕配置"></a>（2）,（MIPI + HDMI）屏幕配置</h3><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/edge_v_ts050.jpg"></p>
<h3 id="（3）-配置-dts"><a href="#（3）-配置-dts" class="headerlink" title="（3）,配置 dts"></a>（3）,配置 dts</h3><h4 id="3-1-使能对应显示设备节点"><a href="#3-1-使能对应显示设备节点" class="headerlink" title="3.1,使能对应显示设备节点"></a>3.1,使能对应显示设备节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&amp;dp_in_vopl &#123;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;dp_in_vopb &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;hdmi_in_vopb &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;hdmi_in_vopl &#123;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;route_hdmi &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">    connect = &lt;&amp;vopb_out_hdmi&gt;;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;route_dsi &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">    connect = &lt;&amp;vopl_out_dsi&gt;;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;dsi_in_vopb &#123;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;dsi_in_vopl &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<h4 id="3-2-绑定-PLL"><a href="#3-2-绑定-PLL" class="headerlink" title="3.2, 绑定 PLL"></a>3.2, 绑定 PLL</h4><p>rk3399 的 hdmi 所绑定的 vop 时钟需要挂载到 vpll 上，若是双显需将另一个 vop 时钟挂到 cpll 这样可以分出任意 dclk 的频率。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&amp;vopb &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">    assigned-clocks = &lt;&amp;cru DCLK_VOP0_DIV&gt;;</span><br><span class="line">    assigned-clock-parents = &lt;&amp;cru PLL_VPLL&gt;;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">&amp;vopl &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">    assigned-clocks = &lt;&amp;cru DCLK_VOP1_DIV&gt;;</span><br><span class="line">    assigned-clock-parents = &lt;&amp;cru PLL_CPLL&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-配置-timing"><a href="#3-3-配置-timing" class="headerlink" title="3.3,配置 timing"></a>3.3,配置 timing</h4><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/Android10.Display.3.MIPI-DSI.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&amp;dsi &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">    rockchip,lane-rate = &lt;1000&gt;;</span><br><span class="line">    dsi_panel: panel@0 &#123;</span><br><span class="line">        status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;simple-panel-dsi&quot;</span>;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-gpios = &lt;&amp;gpio4 RK_PD4 GPIO_ACTIVE_HIGH&gt;; /* GPIO4_D4 */</span><br><span class="line">        <span class="built_in">enable</span>-gpios = &lt;&amp;gpio4 RK_PD5 GPIO_ACTIVE_HIGH&gt;; /* GPIO4_D5 */</span><br><span class="line">//      pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">//      pinctrl-0 = &lt;&amp;lcd_reset_gpio&gt;, &lt;&amp;lcd_enable_gpio&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        <span class="built_in">enable</span>-delay-ms = &lt;60&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;60&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;60&gt;;</span><br><span class="line">        <span class="built_in">disable</span>-delay-ms = &lt;60&gt;;</span><br><span class="line">        init-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST |</span><br><span class="line">                  MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">​</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        panel-init-sequence = [</span><br><span class="line">            15 00 02  FF 05</span><br><span class="line">            ......</span><br><span class="line">            05 0A 01  29</span><br><span class="line">        ];</span><br><span class="line">        panel-exit-sequence = [</span><br><span class="line">            05 05 01 28</span><br><span class="line">            05 78 01 10</span><br><span class="line">        ];</span><br><span class="line">​</span><br><span class="line">        disp_timings: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;timing0&gt;;</span><br><span class="line">            timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;120000000&gt;;</span><br><span class="line">                hactive = &lt;1088&gt;; /* default 1080, but afbdc must 16 align */</span><br><span class="line">                hfront-porch = &lt;104&gt;;</span><br><span class="line">                hback-porch = &lt;127&gt;;</span><br><span class="line">                hsync-len = &lt;4&gt;; /////</span><br><span class="line">                vactive = &lt;1920&gt;;</span><br><span class="line">                vfront-porch = &lt;4&gt;;</span><br><span class="line">                vback-porch = &lt;3&gt;;</span><br><span class="line">                vsync-len = &lt;2&gt;; /////</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/timing_attribute_reference_figure.png"><br><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/timing_attribute_reference_figure_2.png"></p>
<p><strong>命令格式说明</strong></p>
<blockquote>
<p>panel-exit-sequence = [<br>05 05 01 28<br>05 78 01 10<br>];</p>
</blockquote>
<p>命令的前面三个字节分别表示命令类型、延时和命令净荷长度。从第四个字节开始表示命令的有效 payload。这个字节数需要与第三个字节一致。<br>第一个字节代表的命令类型分两大类：DCS 命令和 Generic 命令。DCS 命令是有 mipi 标准协议里面指定的命令，具体可以参考《MIPI Alliance Specification for Display Command Set.pdf 》。Generic 命令一般应用于厂商自定义的命令。具体使用哪种类型需要参考屏规格书或者咨询屏厂 FAE。如果没有特别指定，建议按 DCS 命令类型配置。DCS 命 令 的 类 型 有 三 种 ： 0x05/0x15/0x39 。 Generic 命 令 的 类 型 分 为 ：<br>0x03/0x13/0x23/0x29。</p>
<h3 id="3-4-背光-backlight"><a href="#3-4-背光-backlight" class="headerlink" title="3.4, 背光 backlight"></a>3.4, 背光 backlight</h3><p>pwms 属性：配置 PWM，MIPI 屏使用的 pwm 输出是 pwm1，25000ns 是周期 (40 KHz)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&amp;backlight &#123;</span><br><span class="line">    pwms = &lt;&amp;pwm1 0 25000 0&gt;;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">​</span><br><span class="line">&amp;pwm1 &#123;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="二-、U-boot-Display-显示过程分析"><a href="#二-、U-boot-Display-显示过程分析" class="headerlink" title="(二)、U-boot Display 显示过程分析"></a>(二)、U-boot Display 显示过程分析</h2><p>首先看看全部 Log：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_display_probe 1531 </span><br><span class="line">[2020/9/11 15:42:21] init_display_buffer 0x7df00000zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_of_find_connector 1473 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_of_find_bridge 1416 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_of_find_panel 1355 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c connector_panel_init 244 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c connector_phy_init 212 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_of_find_connector 1473 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_probe 606 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot dw_mipi_dsi_probe dsi-&gt;id 0x0 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_of_find_bridge 1416 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_of_find_panel 1355 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_child_pre_probe 729 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_host_attach 675 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c rockchip_panel_ofdata_to_platdata 361 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c rockchip_panel_parse_cmds 99 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c rockchip_panel_parse_cmds 99 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c rockchip_panel_probe 422 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c connector_panel_init 244 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c connector_phy_init 212 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/clk/rockchip/clk_rk3399.c rk3399_clk_set_rate 1233 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c display_logo 956 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c display_init 701 </span><br><span class="line">[2020/9/11 15:42:21] Rockchip UBOOT DRM driver version: v1.0.1</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_vop_preinit 585 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c display_logo 956 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c display_init 701 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_vop_preinit 585 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c panel_simple_init 577 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_connector_init 380 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c display_get_timing 541 </span><br><span class="line">[2020/9/11 15:42:21] Using display timing dts</span><br><span class="line">[2020/9/11 15:42:21] Detailed mode clock 120000 kHz, flags[a]</span><br><span class="line">[2020/9/11 15:42:21]     H: 1088 1192 1196 1323</span><br><span class="line">[2020/9/11 15:42:21]     V: 1920 1924 1926 1929</span><br><span class="line">[2020/9/11 15:42:21] bus_format: 100e</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_vop_init 616 </span><br><span class="line">[2020/9/11 15:42:21] vop-&gt;regs ret=00000000ff8f0000</span><br><span class="line">[2020/9/11 15:42:21] vop-&gt;grf ret=00000000ff770000</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/clk/rockchip/clk_rk3399.c rk3399_dclk_vop_set_parent 1347 </span><br><span class="line">[2020/9/11 15:42:21] mode-&gt;clock ret=120000</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/clk/rockchip/clk_rk3399.c rk3399_clk_set_rate 1233 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/clk/rockchip/clk_rk3399.c rk3399_vop_set_clk 761 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot aclkreg_addr 00000000ff7601c0 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot dclkreg_addr 00000000ff7601c8 </span><br><span class="line">[2020/9/11 15:42:21] PLL at 00000000ff760060: fbdiv=35, refdiv=1, postdiv1=7, postdiv2=1, vco=840000 khz, output=120000 khz</span><br><span class="line">[2020/9/11 15:42:21] PLL at &amp;pll_con[3] : 00000000ff76006c PLL at &amp;pll_con[0] : 00000000ff760060 PLL at &amp;pll_con[1] : 00000000ff760064 PLL at &amp;pll_con[2] : 00000000ff760068 zjj.rk3399.uboot &amp;cru-&gt;cpll_con[0] 00000000ff760060 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/zhoujinjian_mipi_rockchip_display.c zjj_rockchip_vop_init 602 </span><br><span class="line">[2020/9/11 15:42:21] dma_addr 7df06000</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_vop_set_plane 670 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/zhoujinjian_mipi_rockchip_display.c zjj_rockchip_vop_set_plane 695 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c display_enable 870 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_connector_prepare 541 </span><br><span class="line">[2020/9/11 15:42:21] final DSI-Link bandwidth: 0 Mbps x 4</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write name VOPSEL</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write vop-&gt;grf:00000000ff770000 + reg:0x6250  GENMASK(msb:0x0, lsb:0x0) val:0x1 &lt;&lt; lsb:0x0</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_pre_enable 519 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_host_init 400 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c mipi_dphy_init 458 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write name TURNREQUEST</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write vop-&gt;grf:00000000ff770000 + reg:0x6258  GENMASK(msb:0xf, lsb:0xc) val:0x0 &lt;&lt; lsb:0xc</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write name TURNDISABLE</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write vop-&gt;grf:00000000ff770000 + reg:0x6258  GENMASK(msb:0xb, lsb:0x8) val:0x0 &lt;&lt; lsb:0x8</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write name FORCETXSTOPMODE</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write vop-&gt;grf:00000000ff770000 + reg:0x6258  GENMASK(msb:0x7, lsb:0x4) val:0x0 &lt;&lt; lsb:0x4</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write name FORCERXMODE</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot grf_field_write vop-&gt;grf:00000000ff770000 + reg:0x6258  GENMASK(msb:0x3, lsb:0x0) val:0x0 &lt;&lt; lsb:0x0</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x44, test_data=0x34, monitor_data=0x34</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x60, test_data=0x87, monitor_data=0x87</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x70, test_data=0x87, monitor_data=0x87</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x19, test_data=0x30, monitor_data=0x30</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x17, test_data=0x03, monitor_data=0x03</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x18, test_data=0x05, monitor_data=0x05</span><br><span class="line">[2020/9/11 15:42:21] test_code=0x18, test_data=0x85, monitor_data=0x05</span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c mipi_dphy_power_on 188 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c panel_simple_prepare 189 </span><br><span class="line">[2020/9/11 15:42:21] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c rockchip_panel_send_dsi_cmds 145 </span><br><span class="line">[2020/9/11 15:42:22] zjj.rk3399.uboot drivers/video/drm/rockchip_display.c rockchip_vop_enable 677 </span><br><span class="line">[2020/9/11 15:42:22] zjj.rk3399.uboot drivers/video/drm/zhoujinjian_mipi_rockchip_display.c zjj_rockchip_vop_enable 723 </span><br><span class="line">[2020/9/11 15:42:22] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_connector_enable 574 </span><br><span class="line">[2020/9/11 15:42:22] zjj.rk3399.uboot drivers/video/drm/dw_mipi_dsi.c dw_mipi_dsi_enable 340 </span><br><span class="line">[2020/9/11 15:42:22] zjj.rk3399.uboot drivers/video/drm/rockchip_panel.c panel_simple_enable 269 </span><br><span class="line">[2020/9/11 15:42:22] zjj rk_pwm_bl_config.</span><br><span class="line">[2020/9/11 15:42:22] pwm_1-&gt;base 0xff420010</span><br><span class="line">​</span><br><span class="line">[END] 2020/9/11 15:42:59</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
<h4 id="U-boot-Display-显示过程流程图"><a href="#U-boot-Display-显示过程流程图" class="headerlink" title="U-boot Display 显示过程流程图"></a>U-boot Display 显示过程流程图</h4><hr>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/Android10.Display.3/Android10.Display.3.UBoot.Display.Flow.png"></p>
<h2 id="（三）、vop-dsi-panel-三大模块-init-分析"><a href="#（三）、vop-dsi-panel-三大模块-init-分析" class="headerlink" title="（三）、vop, dsi, panel 三大模块 init 分析"></a>（三）、vop, dsi, panel 三大模块 init 分析</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\rockchip_display.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">display_init</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">panel_state</span> *<span class="title">panel_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">panel_state</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_connector</span> *<span class="title">conn</span> = <span class="title">conn_state</span>-&gt;<span class="title">connector</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_connector_funcs</span> *<span class="title">conn_funcs</span> = <span class="title">conn</span>-&gt;<span class="title">funcs</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">crtc_state</span> *<span class="title">crtc_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">crtc_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_crtc</span> *<span class="title">crtc</span> = <span class="title">crtc_state</span>-&gt;<span class="title">crtc</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_crtc_funcs</span> *<span class="title">crtc_funcs</span> = <span class="title">crtc</span>-&gt;<span class="title">funcs</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">drm_display_mode</span> *<span class="title">mode</span> = &amp;<span class="title">conn_state</span>-&gt;<span class="title">mode</span>;</span></span><br><span class="line">    <span class="keyword">int</span> bpc;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> __print_once = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> (crtc_funcs-&gt;preinit) &#123;</span><br><span class="line">        ret = rockchip_vop_preinit(state);</span><br><span class="line">        <span class="keyword">if</span> (ret)</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (panel_state-&gt;panel)</span><br><span class="line">        panel_simple_init(panel_state-&gt;panel);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (conn_funcs-&gt;init) &#123;</span><br><span class="line">        ret = conn_funcs-&gt;init(state);</span><br><span class="line">        <span class="keyword">if</span> (ret)</span><br><span class="line">            <span class="keyword">goto</span> deinit;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (conn_state-&gt;phy)</span><br><span class="line">        rockchip_phy_init(conn_state-&gt;phy);</span><br><span class="line">   ......</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (panel_state-&gt;panel) &#123;</span><br><span class="line">        ret = display_get_timing(state);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (conn_state-&gt;bridge) &#123;</span><br><span class="line">        ret = video_bridge_read_edid(conn_state-&gt;bridge-&gt;dev,</span><br><span class="line">                         conn_state-&gt;edid, EDID_SIZE);</span><br><span class="line">        <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            ret = edid_get_drm_mode(conn_state-&gt;edid, ret, mode,</span><br><span class="line">                        &amp;bpc);</span><br><span class="line">            <span class="keyword">if</span> (!ret)</span><br><span class="line">                edid_print_info((<span class="keyword">void</span> *)&amp;conn_state-&gt;edid);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ret = video_bridge_get_timing(conn_state-&gt;bridge-&gt;dev);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (conn_funcs-&gt;get_timing) &#123;</span><br><span class="line">        ret = conn_funcs-&gt;get_timing(state);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (conn_funcs-&gt;get_edid) &#123;</span><br><span class="line">        ret = conn_funcs-&gt;get_edid(state);</span><br><span class="line">        <span class="keyword">if</span> (!ret) &#123;</span><br><span class="line">            ret = edid_get_drm_mode((<span class="keyword">void</span> *)&amp;conn_state-&gt;edid,</span><br><span class="line">                        <span class="keyword">sizeof</span>(conn_state-&gt;edid), mode,</span><br><span class="line">                        &amp;bpc);</span><br><span class="line">            <span class="keyword">if</span> (!ret)</span><br><span class="line">                edid_print_info((<span class="keyword">void</span> *)&amp;conn_state-&gt;edid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (ret)</span><br><span class="line">        <span class="keyword">goto</span> deinit;</span><br><span class="line">​</span><br><span class="line">    drm_mode_set_crtcinfo(mode, CRTC_INTERLACE_HALVE_V);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (crtc_funcs-&gt;init) &#123;</span><br><span class="line">        <span class="comment">//zjj_rockchip_vop_init();</span></span><br><span class="line">        ret = rockchip_vop_init(state);</span><br><span class="line">        <span class="keyword">if</span> (ret)</span><br><span class="line">            <span class="keyword">goto</span> deinit;</span><br><span class="line">    &#125;</span><br><span class="line">    state-&gt;is_init = <span class="number">1</span>;</span><br><span class="line">​</span><br><span class="line">    crtc_state-&gt;crtc-&gt;active = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;crtc_state-&gt;crtc-&gt;active_mode,</span><br><span class="line">           &amp;conn_state-&gt;mode, <span class="keyword">sizeof</span>(struct drm_display_mode));</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">​</span><br><span class="line">deinit:</span><br><span class="line">    <span class="keyword">if</span> (conn_funcs-&gt;deinit)</span><br><span class="line">        conn_funcs-&gt;deinit(state);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1、Panel-模块-init-分析"><a href="#3-1、Panel-模块-init-分析" class="headerlink" title="3.1、Panel 模块 init 分析"></a>3.1、Panel 模块 init 分析</h3><h4 id="3-1-1、panel-simple-init"><a href="#3-1-1、panel-simple-init" class="headerlink" title="3.1.1、panel_simple_init()"></a>3.1.1、panel_simple_init()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\rockchip_panel.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">panel_simple_init</span><span class="params">(struct rockchip_panel *panel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">display_state</span> *<span class="title">state</span> = <span class="title">panel</span>-&gt;<span class="title">state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    conn_state-&gt;bus_format = panel-&gt;bus_format;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<h3 id="3-2、DSI-模块-init-分析"><a href="#3-2、DSI-模块-init-分析" class="headerlink" title="3.2、DSI 模块 init 分析"></a>3.2、DSI 模块 init 分析</h3><h4 id="3-2-1、dw-mipi-dsi-connector-init"><a href="#3-2-1、dw-mipi-dsi-connector-init" class="headerlink" title="3.2.1、dw_mipi_dsi_connector_init()"></a>3.2.1、dw_mipi_dsi_connector_init()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\dw_mipi_dsi.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dw_mipi_dsi_connector_init</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="comment">//struct dw_mipi_dsi *dsi = dev_get_priv(conn_state-&gt;dev);</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dsi-&gt;dphy.phy = conn_state-&gt;phy;</span></span><br><span class="line">​</span><br><span class="line">    conn_state-&gt;output_mode = ROCKCHIP_OUT_MODE_P888;</span><br><span class="line">    conn_state-&gt;color_space = V4L2_COLORSPACE_DEFAULT;</span><br><span class="line">    conn_state-&gt;type = DRM_MODE_CONNECTOR_DSI;</span><br><span class="line">    <span class="comment">//printf(&quot;zjj.rk3399.uboot dsi:%p , dsi-&gt;id %d \n&quot;,&amp;dsi , dsi-&gt;id);</span></span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3、Vop-模块-init-分析"><a href="#3-3、Vop-模块-init-分析" class="headerlink" title="3.3、Vop 模块 init 分析"></a>3.3、Vop 模块 init 分析</h3><h4 id="3-3-1、rockchip-vop-init"><a href="#3-3-1、rockchip-vop-init" class="headerlink" title="3.3.1、rockchip_vop_init()"></a>3.3.1、rockchip_vop_init()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">rockchip_vop_init</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">crtc_state</span> *<span class="title">crtc_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">crtc_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">drm_display_mode</span> *<span class="title">mode</span> = &amp;<span class="title">conn_state</span>-&gt;<span class="title">mode</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_crtc</span> *<span class="title">crtc</span> = <span class="title">crtc_state</span>-&gt;<span class="title">crtc</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">vop_data</span> *<span class="title">vop_data</span> = <span class="title">crtc</span>-&gt;<span class="title">data</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vop</span> *<span class="title">vop</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">clk</span> <span class="title">dclk</span>;</span></span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    vop = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(*vop));</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">memset</span>(vop, <span class="number">0</span>, <span class="keyword">sizeof</span>(*vop));</span><br><span class="line">​</span><br><span class="line">    crtc_state-&gt;<span class="keyword">private</span> = vop;</span><br><span class="line">​</span><br><span class="line">    vop-&gt;regs = dev_read_addr_ptr(crtc_state-&gt;dev);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;vop-&gt;regs ret=%p\n&quot;</span>, vop-&gt;regs);</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">/* Process &#x27;assigned-&#123;clocks/clock-parents/clock-rates&#125;&#x27; properties */</span></span><br><span class="line">    ret = clk_set_defaults(crtc_state-&gt;dev);</span><br><span class="line">    <span class="keyword">if</span> (ret)</span><br><span class="line">        debug(<span class="string">&quot;%s clk_set_defaults failed %d\n&quot;</span>, __func__, ret);</span><br><span class="line">​</span><br><span class="line">    ret = clk_get_by_name(crtc_state-&gt;dev, <span class="string">&quot;dclk_vop&quot;</span>, &amp;dclk);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;mode-&gt;clock ret=%d\n&quot;</span>,mode-&gt;clock);</span><br><span class="line">    <span class="keyword">if</span> (!ret)</span><br><span class="line">        ret = clk_set_rate(&amp;dclk, mode-&gt;clock * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span> (IS_ERR_VALUE(ret)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: Failed to set dclk: ret=%d\n&quot;</span>, __func__, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">memcpy</span>(vop-&gt;regsbak, vop-&gt;regs, vop_data-&gt;reg_len);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//rockchip_vop_init_gamma(vop, state);</span></span><br><span class="line">​</span><br><span class="line">    zjj_rockchip_vop_init(vop-&gt;regs, vop-&gt;regsbak, vop_data-&gt;reg_len);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2、zjj-rockchip-vop-init"><a href="#3-3-2、zjj-rockchip-vop-init" class="headerlink" title="3.3.2、zjj_rockchip_vop_init()"></a>3.3.2、zjj_rockchip_vop_init()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\zhoujinjian_mipi_rockchip_display.c</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> mask;</span><br><span class="line">    <span class="keyword">uint32_t</span> offset:<span class="number">12</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> shift:<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> begin_minor:<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> end_minor:<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> major:<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> write_mask:<span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* zjj_rockchip_vop_init */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">global_regdone_en</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_SYS_CTRL</span>, 0<span class="title">x1</span>, 11, 3, 2, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">axi_outstanding_max_num</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_SYS_CTRL1</span>, 0<span class="title">x1f</span>, 13);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">axi_max_outstanding_en</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_SYS_CTRL1</span>, 0<span class="title">x1</span>, 12);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">win_gate0</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_CTRL0</span>, 0<span class="title">x1</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">win_gate1</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN3_CTRL0</span>, 0<span class="title">x1</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_blank</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x3</span>, 18);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">mipi_en</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_SYS_CTRL</span>, 0<span class="title">x1</span>, 15);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">mipi_pin_pol</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_DSP_CTRL1</span>, 0<span class="title">x7</span>, 28, 3, 2, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">mipi_dclk_pol</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_DSP_CTRL1</span>, 0<span class="title">x1</span>, 31, 3, 2, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">mipi_dual_channel_en</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_SYS_CTRL</span>, 0<span class="title">x1</span>, 3);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">data01_swap</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_SYS_CTRL</span>, 0<span class="title">x1</span>, 17, 3, 5, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dither_down</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL1</span>, 0<span class="title">xf</span>, 1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dclk_ddr</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1</span>, 8, 3, 4, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_data_swap</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1f</span>, 12);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">out_mode</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">xf</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">overlay_mode</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_SYS_CTRL</span>, 0<span class="title">x1</span>, 16, 3, 2, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_out_yuv</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_POST_SCL_CTRL</span>, 0<span class="title">x1</span>, 2, 3, 5, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">bcsh_r2y_en</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_BCSH_CTRL</span>, 0<span class="title">x1</span>, 4, 3, 1, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">bcsh_y2r_en</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_BCSH_CTRL</span>, 0<span class="title">x1</span>, 0, 3, 1, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">bcsh_r2y_csc_mode</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_BCSH_CTRL</span>, 0<span class="title">x1</span>, 6, 3, 1, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">bcsh_y2r_csc_mode</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_BCSH_CTRL</span>, 0<span class="title">x3</span>, 2, 3, 1, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_background</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_BG</span>, 0<span class="title">xffffffff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">htotal_pw</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_HTOTAL_HS_END</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">hact_st_end</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_HACT_ST_END</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">vact_st_end</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_VACT_ST_END</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_interlace</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1</span>, 10);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">p2i_en</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1</span>, 5, 3, 4, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">vtotal_pw</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_VTOTAL_VS_END</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">hpost_st_end</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_POST_DSP_HACT_INFO</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">vpost_st_end</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_POST_DSP_VACT_INFO</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">post_scl_factor</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_POST_SCL_FACTOR_YRGB</span>, 0<span class="title">xffffffff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">post_scl_ctrl</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_POST_SCL_CTRL</span>, 0<span class="title">x3</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">core_dclk_div</span> = <span class="title">VOP_REG_VER</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1</span>, 4, 3, 4, -1);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">line_flag_num0</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_LINE_FLAG</span>, 0<span class="title">xffff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">line_flag_num1</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_LINE_FLAG</span>, 0<span class="title">xffff</span>, 16);</span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">zjj_rockchip_vop_init</span><span class="params">(<span class="keyword">void</span> * reg, u32 * rbak, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    regsbak = rbak;</span><br><span class="line">    regs = reg;</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, global_regdone_en.offset, global_regdone_en.mask, global_regdone_en.shift, </span><br><span class="line">        <span class="number">1</span>, global_regdone_en.write_mask);</span><br><span class="line">    vop_mask_write(regs, axi_outstanding_max_num.offset, axi_outstanding_max_num.mask, axi_outstanding_max_num.shift, </span><br><span class="line">        <span class="number">30</span>, axi_outstanding_max_num.write_mask);</span><br><span class="line">    vop_mask_write(regs, axi_max_outstanding_en.offset, axi_max_outstanding_en.mask, axi_max_outstanding_en.shift, </span><br><span class="line">        <span class="number">1</span>, axi_max_outstanding_en.write_mask);</span><br><span class="line">    vop_mask_write(regs, win_gate0.offset, win_gate0.mask, win_gate0.shift, </span><br><span class="line">        <span class="number">1</span>, win_gate0.write_mask);</span><br><span class="line">    vop_mask_write(regs, win_gate1.offset, win_gate1.mask, win_gate1.shift, </span><br><span class="line">        <span class="number">1</span>, win_gate0.write_mask);</span><br><span class="line">    vop_mask_write(regs, dsp_blank.offset, dsp_blank.mask, dsp_blank.shift, </span><br><span class="line">        <span class="number">0</span>, dsp_blank.write_mask);</span><br><span class="line">    vop_mask_write(regs, mipi_en.offset, mipi_en.mask, mipi_en.shift, </span><br><span class="line">        <span class="number">1</span>, mipi_en.write_mask);</span><br><span class="line">    vop_mask_write(regs, mipi_pin_pol.offset, mipi_pin_pol.mask, mipi_pin_pol.shift, </span><br><span class="line">        <span class="number">8</span>, mipi_pin_pol.write_mask);</span><br><span class="line">    vop_mask_write(regs, mipi_dclk_pol.offset, mipi_dclk_pol.mask, mipi_dclk_pol.shift, </span><br><span class="line">        <span class="number">1</span>, mipi_dclk_pol.write_mask);</span><br><span class="line">    vop_mask_write(regs, mipi_dual_channel_en.offset, mipi_dual_channel_en.mask, mipi_dual_channel_en.shift, </span><br><span class="line">        <span class="number">0</span>, mipi_dual_channel_en.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, data01_swap.offset, data01_swap.mask, data01_swap.shift, </span><br><span class="line">        <span class="number">0</span>, data01_swap.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, dither_down.offset, dither_down.mask, dither_down.shift, </span><br><span class="line">        <span class="number">1</span>, dither_down.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, dclk_ddr.offset, dclk_ddr.mask, dclk_ddr.shift, </span><br><span class="line">        <span class="number">0</span>, dclk_ddr.write_mask);</span><br><span class="line">    vop_mask_write(regs, dsp_data_swap.offset, dsp_data_swap.mask, dsp_data_swap.shift, </span><br><span class="line">        <span class="number">0</span>, dsp_data_swap.write_mask);</span><br><span class="line">    vop_mask_write(regs, dsp_data_swap.offset, dsp_data_swap.mask, dsp_data_swap.shift, </span><br><span class="line">        <span class="number">0</span>, dsp_data_swap.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, out_mode.offset, out_mode.mask, out_mode.shift, </span><br><span class="line">        <span class="number">0</span>, out_mode.write_mask);</span><br><span class="line">    vop_mask_write(regs, overlay_mode.offset, overlay_mode.mask, overlay_mode.shift, </span><br><span class="line">        <span class="number">0</span>, overlay_mode.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, dsp_out_yuv.offset, dsp_out_yuv.mask, dsp_out_yuv.shift, </span><br><span class="line">        <span class="number">0</span>, dsp_out_yuv.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, bcsh_r2y_en.offset, bcsh_r2y_en.mask, bcsh_r2y_en.shift, </span><br><span class="line">        <span class="number">0</span>, bcsh_r2y_en.write_mask);</span><br><span class="line">    vop_mask_write(regs, bcsh_y2r_en.offset, bcsh_y2r_en.mask, bcsh_y2r_en.shift, </span><br><span class="line">        <span class="number">0</span>, bcsh_y2r_en.write_mask);</span><br><span class="line">    vop_mask_write(regs, bcsh_r2y_csc_mode.offset, bcsh_r2y_csc_mode.mask, bcsh_r2y_csc_mode.shift, </span><br><span class="line">        <span class="number">1</span>, bcsh_r2y_csc_mode.write_mask);</span><br><span class="line">    vop_mask_write(regs, bcsh_y2r_csc_mode.offset, bcsh_y2r_csc_mode.mask, bcsh_y2r_csc_mode.shift, </span><br><span class="line">        <span class="number">1</span>, bcsh_y2r_csc_mode.write_mask);</span><br><span class="line">    vop_mask_write(regs, htotal_pw.offset, htotal_pw.mask, htotal_pw.shift, </span><br><span class="line">        <span class="number">0x52b0004</span>, htotal_pw.write_mask);</span><br><span class="line">    vop_mask_write(regs, hact_st_end.offset, hact_st_end.mask, hact_st_end.shift, </span><br><span class="line">        <span class="number">0x8304c3</span>, hact_st_end.write_mask);</span><br><span class="line">    vop_mask_write(regs, vact_st_end.offset, vact_st_end.mask, vact_st_end.shift, </span><br><span class="line">        <span class="number">0x50785</span>, vact_st_end.write_mask);</span><br><span class="line">    vop_mask_write(regs, dsp_interlace.offset, dsp_interlace.mask, dsp_interlace.shift, </span><br><span class="line">        <span class="number">0</span>, dsp_interlace.write_mask);</span><br><span class="line">    vop_mask_write(regs, p2i_en.offset, p2i_en.mask, p2i_en.shift, </span><br><span class="line">        <span class="number">0</span>, p2i_en.write_mask);</span><br><span class="line">    vop_mask_write(regs, vtotal_pw.offset, vtotal_pw.mask, vtotal_pw.shift, </span><br><span class="line">         <span class="number">0x7890002</span>, vtotal_pw.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, hpost_st_end.offset, hpost_st_end.mask, hpost_st_end.shift, </span><br><span class="line">         <span class="number">0x8304c3</span>, hpost_st_end.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, vpost_st_end.offset, vpost_st_end.mask, vpost_st_end.shift, </span><br><span class="line">         <span class="number">0x50785</span>, vpost_st_end.write_mask);</span><br><span class="line">​</span><br><span class="line">    vop_mask_write(regs, post_scl_factor.offset, post_scl_factor.mask, post_scl_factor.shift, </span><br><span class="line">         <span class="number">0x10001000</span> , post_scl_factor.write_mask);</span><br><span class="line">    vop_mask_write(regs, post_scl_ctrl.offset, post_scl_ctrl.mask, post_scl_ctrl.shift, </span><br><span class="line">         <span class="number">0</span> , post_scl_ctrl.write_mask);</span><br><span class="line">    </span><br><span class="line">    vop_mask_write(regs, core_dclk_div.offset, core_dclk_div.mask, core_dclk_div.shift, </span><br><span class="line">         <span class="number">0</span> , core_dclk_div.write_mask);</span><br><span class="line">    </span><br><span class="line">    vop_mask_write(regs, line_flag_num0.offset, line_flag_num0.mask, line_flag_num0.shift, </span><br><span class="line">         <span class="number">0x782</span> , line_flag_num0.write_mask);</span><br><span class="line">    vop_mask_write(regs, line_flag_num1.offset, line_flag_num1.mask, line_flag_num1.shift, </span><br><span class="line">         <span class="number">0x72b</span> , line_flag_num1.write_mask);</span><br><span class="line">    vop_mask_write(regs, cfg_done.offset, cfg_done.mask, cfg_done.shift, </span><br><span class="line">         <span class="number">1</span> , cfg_done.write_mask);</span><br><span class="line">​</span><br><span class="line">&#125;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3、zjj-rockchip-vop-set-plane-​​​​​​​"><a href="#3-3-3、zjj-rockchip-vop-set-plane-​​​​​​​" class="headerlink" title="3.3.3、zjj_rockchip_vop_set_plane()​​​​​​​"></a>3.3.3、zjj_rockchip_vop_set_plane()​​​​​​​</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\zhoujinjian_mipi_rockchip_display.c</span><br><span class="line"><span class="comment">/* zjj_rockchip_vop_set_plane*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">ymirror</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1</span>, 23);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">xmirror</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_DSP_CTRL0</span>, 0<span class="title">x1</span>, 22);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">format</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_CTRL0</span>, 0<span class="title">x3</span>, 5);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">yrgb_vir</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_VIR0_1</span>, 0<span class="title">x1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">yrgb_mst</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_MST0</span>, 0<span class="title">xffffffff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">act_info</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN0_ACT_INFO</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_info</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_DSP_INFO0</span>, 0<span class="title">x0fff0fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">dsp_st</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_DSP_ST0</span>, 0<span class="title">x1fff1fff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">rb_swap</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_CTRL0</span>, 0<span class="title">x1</span>, 20);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">src_alpha_ctl</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_SRC_ALPHA_CTRL</span>, 0<span class="title">xffff</span>, 0);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">zjj_vop_reg</span> <span class="title">enable</span> = <span class="title">VOP_REG</span>(<span class="title">RK3399_WIN2_CTRL0</span>, 0<span class="title">x1</span>, 4);</span></span><br><span class="line">​</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">zjj_rockchip_vop_set_plane</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">    vop_mask_write(regs, ymirror.offset, ymirror.mask, ymirror.shift, </span><br><span class="line">         <span class="number">0</span> , ymirror.write_mask);</span><br><span class="line">    vop_mask_write(regs, xmirror.offset, xmirror.mask, xmirror.shift, </span><br><span class="line">         <span class="number">0</span> , xmirror.write_mask);</span><br><span class="line">    vop_mask_write(regs, format.offset, format.mask, format.shift, </span><br><span class="line">         <span class="number">2</span> , format.write_mask);</span><br><span class="line">    vop_mask_write(regs, yrgb_vir.offset, yrgb_vir.mask, yrgb_vir.shift, </span><br><span class="line">         <span class="number">0x12c</span> , yrgb_vir.write_mask);</span><br><span class="line">    vop_mask_write(regs, yrgb_mst.offset, yrgb_mst.mask, yrgb_mst.shift, </span><br><span class="line">         <span class="number">0x7df06000</span> , yrgb_mst.write_mask);</span><br><span class="line">    vop_mask_write(regs, act_info.offset, act_info.mask, act_info.shift, </span><br><span class="line">         ((<span class="number">1920</span><span class="number">-1</span>) &lt;&lt; <span class="number">16</span>) |  ((<span class="number">1080</span><span class="number">-1</span>) &amp; <span class="number">0xffff</span>), act_info.write_mask);</span><br><span class="line">    vop_mask_write(regs, dsp_info.offset, dsp_info.mask, dsp_info.shift, </span><br><span class="line">         ((<span class="number">1920</span><span class="number">-1</span>) &lt;&lt; <span class="number">16</span>) |  ((<span class="number">1080</span><span class="number">-1</span>) &amp; <span class="number">0xffff</span>), dsp_info.write_mask);</span><br><span class="line">    vop_mask_write(regs, dsp_st.offset, dsp_st.mask, dsp_st.shift, </span><br><span class="line">         ((<span class="number">1929</span> - <span class="number">1924</span>) &lt;&lt; <span class="number">16</span>) | ((<span class="number">1323</span> - <span class="number">1192</span>) &amp; <span class="number">0xffff</span>)  , dsp_st.write_mask);</span><br><span class="line">    vop_mask_write(regs, rb_swap.offset, rb_swap.mask, rb_swap.shift, </span><br><span class="line">         <span class="number">1</span> , rb_swap.write_mask);</span><br><span class="line">    vop_mask_write(regs, src_alpha_ctl.offset, src_alpha_ctl.mask, src_alpha_ctl.shift, </span><br><span class="line">         <span class="number">0</span> , src_alpha_ctl.write_mask);</span><br><span class="line">    vop_mask_write(regs, enable.offset, enable.mask, enable.shift, </span><br><span class="line">         <span class="number">1</span> , enable.write_mask);</span><br><span class="line">​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="（四）、vop-dsi-panel-三大模块-init-分析"><a href="#（四）、vop-dsi-panel-三大模块-init-分析" class="headerlink" title="（四）、vop, dsi, panel 三大模块 init 分析"></a>（四）、vop, dsi, panel 三大模块 init 分析</h2><h3 id="4-1、vop-模块-prepare-分析"><a href="#4-1、vop-模块-prepare-分析" class="headerlink" title="4.1、vop 模块 prepare 分析"></a>4.1、vop 模块 prepare 分析</h3><h4 id="4-1-1、rockchip-vop-prepare"><a href="#4-1-1、rockchip-vop-prepare" class="headerlink" title="4.1.1、rockchip_vop_prepare()"></a>4.1.1、rockchip_vop_prepare()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">rockchip_vop_prepare</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2、DSI-模块-prepare-分析"><a href="#4-2、DSI-模块-prepare-分析" class="headerlink" title="4.2、DSI 模块 prepare 分析"></a>4.2、DSI 模块 prepare 分析</h3><h4 id="4-2-1、dw-mipi-dsi-connector-prepare"><a href="#4-2-1、dw-mipi-dsi-connector-prepare" class="headerlink" title="4.2.1、dw_mipi_dsi_connector_prepare()"></a>4.2.1、dw_mipi_dsi_connector_prepare()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\dw_mipi_dsi.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dw_mipi_dsi_connector_prepare</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="comment">//struct crtc_state *crtc_state = &amp;state-&gt;crtc_state;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dw_mipi_dsi</span> *<span class="title">dsi</span> = <span class="title">dev_get_priv</span>(<span class="title">conn_state</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="comment">//unsigned long lane_rate;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;dsi-&gt;mode, &amp;conn_state-&gt;mode, <span class="keyword">sizeof</span>(struct drm_display_mode));</span><br><span class="line">    <span class="comment">//if (dsi-&gt;dphy.phy)</span></span><br><span class="line">    <span class="comment">//  dw_mipi_dsi_set_hs_clk(dsi, lane_rate);</span></span><br><span class="line">    <span class="comment">//else</span></span><br><span class="line">    <span class="comment">//dw_mipi_dsi_set_pll(dsi, 1000000000);</span></span><br><span class="line">​</span><br><span class="line">    <span class="comment">//printf(&quot;final DSI-Link lane_rate: lane_rate %ld crtc_id %d\n&quot;,lane_rate,crtc_state-&gt;crtc_id);</span></span><br><span class="line">​</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;final DSI-Link bandwidth: %u Mbps x %d\n&quot;</span>,</span><br><span class="line">           dsi-&gt;lane_mbps, dsi-&gt;slave ? dsi-&gt;lanes * <span class="number">2</span> : dsi-&gt;lanes);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_vop_routing(dsi, 1);</span></span><br><span class="line">    grf_field_write(dsi, VOPSEL, <span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    dw_mipi_dsi_pre_enable(dsi);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dw_mipi_dsi_pre_enable</span><span class="params">(struct dw_mipi_dsi *dsi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dsi-&gt;prepared)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (dsi-&gt;master)</span><br><span class="line">        dw_mipi_dsi_pre_enable(dsi-&gt;master);</span><br><span class="line">​</span><br><span class="line">    dw_mipi_dsi_host_init(dsi);</span><br><span class="line">    mipi_dphy_init(dsi);</span><br><span class="line">    mipi_dphy_power_on(dsi);</span><br><span class="line">    dsi_write(dsi, DSI_PWR_UP, POWERUP);</span><br><span class="line">​</span><br><span class="line">    dsi-&gt;prepared = <span class="literal">true</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (dsi-&gt;slave)</span></span><br><span class="line">    <span class="comment">//  dw_mipi_dsi_pre_enable(dsi-&gt;slave);</span></span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dw_mipi_dsi_host_init</span><span class="params">(struct dw_mipi_dsi *dsi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_init(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_PWR_UP, RESET);</span><br><span class="line">    dsi_write(dsi, DSI_CLKMGR_CFG, <span class="number">0xa07</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_dpi_config(dsi, &amp;dsi-&gt;mode);</span></span><br><span class="line">    dsi_write(dsi, DSI_DPI_VCID, <span class="number">0x0</span>);</span><br><span class="line">    dsi_write(dsi, DSI_DPI_COLOR_CODING, <span class="number">0x05</span>);<span class="comment">//MIPI_DSI_FMT_RGB888:DPI_COLOR_CODING_24BIT</span></span><br><span class="line">    dsi_write(dsi, DSI_DPI_CFG_POL, <span class="number">0x06</span>);</span><br><span class="line">    dsi_write(dsi, DSI_DPI_LP_CMD_TIM, OUTVACT_LPCMD_TIME(<span class="number">4</span>)| INVACT_LPCMD_TIME(<span class="number">4</span>));</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_packet_handler_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_PCKHDL_CFG, <span class="number">0x1c</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_video_mode_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_VID_MODE_CFG, <span class="number">0x3f02</span>);</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_video_packet_config(dsi, &amp;dsi-&gt;mode);</span></span><br><span class="line">    dsi_write(dsi, DSI_VID_PKT_SIZE, VID_PKT_SIZE(<span class="number">1088</span>));</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_command_mode_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_TO_CNT_CFG, HSTX_TO_CNT(<span class="number">1000</span>) | LPRX_TO_CNT(<span class="number">1000</span>));</span><br><span class="line">    dsi_write(dsi, DSI_BTA_TO_CNT, <span class="number">0xd00</span>);</span><br><span class="line">​</span><br><span class="line">    dsi_update_bits(dsi, DSI_MODE_CFG, CMD_VIDEO_MODE, COMMAND_MODE);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_line_timer_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_VID_HLINE_TIME, <span class="number">0x55d</span>);</span><br><span class="line">    dsi_write(dsi, DSI_VID_HSA_TIME, <span class="number">0x04</span>);</span><br><span class="line">    dsi_write(dsi, DSI_VID_HBP_TIME, <span class="number">0x84</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_vertical_timing_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_VID_VACTIVE_LINES, <span class="number">1920</span>);</span><br><span class="line">    dsi_write(dsi, DSI_VID_VSA_LINES, <span class="number">0x02</span>);</span><br><span class="line">    dsi_write(dsi, DSI_VID_VFP_LINES, <span class="number">0x04</span>);</span><br><span class="line">    dsi_write(dsi, DSI_VID_VBP_LINES, <span class="number">0x03</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_dphy_timing_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_PHY_TMR_CFG, PHY_HS2LP_TIME(<span class="number">0x14</span>)</span><br><span class="line">          | PHY_LP2HS_TIME(<span class="number">0x10</span>) | MAX_RD_TIME(<span class="number">10000</span>));</span><br><span class="line">​</span><br><span class="line">    dsi_write(dsi, DSI_PHY_TMR_LPCLK_CFG, PHY_CLKHS2LP_TIME(<span class="number">0x40</span>)</span><br><span class="line">          | PHY_CLKLP2HS_TIME(<span class="number">0x40</span>));</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_dphy_interface_config(dsi);</span></span><br><span class="line">    dsi_write(dsi, DSI_PHY_IF_CFG, PHY_STOP_WAIT_TIME(<span class="number">0x20</span>) |</span><br><span class="line">          N_LANES(<span class="number">4</span>));</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//dw_mipi_dsi_clear_err(dsi);</span></span><br><span class="line">    dsi_read(dsi, DSI_INT_ST0);</span><br><span class="line">    dsi_read(dsi, DSI_INT_ST1);</span><br><span class="line">    dsi_write(dsi, DSI_INT_MSK0, <span class="number">0</span>);</span><br><span class="line">    dsi_write(dsi, DSI_INT_MSK1, <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mipi_dphy_init</span><span class="params">(struct dw_mipi_dsi *dsi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    u32 <span class="built_in">map</span>[] = &#123;<span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x7</span>, <span class="number">0xf</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//mipi_dphy_enableclk_deassert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_RSTZ, PHY_ENABLECLK, <span class="number">0</span>);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//mipi_dphy_shutdownz_assert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_RSTZ, PHY_SHUTDOWNZ, <span class="number">0</span>);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//mipi_dphy_rstz_assert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_RSTZ, PHY_RSTZ, <span class="number">0</span>);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//testif_testclr_assert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_TST_CTRL0, PHY_TESTCLR, PHY_TESTCLR);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* Configures DPHY to work as a Master */</span></span><br><span class="line">    grf_field_write(dsi, MASTERSLAVEZ, <span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* Configures lane as TX */</span></span><br><span class="line">    grf_field_write(dsi, BASEDIR, <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* Set all REQUEST inputs to zero */</span></span><br><span class="line">    grf_field_write(dsi, TURNREQUEST, <span class="number">0</span>);</span><br><span class="line">    grf_field_write(dsi, TURNDISABLE, <span class="number">0</span>);</span><br><span class="line">    grf_field_write(dsi, FORCETXSTOPMODE, <span class="number">0</span>);</span><br><span class="line">    grf_field_write(dsi, FORCERXMODE, <span class="number">0</span>);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//testif_testclr_deassert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_TST_CTRL0, PHY_TESTCLR, <span class="number">0</span>);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (!dsi-&gt;dphy.phy)</span></span><br><span class="line">    <span class="comment">//  dw_mipi_dsi_phy_init(dsi);</span></span><br><span class="line">    testif_write(dsi, <span class="number">0x44</span>, HSFREQRANGE(<span class="number">26</span>));</span><br><span class="line">    testif_write(dsi, <span class="number">0x60</span>, <span class="number">0x80</span> | (<span class="number">996</span> &gt;&gt; <span class="number">3</span>) * <span class="number">60</span> / <span class="number">1000</span>);</span><br><span class="line">    testif_write(dsi, <span class="number">0x70</span>, <span class="number">0x80</span> | (<span class="number">996</span> &gt;&gt; <span class="number">3</span>) * <span class="number">60</span> / <span class="number">1000</span>);</span><br><span class="line">    testif_write(dsi, <span class="number">0x19</span>, <span class="number">0x30</span>);</span><br><span class="line">    testif_write(dsi, <span class="number">0x17</span>, INPUT_DIV(<span class="number">3</span>));</span><br><span class="line">    testif_write(dsi, <span class="number">0x18</span>, FEEDBACK_DIV_LO(<span class="number">165</span>));</span><br><span class="line">    testif_write(dsi, <span class="number">0x18</span>, FEEDBACK_DIV_HI(<span class="number">165</span> &gt;&gt; <span class="number">5</span>));</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* Enable Data Lane Module */</span></span><br><span class="line">    grf_field_write(dsi, ENABLE_N, <span class="built_in">map</span>[dsi-&gt;lanes]);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* Enable Clock Lane Module */</span></span><br><span class="line">    grf_field_write(dsi, ENABLECLK, <span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//mipi_dphy_enableclk_assert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_RSTZ, PHY_ENABLECLK, PHY_ENABLECLK);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">mipi_dphy_power_on</span><span class="params">(struct dw_mipi_dsi *dsi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    u32 mask, val;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//mipi_dphy_shutdownz_deassert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_RSTZ, PHY_SHUTDOWNZ, PHY_SHUTDOWNZ);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//mipi_dphy_rstz_deassert(dsi);</span></span><br><span class="line">    dsi_update_bits(dsi, DSI_PHY_RSTZ, PHY_RSTZ, PHY_RSTZ);</span><br><span class="line">    udelay(<span class="number">1</span>);</span><br><span class="line">    mdelay(<span class="number">2</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (dsi-&gt;dphy.phy) &#123;</span></span><br><span class="line">    <span class="comment">//  rockchip_phy_set_mode(dsi-&gt;dphy.phy, PHY_MODE_VIDEO_MIPI);</span></span><br><span class="line">    <span class="comment">//  rockchip_phy_power_on(dsi-&gt;dphy.phy);</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">​</span><br><span class="line">    ret = readl_poll_timeout((<span class="keyword">void</span>*)<span class="number">0xff960000</span> + DSI_PHY_STATUS,</span><br><span class="line">                 val, val &amp; PHY_LOCK, PHY_STATUS_TIMEOUT_US);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;PHY is not locked\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    udelay(<span class="number">200</span>);</span><br><span class="line">​</span><br><span class="line">    mask = PHY_STOPSTATELANE;</span><br><span class="line">    ret = readl_poll_timeout((<span class="keyword">void</span>*)<span class="number">0xff960000</span> + DSI_PHY_STATUS,</span><br><span class="line">                 val, (val &amp; mask) == mask,</span><br><span class="line">                 PHY_STATUS_TIMEOUT_US);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;lane module is not in stop state\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    udelay(<span class="number">10</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3、panel-模块-prepare-分析"><a href="#4-3、panel-模块-prepare-分析" class="headerlink" title="4.3、panel 模块 prepare 分析"></a>4.3、panel 模块 prepare 分析</h3><h4 id="4-3-1、rockchip-panel-prepare"><a href="#4-3-1、rockchip-panel-prepare" class="headerlink" title="4.3.1、rockchip_panel_prepare()"></a>4.3.1、rockchip_panel_prepare()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\rockchip_panel.c</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">panel_simple_prepare</span><span class="params">(struct rockchip_panel *panel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_panel_plat</span> *<span class="title">plat</span> = <span class="title">dev_get_platdata</span>(<span class="title">panel</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_panel_priv</span> *<span class="title">priv</span> = <span class="title">dev_get_priv</span>(<span class="title">panel</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mipi_dsi_device</span> *<span class="title">dsi</span> = <span class="title">dev_get_parent_platdata</span>(<span class="title">panel</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (priv-&gt;prepared)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (priv-&gt;power_supply)</span></span><br><span class="line">    <span class="comment">//  regulator_set_enable(priv-&gt;power_supply, !plat-&gt;power_invert);</span></span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (dm_gpio_is_valid(&amp;priv-&gt;enable_gpio))</span></span><br><span class="line">    <span class="comment">//  dm_gpio_set_value(&amp;priv-&gt;enable_gpio, 1);</span></span><br><span class="line">    clrsetbits_le32(<span class="number">0xff790000</span>, OFFSET_TO_BIT(<span class="number">29</span>), <span class="number">1</span> ? OFFSET_TO_BIT(<span class="number">29</span>) : <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (plat-&gt;delay.prepare)</span></span><br><span class="line">        mdelay(<span class="number">60</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (dm_gpio_is_valid(&amp;priv-&gt;reset_gpio))</span></span><br><span class="line">    <span class="comment">//  dm_gpio_set_value(&amp;priv-&gt;reset_gpio, 1);</span></span><br><span class="line">    clrsetbits_le32(<span class="number">0xff790000</span>, OFFSET_TO_BIT(<span class="number">28</span>), <span class="number">1</span> ? OFFSET_TO_BIT(<span class="number">28</span>) : <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (plat-&gt;delay.reset)</span></span><br><span class="line">        mdelay(<span class="number">10</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (dm_gpio_is_valid(&amp;priv-&gt;reset_gpio))</span></span><br><span class="line">    <span class="comment">//  dm_gpio_set_value(&amp;priv-&gt;reset_gpio, 0);    </span></span><br><span class="line">    clrsetbits_le32(<span class="number">0xff790000</span>, OFFSET_TO_BIT(<span class="number">28</span>), <span class="number">0</span> ? OFFSET_TO_BIT(<span class="number">28</span>) : <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (plat-&gt;delay.reset)</span></span><br><span class="line">        mdelay(<span class="number">10</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (dm_gpio_is_valid(&amp;priv-&gt;reset_gpio))</span></span><br><span class="line">    <span class="comment">//  dm_gpio_set_value(&amp;priv-&gt;reset_gpio, 1);</span></span><br><span class="line">    clrsetbits_le32(<span class="number">0xff790000</span>, OFFSET_TO_BIT(<span class="number">28</span>), <span class="number">1</span> ? OFFSET_TO_BIT(<span class="number">28</span>) : <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (plat-&gt;delay.init)</span><br><span class="line">        mdelay(<span class="number">20</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (plat-&gt;on_cmds) &#123;</span><br><span class="line">            ret = rockchip_panel_send_dsi_cmds(dsi, plat-&gt;on_cmds);</span><br><span class="line">        <span class="keyword">if</span> (ret)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;failed to send on cmds: %d\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    priv-&gt;prepared = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">rockchip_panel_send_dsi_cmds</span><span class="params">(struct mipi_dsi_device *dsi,</span></span></span><br><span class="line"><span class="function"><span class="params">                    struct rockchip_panel_cmds *cmds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, ret;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (!cmds)</span><br><span class="line">        <span class="keyword">return</span> -EINVAL;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cmds-&gt;cmd_cnt; i++) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_cmd_desc</span> *<span class="title">desc</span> = &amp;<span class="title">cmds</span>-&gt;<span class="title">cmds</span>[<span class="title">i</span>];</span></span><br><span class="line">        <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_cmd_header</span> *<span class="title">header</span> = &amp;<span class="title">desc</span>-&gt;<span class="title">header</span>;</span></span><br><span class="line">​</span><br><span class="line">        <span class="keyword">switch</span> (header-&gt;data_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_GENERIC_SHORT_WRITE_0_PARAM:</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_GENERIC_SHORT_WRITE_1_PARAM:</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_GENERIC_SHORT_WRITE_2_PARAM:</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_GENERIC_LONG_WRITE:</span><br><span class="line">            ret = mipi_dsi_generic_write(dsi, desc-&gt;payload,</span><br><span class="line">                             header-&gt;payload_length);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_DCS_SHORT_WRITE:</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_DCS_SHORT_WRITE_PARAM:</span><br><span class="line">        <span class="keyword">case</span> MIPI_DSI_DCS_LONG_WRITE:</span><br><span class="line">            ret = mipi_dsi_dcs_write_buffer(dsi, desc-&gt;payload,</span><br><span class="line">                            header-&gt;payload_length);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;unsupport command data type: %d\n&quot;</span>,</span><br><span class="line">                   header-&gt;data_type);</span><br><span class="line">            <span class="keyword">return</span> -EINVAL;</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;failed to write cmd%d: %d\n&quot;</span>, i, ret);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> (header-&gt;delay_ms)</span><br><span class="line">            mdelay(header-&gt;delay_ms);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line">X:\u-boot\drivers\video\drm\dw_mipi_dsi.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">dw_mipi_dsi_transfer</span><span class="params">(struct dw_mipi_dsi *dsi,</span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="keyword">const</span> struct mipi_dsi_msg *msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mipi_dsi_packet</span> <span class="title">packet</span>;</span></span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    <span class="comment">//printf(&quot;zjj.rk3399.uboot  msg-&gt;type:0x%x mode_flags:0x%x\n&quot;, msg-&gt;type ,dsi-&gt;mode_flags);</span></span><br><span class="line">​</span><br><span class="line">    dsi_update_bits(dsi, DSI_VID_MODE_CFG, LP_CMD_EN, LP_CMD_EN);</span><br><span class="line">    dsi_update_bits(dsi, DSI_LPCLK_CTRL, PHY_TXREQUESTCLKHS, <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">switch</span> (msg-&gt;type) &#123;</span><br><span class="line">    <span class="keyword">case</span> MIPI_DSI_DCS_SHORT_WRITE:</span><br><span class="line">​</span><br><span class="line">        dsi_update_bits(dsi, DSI_CMD_MODE_CFG, DCS_SW_0P_TX,</span><br><span class="line">                dsi-&gt;mode_flags &amp; MIPI_DSI_MODE_LPM ?</span><br><span class="line">                DCS_SW_0P_TX : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> MIPI_DSI_DCS_SHORT_WRITE_PARAM:</span><br><span class="line">        dsi_update_bits(dsi, DSI_CMD_MODE_CFG, DCS_SW_1P_TX,</span><br><span class="line">                dsi-&gt;mode_flags &amp; MIPI_DSI_MODE_LPM ?</span><br><span class="line">                DCS_SW_1P_TX : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> -EINVAL;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    dsi_update_bits(dsi, DSI_CMD_MODE_CFG,</span><br><span class="line">                ACK_RQST_EN, ACK_RQST_EN);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* create a packet to the DSI protocol */</span></span><br><span class="line">    ret = mipi_dsi_create_packet(&amp;packet, msg);</span><br><span class="line">​</span><br><span class="line">​</span><br><span class="line">    ret = genif_wait_cmd_fifo_not_full(dsi);</span><br><span class="line">​</span><br><span class="line">​</span><br><span class="line">    <span class="comment">/* Send packet header */</span></span><br><span class="line">    val = get_unaligned_le32(packet.header);</span><br><span class="line">    dsi_write(dsi, DSI_GEN_HDR, val);</span><br><span class="line">​</span><br><span class="line">    ret = genif_wait_write_fifo_empty(dsi);</span><br><span class="line">    <span class="keyword">if</span> (ret)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (msg-&gt;rx_len) &#123;</span><br><span class="line">        ret = dw_mipi_dsi_read_from_fifo(dsi, msg);</span><br><span class="line">        <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (dsi-&gt;slave) &#123;</span><br><span class="line">        ret = dw_mipi_dsi_transfer(dsi-&gt;slave, msg);</span><br><span class="line">        <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> msg-&gt;rx_len ? msg-&gt;rx_len : msg-&gt;tx_len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="（五）、vop-dsi-panel-三大模块-enable-分析"><a href="#（五）、vop-dsi-panel-三大模块-enable-分析" class="headerlink" title="（五）、vop, dsi, panel 三大模块 enable 分析"></a>（五）、vop, dsi, panel 三大模块 enable 分析</h2><h3 id="5-1、vop-模块-enable-分析"><a href="#5-1、vop-模块-enable-分析" class="headerlink" title="5.1、vop 模块 enable 分析"></a>5.1、vop 模块 enable 分析</h3><h4 id="5-1-1、rockchip-vop-enable"><a href="#5-1-1、rockchip-vop-enable" class="headerlink" title="5.1.1、rockchip_vop_enable()"></a>5.1.1、rockchip_vop_enable()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\rockchip_display.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">rockchip_vop_enable</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">    zjj_rockchip_vop_enable();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">X:\u-boot\drivers\video\drm\zhoujinjian_mipi_rockchip_display.c</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">zjj_rockchip_vop_enable</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">    vop_mask_write(regs, standby.offset, standby.mask, standby.shift, </span><br><span class="line">         <span class="number">0</span> , standby.write_mask);</span><br><span class="line">    vop_mask_write(regs, cfg_done.offset, cfg_done.mask, cfg_done.shift, </span><br><span class="line">         <span class="number">1</span> , cfg_done.write_mask);</span><br><span class="line">​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2、dsi-模块-enable-分析"><a href="#5-2、dsi-模块-enable-分析" class="headerlink" title="5.2、dsi 模块 enable 分析"></a>5.2、dsi 模块 enable 分析</h3><h4 id="5-2-1、rockchip-dw-mipi-dsi-enable"><a href="#5-2-1、rockchip-dw-mipi-dsi-enable" class="headerlink" title="5.2.1、rockchip_dw_mipi_dsi_enable()"></a>5.2.1、rockchip_dw_mipi_dsi_enable()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dw_mipi_dsi_connector_enable</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dw_mipi_dsi</span> *<span class="title">dsi</span> = <span class="title">dev_get_priv</span>(<span class="title">conn_state</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    dw_mipi_dsi_enable(dsi);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dw_mipi_dsi_enable</span><span class="params">(struct dw_mipi_dsi *dsi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//const struct drm_display_mode *mode = &amp;dsi-&gt;mode;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    dsi_update_bits(dsi, DSI_LPCLK_CTRL,</span><br><span class="line">            PHY_TXREQUESTCLKHS, PHY_TXREQUESTCLKHS);</span><br><span class="line">    dsi_write(dsi, DSI_PWR_UP, RESET);</span><br><span class="line">    dsi_update_bits(dsi, DSI_MODE_CFG, CMD_VIDEO_MODE, VIDEO_MODE);</span><br><span class="line">    dsi_write(dsi, DSI_PWR_UP, POWERUP);</span><br><span class="line">​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3、panel-模块-enable-分析"><a href="#5-3、panel-模块-enable-分析" class="headerlink" title="5.3、panel 模块 enable 分析"></a>5.3、panel 模块 enable 分析</h3><h4 id="5-3-1、panel-simple-enable"><a href="#5-3-1、panel-simple-enable" class="headerlink" title="5.3.1、panel_simple_enable()"></a>5.3.1、panel_simple_enable()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\rockchip_panel.c</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">panel_simple_enable</span><span class="params">(struct rockchip_panel *panel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_panel_plat</span> *<span class="title">plat</span> = <span class="title">dev_get_platdata</span>(<span class="title">panel</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rockchip_panel_priv</span> *<span class="title">priv</span> = <span class="title">dev_get_priv</span>(<span class="title">panel</span>-&gt;<span class="title">dev</span>);</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (priv-&gt;enabled)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (plat-&gt;delay.enable)</span><br><span class="line">        mdelay(plat-&gt;delay.enable);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">//D:\RK3399_Android8.1_MIPI\u-boot\arch\arm\include\asm\arch-rk33xx\io-rk3399.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RKIO_GRF_PHYS    0xFF770000</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//D:\RK3399_Android8.1_MIPI\u-boot\arch\arm\include\asm\arch-rk33xx\grf-rk3399.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GRF_GPIO4C_IOMUX    0xe028</span></span><br><span class="line">​</span><br><span class="line">    <span class="comment">//if (priv-&gt;backlight)</span></span><br><span class="line">    <span class="comment">//  backlight_enable(priv-&gt;backlight);</span></span><br><span class="line">      <span class="comment">//#define RKIO_PWM_PHYS                 0xFF420000</span></span><br><span class="line">      <span class="comment">//#define RKIO_PWM1_PHYS                 (RKIO_PWM_PHYS + 0x10)</span></span><br><span class="line">      u32 bl_base = <span class="number">0xff420010</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;zjj rk_pwm_bl_config.\n&quot;</span>);</span><br><span class="line">      <span class="keyword">int</span> brightness = <span class="number">255</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;pwm_1-&gt;base 0x%x\n&quot;</span>, bl_base);</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//使能pwm_1,GRF_GPIO4C_IOMUX == 0xe028</span></span><br><span class="line">      <span class="comment">//grf_writel((3 &lt;&lt; 28) | (1 &lt;&lt; 12) , GRF_GPIO4C_IOMUX);</span></span><br><span class="line">      <span class="keyword">volatile</span> <span class="keyword">void</span> *addr = (<span class="keyword">void</span>*)(RKIO_GRF_PHYS + GRF_GPIO4C_IOMUX);</span><br><span class="line">      *(u32 *)addr = (<span class="number">3</span> &lt;&lt; <span class="number">28</span>) | (<span class="number">1</span> &lt;&lt; <span class="number">12</span>);</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//Datasheet：Rockchip RK3399TRM V1.3 Part1 P903</span></span><br><span class="line">      <span class="comment">//PMU_PWRDN_ST</span></span><br><span class="line">      <span class="comment">//Address: Operational Base + offset (0x0018)</span></span><br><span class="line">    </span><br><span class="line">      <span class="keyword">if</span> (brightness == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">//PWM_REG_DUTY == 0x08 即bl.base + PWM_REG_DUTY= 0xff420018</span></span><br><span class="line">          <span class="comment">//write_pwm_reg(&amp;bl, PWM_REG_DUTY, 0);</span></span><br><span class="line">          *(u32 *)(<span class="number">0xff420018</span>) = <span class="number">0</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//PWM_REG_DUTY == 0x08 即bl.base + PWM_REG_DUTY= 0xff420018</span></span><br><span class="line">          <span class="comment">//write_pwm_reg(&amp;bl, PWM_REG_DUTY, 1);</span></span><br><span class="line">          *(u32 *)(<span class="number">0xff420018</span>) = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//write_pwm_reg(&amp;bl, PWM_REG_CNTR, 0);</span></span><br><span class="line">      <span class="comment">//Datasheet：Rockchip RK3399TRM V1.3 Part1 P906</span></span><br><span class="line">      <span class="comment">//0xff42001c hardware pull up.0x000f</span></span><br><span class="line">      <span class="comment">//write_pwm_reg(&amp;bl, PWM_REG_CTRL, 0x000f);</span></span><br><span class="line">      *(u32 *)(<span class="number">0xff42001c</span>) = <span class="number">0x000f</span>;</span><br><span class="line">​</span><br><span class="line">    priv-&gt;enabled = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>循环刷新Buffer：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">X:\u-boot\drivers\video\drm\rockchip_display.c</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">display_logo</span><span class="params">(struct display_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">crtc_state</span> *<span class="title">crtc_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">crtc_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">connector_state</span> *<span class="title">conn_state</span> = &amp;<span class="title">state</span>-&gt;<span class="title">conn_state</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">logo_info</span> *<span class="title">logo</span> = &amp;<span class="title">state</span>-&gt;<span class="title">logo</span>;</span></span><br><span class="line">    <span class="keyword">int</span> hdisplay, vdisplay, ret;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;zjj.rk3399.uboot %s %s %d \n&quot;</span>,__FILE__,__FUNCTION__,__LINE__);</span><br><span class="line">​</span><br><span class="line">    ret = display_init(state);</span><br><span class="line">    <span class="keyword">if</span> (!state-&gt;is_init || ret)</span><br><span class="line">        <span class="keyword">return</span> -ENODEV;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">switch</span> (logo-&gt;bpp) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">        crtc_state-&gt;format = ROCKCHIP_FMT_RGB565;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">24</span>:</span><br><span class="line">        crtc_state-&gt;format = ROCKCHIP_FMT_RGB888;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">        crtc_state-&gt;format = ROCKCHIP_FMT_ARGB8888;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t support bmp bits[%d]\n&quot;</span>, logo-&gt;bpp);</span><br><span class="line">        <span class="keyword">return</span> -EINVAL;</span><br><span class="line">    &#125;</span><br><span class="line">    crtc_state-&gt;rb_swap = logo-&gt;bpp != <span class="number">32</span>;</span><br><span class="line">    hdisplay = conn_state-&gt;mode.hdisplay;</span><br><span class="line">    vdisplay = conn_state-&gt;mode.vdisplay;</span><br><span class="line">    crtc_state-&gt;src_w = logo-&gt;width;</span><br><span class="line">    crtc_state-&gt;src_h = logo-&gt;height;</span><br><span class="line">    crtc_state-&gt;src_x = <span class="number">0</span>;</span><br><span class="line">    crtc_state-&gt;src_y = <span class="number">0</span>;</span><br><span class="line">    crtc_state-&gt;ymirror = logo-&gt;ymirror;</span><br><span class="line">​</span><br><span class="line">    crtc_state-&gt;dma_addr = (u32)(<span class="keyword">unsigned</span> <span class="keyword">long</span>)logo-&gt;mem + logo-&gt;offset;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;dma_addr %x\n&quot;</span>, crtc_state-&gt;dma_addr);</span><br><span class="line">​</span><br><span class="line">    crtc_state-&gt;xvir = ALIGN(crtc_state-&gt;src_w * logo-&gt;bpp, <span class="number">32</span>) &gt;&gt; <span class="number">5</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (logo-&gt;mode == ROCKCHIP_DISPLAY_FULLSCREEN) &#123;</span><br><span class="line">        crtc_state-&gt;crtc_x = <span class="number">0</span>;</span><br><span class="line">        crtc_state-&gt;crtc_y = <span class="number">0</span>;</span><br><span class="line">        crtc_state-&gt;crtc_w = hdisplay;</span><br><span class="line">        crtc_state-&gt;crtc_h = vdisplay;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (crtc_state-&gt;src_w &gt;= hdisplay) &#123;</span><br><span class="line">            crtc_state-&gt;crtc_x = <span class="number">0</span>;</span><br><span class="line">            crtc_state-&gt;crtc_w = hdisplay;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            crtc_state-&gt;crtc_x = (hdisplay - crtc_state-&gt;src_w) / <span class="number">2</span>;</span><br><span class="line">            crtc_state-&gt;crtc_w = crtc_state-&gt;src_w;</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> (crtc_state-&gt;src_h &gt;= vdisplay) &#123;</span><br><span class="line">            crtc_state-&gt;crtc_y = <span class="number">0</span>;</span><br><span class="line">            crtc_state-&gt;crtc_h = vdisplay;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            crtc_state-&gt;crtc_y = (vdisplay - crtc_state-&gt;src_h) / <span class="number">2</span>;</span><br><span class="line">            crtc_state-&gt;crtc_h = crtc_state-&gt;src_h;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    display_set_plane(state);</span><br><span class="line">    display_enable(state);</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        fb_data(WHITE);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(YELLOW);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(MAGENTA);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">    </span><br><span class="line">        fb_data(RED);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(CYAN);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(GREEN);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">​</span><br><span class="line">        fb_data(BLUE);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(DGRAY);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(LGRAY);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">​</span><br><span class="line">        fb_data(OLIVE);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(PURPLE);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(MAROON);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">        </span><br><span class="line">        fb_data(BLACK);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">​</span><br><span class="line">        fb_data(DCYAN);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">​</span><br><span class="line">        fb_data(DGREEN);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">​</span><br><span class="line">        fb_data(NAVY);</span><br><span class="line">        mdelay(<span class="number">2000</span>);</span><br><span class="line">​</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六-、参考资料-特别感谢-："><a href="#六-、参考资料-特别感谢-：" class="headerlink" title="(六)、参考资料(特别感谢)："></a>(六)、参考资料(特别感谢)：</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kris_fei/article/details/79003925">（1）【[RK3399][Android7.1] Uboot display 加载过程小结】</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.khadas.com/zh-cn/edge/ConnectLcd.html#3-%EF%BC%88MIPI-HDMI%EF%BC%89%E5%B1%8F%E5%B9%95%E9%85%8D%E7%BD%AE">（2）【Connect to TS050 Touchscreen】</a></p>
<p><a target="_blank" rel="noopener" href="http://wiki.t-firefly.com/zh_CN/Firefly-RK3399/driver_lcd.html">（3）【Firefly-RK3399 LCD使用】</a></p>
<p><a target="_blank" rel="noopener" href="https://hceng.cn/2018/07/19/RK3288%E2%80%94%E2%80%94LCD%E8%A3%B8%E6%9C%BA/">（4）【RK3288——LCD裸机】</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">zhoujinjian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zhoujinjian.com/posts/20210510/">https://zhoujinjian.com/posts/20210510/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhoujinjian.com" target="_blank">zhoujinjian</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Graphics/">Graphics</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.24.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/20210610/"><img class="prev-cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.25.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android 10 Display System源码分析（4）：DRM/KMS分析（Android 10.0 &amp;&amp; Kernel 4.15）</div></div></a></div><div class="next-post pull-right"><a href="/posts/20210410/"><img class="next-cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.23.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Android 10 Display System源码分析（2）：Display System 精彩世界（Android 10.0 &amp;&amp; Kernel 4.15）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/20210310/" title="Android 10 Display System源码分析（1）：LCD显示原理（Android 10.0 && Kernel 4.15）"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-10</div><div class="title">Android 10 Display System源码分析（1）：LCD显示原理（Android 10.0 && Kernel 4.15）</div></div></a></div><div><a href="/posts/20210410/" title="Android 10 Display System源码分析（2）：Display System 精彩世界（Android 10.0 && Kernel 4.15）"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.23.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-10</div><div class="title">Android 10 Display System源码分析（2）：Display System 精彩世界（Android 10.0 && Kernel 4.15）</div></div></a></div><div><a href="/posts/20210610/" title="Android 10 Display System源码分析（4）：DRM/KMS分析（Android 10.0 && Kernel 4.15）"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.25.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-10</div><div class="title">Android 10 Display System源码分析（4）：DRM/KMS分析（Android 10.0 && Kernel 4.15）</div></div></a></div><div><a href="/posts/20210710/" title="Android 10 Display System源码分析（5）：ModeTest分析（Android 10.0 && Kernel 4.15）"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.26.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-10</div><div class="title">Android 10 Display System源码分析（5）：ModeTest分析（Android 10.0 && Kernel 4.15）</div></div></a></div><div><a href="/posts/20210810/" title="Android 10 Display System源码分析（6）：【DRM/KMS】HWComposer && Gralloc2 分析（Android 10.0 && Kernel 4.15）"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.27.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">Android 10 Display System源码分析（6）：【DRM/KMS】HWComposer && Gralloc2 分析（Android 10.0 && Kernel 4.15）</div></div></a></div><div><a href="/posts/20210910/" title="Android 10 Display System源码分析（7）：Native Surface创建 && SurfaceFlinger合成流程分析（Android 10.0 && Kernel 4.15）"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.28.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-10</div><div class="title">Android 10 Display System源码分析（7）：Native Surface创建 && SurfaceFlinger合成流程分析（Android 10.0 && Kernel 4.15）</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E3%80%81MIPI-%E5%B1%8F%E5%B9%95%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">(一)、MIPI 屏幕配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E3%80%81LCD-%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">（1）、LCD 使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89-%EF%BC%88MIPI-HDMI%EF%BC%89%E5%B1%8F%E5%B9%95%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">（2）,（MIPI + HDMI）屏幕配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89-%E9%85%8D%E7%BD%AE-dts"><span class="toc-number">1.3.</span> <span class="toc-text">（3）,配置 dts</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E4%BD%BF%E8%83%BD%E5%AF%B9%E5%BA%94%E6%98%BE%E7%A4%BA%E8%AE%BE%E5%A4%87%E8%8A%82%E7%82%B9"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1,使能对应显示设备节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E7%BB%91%E5%AE%9A-PLL"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2, 绑定 PLL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E9%85%8D%E7%BD%AE-timing"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3,配置 timing</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%83%8C%E5%85%89-backlight"><span class="toc-number">1.4.</span> <span class="toc-text">3.4, 背光 backlight</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E3%80%81U-boot-Display-%E6%98%BE%E7%A4%BA%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">(二)、U-boot Display 显示过程分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#U-boot-Display-%E6%98%BE%E7%A4%BA%E8%BF%87%E7%A8%8B%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">2.0.1.</span> <span class="toc-text">U-boot Display 显示过程流程图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%81vop-dsi-panel-%E4%B8%89%E5%A4%A7%E6%A8%A1%E5%9D%97-init-%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">（三）、vop, dsi, panel 三大模块 init 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81Panel-%E6%A8%A1%E5%9D%97-init-%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">3.1、Panel 模块 init 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1%E3%80%81panel-simple-init"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1、panel_simple_init()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81DSI-%E6%A8%A1%E5%9D%97-init-%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">3.2、DSI 模块 init 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1%E3%80%81dw-mipi-dsi-connector-init"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1、dw_mipi_dsi_connector_init()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81Vop-%E6%A8%A1%E5%9D%97-init-%E5%88%86%E6%9E%90"><span class="toc-number">3.3.</span> <span class="toc-text">3.3、Vop 模块 init 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1%E3%80%81rockchip-vop-init"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1、rockchip_vop_init()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2%E3%80%81zjj-rockchip-vop-init"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2、zjj_rockchip_vop_init()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3%E3%80%81zjj-rockchip-vop-set-plane-%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3、zjj_rockchip_vop_set_plane()​​​​​​​</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E3%80%81vop-dsi-panel-%E4%B8%89%E5%A4%A7%E6%A8%A1%E5%9D%97-init-%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">（四）、vop, dsi, panel 三大模块 init 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81vop-%E6%A8%A1%E5%9D%97-prepare-%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、vop 模块 prepare 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1%E3%80%81rockchip-vop-prepare"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1、rockchip_vop_prepare()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81DSI-%E6%A8%A1%E5%9D%97-prepare-%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、DSI 模块 prepare 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1%E3%80%81dw-mipi-dsi-connector-prepare"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1、dw_mipi_dsi_connector_prepare()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81panel-%E6%A8%A1%E5%9D%97-prepare-%E5%88%86%E6%9E%90"><span class="toc-number">4.3.</span> <span class="toc-text">4.3、panel 模块 prepare 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1%E3%80%81rockchip-panel-prepare"><span class="toc-number">4.3.1.</span> <span class="toc-text">4.3.1、rockchip_panel_prepare()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%94%EF%BC%89%E3%80%81vop-dsi-panel-%E4%B8%89%E5%A4%A7%E6%A8%A1%E5%9D%97-enable-%E5%88%86%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">（五）、vop, dsi, panel 三大模块 enable 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81vop-%E6%A8%A1%E5%9D%97-enable-%E5%88%86%E6%9E%90"><span class="toc-number">5.1.</span> <span class="toc-text">5.1、vop 模块 enable 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1%E3%80%81rockchip-vop-enable"><span class="toc-number">5.1.1.</span> <span class="toc-text">5.1.1、rockchip_vop_enable()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81dsi-%E6%A8%A1%E5%9D%97-enable-%E5%88%86%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">5.2、dsi 模块 enable 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1%E3%80%81rockchip-dw-mipi-dsi-enable"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1、rockchip_dw_mipi_dsi_enable()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E3%80%81panel-%E6%A8%A1%E5%9D%97-enable-%E5%88%86%E6%9E%90"><span class="toc-number">5.3.</span> <span class="toc-text">5.3、panel 模块 enable 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1%E3%80%81panel-simple-enable"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.3.1、panel_simple_enable()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-%E7%89%B9%E5%88%AB%E6%84%9F%E8%B0%A2-%EF%BC%9A"><span class="toc-number">6.</span> <span class="toc-text">(六)、参考资料(特别感谢)：</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/20240225/" title="Android 11 Display System V2（8）：Rockchip RK3399 - DRM HDMI驱动程序"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.64.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2（8）：Rockchip RK3399 - DRM HDMI驱动程序"/></a><div class="content"><a class="title" href="/posts/20240225/" title="Android 11 Display System V2（8）：Rockchip RK3399 - DRM HDMI驱动程序">Android 11 Display System V2（8）：Rockchip RK3399 - DRM HDMI驱动程序</a><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240224/" title="Android 11 Display System V2（7）：Rockchip RK3399 - DRM HDMI介绍"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.63.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2（7）：Rockchip RK3399 - DRM HDMI介绍"/></a><div class="content"><a class="title" href="/posts/20240224/" title="Android 11 Display System V2（7）：Rockchip RK3399 - DRM HDMI介绍">Android 11 Display System V2（7）：Rockchip RK3399 - DRM HDMI介绍</a><time datetime="2024-02-23T16:00:00.000Z" title="发表于 2024-02-24 00:00:00">2024-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240223/" title="Android 11 Display System V2（6）：Rockchip RK3399 - DRM encoder、bridge、connector基础知识"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.62.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2（6）：Rockchip RK3399 - DRM encoder、bridge、connector基础知识"/></a><div class="content"><a class="title" href="/posts/20240223/" title="Android 11 Display System V2（6）：Rockchip RK3399 - DRM encoder、bridge、connector基础知识">Android 11 Display System V2（6）：Rockchip RK3399 - DRM encoder、bridge、connector基础知识</a><time datetime="2024-02-22T16:00:00.000Z" title="发表于 2024-02-23 00:00:00">2024-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240222/" title="Android 11 Display System V2（5）：Rockchip RK3399 - DRM gem基础知识"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.61.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2（5）：Rockchip RK3399 - DRM gem基础知识"/></a><div class="content"><a class="title" href="/posts/20240222/" title="Android 11 Display System V2（5）：Rockchip RK3399 - DRM gem基础知识">Android 11 Display System V2（5）：Rockchip RK3399 - DRM gem基础知识</a><time datetime="2024-02-21T16:00:00.000Z" title="发表于 2024-02-22 00:00:00">2024-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240221/" title="Android 11 Display System V2（4）：Rockchip RK3399 - DRM gem基础知识"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.60.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2（4）：Rockchip RK3399 - DRM gem基础知识"/></a><div class="content"><a class="title" href="/posts/20240221/" title="Android 11 Display System V2（4）：Rockchip RK3399 - DRM gem基础知识">Android 11 Display System V2（4）：Rockchip RK3399 - DRM gem基础知识</a><time datetime="2024-02-20T16:00:00.000Z" title="发表于 2024-02-21 00:00:00">2024-02-21</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By zhoujinjian</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/js/fishes.js"></script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>