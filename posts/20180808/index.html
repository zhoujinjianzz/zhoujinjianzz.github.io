<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Android N Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architecture | zhoujinjian</title><meta name="keywords" content="Android,Graphics,Display"><meta name="author" content="zhoujinjian"><meta name="copyright" content="zhoujinjian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="æ³¨ï¼šæ–‡ç« éƒ½æ˜¯é€šè¿‡é˜…è¯»å„ä½å‰è¾ˆæ€»ç»“çš„èµ„æ–™ã€Android 7.1.2 &amp;&amp; Linuxï¼ˆkernel 3.18ï¼‰Qualcommå¹³å°æºç ã€åŠ ä¸Šè‡ªå·±çš„æ€è€ƒåˆ†ææ€»ç»“å‡ºæ¥çš„ï¼Œå…¶ä¸­éš¾å…æœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚æ–‡ç« ä¸ºä¸ªäººå­¦ä¹ ã€ç ”ç©¶ã€æ¬£èµä¹‹ç”¨ï¼Œå›¾æ–‡å†…å®¹æ•´ç†è‡ªäº’è”ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œç¦æ­¢è½¬è½½ï¼ˆÂ©Qualcomm Technologies, Inc. ç‰ˆæƒæ‰€æœ‰ï¼‰ï¼Œè°¢è°¢ã€‚ ã€ç‰¹åˆ«æ„Ÿ">
<meta property="og:type" content="article">
<meta property="og:title" content="Android N Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architecture">
<meta property="og:url" content="https://zhoujinjian.com/posts/20180808/index.html">
<meta property="og:site_name" content="zhoujinjian">
<meta property="og:description" content="æ³¨ï¼šæ–‡ç« éƒ½æ˜¯é€šè¿‡é˜…è¯»å„ä½å‰è¾ˆæ€»ç»“çš„èµ„æ–™ã€Android 7.1.2 &amp;&amp; Linuxï¼ˆkernel 3.18ï¼‰Qualcommå¹³å°æºç ã€åŠ ä¸Šè‡ªå·±çš„æ€è€ƒåˆ†ææ€»ç»“å‡ºæ¥çš„ï¼Œå…¶ä¸­éš¾å…æœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚æ–‡ç« ä¸ºä¸ªäººå­¦ä¹ ã€ç ”ç©¶ã€æ¬£èµä¹‹ç”¨ï¼Œå›¾æ–‡å†…å®¹æ•´ç†è‡ªäº’è”ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œç¦æ­¢è½¬è½½ï¼ˆÂ©Qualcomm Technologies, Inc. ç‰ˆæƒæ‰€æœ‰ï¼‰ï¼Œè°¢è°¢ã€‚ ã€ç‰¹åˆ«æ„Ÿ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.23.jpg">
<meta property="article:published_time" content="2018-08-08T01:25:00.000Z">
<meta property="article:modified_time" content="2024-04-14T13:01:32.952Z">
<meta property="article:author" content="zhoujinjian">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Graphics">
<meta property="article:tag" content="Display">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.23.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zhoujinjian.com/posts/20180808/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-14 21:01:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 5.0.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">104</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">13</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> åª’ä½“</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> ä¹¦å•</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/home/"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fab fa-safari"></i><span> å¯¼èˆª</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.23.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zhoujinjian</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> åª’ä½“</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> ä¹¦å•</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/home/"><i class="fa-fw fa fa-cloud-sun-rain"></i><span> ä¸»é¡µ</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fab fa-safari"></i><span> å¯¼èˆª</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">Android N Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architecture</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2018-08-08T01:25:00.000Z" title="å‘è¡¨äº 2018-08-08 09:25:00">2018-08-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-04-14T13:01:32.952Z" title="æ›´æ–°äº 2024-04-14 21:01:32">2024-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Display/">Display</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><hr>
<p>æ³¨ï¼šæ–‡ç« éƒ½æ˜¯é€šè¿‡é˜…è¯»å„ä½å‰è¾ˆæ€»ç»“çš„èµ„æ–™ã€Android 7.1.2 &amp;&amp; Linuxï¼ˆkernel 3.18ï¼‰Qualcommå¹³å°æºç ã€åŠ ä¸Šè‡ªå·±çš„æ€è€ƒåˆ†ææ€»ç»“å‡ºæ¥çš„ï¼Œå…¶ä¸­éš¾å…æœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚æ–‡ç« ä¸ºä¸ªäººå­¦ä¹ ã€ç ”ç©¶ã€æ¬£èµä¹‹ç”¨ï¼Œå›¾æ–‡å†…å®¹æ•´ç†è‡ªäº’è”ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œç¦æ­¢è½¬è½½ï¼ˆÂ©Qualcomm Technologies, Inc. ç‰ˆæƒæ‰€æœ‰ï¼‰ï¼Œè°¢è°¢ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/eliot_shao/article/details/74926010">ã€ç‰¹åˆ«æ„Ÿè°¢ - é«˜é€šAndroidå¹³å°-åº”ç”¨ç©ºé—´æ“ä½œframebuffer dump LCDæ€»ç»“ã€‘</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012719256/article/details/52096727">ã€ç‰¹åˆ«æ„Ÿè°¢ -  linux qcom LCD framworkã€‘</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/ic_soc_arm_robin/article/details/12949347">ã€ç‰¹åˆ«æ„Ÿè°¢ -  msm8610 lcd driver code analysisã€‘</a></p>
<p>Google Pixelã€Pixel XL å†…æ ¸ä»£ç ï¼ˆæ–‡ç« åŸºäº Kernel-3.18ï¼‰ï¼š<br> <a target="_blank" rel="noopener" href="https://github.com/matthewdalex/marlin">Kernel source for Pixel and Pixel XL - GitHub</a></p>
<p>AOSP æºç ï¼ˆæ–‡ç« åŸºäº Android 7.1.2ï¼‰ï¼š<br> <a target="_blank" rel="noopener" href="https://testerhome.com/topics/2229"> Android ç³»ç»Ÿå…¨å¥—æºä»£ç åˆ†äº« (æ›´æ–°åˆ° 8.1.0_r1)</a></p>
<p> ğŸŒ€ğŸŒ€ï¼šä¸“æ³¨äºLinux &amp;&amp; Android Multimediaï¼ˆCameraã€Videoã€Audioã€Displayï¼‰ç³»ç»Ÿåˆ†æä¸ç ”ç©¶</p>
<p>ã€Android Display System ç³»ç»Ÿåˆ†æç³»åˆ—ã€‘ï¼š<br>ã€Android Display Systemï¼ˆ1ï¼‰ï¼šAndroid 7.1.2 (Android N) Android Graphics ç³»ç»Ÿ åˆ†æã€‘<br>ã€Android Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL &amp;&amp; OpenGLã€‘<br>ã€Android Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æã€‘<br>ã€Android Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc &amp;&amp; HWComposeræ¨¡å—åˆ†æã€‘<br>ã€Android Display Systemï¼ˆ5ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Display Driver Architectureã€‘ </p>
<hr>
<p>è·¯å¾„ï¼š<br>kernel\msm-3.18\drivers\video\msm\mdss</p>
<p> MDSS driver software block diagram</p>
<ul>
<li>mdss_fb â†’ Top-level IOCTL/native framebufferinterface</li>
<li>mdss_mdp.c â†’ MDP resources(clocks/irq/bus-bw/power)</li>
<li>mdss_mdp_overlay â†’ Overlay/DMA top-levelAPI</li>
<li>mdss_mdp_ctl â†’ Controls the hardware abstraction to club the (LM + DSPP + Ping-pong +<br>interface)</li>
<li>mdss_mdp_pipe â†’ SRC pipe related handling</li>
<li>mdss_mdp_intf_cmd/mdss_mdp_intf_video/mdss_mdp_intf_writeback â†’ MDP panel<br>interface relatedhandling</li>
<li>mdss_mdp_pp â†’ Postprocessing related implementation</li>
<li>mdss_mdp_rotator â†’ Rotator APIs (overlay_set/overlay_playinterface)</li>
<li>mdss_mdp_pp.c â†’ Postprocessing relatedmaterial</li>
</ul>
<hr>
<p><strong>æ³¨ï¼š</strong>é¦–å…ˆè¯´æ˜ï¼Œç”±äºåšä¸»ä¸æ˜¯kernelå¼€å‘æ–¹å‘çš„ï¼Œå¯èƒ½ç†è§£ä¸å¤Ÿé€å½»ï¼Œè¿˜è¯·çœ‹å®˜è§è°…ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç†è§£Kernel DisplayåŸç†ã€‚ä¸ºäº†åŠ æ·±å¯¹æ˜¾ç¤ºå±å·¥ä½œåŸç†çš„ç†è§£ï¼Œé¦–å…ˆå…ˆçœ‹ä¸¤ä¸ªæ“ä½œLCDæ˜¾ç¤ºå±çš„ä¾‹å­<br>ç»ªè®ºï¼ˆæ€»ä½“æ¶æ„å›¾ï¼‰ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-01-Display-Architecture.png" alt="Alt text | center"></p>
<h4 id="ï¼ˆä¸€ï¼‰ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ"><a href="#ï¼ˆä¸€ï¼‰ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ"></a>ï¼ˆä¸€ï¼‰ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ</h4><h5 id="1-1ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ"><a href="#1-1ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ" class="headerlink" title="1.1ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ"></a>1.1ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ</h5><h5 id="1-1-1ã€æºä»£ç "><a href="#1-1-1ã€æºä»£ç " class="headerlink" title="1.1.1ã€æºä»£ç "></a>1.1.1ã€æºä»£ç </h5><p><strong>panel_test.c</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/fb.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;yellow_face.zif&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> fbfd = <span class="number">0</span>;  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_var_screeninfo</span> <span class="title">vinfo</span>;</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_fix_screeninfo</span> <span class="title">finfo</span>;</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_cmap</span> <span class="title">cmapinfo</span>;</span>  </span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> screensize = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">char</span> *fbp = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> location = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">int</span> b,g,r;  </span><br><span class="line">    <span class="comment">// Open the file for reading and writing  </span></span><br><span class="line">    fbfd = open(<span class="string">&quot;/dev/graphics/fb0&quot;</span>, O_RDWR,<span class="number">0</span>);                    <span class="comment">// æ‰“å¼€Frame Bufferè®¾å¤‡  </span></span><br><span class="line">    <span class="keyword">if</span> (fbfd &lt; <span class="number">0</span>) &#123;  </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error: cannot open framebuffer device.%x\n&quot;</span>,fbfd);  </span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The framebuffer device was opened successfully.\n&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Get fixed screen information  </span></span><br><span class="line">    <span class="keyword">if</span> (ioctl(fbfd, FBIOGET_FSCREENINFO, &amp;finfo)) &#123;            <span class="comment">// è·å–è®¾å¤‡å›ºæœ‰ä¿¡æ¯  </span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error reading fixed information.\n&quot;</span>);  </span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">2</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\ntype:0x%x\n&quot;</span>, finfo.type );                            <span class="comment">// FrameBuffer ç±»å‹,å¦‚0ä¸ºè±¡ç´   </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;visual:%d\n&quot;</span>, finfo.visual );                        <span class="comment">// è§†è§‰ç±»å‹ï¼šå¦‚çœŸå½©2ï¼Œä¼ªå½©3   </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;line_length:%d\n&quot;</span>, finfo.line_length );        <span class="comment">// æ¯è¡Œé•¿åº¦  </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nsmem_start:0x%lx,smem_len:%u\n&quot;</span>, finfo.smem_start, finfo.smem_len ); <span class="comment">// æ˜ è±¡RAMçš„å‚æ•°  </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;mmio_start:0x%lx ,mmio_len:%u\n&quot;</span>, finfo.mmio_start, finfo.mmio_len );  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// Get variable screen information  </span></span><br><span class="line">    <span class="keyword">if</span> (ioctl(fbfd, FBIOGET_VSCREENINFO, &amp;vinfo)) &#123;            <span class="comment">// è·å–è®¾å¤‡å¯å˜ä¿¡æ¯  </span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error reading variable information.\n&quot;</span>);  </span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">3</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%dx%d, %dbpp,xres_virtual=%d,yres_virtual=%dvinfo.xoffset=%d,vinfo.yoffset=%d\n&quot;</span>, vinfo.xres, vinfo.yres, vinfo.bits_per_pixel,vinfo.xres_virtual,vinfo.yres_virtual,vinfo.xoffset,vinfo.yoffset);  </span><br><span class="line"></span><br><span class="line">    screensize = finfo.line_length * vinfo.yres_virtual;</span><br><span class="line">    <span class="comment">// Map the device to memory é€šè¿‡mmapç³»ç»Ÿè°ƒç”¨å°†framebufferå†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´,å¹¶è¿”å›æ˜ å°„åçš„èµ·å§‹åœ°å€  </span></span><br><span class="line">    fbp = (<span class="keyword">char</span> *)mmap(<span class="number">0</span>, screensize, PROT_READ | PROT_WRITE, MAP_SHARED,fbfd, <span class="number">0</span>);  </span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">int</span>)fbp == <span class="number">-1</span>) &#123;  </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error: failed to map framebuffer device to memory.\n&quot;</span>);  </span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">4</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The framebuffer device was mapped to memory successfully.\n&quot;</span>);  </span><br><span class="line"><span class="comment">/***************exampel 1**********************/</span></span><br><span class="line">    b = <span class="number">10</span>;</span><br><span class="line">    g = <span class="number">100</span>;</span><br><span class="line">    r = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">for</span> ( y = <span class="number">0</span>; y &lt; <span class="number">340</span>; y++ )</span><br><span class="line">        <span class="keyword">for</span> ( x = <span class="number">0</span>; x &lt; <span class="number">420</span>; x++ ) &#123; </span><br><span class="line">      </span><br><span class="line">         location = (x+<span class="number">100</span>) * (vinfo.bits_per_pixel/<span class="number">8</span>) + </span><br><span class="line">             (y+<span class="number">100</span>) * finfo.line_length; </span><br><span class="line">      </span><br><span class="line">         <span class="keyword">if</span> ( vinfo.bits_per_pixel == <span class="number">32</span> ) &#123;        <span class="comment">//          </span></span><br><span class="line">                        *(fbp + location) = b; <span class="comment">// Some blue  </span></span><br><span class="line">                        *(fbp + location + <span class="number">1</span>) = g;             <span class="comment">// A little green  </span></span><br><span class="line">                        *(fbp + location + <span class="number">2</span>) = r;             <span class="comment">// A lot of red  </span></span><br><span class="line">                        *(fbp + location + <span class="number">3</span>) = <span class="number">0</span>;     <span class="comment">// No transparency  </span></span><br><span class="line">         &#125;</span><br><span class="line">      </span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">/*****************exampel 1********************/</span></span><br><span class="line"><span class="comment">/*****************exampel 2********************/</span>        </span><br><span class="line">     <span class="keyword">unsigned</span> <span class="keyword">char</span> *pTemp = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)fbp;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="comment">//èµ·å§‹åæ ‡(x,y),ç»ˆç‚¹åæ ‡(right,bottom)</span></span><br><span class="line">    x = <span class="number">400</span>;</span><br><span class="line">    y = <span class="number">400</span>;</span><br><span class="line">    <span class="keyword">int</span> right = <span class="number">700</span>;<span class="comment">//vinfo.xres;</span></span><br><span class="line">    <span class="keyword">int</span> bottom = <span class="number">1000</span>;<span class="comment">//vinfo.yres;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i=y; i&lt; bottom; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(j=x; j&lt;right; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">short</span> data = yellow_face_data[(((i-y)  % <span class="number">128</span>) * <span class="number">128</span>) + ((j-x) %<span class="number">128</span>)];</span><br><span class="line">            pTemp[i*finfo.line_length + (j*<span class="number">4</span>) + <span class="number">2</span>] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((data &amp; <span class="number">0xF800</span>) &gt;&gt; <span class="number">11</span> &lt;&lt; <span class="number">3</span>);</span><br><span class="line">            pTemp[i*finfo.line_length + (j*<span class="number">4</span>) + <span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((data &amp; <span class="number">0x7E0</span>) &gt;&gt; <span class="number">5</span> &lt;&lt; <span class="number">2</span>);</span><br><span class="line">            pTemp[i*finfo.line_length + (j*<span class="number">4</span>) + <span class="number">0</span>] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((data &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"><span class="comment">/*****************exampel 2********************/</span>    </span><br><span class="line"><span class="comment">//noteï¼švinfo.xoffset =0 vinfo.yoffset =0 å¦åˆ™FBIOPAN_DISPLAYä¸æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (ioctl(fbfd, FBIOPAN_DISPLAY, &amp;vinfo)) &#123;    </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error FBIOPAN_DISPLAY information.\n&quot;</span>);  </span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">5</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    sleep(<span class="number">10</span>);</span><br><span class="line">    munmap(fbp,finfo.smem_len);<span class="comment">//finfo.smem_len == screensize == finfo.line_length * vinfo.yres_virtual </span></span><br><span class="line">    close(fbfd);  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Android.mk</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Copyright <span class="number">2006</span><span class="number">-2014</span> The Android Open Source Project</span><br><span class="line"></span><br><span class="line">LOCAL_PATH:= $(call my-dir)</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"></span><br><span class="line">LOCAL_SRC_FILES:= panel_test.c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LOCAL_SHARED_LIBRARIES        := $(common_libs) libqdutils libdl liblog libbase libcutils</span><br><span class="line">LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)</span><br><span class="line">LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps) $(kernel_deps)</span><br><span class="line"></span><br><span class="line">LOCAL_MODULE := panel_test</span><br><span class="line"></span><br><span class="line">LOCAL_CFLAGS := -Werror</span><br><span class="line"></span><br><span class="line">include $(BUILD_EXECUTABLE)</span><br><span class="line"></span><br><span class="line">include $(call first-makefiles-under,$(LOCAL_PATH))</span><br></pre></td></tr></table></figure>
<p><strong>yellow_face.zif</strong><br><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-yellow_face.zif">yellow_face.zif</a></p>
<h5 id="1-1-2ã€ç¼–è¯‘æµ‹è¯•"><a href="#1-1-2ã€ç¼–è¯‘æµ‹è¯•" class="headerlink" title="1.1.2ã€ç¼–è¯‘æµ‹è¯•"></a>1.1.2ã€ç¼–è¯‘æµ‹è¯•</h5><p>ç¼–è¯‘ä¼šç”Ÿæˆpanel_testï¼Œç„¶åè¿›è¡Œæµ‹è¯•ã€‚</p>
<blockquote>
<p>æ³¨æ„äº‹é¡¹ï¼š<br>1ã€adb shell stop æ€æ‰surfaceflinger ä¹‹ååœ¨æµ‹è¯•ï¼›<br>2ã€è®¾ç½®èƒŒå…‰ echo 255 &gt; /sys/class/leds/lcd-backlight/brightness</p>
</blockquote>
<blockquote>
<p>1ã€è¿æ¥adb<br>2ã€adb push panel_test system/bin<br>3ã€è¿›å…¥adb shell<br>4ã€stop<br>5ã€echo 255 &gt; /sys/class/leds/lcd-backlight/brightness<br>6ã€system/bin/panel_test</p>
</blockquote>
<h5 id="1-1-3ã€æ˜¾ç¤ºæ•ˆæœ"><a href="#1-1-3ã€æ˜¾ç¤ºæ•ˆæœ" class="headerlink" title="1.1.3ã€æ˜¾ç¤ºæ•ˆæœ"></a>1.1.3ã€æ˜¾ç¤ºæ•ˆæœ</h5><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-02-Qcom_FrameBuffer_test_.gif" alt="Alt text | center"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-03-yellow_face_zif_test.jpg" alt="Alt text | center"></p>
<h5 id="1-1-4ã€è§†é¢‘ï¼ˆåŠ æ·±ç†è§£ã€è‡ªâ˜¯å¤‡â˜¯æ¢¯â˜¯å­ï¼‰"><a href="#1-1-4ã€è§†é¢‘ï¼ˆåŠ æ·±ç†è§£ã€è‡ªâ˜¯å¤‡â˜¯æ¢¯â˜¯å­ï¼‰" class="headerlink" title="1.1.4ã€è§†é¢‘ï¼ˆåŠ æ·±ç†è§£ã€è‡ªâ˜¯å¤‡â˜¯æ¢¯â˜¯å­ï¼‰"></a>1.1.4ã€è§†é¢‘ï¼ˆåŠ æ·±ç†è§£ã€è‡ªâ˜¯å¤‡â˜¯æ¢¯â˜¯å­ï¼‰</h5><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BUPPyR6VasI">Android Frame Buffer and Screen Shots Tutorial</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=7n_hDZ6kHjc">Mplayer on Android Through Chroot and Frame Buffer</a></p>
<h5 id="1-1-5ã€é©±åŠ¨æ€»ä½“æ¦‚è§ˆå›¾"><a href="#1-1-5ã€é©±åŠ¨æ€»ä½“æ¦‚è§ˆå›¾" class="headerlink" title="1.1.5ã€é©±åŠ¨æ€»ä½“æ¦‚è§ˆå›¾"></a>1.1.5ã€é©±åŠ¨æ€»ä½“æ¦‚è§ˆå›¾</h5><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-04-msm8x25-display-overview.png" alt="Alt text | center"></p>
<h4 id="ï¼ˆäºŒï¼‰ã€FrameBufferé©±åŠ¨ç¨‹åºåˆ†æ"><a href="#ï¼ˆäºŒï¼‰ã€FrameBufferé©±åŠ¨ç¨‹åºåˆ†æ" class="headerlink" title="ï¼ˆäºŒï¼‰ã€FrameBufferé©±åŠ¨ç¨‹åºåˆ†æ"></a>ï¼ˆäºŒï¼‰ã€FrameBufferé©±åŠ¨ç¨‹åºåˆ†æ</h4><p>FrameBufferé€šå¸¸ä½œä¸ºLCDæ§åˆ¶å™¨æˆ–è€…å…¶ä»–æ˜¾ç¤ºè®¾å¤‡çš„é©±åŠ¨ï¼ŒFrameBufferé©±åŠ¨æ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ï¼Œè®¾å¤‡èŠ‚ç‚¹æ˜¯/dev/fbXï¼ˆAndroid è®¾å¤‡ä¸º/dev/graphics/fb0ï¼‰ï¼Œä¸»è®¾å¤‡å·ä¸º29ï¼Œæ¬¡è®¾å¤‡å·é€’å¢ï¼Œç”¨æˆ·å¯ä»¥å°†Framebufferçœ‹æˆæ˜¯æ˜¾ç¤ºå†…å­˜çš„ä¸€ä¸ªæ˜ åƒï¼Œå°†å…¶æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œå†™æ“ä½œå¯ä»¥ç«‹å³ååº”åœ¨å±å¹•ä¸Šã€‚è¿™ç§æ“ä½œæ˜¯æŠ½è±¡çš„ï¼Œç»Ÿä¸€çš„ã€‚ç”¨æˆ·ä¸å¿…å…³å¿ƒç‰©ç†æ˜¾å­˜çš„ä½ç½®ã€æ¢é¡µæœºåˆ¶ç­‰ç­‰å…·ä½“ç»†èŠ‚ã€‚è¿™äº›éƒ½æ˜¯ç”±Framebufferè®¾å¤‡é©±åŠ¨æ¥å®Œæˆçš„ã€‚Framebufferè®¾å¤‡ä¸ºä¸Šå±‚åº”ç”¨ç¨‹åºæä¾›ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿä¸ºä¸‹ä¸€å±‚çš„ç‰¹å®šç¡¬ä»¶é©±åŠ¨æä¾›æ¥å£ï¼›é‚£äº›åº•å±‚ç¡¬ä»¶é©±åŠ¨éœ€è¦ç”¨åˆ°è¿™å„¿çš„æ¥å£æ¥å‘ç³»ç»Ÿå†…æ ¸æ³¨å†Œå®ƒä»¬è‡ªå·±ã€‚</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-05-mdss-driver-architecture.png" alt="Alt text | center"></p>
<p>Linuxä¸­çš„PCIè®¾å¤‡å¯ä»¥å°†å…¶æ§åˆ¶å¯„å­˜å™¨æ˜ å°„åˆ°ç‰©ç†å†…å­˜ç©ºé—´ï¼Œè€Œåï¼Œå¯¹è¿™äº›æ§åˆ¶å¯„å­˜å™¨çš„è®¿é—®å˜æˆäº†å¯¹ç†å†…å­˜çš„è®¿é—®ï¼Œå› æ­¤ï¼Œè¿™äº›å¯„å­˜å™¨åˆè¢«ç§°ä¸ºâ€memioâ€ã€‚ä¸€æ—¦è¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼ŒLinuxçš„æ™®é€šè¿›ç¨‹å°±å¯ä»¥é€šè¿‡mmapå°†è¿™äº›å†…å­˜I/Oæ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è®¿é—®è¿™äº›å¯„å­˜å™¨äº†ã€‚</p>
<p>FrameBufferè®¾å¤‡å±äºå­—ç¬¦è®¾å¤‡ï¼Œé‡‡ç”¨äº†æ–‡ä»¶å±‚â€”é©±åŠ¨å±‚çš„æ¥å£æ–¹å¼ï¼ŒLinuxä¸ºå¸§ç¼“å†²è®¾å¤‡å®šä¹‰äº†é©±åŠ¨å±‚çš„æ¥å£fb_infoç»“æ„ï¼Œåœ¨æ–‡ä»¶å±‚ä¸Šï¼Œç”¨æˆ·è°ƒç”¨file_operationsçš„å‡½æ•°æ“ä½œï¼Œé—´æ¥è°ƒç”¨fb_infoä¸­çš„fb_opså‡½æ•°é›†æ¥æ“ä½œç¡¬ä»¶ã€‚</p>
<h5 id="2-1ã€-Framebufferæ•°æ®ç»“æ„"><a href="#2-1ã€-Framebufferæ•°æ®ç»“æ„" class="headerlink" title="2.1ã€ Framebufferæ•°æ®ç»“æ„"></a>2.1ã€ Framebufferæ•°æ®ç»“æ„</h5><h5 id="2-1-1ã€-fb-info"><a href="#2-1-1ã€-fb-info" class="headerlink" title="2.1.1ã€ fb_info"></a>2.1.1ã€ fb_info</h5><p>fb_infoæ˜¯Linuxä¸ºå¸§ç¼“å†²è®¾å¤‡å®šä¹‰çš„é©±åŠ¨å±‚æ¥å£ã€‚å®ƒä¸ä»…åŒ…å«äº†åº•å±‚å‡½æ•°ï¼Œè€Œä¸”è¿˜æœ‰è®°å½•è®¾å¤‡çŠ¶æ€çš„æ•°æ®ã€‚æ¯ä¸ªå¸§ç¼“å†²è®¾å¤‡éƒ½ä¸ä¸€ä¸ªfb_infoç»“æ„ç›¸å¯¹åº”ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;kernel\include\linux\fb.h]</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fb_info</span> &#123;</span></span><br><span class="line">    <span class="keyword">atomic_t</span> count;</span><br><span class="line">    <span class="keyword">int</span> node;</span><br><span class="line">    <span class="keyword">int</span> flags;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">lock</span>;</span>        <span class="comment">/* Lock for open/release/ioctl funcs */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">mm_lock</span>;</span>        <span class="comment">/* Lock for fb_mmap and smem_* fields */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_var_screeninfo</span> <span class="title">var</span>;</span>    <span class="comment">/* Current var */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_fix_screeninfo</span> <span class="title">fix</span>;</span>    <span class="comment">/* Current fix */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_monspecs</span> <span class="title">monspecs</span>;</span>    <span class="comment">/* Current Monitor specs */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">work_struct</span> <span class="title">queue</span>;</span>    <span class="comment">/* Framebuffer event queue */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_pixmap</span> <span class="title">pixmap</span>;</span>    <span class="comment">/* Image hardware mapper */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_pixmap</span> <span class="title">sprite</span>;</span>    <span class="comment">/* Cursor hardware mapper */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_cmap</span> <span class="title">cmap</span>;</span>        <span class="comment">/* Current cmap */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">modelist</span>;</span>      <span class="comment">/* mode list */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_videomode</span> *<span class="title">mode</span>;</span>    <span class="comment">/* current mode */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">file</span> *<span class="title">file</span>;</span>        <span class="comment">/* current file node */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FB_DEFERRED_IO</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">delayed_work</span> <span class="title">deferred_work</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_deferred_io</span> *<span class="title">fbdefio</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_ops</span> *<span class="title">fbops</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">device</span>;</span>        <span class="comment">/* This is the parent */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">dev</span>;</span>        <span class="comment">/* This is this fb device */</span></span><br><span class="line">    <span class="keyword">int</span> class_flag;                    <span class="comment">/* private sysfs flags */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FB_TILEBLITTING</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_tile_ops</span> *<span class="title">tileops</span>;</span>    <span class="comment">/* Tile Blitting */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">char</span> __iomem *screen_base;    <span class="comment">/* Virtual address */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> screen_size;    <span class="comment">/* Amount of ioremapped VRAM or 0 */</span> </span><br><span class="line">    <span class="keyword">void</span> *pseudo_palette;        <span class="comment">/* Fake palette of 16 colors */</span> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FBINFO_STATE_RUNNING    0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FBINFO_STATE_SUSPENDED    1</span></span><br><span class="line">    u32 state;            <span class="comment">/* Hardware state i.e suspend */</span></span><br><span class="line">    <span class="keyword">void</span> *fbcon_par;                <span class="comment">/* fbcon use-only private area */</span></span><br><span class="line">    <span class="comment">/* From here on everything is device dependent */</span></span><br><span class="line">    <span class="keyword">void</span> *par;</span><br><span class="line">    <span class="comment">/* we need the PCI or similar aperture base/size not</span></span><br><span class="line"><span class="comment">       smem_start/size as smem_start may just be an object</span></span><br><span class="line"><span class="comment">       allocated inside the aperture so may not actually overlap */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">apertures_struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> count;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">aperture</span> &#123;</span></span><br><span class="line">            <span class="keyword">resource_size_t</span> base;</span><br><span class="line">            <span class="keyword">resource_size_t</span> size;</span><br><span class="line">        &#125; ranges[<span class="number">0</span>];</span><br><span class="line">    &#125; *apertures;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> skip_vt_switch; <span class="comment">/* no VT switch on suspend/resume required */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="2-1-2ã€fb-var-screeninfo"><a href="#2-1-2ã€fb-var-screeninfo" class="headerlink" title="2.1.2ã€fb_var_screeninfo"></a>2.1.2ã€fb_var_screeninfo</h5><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-06-xres-yres.png" alt="Alt text | center"></p>
<p>fb_var_screeninfoï¼šç”¨äºè®°å½•ç”¨æˆ·å¯ä¿®æ”¹çš„æ˜¾ç¤ºæ§åˆ¶å™¨å‚æ•°ï¼ŒåŒ…æ‹¬å±å¹•åˆ†è¾¨ç‡ã€æ¯ä¸ªåƒç´ ç‚¹çš„æ¯”ç‰¹æ•°ç­‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\include\uapi\linux\fb.h]</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fb_var_screeninfo</span> &#123;</span>  </span><br><span class="line">    __u32 xres;         <span class="comment">/* è¡Œå¯è§åƒç´ */</span>  </span><br><span class="line">    __u32 yres;         <span class="comment">/* åˆ—å¯è§åƒç´ */</span>  </span><br><span class="line">    __u32 xres_virtual; <span class="comment">/* è¡Œè™šæ‹Ÿåƒç´ */</span>  </span><br><span class="line">    __u32 yres_virtual; <span class="comment">/* åˆ—è™šæ‹Ÿåƒç´ */</span>  </span><br><span class="line">    __u32 xoffset;      <span class="comment">/* æ°´å¹³åç§»é‡*/</span>  </span><br><span class="line">    __u32 yoffset;      <span class="comment">/* å‚ç›´åç§»é‡*/</span>  </span><br><span class="line">    __u32 bits_per_pixel;<span class="comment">/*æ¯ä¸ªåƒç´ æ‰€å bitä½æ•°*/</span>  </span><br><span class="line">    __u32 grayscale;    <span class="comment">/* ç°è‰²åˆ»åº¦*/</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_bitfield</span> <span class="title">red</span>;</span> <span class="comment">/* bitfield in fb mem if true color, */</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_bitfield</span> <span class="title">green</span>;</span>   <span class="comment">/* else only length is significant */</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_bitfield</span> <span class="title">blue</span>;</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_bitfield</span> <span class="title">transp</span>;</span>  <span class="comment">/* transparency         */</span>    </span><br><span class="line">    __u32 nonstd;           <span class="comment">/* != 0 Non standard pixel format */</span>  </span><br><span class="line">    __u32 activate;         <span class="comment">/* see FB_ACTIVATE_*        */</span>  </span><br><span class="line">    __u32 height;           <span class="comment">/* å›¾åƒé«˜åº¦*/</span>  </span><br><span class="line">    __u32 width;            <span class="comment">/* å›¾åƒå®½åº¦*/</span>  </span><br><span class="line">    __u32 accel_flags;      <span class="comment">/* (OBSOLETE) see fb_info.flags */</span>  </span><br><span class="line">    __u32 pixclock;         <span class="comment">/* pixel clock in ps (pico seconds) */</span>  </span><br><span class="line">    __u32 left_margin;      <span class="comment">/* time from sync to picture    */</span>  </span><br><span class="line">    __u32 right_margin;     <span class="comment">/* time from picture to sync    */</span>  </span><br><span class="line">    __u32 upper_margin;     <span class="comment">/* time from sync to picture    */</span>  </span><br><span class="line">    __u32 lower_margin;  </span><br><span class="line">    __u32 hsync_len;        <span class="comment">/* length of horizontal sync    */</span>  </span><br><span class="line">    __u32 vsync_len;        <span class="comment">/* length of vertical sync  */</span>  </span><br><span class="line">    __u32 sync;         <span class="comment">/* see FB_SYNC_*        */</span>  </span><br><span class="line">    __u32 vmode;            <span class="comment">/* see FB_VMODE_*       */</span>  </span><br><span class="line">    __u32 rotate;           <span class="comment">/* angle we rotate counter clockwise */</span>  </span><br><span class="line">    __u32 reserved[<span class="number">5</span>];      <span class="comment">/* Reserved for future compatibility */</span>  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2-1-3ã€fb-fix-screeninfo"><a href="#2-1-3ã€fb-fix-screeninfo" class="headerlink" title="2.1.3ã€fb_fix_screeninfo"></a>2.1.3ã€fb_fix_screeninfo</h5><p>fb_fix_screeninfoï¼šè®°å½•äº†ç”¨æˆ·ä¸èƒ½ä¿®æ”¹çš„æ˜¾ç¤ºæ§åˆ¶å™¨çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯åœ¨é©±åŠ¨åˆå§‹åŒ–æ—¶è®¾ç½®çš„</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\include\uapi\linux\fb.h]</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fb_fix_screeninfo</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> id[<span class="number">16</span>];            <span class="comment">/* identification string eg &quot;TT Builtin&quot; */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> smem_start;    <span class="comment">/* Start of frame buffer mem */</span></span><br><span class="line">                    <span class="comment">/* (physical address) */</span></span><br><span class="line">    __u32 smem_len;            <span class="comment">/* Length of frame buffer mem */</span></span><br><span class="line">    __u32 type;            <span class="comment">/* see FB_TYPE_*        */</span></span><br><span class="line">    __u32 type_aux;            <span class="comment">/* Interleave for interleaved Planes */</span></span><br><span class="line">    __u32 visual;            <span class="comment">/* see FB_VISUAL_*        */</span> </span><br><span class="line">    __u16 xpanstep;            <span class="comment">/* zero if no hardware panning  */</span></span><br><span class="line">    __u16 ypanstep;            <span class="comment">/* zero if no hardware panning  */</span></span><br><span class="line">    __u16 ywrapstep;        <span class="comment">/* zero if no hardware ywrap    */</span></span><br><span class="line">    __u32 line_length;        <span class="comment">/* length of a line in bytes    */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> mmio_start;    <span class="comment">/* Start of Memory Mapped I/O   */</span></span><br><span class="line">                    <span class="comment">/* (physical address) */</span></span><br><span class="line">    __u32 mmio_len;            <span class="comment">/* Length of Memory Mapped I/O  */</span></span><br><span class="line">    __u32 accel;            <span class="comment">/* Indicate to driver which    */</span></span><br><span class="line">                    <span class="comment">/*  specific chip/card we have    */</span></span><br><span class="line">    __u16 capabilities;        <span class="comment">/* see FB_CAP_*            */</span></span><br><span class="line">    __u16 reserved[<span class="number">2</span>];        <span class="comment">/* Reserved for future compatibility */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>fb_opsæ˜¯æä¾›ç»™åº•å±‚è®¾å¤‡é©±åŠ¨çš„ä¸€ä¸ªæ¥å£ã€‚å½“æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªFrameBufferçš„æ—¶å€™ï¼Œå°±è¦ä¾ç…§Linux FrameBufferç¼–ç¨‹çš„å¥—è·¯ï¼Œå¡«å†™fb_opsç»“æ„ä½“ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\include\linux\fb.h]</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fb_ops</span> &#123;</span></span><br><span class="line">    <span class="comment">/* open/release and usage marking */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_open)(struct fb_info *info, <span class="keyword">int</span> user);</span><br><span class="line">    <span class="keyword">int</span> (*fb_release)(struct fb_info *info, <span class="keyword">int</span> user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* For framebuffers with strange non linear layouts or that do not</span></span><br><span class="line"><span class="comment">     * work with normal memory mapped access</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">ssize_t</span> (*fb_read)(struct fb_info *info, <span class="keyword">char</span> __user *buf,</span><br><span class="line">               <span class="keyword">size_t</span> count, <span class="keyword">loff_t</span> *ppos);</span><br><span class="line">    <span class="keyword">ssize_t</span> (*fb_write)(struct fb_info *info, <span class="keyword">const</span> <span class="keyword">char</span> __user *buf,</span><br><span class="line">                <span class="keyword">size_t</span> count, <span class="keyword">loff_t</span> *ppos);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* checks var and eventually tweaks it to something supported,</span></span><br><span class="line"><span class="comment">     * DO NOT MODIFY PAR */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_check_var)(struct fb_var_screeninfo *var, struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* set the video mode according to info-&gt;var */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_set_par)(struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* set color register */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_setcolreg)(<span class="keyword">unsigned</span> regno, <span class="keyword">unsigned</span> red, <span class="keyword">unsigned</span> green,</span><br><span class="line">                <span class="keyword">unsigned</span> blue, <span class="keyword">unsigned</span> transp, struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* set color registers in batch */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_setcmap)(struct fb_cmap *cmap, struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* blank display */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_blank)(<span class="keyword">int</span> blank, struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* pan display */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_pan_display)(struct fb_var_screeninfo *var, struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Draws a rectangle */</span></span><br><span class="line">    <span class="keyword">void</span> (*fb_fillrect) (struct fb_info *info, <span class="keyword">const</span> struct fb_fillrect *rect);</span><br><span class="line">    <span class="comment">/* Copy data from area to another */</span></span><br><span class="line">    <span class="keyword">void</span> (*fb_copyarea) (struct fb_info *info, <span class="keyword">const</span> struct fb_copyarea *region);</span><br><span class="line">    <span class="comment">/* Draws a image to the display */</span></span><br><span class="line">    <span class="keyword">void</span> (*fb_imageblit) (struct fb_info *info, <span class="keyword">const</span> struct fb_image *image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Draws cursor */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_cursor) (struct fb_info *info, struct fb_cursor *cursor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Rotates the display */</span></span><br><span class="line">    <span class="keyword">void</span> (*fb_rotate)(struct fb_info *info, <span class="keyword">int</span> angle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* wait for blit idle, optional */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_sync)(struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* perform fb specific ioctl (optional) */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_ioctl)(struct fb_info *info, <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd,</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">long</span> arg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* perform fb specific ioctl v2 (optional) - provides file param */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_ioctl_v2)(struct fb_info *info, <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd,</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">long</span> arg, struct file *file);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Handle 32bit compat ioctl (optional) */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_compat_ioctl)(struct fb_info *info, <span class="keyword">unsigned</span> cmd,</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">long</span> arg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Handle 32bit compat ioctl (optional) */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_compat_ioctl_v2)(struct fb_info *info, <span class="keyword">unsigned</span> cmd,</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">long</span> arg, struct file *file);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* perform fb specific mmap */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_mmap)(struct fb_info *info, struct vm_area_struct *vma);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* get capability given var */</span></span><br><span class="line">    <span class="keyword">void</span> (*fb_get_caps)(struct fb_info *info, struct fb_blit_caps *caps,</span><br><span class="line">                struct fb_var_screeninfo *var);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* teardown any resources to do with this framebuffer */</span></span><br><span class="line">    <span class="keyword">void</span> (*fb_destroy)(struct fb_info *info);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* called at KDB enter and leave time to prepare the console */</span></span><br><span class="line">    <span class="keyword">int</span> (*fb_debug_enter)(struct fb_info *info);</span><br><span class="line">    <span class="keyword">int</span> (*fb_debug_leave)(struct fb_info *info);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="2-2ã€Framebufferé©±åŠ¨æ³¨å†Œè¿‡ç¨‹"><a href="#2-2ã€Framebufferé©±åŠ¨æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="2.2ã€Framebufferé©±åŠ¨æ³¨å†Œè¿‡ç¨‹"></a>2.2ã€Framebufferé©±åŠ¨æ³¨å†Œè¿‡ç¨‹</h5><p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå†…æ ¸è°ƒç”¨æ‰€æœ‰æ³¨å†Œé©±åŠ¨ç¨‹åºçš„é©±åŠ¨ç¨‹åºåˆå§‹åŒ–å‡½æ•°ã€‚ ä¸ºäº†å¸§ç¼“å†²åŒºé©±åŠ¨ç¨‹åºï¼Œè°ƒç”¨mdss_fb_initã€‚ mdss_fb_initæ³¨å†Œmdss_fb_driverã€‚é©±åŠ¨åœ¨mdss_fb.cæ–‡ä»¶ä¸­æ³¨å†Œã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[-\drivers\video\msm\mdss\mdss_fb.c]</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">mdss_fb_driver</span> = &#123;</span></span><br><span class="line">    .probe = mdss_fb_probe,</span><br><span class="line">    .remove = mdss_fb_remove,</span><br><span class="line">    .suspend = mdss_fb_suspend,</span><br><span class="line">    .resume = mdss_fb_resume,</span><br><span class="line">    .shutdown = mdss_fb_shutdown,</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = <span class="string">&quot;mdss_fb&quot;</span>,</span><br><span class="line">        .of_match_table = mdss_fb_dt_match,</span><br><span class="line">        .pm = &amp;mdss_fb_pm_ops,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨initä¹‹åï¼Œå†…æ ¸è°ƒç”¨æ¯ä¸ªå¹³å°é©±åŠ¨ç¨‹åºçš„æ¢æµ‹å‡½æ•°ã€‚ åœ¨è°ƒç”¨mdss_fb_probeæ—¶ï¼Œå‡½æ•°æ‰§è¡Œèµ„æºåˆ†é…å¹¶è°ƒç”¨mdss_fb_registerã€‚ å¯ä»¥æœ‰å¤šä¸ªå¸§ç¼“å†²åŒºï¼ˆfbï¼‰è®¾å¤‡ï¼ˆèŠ‚ç‚¹ï¼‰ã€‚ è¯¥é©±åŠ¨ç¨‹åºé€šè¿‡è°ƒç”¨mdss_fb_registeræ¥æ³¨å†Œå„ä¸ªfbè®¾å¤‡ï¼Œåè€…åˆè°ƒç”¨register_framebufferã€‚ HDMIå’Œä¸»æ˜¾ç¤ºå™¨æ˜¯å„ä¸ªfbè®¾å¤‡çš„ä¾‹å­ã€‚ ä»¥ä¸‹æ“ä½œå·²æ³¨å†Œï¼š</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹mdss_fb_probe()å‡½æ•°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\msm\mdss\mdss_fb.c]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">mdss_fb_probe</span><span class="params">(struct platform_device *pdev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msm_fb_data_type</span> *<span class="title">mfd</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mdss_panel_data</span> *<span class="title">pdata</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_info</span> *<span class="title">fbi</span>;</span></span><br><span class="line">    <span class="keyword">int</span> rc;</span><br><span class="line"></span><br><span class="line">    pdata = dev_get_platdata(&amp;pdev-&gt;dev);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * alloc framebuffer info + par data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    fbi = framebuffer_alloc(<span class="keyword">sizeof</span>(struct msm_fb_data_type), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    mfd = (struct msm_fb_data_type *)fbi-&gt;par;</span><br><span class="line">    mfd-&gt;key = MFD_KEY;</span><br><span class="line">    mfd-&gt;fbi = fbi;</span><br><span class="line">    mfd-&gt;panel_info = &amp;pdata-&gt;panel_info;</span><br><span class="line">    mfd-&gt;panel.type = pdata-&gt;panel_info.type;</span><br><span class="line">    mfd-&gt;panel.id = mfd-&gt;index;</span><br><span class="line">    mfd-&gt;fb_page = MDSS_FB_NUM;</span><br><span class="line">    mfd-&gt;index = fbi_list_index;</span><br><span class="line">    mfd-&gt;mdp_fb_page_protection = MDP_FB_PAGE_PROTECTION_WRITECOMBINE;</span><br><span class="line"></span><br><span class="line">    mfd-&gt;ext_ad_ctrl = <span class="number">-1</span>;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    platform_set_drvdata(pdev, mfd);</span><br><span class="line"></span><br><span class="line">    rc = mdss_fb_register(mfd);</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆè°ƒç”¨framebuffer_alloc()å‡½æ•°è¿”å›ä¸€ä¸ªfb_info ç»“æ„ä½“ï¼Œç„¶åè°ƒç”¨mdss_fb_register(mfd)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\msm\mdss\mdss_fb.c]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">mdss_fb_register</span><span class="params">(struct msm_fb_data_type *mfd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = -ENODEV;</span><br><span class="line">    <span class="keyword">int</span> bpp;</span><br><span class="line">    <span class="keyword">char</span> panel_name[<span class="number">20</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mdss_panel_info</span> *<span class="title">panel_info</span> = <span class="title">mfd</span>-&gt;<span class="title">panel_info</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_info</span> *<span class="title">fbi</span> = <span class="title">mfd</span>-&gt;<span class="title">fbi</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_fix_screeninfo</span> *<span class="title">fix</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_var_screeninfo</span> *<span class="title">var</span>;</span></span><br><span class="line">    <span class="keyword">int</span> *id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * fb info initialization</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    fix = &amp;fbi-&gt;fix;</span><br><span class="line">    var = &amp;fbi-&gt;var;</span><br><span class="line"></span><br><span class="line">    fix-&gt;type_aux = <span class="number">0</span>;    <span class="comment">/* if type == FB_TYPE_INTERLEAVED_PLANES */</span></span><br><span class="line">    fix-&gt;visual = FB_VISUAL_TRUECOLOR;    <span class="comment">/* True Color */</span></span><br><span class="line">    fix-&gt;ywrapstep = <span class="number">0</span>;    <span class="comment">/* No support */</span></span><br><span class="line">    fix-&gt;mmio_start = <span class="number">0</span>;    <span class="comment">/* No MMIO Address */</span></span><br><span class="line">    fix-&gt;mmio_len = <span class="number">0</span>;    <span class="comment">/* No MMIO Address */</span></span><br><span class="line">    fix-&gt;accel = FB_ACCEL_NONE;<span class="comment">/* FB_ACCEL_MSM needes to be added in fb.h */</span></span><br><span class="line"></span><br><span class="line">    var-&gt;xoffset = <span class="number">0</span>,    <span class="comment">/* Offset from virtual to visible */</span></span><br><span class="line">    var-&gt;yoffset = <span class="number">0</span>,    <span class="comment">/* resolution */</span></span><br><span class="line">    var-&gt;grayscale = <span class="number">0</span>,    <span class="comment">/* No graylevels */</span></span><br><span class="line">    var-&gt;nonstd = <span class="number">0</span>,    <span class="comment">/* standard pixel format */</span></span><br><span class="line">    var-&gt;activate = FB_ACTIVATE_VBL,    <span class="comment">/* activate it at vsync */</span></span><br><span class="line">    var-&gt;height = <span class="number">-1</span>,    <span class="comment">/* height of picture in mm */</span></span><br><span class="line">    var-&gt;width = <span class="number">-1</span>,    <span class="comment">/* width of picture in mm */</span></span><br><span class="line">    var-&gt;accel_flags = <span class="number">0</span>,    <span class="comment">/* acceleration flags */</span></span><br><span class="line">    var-&gt;sync = <span class="number">0</span>,    <span class="comment">/* see FB_SYNC_* */</span></span><br><span class="line">    var-&gt;rotate = <span class="number">0</span>,    <span class="comment">/* angle we rotate counter clockwise */</span></span><br><span class="line">    mfd-&gt;op_enable = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (mfd-&gt;fb_imgType) &#123;</span><br><span class="line">    <span class="keyword">case</span> MDP_RGB_565:</span><br><span class="line">        ......</span><br><span class="line">        var-&gt;transp.offset = <span class="number">0</span>;</span><br><span class="line">        var-&gt;transp.length = <span class="number">0</span>;</span><br><span class="line">        bpp = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> MDP_RGB_888:</span><br><span class="line">        ......</span><br><span class="line">        var-&gt;transp.offset = <span class="number">0</span>;</span><br><span class="line">        var-&gt;transp.length = <span class="number">0</span>;</span><br><span class="line">        bpp = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> MDP_ARGB_8888:</span><br><span class="line">        ......</span><br><span class="line">        var-&gt;transp.offset = <span class="number">0</span>;</span><br><span class="line">        var-&gt;transp.length = <span class="number">8</span>;</span><br><span class="line">        bpp = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> MDP_RGBA_8888:</span><br><span class="line">        ......</span><br><span class="line">        var-&gt;transp.offset = <span class="number">24</span>;</span><br><span class="line">        var-&gt;transp.length = <span class="number">8</span>;</span><br><span class="line">        bpp = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> MDP_YCRYCB_H2V1:</span><br><span class="line">        ......</span><br><span class="line">        var-&gt;transp.offset = <span class="number">0</span>;</span><br><span class="line">        var-&gt;transp.length = <span class="number">0</span>;</span><br><span class="line">        bpp = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mdss_panelinfo_to_fb_var(panel_info, var);</span><br><span class="line"></span><br><span class="line">    fix-&gt;type = panel_info-&gt;is_3d_panel;</span><br><span class="line">    <span class="keyword">if</span> (mfd-&gt;mdp.fb_stride)</span><br><span class="line">        fix-&gt;line_length = mfd-&gt;mdp.fb_stride(mfd-&gt;index, var-&gt;xres,</span><br><span class="line">                            bpp);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        fix-&gt;line_length = var-&gt;xres * bpp;</span><br><span class="line"></span><br><span class="line">    var-&gt;xres_virtual = var-&gt;xres;</span><br><span class="line">    var-&gt;yres_virtual = panel_info-&gt;yres * mfd-&gt;fb_page;</span><br><span class="line">    var-&gt;bits_per_pixel = bpp * <span class="number">8</span>;    <span class="comment">/* FrameBuffer color depth */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Populate smem length here for uspace to get the</span></span><br><span class="line"><span class="comment">     * Framebuffer size when FBIO_FSCREENINFO ioctl is called.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    fix-&gt;smem_len = PAGE_ALIGN(fix-&gt;line_length * var-&gt;yres) * mfd-&gt;fb_page;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* id field for fb app  */</span></span><br><span class="line">    id = (<span class="keyword">int</span> *)&amp;mfd-&gt;panel;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">snprintf</span>(fix-&gt;id, <span class="keyword">sizeof</span>(fix-&gt;id), <span class="string">&quot;mdssfb_%x&quot;</span>, (u32) *id);</span><br><span class="line"></span><br><span class="line">    fbi-&gt;fbops = &amp;mdss_fb_ops;</span><br><span class="line">    fbi-&gt;flags = FBINFO_FLAG_DEFAULT;</span><br><span class="line">    fbi-&gt;pseudo_palette = mdss_fb_pseudo_palette;</span><br><span class="line"></span><br><span class="line">    mfd-&gt;ref_cnt = <span class="number">0</span>;</span><br><span class="line">    mfd-&gt;panel_power_state = MDSS_PANEL_POWER_OFF;</span><br><span class="line">    mfd-&gt;dcm_state = DCM_UNINIT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mdss_fb_alloc_fbmem(mfd))</span><br><span class="line">        pr_warn(<span class="string">&quot;unable to allocate fb memory in fb register\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    ret = fb_alloc_cmap(&amp;fbi-&gt;cmap, <span class="number">256</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret)</span><br><span class="line">        pr_err(<span class="string">&quot;fb_alloc_cmap() failed!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (register_framebuffer(fbi) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        fb_dealloc_cmap(&amp;fbi-&gt;cmap);</span><br><span class="line">        mfd-&gt;op_enable = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> -EPERM;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">snprintf</span>(panel_name, ARRAY_SIZE(panel_name), <span class="string">&quot;mdss_panel_fb%d&quot;</span>,</span><br><span class="line">        mfd-&gt;index);</span><br><span class="line">    mdss_panel_debugfs_init(panel_info, panel_name);</span><br><span class="line">    pr_info(<span class="string">&quot;FrameBuffer[%d] %dx%d registered successfully!\n&quot;</span>, mfd-&gt;index,</span><br><span class="line">                    fbi-&gt;var.xres, fbi-&gt;var.yres);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»»ä½•ä¸€ä¸ªç‰¹å®šç¡¬ä»¶Framebufferé©±åŠ¨åœ¨åˆå§‹åŒ–æ—¶éƒ½å¿…é¡»å‘fbmem.cæ³¨å†Œï¼ŒFrameBufferæ¨¡å—æä¾›äº†é©±åŠ¨æ³¨å†Œæ¥å£å‡½æ•°register_framebufferï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\fbdev\core\fbmem.c]</span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">register_framebuffer(struct fb_info *fb_info)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">    mutex_lock(&amp;registration_lock);</span><br><span class="line">    ret = do_register_framebuffer(fb_info);</span><br><span class="line">    mutex_unlock(&amp;registration_lock);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°fb_infoæè¿°ç‰¹å®šç¡¬ä»¶çš„FrameBufferé©±åŠ¨ä¿¡æ¯</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\fbdev\core\fbmem.c]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">do_register_framebuffer</span><span class="params">(struct fb_info *fb_info)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i;  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_event</span> <span class="title">event</span>;</span>  </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fb_videomode</span> <span class="title">mode</span>;</span>  </span><br><span class="line">    <span class="keyword">if</span> (fb_check_foreignness(fb_info))  </span><br><span class="line">        <span class="keyword">return</span> -ENOSYS;  </span><br><span class="line">    <span class="comment">//æ ¹æ®å½“å‰æ³¨å†Œçš„fb_infoçš„apertureså±æ€§ä»FrameBufferé©±åŠ¨æ•°ç»„registered_fbä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨å†²çª  </span></span><br><span class="line">    do_remove_conflicting_framebuffers(fb_info-&gt;apertures, fb_info-&gt;fix.id,  </span><br><span class="line">                     fb_is_primary_device(fb_info));  </span><br><span class="line">    <span class="comment">//åˆ¤æ–­å·²æ³¨å†Œçš„é©±åŠ¨æ˜¯å¦è¶…è¿‡32ä¸ªFrameBufferé©±åŠ¨  </span></span><br><span class="line">    <span class="keyword">if</span> (num_registered_fb == FB_MAX)  </span><br><span class="line">        <span class="keyword">return</span> -ENXIO;  </span><br><span class="line">    <span class="comment">//å¢åŠ å·²æ³¨å†Œçš„é©±åŠ¨ä¸ªæ•°  </span></span><br><span class="line">    num_registered_fb++;  </span><br><span class="line">    <span class="comment">//ä»æ•°ç»„registered_fbä¸­æŸ¥æ‰¾ç©ºé—²å…ƒç´ ï¼Œç”¨äºå­˜å‚¨å½“å‰æ³¨å†Œçš„fb_info  </span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span> ; i &lt; FB_MAX; i++)  </span><br><span class="line">        <span class="keyword">if</span> (!registered_fb[i])  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">    <span class="comment">//å°†å½“å‰æ³¨å†Œçš„fb_infoåœ¨æ•°ç»„registered_fbä¸­çš„ç´¢å¼•ä½ç½®ä¿å­˜åˆ°fb_info-&gt;node  </span></span><br><span class="line">    fb_info-&gt;node = i;  </span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–å½“å‰æ³¨å†Œçš„fb_infoçš„æˆå‘˜ä¿¡æ¯  </span></span><br><span class="line">    atomic_set(&amp;fb_info-&gt;count, <span class="number">1</span>);  </span><br><span class="line">    mutex_init(&amp;fb_info-&gt;lock);  </span><br><span class="line">    mutex_init(&amp;fb_info-&gt;mm_lock);  </span><br><span class="line">    <span class="comment">//åœ¨/devç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªfbxçš„è®¾å¤‡æ–‡ä»¶ï¼Œæ¬¡è®¾å¤‡å·å°±æ˜¯è¯¥fb_infoåœ¨æ•°ç»„registered_fbä¸­çš„ç´¢å¼•  </span></span><br><span class="line">    fb_info-&gt;dev = device_create(fb_class, fb_info-&gt;device,MKDEV(FB_MAJOR, i), <span class="literal">NULL</span>, <span class="string">&quot;fb%d&quot;</span>, i);  </span><br><span class="line">    <span class="keyword">if</span> (IS_ERR(fb_info-&gt;dev)) &#123;  </span><br><span class="line">        printk(KERN_WARNING <span class="string">&quot;Unable to create device for framebuffer %d; errno = %ld\n&quot;</span>, i, PTR_ERR(fb_info-&gt;dev));  </span><br><span class="line">        fb_info-&gt;dev = <span class="literal">NULL</span>;  </span><br><span class="line">    &#125; <span class="keyword">else</span>  </span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–fb_info  </span></span><br><span class="line">        fb_init_device(fb_info);  </span><br><span class="line">    <span class="keyword">if</span> (fb_info-&gt;pixmap.addr == <span class="literal">NULL</span>) &#123;  </span><br><span class="line">        fb_info-&gt;pixmap.addr = kmalloc(FBPIXMAPSIZE, GFP_KERNEL);  </span><br><span class="line">        <span class="keyword">if</span> (fb_info-&gt;pixmap.addr) &#123;  </span><br><span class="line">            fb_info-&gt;pixmap.size = FBPIXMAPSIZE;  </span><br><span class="line">            fb_info-&gt;pixmap.buf_align = <span class="number">1</span>;  </span><br><span class="line">            fb_info-&gt;pixmap.scan_align = <span class="number">1</span>;  </span><br><span class="line">            fb_info-&gt;pixmap.access_align = <span class="number">32</span>;  </span><br><span class="line">            fb_info-&gt;pixmap.flags = FB_PIXMAP_DEFAULT;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;     </span><br><span class="line">    fb_info-&gt;pixmap.offset = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (!fb_info-&gt;pixmap.blit_x)  </span><br><span class="line">        fb_info-&gt;pixmap.blit_x = ~(u32)<span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (!fb_info-&gt;pixmap.blit_y)  </span><br><span class="line">        fb_info-&gt;pixmap.blit_y = ~(u32)<span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (!fb_info-&gt;modelist.prev || !fb_info-&gt;modelist.next)  </span><br><span class="line">        INIT_LIST_HEAD(&amp;fb_info-&gt;modelist);  </span><br><span class="line">    fb_var_to_videomode(&amp;mode, &amp;fb_info-&gt;var);  </span><br><span class="line">    fb_add_videomode(&amp;mode, &amp;fb_info-&gt;modelist);  </span><br><span class="line">    <span class="comment">//å°†ç‰¹å®šç¡¬ä»¶å¯¹åº”çš„fb_infoæ³¨å†Œåˆ°registered_fbæ•°ç»„ä¸­  </span></span><br><span class="line">    registered_fb[i] = fb_info;  </span><br><span class="line">    event.info = fb_info;  </span><br><span class="line">    <span class="keyword">if</span> (!lock_fb_info(fb_info))  </span><br><span class="line">        <span class="keyword">return</span> -ENODEV;  </span><br><span class="line">    <span class="comment">//ä½¿ç”¨Linuxäº‹ä»¶é€šçŸ¥æœºåˆ¶å‘é€ä¸€ä¸ªFrameBufferæ³¨å†Œäº‹ä»¶FB_EVENT_FB_REGISTERED  </span></span><br><span class="line">    fb_notifier_call_chain(FB_EVENT_FB_REGISTERED, &amp;event);  </span><br><span class="line">    unlock_fb_info(fb_info);  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>æ³¨å†Œè¿‡ç¨‹å°±æ˜¯å°†æŒ‡å®šçš„è®¾å¤‡é©±åŠ¨ä¿¡æ¯fb_infoå­˜æ”¾åˆ°registered_fbæ•°ç»„ä¸­ã€‚å› æ­¤åœ¨æ³¨å†Œå…·ä½“çš„fb_infoæ—¶ï¼Œé¦–å…ˆè¦æ„é€ ä¸€ä¸ªfb_infoæ•°æ®ç»“æ„ï¼Œå¹¶åˆå§‹åŒ–è¯¥æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„ç”¨äºæè¿°ä¸€ä¸ªç‰¹å®šçš„FrameBufferé©±åŠ¨ã€‚</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-07-fb-device-create.jpg" alt="Alt text | center"></p>
<h4 id="ï¼ˆä¸‰ï¼‰ã€MDP-driver"><a href="#ï¼ˆä¸‰ï¼‰ã€MDP-driver" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€MDP driver"></a>ï¼ˆä¸‰ï¼‰ã€MDP driver</h4><p>MDPä¹Ÿè¢«æ³¨å†Œä¸ºå¹³å°é©±åŠ¨ç¨‹åºã€‚ mdp3_driver_initæ‰§è¡Œé©±åŠ¨ç¨‹åºinitã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\msm\mdss\mdp3.c]</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">mdp3_driver</span> = &#123;</span></span><br><span class="line">    .probe = mdp3_probe,</span><br><span class="line">    .remove = mdp3_remove,</span><br><span class="line">    .suspend = mdp3_suspend,</span><br><span class="line">    .resume = mdp3_resume,</span><br><span class="line">    .shutdown = <span class="literal">NULL</span>,</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = <span class="string">&quot;mdp3&quot;</span>,</span><br><span class="line">        .of_match_table = mdp3_dt_match,</span><br><span class="line">        .pm             = &amp;mdp3_pm_ops,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">mdp3_driver_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">    ret = platform_driver_register(&amp;mdp3_driver);</span><br><span class="line">    <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;register mdp3 driver failed!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">mdp3_probe</span><span class="params">(struct platform_device *pdev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rc;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">msm_mdp_interface</span> <span class="title">mdp3_interface</span> = &#123;</span></span><br><span class="line">    .init_fnc = mdp3_init,</span><br><span class="line">    .fb_mem_get_iommu_domain = mdp3_fb_mem_get_iommu_domain,</span><br><span class="line">    .panel_register_done = mdp3_panel_register_done,</span><br><span class="line">    .fb_stride = mdp3_fb_stride,</span><br><span class="line">    .check_dsi_status = mdp3_check_dsi_ctrl_status,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mdp3_intr_cb</span> <span class="title">underrun_cb</span> = &#123;</span></span><br><span class="line">        .cb = mdp3_dma_underrun_intr_handler,</span><br><span class="line">        .data = <span class="literal">NULL</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    pr_debug(<span class="string">&quot;%s: START\n&quot;</span>, __func__);</span><br><span class="line">    <span class="keyword">if</span> (!pdev-&gt;dev.of_node) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;MDP driver only supports device tree probe\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> -ENOTSUPP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mdp3_res) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;MDP already initialized\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> -EINVAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mdp3_res = devm_kzalloc(&amp;pdev-&gt;dev, <span class="keyword">sizeof</span>(struct mdp3_hw_resource),</span><br><span class="line">                GFP_KERNEL);</span><br><span class="line">    <span class="keyword">if</span> (mdp3_res == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> -ENOMEM;</span><br><span class="line"></span><br><span class="line">    pdev-&gt;id = <span class="number">0</span>;</span><br><span class="line">    mdp3_res-&gt;pdev = pdev;</span><br><span class="line">    mutex_init(&amp;mdp3_res-&gt;res_mutex);</span><br><span class="line">    spin_lock_init(&amp;mdp3_res-&gt;irq_lock);</span><br><span class="line">    platform_set_drvdata(pdev, mdp3_res);</span><br><span class="line">    atomic_set(&amp;mdp3_res-&gt;active_intf_cnt, <span class="number">0</span>);</span><br><span class="line">    mutex_init(&amp;mdp3_res-&gt;reg_bus_lock);</span><br><span class="line">    INIT_LIST_HEAD(&amp;mdp3_res-&gt;reg_bus_clist);</span><br><span class="line"></span><br><span class="line">    mdp3_res-&gt;mdss_util = mdss_get_util_intf();</span><br><span class="line">    <span class="keyword">if</span> (mdp3_res-&gt;mdss_util == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;Failed to get mdss utility functions\n&quot;</span>);</span><br><span class="line">        rc =  -ENODEV;</span><br><span class="line">        <span class="keyword">goto</span> get_util_fail;</span><br><span class="line">    &#125;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;get_iommu_domain = mdp3_get_iommu_domain;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;iommu_attached = is_mdss_iommu_attached;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;iommu_ctrl = mdp3_iommu_ctrl;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;bus_scale_set_quota = mdp3_bus_scale_set_quota;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;panel_intf_type = mdp3_panel_intf_type;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;dyn_clk_gating_ctrl =</span><br><span class="line">        mdp3_dynamic_clock_gating_ctrl;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;panel_intf_type = mdp3_panel_intf_type;</span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;panel_intf_status = mdp3_panel_get_intf_status;</span><br><span class="line">    rc = mdp3_parse_dt(pdev);</span><br><span class="line">    <span class="keyword">if</span> (rc)</span><br><span class="line">        <span class="keyword">goto</span> probe_done;</span><br><span class="line"></span><br><span class="line">    rc = mdp3_res_init();</span><br><span class="line">    <span class="keyword">if</span> (rc) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;unable to initialize mdp3 resources\n&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> probe_done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mdp3_res-&gt;fs_ena = <span class="literal">false</span>;</span><br><span class="line">    mdp3_res-&gt;fs = devm_regulator_get(&amp;pdev-&gt;dev, <span class="string">&quot;vdd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (IS_ERR_OR_NULL(mdp3_res-&gt;fs)) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;unable to get mdss gdsc regulator\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> -EINVAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rc = mdp3_debug_init(pdev);</span><br><span class="line">    <span class="keyword">if</span> (rc) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;unable to initialize mdp debugging\n&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> probe_done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pm_runtime_set_autosuspend_delay(&amp;pdev-&gt;dev, AUTOSUSPEND_TIMEOUT_MS);</span><br><span class="line">    <span class="keyword">if</span> (mdp3_res-&gt;idle_pc_enabled) &#123;</span><br><span class="line">        pr_debug(<span class="string">&quot;%s: Enabling autosuspend\n&quot;</span>, __func__);</span><br><span class="line">        pm_runtime_use_autosuspend(&amp;pdev-&gt;dev);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Enable PM runtime */</span></span><br><span class="line">    pm_runtime_set_suspended(&amp;pdev-&gt;dev);</span><br><span class="line">    pm_runtime_enable(&amp;pdev-&gt;dev);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!pm_runtime_enabled(&amp;pdev-&gt;dev)) &#123;</span><br><span class="line">        rc = mdp3_footswitch_ctrl(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (rc) &#123;</span><br><span class="line">            pr_err(<span class="string">&quot;unable to turn on FS\n&quot;</span>);</span><br><span class="line">            <span class="keyword">goto</span> probe_done;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rc = mdp3_check_version();</span><br><span class="line">    <span class="keyword">if</span> (rc) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;mdp3 check version failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> probe_done;</span><br><span class="line">    &#125;</span><br><span class="line">    rc = mdp3_register_sysfs(pdev);</span><br><span class="line">    <span class="keyword">if</span> (rc)</span><br><span class="line">        pr_err(<span class="string">&quot;unable to register mdp sysfs nodes\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    rc = mdss_fb_register_mdp_instance(&amp;mdp3_interface);</span><br><span class="line">    <span class="keyword">if</span> (rc)</span><br><span class="line">        pr_err(<span class="string">&quot;unable to register mdp instance\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    rc = mdp3_set_intr_callback(MDP3_INTR_LCDC_UNDERFLOW,</span><br><span class="line">                    &amp;underrun_cb);</span><br><span class="line">    <span class="keyword">if</span> (rc)</span><br><span class="line">        pr_err(<span class="string">&quot;unable to configure interrupt callback\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    rc = mdss_smmu_init(mdss_res, &amp;pdev-&gt;dev);</span><br><span class="line">    <span class="keyword">if</span> (rc)</span><br><span class="line">        pr_err(<span class="string">&quot;mdss smmu init failed\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mdp3_res-&gt;mdss_util-&gt;mdp_probe_done = <span class="literal">true</span>;</span><br><span class="line">    pr_debug(<span class="string">&quot;%s: END\n&quot;</span>, __func__);</span><br><span class="line">    <span class="keyword">return</span> rc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†…æ ¸è°ƒç”¨MDPæ¢æµ‹å‡½æ•°mdp3_probeã€‚ åœ¨æ¢æµ‹å™¨ä¸Šï¼Œé©±åŠ¨ç¨‹åºä»è®¾å¤‡æ ‘ä¸­è·å–é¢æ¿ä¿¡æ¯ï¼Œå¹¶é€šè¿‡è°ƒç”¨mdp3_parse_dtæ¥è§£æä¿¡æ¯ã€‚ åœ¨mdp3_ctrl_onæœŸé—´ï¼ŒMDPé©±åŠ¨ç¨‹åºè°ƒç”¨mdp3_ctrl_res_req_clkå¹¶è¯·æ±‚MDPå’ŒVsyncæ—¶é’Ÿã€‚ åœ¨mdp3_ctrl_offæœŸé—´ï¼Œé©±åŠ¨ç¨‹åºè¯·æ±‚å…³é—­MDPå’ŒVsyncæ—¶é’Ÿã€‚</p>
<h4 id="ï¼ˆå››ï¼‰ã€DSI-controller-driver-ï¼ˆlcdé©±åŠ¨-dsiï¼‰"><a href="#ï¼ˆå››ï¼‰ã€DSI-controller-driver-ï¼ˆlcdé©±åŠ¨-dsiï¼‰" class="headerlink" title="ï¼ˆå››ï¼‰ã€DSI controller driver ï¼ˆlcdé©±åŠ¨ dsiï¼‰"></a>ï¼ˆå››ï¼‰ã€DSI controller driver ï¼ˆlcdé©±åŠ¨ dsiï¼‰</h4><p>msm_dsi_v2_driver_initæ‰§è¡Œé©±åŠ¨ç¨‹åºåˆå§‹åŒ–ã€‚ msm_dsi_v2_driver_initè°ƒç”¨ msm_dsi_v2_register_driveræ³¨å†Œé©±åŠ¨ç¨‹åºã€‚<br>æ€»ä½“æ—¶åºå›¾ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-08-dsi-host-v2.png" alt="Alt text | center"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\msm\mdss\dsi_host_v2.c]</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">msm_dsi_v2_driver</span> = &#123;</span></span><br><span class="line">    .probe = msm_dsi_probe,</span><br><span class="line">    .remove = msm_dsi_remove,</span><br><span class="line">    .shutdown = <span class="literal">NULL</span>,</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = <span class="string">&quot;msm_dsi_v2&quot;</span>,</span><br><span class="line">        .of_match_table = msm_dsi_v2_dt_match,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">msm_dsi_v2_register_driver</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> platform_driver_register(&amp;msm_dsi_v2_driver);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">msm_dsi_probe</span><span class="params">(struct platform_device *pdev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dsi_interface</span> <span class="title">intf</span>;</span></span><br><span class="line">    <span class="keyword">char</span> panel_cfg[MDSS_MAX_PANEL_LEN];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mdss_dsi_ctrl_pdata</span> *<span class="title">ctrl_pdata</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="keyword">int</span> rc = <span class="number">0</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">dsi_pan_node</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="keyword">bool</span> cmd_cfg_cont_splash = <span class="literal">false</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">mdss_dsi_mres</span>;</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    pr_debug(<span class="string">&quot;%s\n&quot;</span>, __func__);</span><br><span class="line"></span><br><span class="line">    rc = msm_dsi_init();</span><br><span class="line"></span><br><span class="line">    pdev-&gt;id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    ctrl_pdata = platform_get_drvdata(pdev);</span><br><span class="line">    <span class="keyword">if</span> (!ctrl_pdata) &#123;</span><br><span class="line">        ctrl_pdata = devm_kzalloc(&amp;pdev-&gt;dev,</span><br><span class="line">            <span class="keyword">sizeof</span>(struct mdss_dsi_ctrl_pdata), GFP_KERNEL);</span><br><span class="line">        platform_set_drvdata(pdev, ctrl_pdata);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctrl_pdata-&gt;mdss_util = mdss_get_util_intf();</span><br><span class="line">    <span class="keyword">if</span> (mdp3_res-&gt;mdss_util == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        pr_err(<span class="string">&quot;Failed to get mdss utility functions\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> -ENODEV;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mdss_dsi_mres = platform_get_resource(pdev, IORESOURCE_MEM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (!mdss_dsi_mres) &#123;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dsi_host_private-&gt;dsi_reg_size = resource_size(mdss_dsi_mres);</span><br><span class="line">        dsi_host_private-&gt;dsi_base = ioremap(mdss_dsi_mres-&gt;start,</span><br><span class="line">                        dsi_host_private-&gt;dsi_reg_size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mdss_dsi_mres = platform_get_resource(pdev, IORESOURCE_IRQ, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    rc = of_platform_populate(pdev-&gt;dev.of_node, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;pdev-&gt;dev);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* DSI panels can be different between controllers */</span></span><br><span class="line">    rc = dsi_get_panel_cfg(panel_cfg);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* find panel device node */</span></span><br><span class="line">    dsi_pan_node = dsi_find_panel_of_node(pdev, panel_cfg);</span><br><span class="line">    </span><br><span class="line">    cmd_cfg_cont_splash = mdp3_panel_get_boot_cfg() ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    rc = mdss_dsi_panel_init(dsi_pan_node, ctrl_pdata, cmd_cfg_cont_splash);</span><br><span class="line">    </span><br><span class="line">    rc = dsi_ctrl_config_init(pdev, ctrl_pdata);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    msm_dsi_parse_lane_swap(pdev-&gt;dev.of_node, &amp;(ctrl_pdata-&gt;dlane_swap));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;  i &lt; DSI_MAX_PM; i++) &#123;</span><br><span class="line">        rc = msm_dsi_io_init(pdev, &amp;(ctrl_pdata-&gt;power_data[i]));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pr_debug(<span class="string">&quot;%s: Dsi Ctrl-&gt;0 initialized\n&quot;</span>, __func__);</span><br><span class="line"></span><br><span class="line">    dsi_host_private-&gt;dis_dev = pdev-&gt;dev;</span><br><span class="line">    intf.on = msm_dsi_on;</span><br><span class="line">    intf.off = msm_dsi_off;</span><br><span class="line">    intf.cont_on = msm_dsi_cont_on;</span><br><span class="line">    intf.clk_ctrl = msm_dsi_clk_ctrl;</span><br><span class="line">    intf.op_mode_config = msm_dsi_op_mode_config;</span><br><span class="line">    intf.index = <span class="number">0</span>;</span><br><span class="line">    intf.<span class="keyword">private</span> = <span class="literal">NULL</span>;</span><br><span class="line">    dsi_register_interface(&amp;intf);</span><br><span class="line"></span><br><span class="line">    msm_dsi_debug_init();</span><br><span class="line"></span><br><span class="line">    msm_dsi_ctrl_init(ctrl_pdata);</span><br><span class="line"></span><br><span class="line">    rc = msm_dsi_irq_init(&amp;pdev-&gt;dev, mdss_dsi_mres-&gt;start,</span><br><span class="line">                       ctrl_pdata);</span><br><span class="line">    </span><br><span class="line">    rc = dsi_panel_device_register_v2(pdev, ctrl_pdata);</span><br><span class="line">    </span><br><span class="line">    pr_debug(<span class="string">&quot;%s success\n&quot;</span>, __func__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†…æ ¸è°ƒç”¨msm_dsi_probeã€‚ é¢æ¿è¢«æ£€æµ‹åˆ°ã€‚ msm_dsi_probeè°ƒç”¨mdss_dsi_panel_initå‡½æ•°ã€‚ mdss_dsi_panel_initè°ƒç”¨mdss_panel_parse_dtæ¥è·å–é¢æ¿å‚æ•°ã€‚<br>MDPé©±åŠ¨ç¨‹åºä½¿ç”¨è¯¥äº‹ä»¶ä¸DSIé©±åŠ¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ DSIé©±åŠ¨ç¨‹åºå…·æœ‰mdss_dsi_event_handlerï¼Œè¿™æ˜¯MDPæ ¸å¿ƒäº‹ä»¶çš„å›è°ƒå¤„ç†ç¨‹åºã€‚ mdss_panel.hå®šä¹‰äº†MDPæ ¸å¿ƒäº‹ä»¶ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[-&gt;\drivers\video\msm\mdss\mdss_panel.h]</span><br><span class="line"><span class="keyword">enum</span> mdss_intf_events &#123;</span><br><span class="line">    MDSS_EVENT_RESET = <span class="number">1</span>,</span><br><span class="line">    MDSS_EVENT_LINK_READY,</span><br><span class="line">    MDSS_EVENT_UNBLANK,</span><br><span class="line">    MDSS_EVENT_PANEL_ON,</span><br><span class="line">    MDSS_EVENT_POST_PANEL_ON,</span><br><span class="line">    MDSS_EVENT_BLANK,</span><br><span class="line">    MDSS_EVENT_PANEL_OFF,</span><br><span class="line">    MDSS_EVENT_CLOSE,</span><br><span class="line">    MDSS_EVENT_SUSPEND,</span><br><span class="line">    MDSS_EVENT_RESUME,</span><br><span class="line">    MDSS_EVENT_CHECK_PARAMS,</span><br><span class="line">    MDSS_EVENT_CONT_SPLASH_BEGIN,</span><br><span class="line">    MDSS_EVENT_CONT_SPLASH_FINISH,</span><br><span class="line">    MDSS_EVENT_PANEL_UPDATE_FPS,</span><br><span class="line">    MDSS_EVENT_FB_REGISTERED,</span><br><span class="line">    MDSS_EVENT_PANEL_CLK_CTRL,</span><br><span class="line">    MDSS_EVENT_DSI_CMDLIST_KOFF,</span><br><span class="line">    MDSS_EVENT_ENABLE_PARTIAL_ROI,</span><br><span class="line">    MDSS_EVENT_DSC_PPS_SEND,</span><br><span class="line">    MDSS_EVENT_DSI_STREAM_SIZE,</span><br><span class="line">    MDSS_EVENT_DSI_UPDATE_PANEL_DATA,</span><br><span class="line">    MDSS_EVENT_REGISTER_RECOVERY_HANDLER,</span><br><span class="line">    MDSS_EVENT_REGISTER_MDP_CALLBACK,</span><br><span class="line">    MDSS_EVENT_DSI_PANEL_STATUS,</span><br><span class="line">    MDSS_EVENT_DSI_DYNAMIC_SWITCH,</span><br><span class="line">    MDSS_EVENT_DSI_RECONFIG_CMD,</span><br><span class="line">    MDSS_EVENT_DSI_RESET_WRITE_PTR,</span><br><span class="line">    MDSS_EVENT_PANEL_TIMING_SWITCH,</span><br><span class="line">    MDSS_EVENT_MAX,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨msm_dsi_onæœŸé—´ï¼Œé€šè¿‡è°ƒç”¨msm_dsi_clk_enableæ‰“å¼€DSIæ—¶é’Ÿã€‚ åœ¨msm_dsi_offæœŸé—´ï¼Œé€šè¿‡è°ƒç”¨msm_dsi_clk_disableå…³é—­clksã€‚</p>
<h4 id="ï¼ˆäº”ï¼‰ã€-Panel-driver-ï¼ˆé¢æ¿-dsiï¼‰"><a href="#ï¼ˆäº”ï¼‰ã€-Panel-driver-ï¼ˆé¢æ¿-dsiï¼‰" class="headerlink" title="ï¼ˆäº”ï¼‰ã€ Panel driver ï¼ˆé¢æ¿ dsiï¼‰"></a>ï¼ˆäº”ï¼‰ã€ Panel driver ï¼ˆé¢æ¿ dsiï¼‰</h4><p>MDSS : Multimedia Display sub system<br>DSI: Display Serial Interface</p>
<blockquote>
<p>qcom,mdss-dsi-force-clock-lane-hs;          // faulse ï¼šclockæ¯å¸§å›lp11<br>ture: clockä¸å› qcom,mdss-dsi-hfp-power-mode;               // data æ¯è¡Œå›lp11,å¯¹åº”çš„hfpè¦ä¿®æ”¹æˆ300ä»¥ä¸Š</p>
</blockquote>
<p>é¢æ¿ä¿¡æ¯ä½äºkernel\arch\arm\boot\dts\ä¸­çš„.dtsiæ–‡ä»¶ä¸­ã€‚ è¿™åŒ…å«æ‰€æœ‰é¢æ¿ç‰¹å®šçš„å‘½ä»¤ï¼Œä¾‹å¦‚onï¼Œoffå’Œresetï¼ˆmdss-dsi-on-commandï¼Œmdss-dsi-off-commandï¼Œmdss-dsi-reset-sequenceï¼‰ï¼ŒBLæ§åˆ¶å’Œå…¶ä»–é¢æ¿ ç‹¬ç«‹å‚æ•°ã€‚<br>ä¾‹å¦‚ï¼š<br>msm8610-mdss.dtsi ï¼ˆæ–‡ä»¶åé€šå¸¸ä¸º msmxxx-mdss.dtsi æŒ‡å®šäº†mdss çš„ mdp å’Œ dsiï¼‰</p>
<h5 id="5-1ã€-dtsiæ–‡ä»¶è§£æ"><a href="#5-1ã€-dtsiæ–‡ä»¶è§£æ" class="headerlink" title="5.1ã€.dtsiæ–‡ä»¶è§£æ"></a>5.1ã€.dtsiæ–‡ä»¶è§£æ</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mdss_mdp: qcom,mdss_mdp@fd900000 &#123;</span><br><span class="line">            compatible = <span class="string">&quot;qcom,mdss_mdp3&quot;</span>;  <span class="comment">// å¯¹åº”mdssé©±åŠ¨ mdss_mdp.c</span></span><br><span class="line">----------</span><br><span class="line">  mdss_dsi0: qcom,mdss_dsi@fdd00000 &#123;</span><br><span class="line">        compatible = <span class="string">&quot;qcom,msm-dsi-v2&quot;</span>;      <span class="comment">// å¯¹åº”dsiè§£æé©±åŠ¨ dsi_host_v2.c</span></span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">  mdss_dsi0: qcom,mdss_dsi_ctrl0@<span class="number">1</span>a94000 &#123;</span><br><span class="line">        compatible = <span class="string">&quot;qcom,mdss-dsi-ctrl&quot;</span>;  <span class="comment">// å¯¹åº”dsiè§£æé©±åŠ¨ mdss_dsi.c</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸‹é¢å‡½æ•°å‘ mdss_fb.c æ³¨å†Œäº†fb_infoç»“æ„  (åŒ…å«åœ¨mdss_dsi_ctrl_pdataç»“æ„ä¸­)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drivers\video\msm\mdss\dsi_host_v2.c ï¼ˆlcdé©±åŠ¨ dsiï¼‰</span><br><span class="line">dsi_panel_device_register_v2(struct platform_device *dev,struct mdss_dsi_ctrl_pdata *ctrl_pdata)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">msm_dsi_v2_dt_match</span>[] = &#123;</span></span><br><span class="line">    &#123;.compatible = <span class="string">&quot;qcom,msm-dsi-v2&quot;</span>&#125;,</span><br><span class="line">    &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">æˆ–è€… </span><br><span class="line">drivers\video\msm\mdss\mdss_dsi.c</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>msm8610-asus.dts ï¼ˆæŒ‡å®šmdpä¸­çš„å“ªä¸€ä¸ªé…ç½®ï¼‰<br>é€šå¸¸åœ¨dtsæ–‡ä»¶çš„ mdss_dsi0 labé‡Œé¢é€šè¿‡ qcom,dsi-pref-prim-pan å±æ€§ æŒ‡å®šä½¿ç”¨å“ªä¸€ä¸ªlcdé…ç½®</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;mdss_dsi0 &#123;</span><br><span class="line">        qcom,dsi-pref-prim-pan = &lt;&amp;dsi_fl10802_fwvga_vid&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>dsi-panel-fl10802-fwvga-video.dtsi</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&amp;mdss_mdp &#123;</span><br><span class="line">    dsi_fl10802_fwvga_vid: qcom,mdss_dsi_fl10802_fwvga_video &#123;</span><br><span class="line">        qcom,mdss-dsi-panel-name = <span class="string">&quot;fl10802 fwvga video mode dsi panel&quot;</span>;</span><br><span class="line">        qcom,mdss-dsi-drive-ic = <span class="string">&quot;fl10802&quot;</span>;</span><br><span class="line">        qcom,mdss-dsi-panel-controller = &lt;&amp;mdss_dsi0&gt;;</span><br><span class="line">        qcom,mdss-dsi-panel-type = <span class="string">&quot;dsi_video_mode&quot;</span>;</span><br><span class="line">        qcom,mdss-dsi-panel-destination = <span class="string">&quot;display_1&quot;</span>;</span><br><span class="line">        ...</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>


<h5 id="5-2ã€mdss-mdp-å’Œ-mdss-dsi0-çš„å…³ç³»"><a href="#5-2ã€mdss-mdp-å’Œ-mdss-dsi0-çš„å…³ç³»" class="headerlink" title="5.2ã€mdss_mdp å’Œ mdss_dsi0 çš„å…³ç³»"></a>5.2ã€mdss_mdp å’Œ mdss_dsi0 çš„å…³ç³»</h5><p>mdss_mdp ç›¸å½“äºä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å®šä¹‰äº†å¾ˆå¤šä¸åŒlcdæ˜¾ç¤ºå±çš„é…ç½®é¡¹åŒ…æ‹¬åˆ†è¾¨ç‡ç­‰ç­‰</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-09-mdss_mdp-mdss_dsi0.jpg" alt="Alt text | center"></p>
<p>é¢æ¿é©±åŠ¨ç¨‹åºå¯ä»¥æ ¹æ®è¿æ¥çš„å®é™…é¢æ¿æ•°é‡å…·æœ‰å¤šä¸ªèŠ‚ç‚¹ã€‚<br>mdss_register_panelæ³¨å†Œé¢æ¿é©±åŠ¨ç¨‹åºï¼š<br>msm_dsi_probeâ†’dsi_panel_device_register_v2â†’mdss_register_panelâ†’<br>of_platform_device_create<br>ä»¥ä¸‹é¢æ¿æ§åˆ¶åŠŸèƒ½å¯ç”¨å¹¶åœ¨mdss_dsi_panel_initä¸­åˆå§‹åŒ–ï¼š<br>ctrl_pdataâ†’on = mdss_dsi_panel_on;<br>ctrl_pdataâ†’off = mdss_dsi_panel_off;<br>ctrl_pdataâ†’panel_data.set_backlight = mdss_dsi_panel_bl_ctrl;<br>  ä¾‹å¦‚ï¼Œåœ¨mdp3_ctrl.cä¸­ï¼Œå‡½æ•°mdp3_ctrl_onï¼ˆï¼‰ä¼šè°ƒç”¨ä»¥ä¸‹DSIå¤„ç†ç¨‹åº<br>MDSS_EVENT_UNBLANKå’ŒMDSS_EVENT_PANEL_ONäº‹ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š<br>rc = panelâ†’event_handlerï¼ˆpanelï¼ŒMDSS_EVENT_UNBLANKï¼ŒNULLï¼‰;<br>rc | =é¢æ¿â†’event_handlerï¼ˆé¢æ¿ï¼ŒMDSS_EVENT_PANEL_ONï¼ŒNULLï¼‰;</p>
<h5 id="5-3ã€é€šè¿‡å†…æ ¸æ¥å£æ‰“å¼€å’Œå…³é—­æ˜¾ç¤ºå™¨"><a href="#5-3ã€é€šè¿‡å†…æ ¸æ¥å£æ‰“å¼€å’Œå…³é—­æ˜¾ç¤ºå™¨" class="headerlink" title="5.3ã€é€šè¿‡å†…æ ¸æ¥å£æ‰“å¼€å’Œå…³é—­æ˜¾ç¤ºå™¨"></a>5.3ã€é€šè¿‡å†…æ ¸æ¥å£æ‰“å¼€å’Œå…³é—­æ˜¾ç¤ºå™¨</h5><h5 id="5-3-1ã€å¯åŠ¨"><a href="#5-3-1ã€å¯åŠ¨" class="headerlink" title="5.3.1ã€å¯åŠ¨"></a>5.3.1ã€å¯åŠ¨</h5><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-10-display-subsystem-on-bootup.png" alt="Alt text | center"></p>
<p>æŒ‰ç…§ä¸Šé¢çš„éƒ¨åˆ†æ‰€è¿°æ³¨å†Œè®¾å¤‡åï¼š<br>mdss_fb_openâ†’mdss_fb_blank_subâ†’pdataâ†’onï¼ˆé¢æ¿ONåŠŸèƒ½ï¼‰<br>æ³¨æ„ï¼šå¯¹äºå‘½ä»¤æ¨¡å¼é¢æ¿ï¼Œå¦‚æœé¢æ¿åœ¨å¯åŠ¨æ—¶å·²æ‰“å¼€ï¼Œåˆ™ä¼šè·³è¿‡è¯¥å¯åŠ¨åºåˆ— ä»¥é¿å…å…³é—­/ -onçš„æ–‡ç‰©ã€‚</p>
<h5 id="5-3-2ã€æš‚åœ-æ¢å¤"><a href="#5-3-2ã€æš‚åœ-æ¢å¤" class="headerlink" title="5.3.2ã€æš‚åœ/æ¢å¤"></a>5.3.2ã€æš‚åœ/æ¢å¤</h5><p>æŒ‚èµ·/æ¢å¤æ—¶ï¼Œè°ƒç”¨fbé©±åŠ¨ç¨‹åºæŒ‚èµ·/æ¢å¤å’ŒMDPé©±åŠ¨ç¨‹åºæŒ‚èµ·/æ¢å¤ã€‚ fbé©±åŠ¨ç¨‹åºä¾æ¬¡è°ƒç”¨é¢æ¿é©±åŠ¨ç¨‹åºçš„å¼€/å…³åŠŸèƒ½ã€‚</p>
<h5 id="5-3-2-1ã€æš‚åœåºåˆ—"><a href="#5-3-2-1ã€æš‚åœåºåˆ—" class="headerlink" title="5.3.2.1ã€æš‚åœåºåˆ—"></a>5.3.2.1ã€æš‚åœåºåˆ—</h5><p>![Alt text | center](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-11-suspend">https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-11-suspend</a> sequence.png)</p>
<p>Kernelcallâ†’mdss_fb_release_allâ†’mdss_fb_blankâ†’mdss_fb_blank_subâ†’mdp3_ctrl_offâ†’<br>mdp3_ctrl_offå‘é€ä¸¤ä¸ªäº‹ä»¶ï¼š</p>
<ol>
<li>MDSS_EVENT_PANEL_OFF - dsi_event_handleræ¥æ”¶äº‹ä»¶ã€‚ å½“äº‹ä»¶å‘ç”Ÿæ—¶<br> æ¥æ”¶åˆ°æ—¶ï¼Œè°ƒç”¨å°ç»„å…³é—­åºåˆ—ã€‚</li>
<li>MDSS_EVENT_BLANK - è¯¥äº‹ä»¶ç”±è°ƒç”¨çš„dsi_event_handlerå¤„ç†<br>mdss_dsi_offã€‚</li>
</ol>
<ul>
<li>Kernelcallâ†’mdp3_suspend - æœªä½¿ç”¨<h5 id="5-3-2-2ã€æ¢å¤åºåˆ—"><a href="#5-3-2-2ã€æ¢å¤åºåˆ—" class="headerlink" title="5.3.2.2ã€æ¢å¤åºåˆ—"></a>5.3.2.2ã€æ¢å¤åºåˆ—</h5></li>
</ul>
<p>![Alt text | center](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-12-resume">https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-12-resume</a> sequence.png)</p>
<p>Kernelcallâ†’mdss_fb_blankâ†’mdss_fb_blank_subâ†’mdp3_ctrl_onâ†’<br>mdp3_ctrl_onå‘é€ä¸¤ä¸ªäº‹ä»¶ï¼š</p>
<ol>
<li>MDSS_EVENT_UNBLANK - dsi_event_handleræ¥æ”¶äº‹ä»¶ã€‚ å½“äº‹ä»¶å‘ç”Ÿæ—¶<br>æ”¶åˆ°ï¼ŒDSI-onè¢«è°ƒç”¨ã€‚</li>
<li>MDSS_EVENT_PANEL_ON - äº‹ä»¶ç”±dsi_event_handlerå¤„ç†ï¼Œdsi_event_handlerå‘é€<br>é¢æ¿ä¸Šçš„åºåˆ—ã€‚<br>Kernelcallâ†’mdp3_resume - æœªä½¿ç”¨</li>
</ol>
<h5 id="5-4ã€å›¾åƒæ›´æ–°åˆ°é¢æ¿"><a href="#5-4ã€å›¾åƒæ›´æ–°åˆ°é¢æ¿" class="headerlink" title="5.4ã€å›¾åƒæ›´æ–°åˆ°é¢æ¿"></a>5.4ã€å›¾åƒæ›´æ–°åˆ°é¢æ¿</h5><p>![Alt text | center](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-13-flow">https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/display.system/DS05-13-flow</a> for display subsystem commit.png)</p>
<p> ç”¨æˆ·å¿…é¡»ç¡®ä¿MSMFB_OVERLAY_SET IOCTLåœ¨å‘¼å«ä¹‹å‰è‡³å°‘è¢«è°ƒç”¨ä¸€æ¬¡ åˆ°MSMFB_OVERLAY_PLAY IOCLTï¼ˆä¾‹å¦‚ioctl(fd, MSMFB_OVERLAY_PLAY, &amp;od)ï¼‰ã€‚MSMFB_OVERLAY_PLAYé˜Ÿåˆ—ç¼“å†²åŒº æ˜¾ç¤ºåœ¨é¢æ¿ä¸Šã€‚ ç”¨æˆ·ä½¿ç”¨MSMFB_DISPLAY_COMMITè°ƒç”¨fb IOCLTã€‚è¿™ä¼šå¯åŠ¨ä¸€ä¸ªå‘¼å«<br> mdss_fb_display_commit å¹¶å®‰æ’å·¥ä½œé˜Ÿåˆ—ã€‚æ­¤å·¥ä½œé˜Ÿåˆ—å¤„ç†ç¨‹åºè°ƒç”¨<br> msm_fb_pan_display_exï¼Œç„¶åè°ƒç”¨mdp3_ctrl_pan_displayã€‚<br> mdss_fb_ioctlâ†’ï¼ˆMSMFB_DISPLAY_COMMITï¼‰â†’mdss_fb_display_commitâ†’<br> mdss_fb_pan_display_exâ†’è®¡åˆ’å·¥ä½œmdss_fb_commit_wq_handler<br> msm_fb_commit_wq_handlerâ†’mdp3_ctrl_display_commit_kickoffâ†’mdp3_dmap_update<br>ä¸€æ¬¡å‘¼å«åï¼Œå¯ä»¥æœ‰å¤šä¸ªå¯¹PLAYå’ŒCOMMIT IOCLTçš„å‘¼å« MSMFB_OVERLAY_SET IOCTLã€‚é¢æ¿æ›´æ–°å®Œæˆå¹¶ä¸”è®¾å¤‡å®Œæˆå<br>éœ€è¦è¿›å…¥æŒ‚èµ·æˆ–å…³é—­çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨MSMFB_OVERLAY_UNSETã€‚</p>
<p>æ³¨æ„ï¼šå·¥ä½œé˜Ÿåˆ—æ¶æ„æ­£åœ¨è¢«å³å°†å‘å¸ƒçš„çº¿ç¨‹å–ä»£ï¼Œ<br>è¿™äº›æ–‡ä»¶æœªè¢«æ•è·ã€‚è§†é¢‘å’Œå‘½ä»¤æ¨¡å¼é¢æ¿çš„é¢æ¿æ›´æ–°ç•¥æœ‰ä¸åŒã€‚ä¸ºäº†åœ¨å‘½ä»¤æ¨¡å¼é¢æ¿ä¸­ï¼Œmdp3_dmap_updateå‡½æ•°ä¼šç­‰å¾…ï¼Œç›´åˆ°å‰ä¸€ä¸ªå›¾åƒæ›´æ–°ä¸ºæ­¢å®Œæˆä½¿ç”¨MDP DMAå¼€å§‹æ–°å¸§æ›´æ–°</p>
<p>ifï¼ˆdma-&gt; output_config.out_sel == MDP3_DMA_OUTPUT_SEL_DSI_CMDï¼‰{<br>cb_type = MDP3_DMA_CALLBACK_TYPE_DMA_DONE;<br>å¦‚æœï¼ˆintf-&gt; activeï¼‰<br>wait_for_completion_killableï¼ˆDMA-&gt; dma_compï¼‰;</p>
<p>å¯¹äºè§†é¢‘é¢æ¿ï¼Œåœ¨DMAè§¦å‘åï¼Œmdp3_dmap_updateç­‰å¾…vsyncã€‚</p>
<h4 id="ï¼ˆå…­ï¼‰ã€Msm8610-lcd-driver-å†…æ ¸åˆå§‹åŒ–åˆ†æ"><a href="#ï¼ˆå…­ï¼‰ã€Msm8610-lcd-driver-å†…æ ¸åˆå§‹åŒ–åˆ†æ" class="headerlink" title="ï¼ˆå…­ï¼‰ã€Msm8610  lcd driver å†…æ ¸åˆå§‹åŒ–åˆ†æ"></a>ï¼ˆå…­ï¼‰ã€Msm8610  lcd driver å†…æ ¸åˆå§‹åŒ–åˆ†æ</h4><p>è¯·å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.csdn.net/ic_soc_arm_robin/article/details/12949347">ã€msm8610 lcd driver code analysisã€‘</a></p>
<h4 id="ï¼ˆä¸ƒï¼‰ã€å‚è€ƒèµ„æ–™-ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º-ï¼š"><a href="#ï¼ˆä¸ƒï¼‰ã€å‚è€ƒèµ„æ–™-ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º-ï¼š" class="headerlink" title="ï¼ˆä¸ƒï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š"></a>ï¼ˆä¸ƒï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š</h4><p><strong>(à¹‘ä¹›â—¡ä¹›à¹‘) ã€ï¼ˆ Í¡Â° ÍœÊ– Í¡Â°ï¼‰ã€ï¼ˆà²¡Ï‰à²¡ï¼‰ï¼ï¼ï¼ç´¯<del>~</del></strong><br><strong>æ—¶è‡³ä»Šæ—¥ï¼Œç»ˆäºå®Œæ•´çš„åˆ†æäº†Android Display System æ€»ä½“æ¡†æ¶æµç¨‹ï¼Œä¸ç¦æ„Ÿå¹è®¡ç®—æœºä¸–ç•Œçš„åšå¤§ç²¾æ·±ï¼Œåœ¨è¿™ä¸ªç³»åˆ—çš„åˆ†æä¸­å†ç»ƒäº†å¦‚ä½•æ‹†è§£åˆ†æä¸€ä¸ªåºå¤§å¤æ‚çš„æ¨¡å—ã€å­¦ä¹ æ”¶è·è‰¯å¤šï¼ŒåŒæ—¶ä¹Ÿäº†è§£äº†è‡ªèº«çŸ¥è¯†çš„æ¬ ç¼ºï¼Œç”±äºæ¶‰åŠçŸ¥è¯†è¾ƒå¤šè¾ƒå¹¿ï¼Œåšä¸»ä¹Ÿæœªèƒ½å®Œå…¨åƒé€ï¼Œå…¶ä¸­åˆ†ææœ‰è¯¯çš„åœ°æ–¹è¿˜è¯·å„ä½è§è°…ã€‚æ‰€è°“è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</strong><br><strong>Todoï¼šä¸“æ³¨äºLinux &amp;&amp; Android Multimediaï¼ˆCameraã€Videoã€Audioã€Displayï¼‰ç³»ç»Ÿåˆ†æä¸ç ”ç©¶ï¼ŒMultimedia System ä»»è¿˜æœ‰è®¸å¤šæœªè§£ä¹‹æƒ‘ï¼Œéœ€æ¶è¡¥Linuxå†…æ ¸çŸ¥è¯†ï¼Œå°‘å¹´ï¼ŒåŠ æ²¹ï¼ˆâ½â½â½ï¼‰</strong></p>
<h4 id="ï¼ˆå…«ï¼‰ã€å‚è€ƒèµ„æ–™-ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º-ï¼š"><a href="#ï¼ˆå…«ï¼‰ã€å‚è€ƒèµ„æ–™-ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º-ï¼š" class="headerlink" title="ï¼ˆå…«ï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š"></a>ï¼ˆå…«ï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š</h4><p><a target="_blank" rel="noopener" href="https://s3.amazonaws.com/connect.linaro.org/bkk16/Presentations/Wednesday/BKK16-315.pdf">Graphics Stack Update</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/eliot_shao/article/details/74926010">é«˜é€šAndroidå¹³å°-åº”ç”¨ç©ºé—´æ“ä½œframebuffer dump LCDæ€»ç»“</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/ic_soc_arm_robin/article/details/12949347">msm8610 lcd driver code analysis</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012719256/article/details/52096727">linux qcom LCD framwork</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weijory/article/details/69391838">Qualcommå¹³å° display bring up è¿‡ç¨‹è¯¦è§£</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/wlwl0071986/article/details/8247443">é«˜é€š8x25å¹³å°displayæ¨¡å—æ€»ç»“</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/sfrysh/article/details/7305253">Android ä¸­çš„ framebuffer</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/yangwen123/article/details/12096483">FrameBufferé©±åŠ¨ç¨‹åºåˆ†æ</a><br><a target="_blank" rel="noopener" href="http://www.wxtlife.com/2017/06/07/Android-framebuffer/">Android Framebufferä»‹ç»åŠä½¿ç”¨</a><br><a target="_blank" rel="noopener" href="https://www.wolfcstech.com/categories/Android-%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F/">Android å›¾å½¢ç³»ç»Ÿ</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">zhoujinjian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://zhoujinjian.com/posts/20180808/">https://zhoujinjian.com/posts/20180808/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://zhoujinjian.com" target="_blank">zhoujinjian</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/Graphics/">Graphics</a><a class="post-meta__tags" href="/tags/Display/">Display</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.23.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/20180908/"><img class="prev-cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.13.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Audio Systemï¼ˆ1ï¼‰ï¼šLinux &amp;&amp; Android Audio ç³»ç»Ÿæ¡†æ¶åˆ†æ</div></div></a></div><div class="next-post pull-right"><a href="/posts/20180708/"><img class="next-cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.22.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Android N Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc &amp;&amp; HWComposeræ¨¡å—åˆ†æ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/20180408/" title="Android N Display Systemï¼ˆ1ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android Graphics ç³»ç»Ÿåˆ†æ"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.07.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-04-08</div><div class="title">Android N Display Systemï¼ˆ1ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android Graphics ç³»ç»Ÿåˆ†æ</div></div></a></div><div><a href="/posts/20180508/" title="Android N Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL && OpenGL"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.20.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-05-08</div><div class="title">Android N Display Systemï¼ˆ2ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Android EGL && OpenGL</div></div></a></div><div><a href="/posts/20180608/" title="Android N Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æ"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-08</div><div class="title">Android N Display Systemï¼ˆ3ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹HardwareRenderer.draw()ç»˜åˆ¶æµç¨‹åˆ†æ</div></div></a></div><div><a href="/posts/20180708/" title="Android N Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc && HWComposeræ¨¡å—åˆ†æ"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/hexo.themes/bing-wallpaper-2018.04.22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-08</div><div class="title">Android N Display Systemï¼ˆ4ï¼‰ï¼šAndroid Display System ç³»ç»Ÿåˆ†æä¹‹Gralloc && HWComposeræ¨¡å—åˆ†æ</div></div></a></div><div><a href="/posts/20210310/" title="Android 10 Display Systemæºç åˆ†æï¼ˆ1ï¼‰ï¼šLCDæ˜¾ç¤ºåŸç†ï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-10</div><div class="title">Android 10 Display Systemæºç åˆ†æï¼ˆ1ï¼‰ï¼šLCDæ˜¾ç¤ºåŸç†ï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰</div></div></a></div><div><a href="/posts/20210410/" title="Android 10 Display Systemæºç åˆ†æï¼ˆ2ï¼‰ï¼šDisplay System ç²¾å½©ä¸–ç•Œï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰"><img class="cover" data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.23.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-10</div><div class="title">Android 10 Display Systemæºç åˆ†æï¼ˆ2ï¼‰ï¼šDisplay System ç²¾å½©ä¸–ç•Œï¼ˆAndroid 10.0 && Kernel 4.15ï¼‰</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%81%E7%9B%B4%E6%8E%A5%E6%93%8D%E4%BD%9Cframebuffer%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%83%8F"><span class="toc-number">1.</span> <span class="toc-text">ï¼ˆä¸€ï¼‰ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E3%80%81%E7%9B%B4%E6%8E%A5%E6%93%8D%E4%BD%9Cframebuffer%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%83%8F"><span class="toc-number">1.1.</span> <span class="toc-text">1.1ã€ç›´æ¥æ“ä½œframebufferæ˜¾ç¤ºå›¾åƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1%E3%80%81%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">1.1.1ã€æºä»£ç </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2%E3%80%81%E7%BC%96%E8%AF%91%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.</span> <span class="toc-text">1.1.2ã€ç¼–è¯‘æµ‹è¯•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3%E3%80%81%E6%98%BE%E7%A4%BA%E6%95%88%E6%9E%9C"><span class="toc-number">1.4.</span> <span class="toc-text">1.1.3ã€æ˜¾ç¤ºæ•ˆæœ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4%E3%80%81%E8%A7%86%E9%A2%91%EF%BC%88%E5%8A%A0%E6%B7%B1%E7%90%86%E8%A7%A3%E3%80%81%E8%87%AA%E2%98%AF%E5%A4%87%E2%98%AF%E6%A2%AF%E2%98%AF%E5%AD%90%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">1.1.4ã€è§†é¢‘ï¼ˆåŠ æ·±ç†è§£ã€è‡ªâ˜¯å¤‡â˜¯æ¢¯â˜¯å­ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5%E3%80%81%E9%A9%B1%E5%8A%A8%E6%80%BB%E4%BD%93%E6%A6%82%E8%A7%88%E5%9B%BE"><span class="toc-number">1.6.</span> <span class="toc-text">1.1.5ã€é©±åŠ¨æ€»ä½“æ¦‚è§ˆå›¾</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E3%80%81FrameBuffer%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">ï¼ˆäºŒï¼‰ã€FrameBufferé©±åŠ¨ç¨‹åºåˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E3%80%81-Framebuffer%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">2.1ã€ Framebufferæ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1%E3%80%81-fb-info"><span class="toc-number">2.2.</span> <span class="toc-text">2.1.1ã€ fb_info</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-2%E3%80%81fb-var-screeninfo"><span class="toc-number">2.3.</span> <span class="toc-text">2.1.2ã€fb_var_screeninfo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-3%E3%80%81fb-fix-screeninfo"><span class="toc-number">2.4.</span> <span class="toc-text">2.1.3ã€fb_fix_screeninfo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E3%80%81Framebuffer%E9%A9%B1%E5%8A%A8%E6%B3%A8%E5%86%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">2.5.</span> <span class="toc-text">2.2ã€Framebufferé©±åŠ¨æ³¨å†Œè¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%81MDP-driver"><span class="toc-number">3.</span> <span class="toc-text">ï¼ˆä¸‰ï¼‰ã€MDP driver</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E3%80%81DSI-controller-driver-%EF%BC%88lcd%E9%A9%B1%E5%8A%A8-dsi%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">ï¼ˆå››ï¼‰ã€DSI controller driver ï¼ˆlcdé©±åŠ¨ dsiï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%94%EF%BC%89%E3%80%81-Panel-driver-%EF%BC%88%E9%9D%A2%E6%9D%BF-dsi%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">ï¼ˆäº”ï¼‰ã€ Panel driver ï¼ˆé¢æ¿ dsiï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1%E3%80%81-dtsi%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="toc-number">5.1.</span> <span class="toc-text">5.1ã€.dtsiæ–‡ä»¶è§£æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2%E3%80%81mdss-mdp-%E5%92%8C-mdss-dsi0-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">5.2.</span> <span class="toc-text">5.2ã€mdss_mdp å’Œ mdss_dsi0 çš„å…³ç³»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3%E3%80%81%E9%80%9A%E8%BF%87%E5%86%85%E6%A0%B8%E6%8E%A5%E5%8F%A3%E6%89%93%E5%BC%80%E5%92%8C%E5%85%B3%E9%97%AD%E6%98%BE%E7%A4%BA%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">5.3ã€é€šè¿‡å†…æ ¸æ¥å£æ‰“å¼€å’Œå…³é—­æ˜¾ç¤ºå™¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-1%E3%80%81%E5%90%AF%E5%8A%A8"><span class="toc-number">5.4.</span> <span class="toc-text">5.3.1ã€å¯åŠ¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-2%E3%80%81%E6%9A%82%E5%81%9C-%E6%81%A2%E5%A4%8D"><span class="toc-number">5.5.</span> <span class="toc-text">5.3.2ã€æš‚åœ&#x2F;æ¢å¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-2-1%E3%80%81%E6%9A%82%E5%81%9C%E5%BA%8F%E5%88%97"><span class="toc-number">5.6.</span> <span class="toc-text">5.3.2.1ã€æš‚åœåºåˆ—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-2-2%E3%80%81%E6%81%A2%E5%A4%8D%E5%BA%8F%E5%88%97"><span class="toc-number">5.7.</span> <span class="toc-text">5.3.2.2ã€æ¢å¤åºåˆ—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-4%E3%80%81%E5%9B%BE%E5%83%8F%E6%9B%B4%E6%96%B0%E5%88%B0%E9%9D%A2%E6%9D%BF"><span class="toc-number">5.8.</span> <span class="toc-text">5.4ã€å›¾åƒæ›´æ–°åˆ°é¢æ¿</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E5%85%AD%EF%BC%89%E3%80%81Msm8610-lcd-driver-%E5%86%85%E6%A0%B8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">ï¼ˆå…­ï¼‰ã€Msm8610  lcd driver å†…æ ¸åˆå§‹åŒ–åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%83%EF%BC%89%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-%E7%89%B9%E5%88%AB%E6%84%9F%E8%B0%A2%E5%90%84%E4%BD%8D%E5%89%8D%E8%BE%88%E7%9A%84%E5%88%86%E6%9E%90%E5%92%8C%E5%9B%BE%E7%A4%BA-%EF%BC%9A"><span class="toc-number">7.</span> <span class="toc-text">ï¼ˆä¸ƒï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E5%85%AB%EF%BC%89%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-%E7%89%B9%E5%88%AB%E6%84%9F%E8%B0%A2%E5%90%84%E4%BD%8D%E5%89%8D%E8%BE%88%E7%9A%84%E5%88%86%E6%9E%90%E5%92%8C%E5%9B%BE%E7%A4%BA-%EF%BC%9A"><span class="toc-number">8.</span> <span class="toc-text">ï¼ˆå…«ï¼‰ã€å‚è€ƒèµ„æ–™(ç‰¹åˆ«æ„Ÿè°¢å„ä½å‰è¾ˆçš„åˆ†æå’Œå›¾ç¤º)ï¼š</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/20240225/" title="Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.64.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº"/></a><div class="content"><a class="title" href="/posts/20240225/" title="Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº">Android 11 Display System V2ï¼ˆ8ï¼‰ï¼šRockchip RK3399 - DRM HDMIé©±åŠ¨ç¨‹åº</a><time datetime="2024-02-24T16:00:00.000Z" title="å‘è¡¨äº 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240224/" title="Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.63.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»"/></a><div class="content"><a class="title" href="/posts/20240224/" title="Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»">Android 11 Display System V2ï¼ˆ7ï¼‰ï¼šRockchip RK3399 - DRM HDMIä»‹ç»</a><time datetime="2024-02-23T16:00:00.000Z" title="å‘è¡¨äº 2024-02-24 00:00:00">2024-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240223/" title="Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.62.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†"/></a><div class="content"><a class="title" href="/posts/20240223/" title="Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†">Android 11 Display System V2ï¼ˆ6ï¼‰ï¼šRockchip RK3399 - DRM encoderã€bridgeã€connectoråŸºç¡€çŸ¥è¯†</a><time datetime="2024-02-22T16:00:00.000Z" title="å‘è¡¨äº 2024-02-23 00:00:00">2024-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240222/" title="Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.61.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"/></a><div class="content"><a class="title" href="/posts/20240222/" title="Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†">Android 11 Display System V2ï¼ˆ5ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†</a><time datetime="2024-02-21T16:00:00.000Z" title="å‘è¡¨äº 2024-02-22 00:00:00">2024-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20240221/" title="Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"><img data-lazy-src="https://raw.githubusercontent.com/zhoujinjianzz/zhoujinjian.com.images/master/post.cover.pictures/bing-wallpaper-2018.04.60.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†"/></a><div class="content"><a class="title" href="/posts/20240221/" title="Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†">Android 11 Display System V2ï¼ˆ4ï¼‰ï¼šRockchip RK3399 - DRM gemåŸºç¡€çŸ¥è¯†</a><time datetime="2024-02-20T16:00:00.000Z" title="å‘è¡¨äº 2024-02-21 00:00:00">2024-02-21</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By zhoujinjian</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/js/fishes.js"></script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>